!function(t,e,i){t.ui=e.extend(t.ui,{fillTemplate:function(e,s){return i(t.ui.formatString(i(e).html(),s).replace(/(<img(\s+.*)?)(\s+jt-src=")/,'$1 src="'))},updateCounter:function(t,e,i){var s=null,n="";return null==e&&(e=0),null==i?(s=/\(([\d\?]+)\)$/,n=""+e):(s=/\(([\d\?]+\/[\d\?\+-]+)\)$/,n=""+e+"/"+i),t.match(s)?t=t.replace(s,"("+n+")"):t+=" ("+n+")",t}}),t.kits={},t.ListWidget=function(t){e.extend(!0,this,e.common(t,this)),this.target=i(t.target),this.length=0,this.clearItems()},t.ListWidget.prototype={itemId:"id",populate:function(t,e){this.items=t,this.length=t.length,this.target.empty();for(var i=0,s=t.length;i<s;i++)this.target.append(this.renderItem("function"==typeof e?e(t[i]):t[i]))},addItem:function(t){return this.items.push(t),++this.length,this.renderItem(t)},clearItems:function(){this.target.empty(),this.items=[],this.length=0},findItem:function(t){var i=this;return e.findIndex(this.items,"string"!=typeof t?t:function(e){return e[i.itemId]===t})},eraseItem:function(t){var e=this.findItem(t),i=e>=0&&this.items.splice(e,1)[0];return this.length=this.items.length,i},enumerateItems:function(t){for(var e=this.target.children(),i=0,s=this.items.length;i<s;++i)t.call(e[i],this.items[i])}},t.TagWidget=function(t){e.extend(!0,this,e.common(t,this)),this.target=i(t.target),this.subtarget&&(this.target=this.target.find(this.subtarget).eq(0)),this.id=t.id,this.color=this.color||this.target.data("color"),this.color&&this.target.addClass(this.color)},t.TagWidget.prototype={__expects:["hasValue","clickHandler"],color:null,renderItem:null,onUpdated:null,subtarget:null,init:function(i){e.pass(this,t.TagWidget,"init",i),this.manager=i},populate:function(t,i){var s,n,a,r=this,o=null,l=0;if(null==t.length||0==t.length)i||this.target.html("No items found in current selection");else{t.sort(function(t,e){return(t.value||t.val)<(e.value||e.val)?-1:1}),i||this.target.empty();for(var h=0,u=t.length;h<u;h++)o=t[h],a=o.value||o.val,n=this.exclusion&&this.hasValue(a),l+=o.count,o.title=a.toString(),"function"==typeof this.modifyTag&&(o=this.modifyTag(o)),n||(o.onMain=r.clickHandler(a)),this.target.append(s=this.renderItem(o)),n&&s.addClass("selected")}e.act(this,this.onUpdated,l)}};var s={facet:!0,rows:0,fl:"id","facet.limit":-1,"facet.mincount":1,"json.nl":"map",echoParams:"none"};t.AutocompleteWidget=function(t){e.extend(!0,this,e.common(t,this)),this.target=i(t.target),this.id=t.id,this.delayed=null,this.fqName=this.useJson?"json.filter":"fq",this.spyManager=new t.SpyManager({parameters:e.extend(!0,s,t.parameters)});var n=this;e.each(t.groups,function(t){n.spyManager.addParameter("facet.field",t.field,e.extend(!0,{key:t.id},t.facet.domain))})},t.AutocompleteWidget.prototype={__expects:["doRequest","addValue"],servlet:"autophrase",useJson:!1,maxResults:30,groups:{},init:function(s){e.pass(this,t.AutocompleteWidget,"init",s),this.manager=s;var n=this;n.findBox=this.target.find("input").on("change",function(t){var e=i(this);n.addValue(e.val())&&!n.requestSent&&(e.blur().autocomplete("disable"),n.manager.doRequest())}),n.findBox.autocomplete({minLength:0,source:function(t,e){n.reportCallback=e,n.makeRequest(t.term,function(t){n.onResponse(t)},function(t,i,s){e(["Err : '"+i+"!"])})},select:function(t,e){e.item&&(n.requestSent=!0,s.getListener(e.item.id).addValue(e.item.value)&&s.doRequest())}})},makeRequest:function(t,i,s){var n=this.manager.getParameter(this.fqName);this.spyManager.removeParameters("fq");for(var a=0,r=n.length;a<r;++a)this.spyManager.addParameter("fq",n[a].value);this.spyManager.addParameter("q",t||"*:*");var o=e.extend(o,this.manager.ajaxSettings,this.spyManager.prepareQuery());return o.url=this.manager.solrUrl+(this.servlet||this.manager.servlet)+o.url+"&wt=json&json.wrf=?",o.success=i,o.error=s,this.manager.connector.ajax(o)},onResponse:function(t){var i=this,s=[];e.each(this.groups,function(e){if(!(s.length>=i.maxResults))for(var n in t.facet_counts.facet_fields[e.id])if(s.push({id:e.id,value:n,label:(lookup[n]||n)+" ("+t.facet_counts.facet_fields[e.id][n]+") - "+e.id}),s.length>=i.maxResults)break}),"function"==typeof this.reportCallback&&i.reportCallback(s)},afterRequest:function(t){var e=this.manager.getParameter("q").value;this.findBox.val("*:*"!=e&&e.length>0?e:"").autocomplete("enable"),this.requestSent=!1}},t.SimpleItemWidget=function(t){e.extend(!0,this,e.common(t,this)),this.target=i(t.target)},t.SimpleItemWidget.prototype={template:null,classes:null,renderItem:function(e){return t.ui.fillTemplate(template,e).addClass(this.classes)}},t.AccordionExpansion=function(t){e.extend(!0,this,e.common(t,this)),this.target=i(t.target),this.header=null,this.id=t.id,this.automatic&&(t.target=this.makeExpansion())},t.AccordionExpansion.prototype={automatic:!0,title:null,classes:null,expansionTemplate:null,before:null,renderExpansion:function(e){return t.ui.fillTemplate(this.expansionTemplate,e).addClass(this.classes)},makeExpansion:function(t,e){if(!this.header){e||(e=this),t||(t=this.before);var s=this.renderExpansion(e);return this.accordion=this.target,t?"number"==typeof t?this.accordion.children().eq(t).before(s):"string"==typeof t?i(t,this.accordion[0]).before(s):i(t).before(s):this.accordion.append(s),this.refresh(),this.header=i("#"+this.id+"_header"),this.target=i("#"+this.id)}},getHeaderText:function(){return this.header.contents().filter(function(){return 3==this.nodeType})[0]},refresh:function(){this.accordion.accordion("refresh")}},t.SliderWidget=function(t){e.extend(!0,this,e.common(t,this)),this.target=i(t.target),this.prepareLimits(t.limits),null==this.initial&&(this.initial=this.isRange?[this.limits[0],this.limits[1]]:(this.limits[0]+this.limits[1])/2),this.target.val(Array.isArray(this.initial)?this.initial.join(","):this.initial),this.automatic&&this.makeSlider()},t.SliderWidget.prototype={__expects:["updateHandler"],limits:null,units:null,initial:null,title:null,width:null,automatic:!0,isRange:!0,showScale:!0,format:"%s {{units}}",prepareLimits:function(t){this.limits="string"==typeof t?t.split(","):t,this.limits[0]=parseFloat(this.limits[0]),this.limits[1]=parseFloat(this.limits[1]),this.precision=Math.pow(10,parseInt(Math.min(1,Math.floor(Math.log10(this.limits[1]-this.limits[0]+1)-3)))),this.precision<1&&this.precision>.01&&(this.precison=.01)},updateSlider:function(t,e){Array.isArray(t)&&(t=t.join(",")),null!=e?(this.prepareLimits(e),this.target.jRange("updateRange",this.limits,t)):this.target.jRange("setValue",t)},makeSlider:function(){var e=this,i=this.limits[1]>this.limits[0],s=[t.ui.formatNumber(this.limits[0],this.precision),this.title+(i||!this.units?"":" ("+this.units+")"),t.ui.formatNumber(this.limits[1],this.precision)],n=e.updateHandler(),a={from:this.limits[0],to:this.limits[1],step:this.precision,scale:s,showScale:this.showScale,showLabels:i,disable:!i,isRange:this.isRange,width:this.width,format:t.ui.formatString(this.format,this)||""};return null!=this.color&&(a.theme="theme-"+this.color),a.ondragend=function(t){return"string"==typeof t&&e.isRange&&(t=t.split(",")),t=Array.isArray(t)?t.map(function(t){return parseFloat(t)}):parseFloat(t),n(t)},this.target.jRange(a)}}}(jToxKit,asSys,jQuery);
