!function(u,c,d){u.ui=d.extend(u.ui,{templates:{},bakeTemplate:function(t,r,s){var e=d(t);return d("*",e).each(function(t,e){var n=null;e.value&&e.value.match(u.templateRegExp)&&(n={value:e.value},e.value=u.formatString(e.value,r,s));for(var a,i=e.attributes,t=0;t<i.length;++t)i[t].specified&&i[t].value.match(u.templateRegExp)&&(null==n&&(n={}),n[i[t].name]=i[t].value,i[t].value=u.formatString(i[t].value,r,s));1!=e.childNodes.length||e.childNodes[0].nodeType!==Node.TEXT_NODE||(a=e.childNodes[0]).textContent.match(u.templateRegExp)&&(null==n&&(n={}),n[""]=a.textContent,a.textContent=u.formatString(a.textContent,r,s)),null!=n&&d(e).addClass("jtox-live-data").data("jtox-live-data",n)}),e},putTemplate:function(t,e,n){var a=u.ui.bakeTemplate(u.ui.templates[t],e);return n?d(a).appendTo(n):a},updateTree:function(t,a,i){d(".jtox-live-data",t).each(function(t,n){d.each(d(n).data("jtox-live-data"),function(t,e){e=u.formatString(e,a,i),""===t?n.innerHTML=e:"value"===t?n.value=e:n.attributes[t]=e})})},fillHtml:function(t,e,n){return u.formatString(u.ui.templates[t],e,n)},getTemplate:function(t,e,n){return d(u.ui.fillHtml(t,e,n))},updateCounter:function(t,e,n){var a=null,i="";return null==e&&(e=0),i=null==n?(a=/\(([\d\?]+)\)$/,""+e):(a=/\(([\d\?]+\/[\d\?\+-]+)\)$/,e+"/"+n),t.match(a)?t=t.replace(a,"("+i+")"):t+=" ("+i+")",t},enterBlur:function(t){13==t.keyCode&&this.blur()},installHandlers:function(s,t,o){t=t||s.rootElement,o=o||s,d(".jtox-handler",t).each(function(){var t,e,n,a=d(this),i=a.data("handler"),r=_.get(s.settings,["handlers",i],null)||o[i]||window[i];r?(t=_.bind(r,s),e=a.data("handlerDelay"),n=a.data("handlerEvent"),null!=e&&(t=_.debounce(t,parseInt(e))),null!=n?a.on(n,t):"INPUT"==this.tagName||"SELECT"==this.tagName||"TEXTAREA"==this.tagName?a.on("change",t).on("keydown",u.ui.enterBlur):a.on("click",t)):console.warn("jToxQuery: referring unknown handler: '"+i+"'")})},shortenedData:function(t,e,n){var a="";return null==n&&(n=t),n.toString().length<=5?a+=t:(a+='<div class="shortened"><span>'+t+'</div><i class="icon fa fa-copy fa-action"',null!=e&&(a+=' title="'+e+'"'),a+=' data-uuid="'+n+'"></i>'),a},linkedData:function(t,e,n){var a="";return null==n&&(n=t),n.toString().length<=5?a+=t:a+=null!=e?a+'<div title="'+e+'">'+t+"</div>":"<div >"+t+"</div>",a},addTab:function(t,e,n,a){if(null==document.getElementById(n)){var i=d("<a>",{href:"#"+n}).html(e);return d("ul",t[0]).append(d("<li>").append(i)),"function"==typeof a?a=d(a(t[0])):"string"==typeof a&&(a=d(a)),a.attr("id",n),t.append(a).tabs("refresh"),{tab:i,content:a}}console.warn("jToxKit: Trying to add a tab ["+e+"] with existing id:"+n)},renderRange:function(t,e,n,a){var i,r,s,o="";return"string"==typeof t||"number"==typeof t?o+="display"!=n?t:(a?a+"&nbsp;=&nbsp;":"")+u.valueAndUnits(t,e):"object"==typeof t&&null!=t?(i=_.trim(t.loValue),r=_.trim(t.upValue),""!=String(i)&&""!=String(r)&&t.upQualifier&&"="!=t.loQualifier?(a&&(o+=a+"&nbsp;=&nbsp;"),o+=">="==t.loQualifier?"[":"(",o+=i+", "+r,o+="<="==t.upQualifier?"]":") "):(s=function(t,e,n){var a="";return t&&(a+=t+" "),e&&(a+=t||"="!=e?e+" ":""),a+n},""!=String(i)?o+=s(a,t.loQualifier||"=",i):""!=String(r)?o+=s(a,t.upQualifier||"=",r):o+=a||("display"==n?"-":"")),o=o.replace(/ /g,"&nbsp;"),"display"==n&&(e=_.trim(t.unit||e))&&(o+='&nbsp;<span class="units">'+e.replace(/ /g,"&nbsp;")+"</span>")):o+="-",o},putStars:function(t,e,n){if(t.settings.shortStars)return'<span class="fa fa-action fa-star jtox-inline" title="'+n+'"></span>'+e;for(var a='<div title="'+n+'">',i=0;i<t.settings.maxStars;++i)a+='<span class="fa fa-star fa-action jtox-inline',e<=i&&(a+=" transparent"),a+='"></span>';return a+"</div>"},renderRelation:function(t,e,n){if("display"!=e)return _.map(t,"relation").join(",");for(var a="",i=0,r=t.length;i<r;++i)a+="<span>"+t[i].relation.substring(4).toLowerCase()+"</span>"+u.ui.fillHtml("info-ball",{href:n.URI+"/composition",title:t[i].compositionName+"("+t[i].compositionUUID+")"});return a},rebindRenderers:function(t,e,n){var a={};for(var i in e){var r=e[i];"function"==typeof r.render&&(n?r.render=_.bind(r.render,t):a[i]=_.defaults({render:_.bind(r.render,t)},r))}return n?e:_.defaults(a,e)},attachEditors:function(r,t,s,o){var a=[].concat(r.settings.loTags,r.settings.hiTags,r.settings.units);field=null,o=o||{},d(".ajax-auto",t).autocomplete({appendTo:t,source:function(t,e){var n=d(this.element).data("id");_.set(o.ajax,o.searchPath,t.term),u.ambit.call(r,d(this.element).data("service"),o.ajax,function(t){e(t?d.map(t.facet,function(t){var e=t[n]||"";return{label:e+(t.count?" ["+t.count+"]":""),value:e}}):[])})},change:function(t,e){var n=d(this).data("id"),a=d(this).data("path")||_.find(r.settings.editors,{id:n}).path,i=e.item?e.item.value:_.trim(this.value);o.onChange&&!1===o.onChange.call(r,t,n,a,i)||_.set(s,a,i)},minLength:r.settings.minLength||0}),d(".tags-auto",t).autocomplete({appendTo:t,change:function(t,e){var n=d(this).data("id"),a=d(this).data("path")||_.find(r.settings.editors,{id:n}).path,i=parseValue(this.value);o.onChange&&!1===o.onChange.call(r,t,n,a,i)||_.set(s,a,i)},source:function(t,e){var n=d.ui.autocomplete.filter(a,extractLast(t.term));""==t.term&&(n=""),e(n)},focus:function(){return!1},select:function(t,e){var n=this.value,a=extractLast(n);return this.value=n.substr(0,n.length-a.length)+e.item.value+" ",!1}}).bind("keydown",function(t){t.keyCode===d.ui.keyCode.TAB&&autoEl.menu.active&&t.preventDefault()}),d(".no-auto",t).on("change",function(t){var e=d(this).data("id"),n=d(this).data("path")||_.find(r.settings.editors,{id:e}).path,a=d(this).val();o.onChange&&!1===o.onChange.call(r,t,e,n,a)||_.set(s,n,a)})}}),u.ui=c.extend(u.ui,{querySettings:{},templateRoot:null,callId:0,initKit:function(e,t){var n=this,a=e.data(),i=a.kit,r={baseUrl:u.formBaseUrl(document.location.href)};if(a.manualInit)return null;c.each(e.parents(".jtox-kit,.jtox-widget").toArray().reverse(),function(t){parent=n.kit(t),null!=parent&&(r=d.extend(r,parent.settings,{baseUrl:parent.baseUrl}))}),(a=d.extend(_.cloneDeep(r),a,t,n.querySettings)).baseUrl=u.fixBaseUrl(a.baseUrl),a.target=e,a.id===undefined&&(a.id=e.attr("id"));var s=function(t){if(!i)return null;var e=window[i];"function"!=typeof e&&(i=i.charAt(0).toUpperCase()+i.slice(1),e=u.ui[i]||u[i]);var n=null;return"function"==typeof e?n=new e(t):"object"==typeof e&&"function"==typeof e.init&&(n=e.init(t)),null!=n?(e.prototype.__kits===undefined&&(e.prototype.__kits=[]),e.prototype.__kits.push(n)):console.log("jToxError: trying to initialize unexistent jTox kit: "+i),n};if(null==a.configFile){var o=a.configuration;"string"==typeof o&&(o=window[o]),"function"==typeof o&&(o=o.call(i,a,i)),"object"==typeof o&&d.extend(!0,a,o),delete a.configuration;var l=s(a);return e.data("jtKit",l),l}d.ajax({settings:"GET",url:a.configFile},function(t){t&&d.extend(!0,a,t),e.data("jtKit",s(a))})},initialize:function(t){var e,n=this;t||(d(document).on("click",".jtox-kit div.shortened + .icon",function(){return u.copyToClipboard(d(this).data("uuid")),!1}),d(document).on("click",".jtox-foldable>.title",function(t){d(this).parent().toggleClass("folded")}),d(document).on("click",".jtox-diagram .icon",function(){d(this).toggleClass("fa-search-plus fa-search-minus"),d("img",this.parentNode).toggleClass("jtox-smalldiagram")}),e=u.parseURL(document.location),n.querySettings=e.params,n.querySettings.baseUrl&&(n.querySettings.baseUrl=u.fixBaseUrl(n.querySettings.baseUrl)),n.fullUrl=e,t=document);var a=function(){n.initKit(d(this))};d(".jtox-kit",t).each(a),d(".jtox-widget",t).each(a)},kit:function(t){return d(t).closest(".jtox-kit,.jtox-widget").data("jtKit")},attachKit:function(t,e){return d(t).data("jtKit",e)}}),u.ListWidget=function(t){c.extend(!0,this,c.common(t,this)),this.target=d(t.target),this.length=0,this.clearItems()},u.ListWidget.prototype={itemId:"id",populate:function(t,e){this.items=t,this.length=t.length,this.target.empty();for(var n=0,a=t.length;n<a;n++)this.target.append(this.renderItem("function"==typeof e?e(t[n]):t[n]))},addItem:function(t){return this.items.push(t),++this.length,this.renderItem(t)},clearItems:function(){this.target.empty(),this.items=[],this.length=0},findItem:function(e){var n=this;return c.findIndex(this.items,"string"!=typeof e?e:function(t){return t[n.itemId]===e})},eraseItem:function(t){var e=this.findItem(t),n=0<=e&&this.items.splice(e,1)[0];return this.length=this.items.length,n},enumerateItems:function(t){for(var e=this.target.children(),n=0,a=this.items.length;n<a;++n)t.call(e[n],this.items[n])}},u.TagWidget=function(t){c.extend(!0,this,c.common(t,this)),this.target=d(t.target),this.subtarget&&(this.target=this.target.find(this.subtarget).eq(0)),this.id=t.id,this.color=this.color||this.target.data("color"),this.color&&this.target.addClass(this.color)},u.TagWidget.prototype={__expects:["hasValue","clickHandler"],color:null,renderItem:null,onUpdated:null,subtarget:null,init:function(t){c.pass(this,u.TagWidget,"init",t),this.manager=t},populate:function(t,e){var n,a,i,r=null,s=0;if(null==t.length||0==t.length)e||this.target.html("No items found in this selection").addClass("jt-no-tags");else{this.target.removeClass("jt-no-tags"),t.sort(function(t,e){return(t.value||t.val)<(e.value||e.val)?-1:1}),e||this.target.empty();for(var o=0,l=t.length;o<l;o++)i=(r=t[o]).value||r.val,a=this.exclusion&&this.hasValue(i),s+=r.count,r.title=i.toString(),"function"==typeof this.modifyTag&&(r=this.modifyTag(r)),a||(r.onMain=this.clickHandler(i)),this.target.append(n=this.renderItem(r)),a&&n.addClass("selected")}c.act(this,this.onUpdated,s)}},u.AutocompleteWidget=function(t){c.extend(!0,this,c.common(t,this)),this.target=d(t.target),this.lookupMap=t.lookupMap||{}},u.AutocompleteWidget.prototype={__expects:["doRequest","onSelect"],tokenMode:!0,init:function(t){var n=this;this.findBox=this.target.find("input").addBack("input").on("change",function(t){var e;n.requestSent||(e=d(this),n.onSelect(e.val())&&e.blur()[n.tokenMode?"tokenfield":"autocomplete"]("disable"))});var e={minLength:0,source:function(t,e){n.reportCallback=e,n.doRequest(t.term)},select:function(t,e){n.requestSent=!1,e.item&&(n.onSelect&&(n.requestSent=n.onSelect(e.item)),n.onAdded&&(n.requestSent=n.requestSent||n.onAdded(e.item)))}};this.tokenMode?this.findBox.on("tokenfield:removedtoken",function(t){n.requestSent=n.onRemoved&&n.onRemoved(t.attrs.value)}).tokenfield({autocomplete:e}):this.findBox.autocomplete(e),c.pass(this,u.AutocompleteWidget,"init",t)},resetValue:function(t){this.findBox.val(t)[this.tokenMode?"tokenfield":"autocomplete"]("enable"),this.requestSent=!1},onFound:function(t){this.reportCallback&&this.reportCallback(t),this.requestSent=!1}},u.SimpleItemWidget=function(t){c.extend(!0,this,c.common(t,this)),this.target=d(t.target)},u.SimpleItemWidget.prototype={template:null,classes:null,renderItem:function(t){return u.ui.getTemplate(template,t).addClass(this.classes)}},u.AccordionExpansion=function(t){c.extend(!0,this,c.common(t,this)),this.target=d(t.target),this.header=null,this.id=t.id,this.automatic&&(t.target=this.makeExpansion())},u.AccordionExpansion.prototype={automatic:!0,title:null,classes:null,expansionTemplate:null,before:null,renderExpansion:function(t){return u.ui.getTemplate(this.expansionTemplate,t).addClass(this.classes)},makeExpansion:function(t,e){if(!this.header){e=e||this,t=t||this.before;var n=this.renderExpansion(e);return this.accordion=this.target,t?"number"==typeof t?this.accordion.children().eq(t).before(n):"string"==typeof t?d(t,this.accordion[0]).before(n):d(t).before(n):this.accordion.append(n),this.refresh(),this.header=d("#"+this.id+"_header"),this.target=d("#"+this.id)}},getHeaderText:function(){return this.header.contents().filter(function(){return 3==this.nodeType})[0]},refresh:function(){this.accordion.accordion("refresh")}},u.SliderWidget=function(t){c.extend(!0,this,c.common(t,this)),this.target=d(t.target),this.prepareLimits(t.limits),null==this.initial&&(this.initial=this.isRange?[this.limits[0],this.limits[1]]:(this.limits[0]+this.limits[1])/2),this.target.val(Array.isArray(this.initial)?this.initial.join(","):this.initial),this.automatic&&this.makeSlider()},u.SliderWidget.prototype={__expects:["updateHandler"],limits:null,units:null,initial:null,title:null,width:null,automatic:!0,isRange:!0,showScale:!0,format:"%s {{units}}",prepareLimits:function(t){this.limits="string"==typeof t?t.split(","):t,this.limits[0]=parseFloat(this.limits[0]),this.limits[1]=parseFloat(this.limits[1]),this.precision=Math.pow(10,parseInt(Math.min(1,Math.floor(Math.log10(this.limits[1]-this.limits[0]+1)-3)))),this.precision<1&&.01<this.precision&&(this.precison=.01)},updateSlider:function(t,e){Array.isArray(t)&&(t=t.join(",")),null!=e?(this.prepareLimits(e),this.target.jRange("updateRange",this.limits,t)):this.target.jRange("setValue",t)},makeSlider:function(){var e=this,t=this.limits[1]>this.limits[0],n=[u.nicifyNumber(this.limits[0],this.precision),this.title+(t||!this.units?"":" ("+this.units+")"),u.nicifyNumber(this.limits[1],this.precision)],a=e.updateHandler(),i={from:this.limits[0],to:this.limits[1],step:this.precision,scale:n,showScale:this.showScale,showLabels:t,disable:!t,isRange:this.isRange,width:this.width,format:u.formatString(this.format,this)||""};return null!=this.color&&(i.theme="theme-"+this.color),i.ondragend=function(t){return"string"==typeof t&&e.isRange&&(t=t.split(",")),t=Array.isArray(t)?t.map(function(t){return parseFloat(t)}):parseFloat(t),a(t)},this.target.jRange(i)}},CurrentSearchWidgeting=function(t){c.extend(!0,this,c.common(t,this)),this.target=t.target,this.id=t.id,this.manager=null,this.facetWidgets={},this.fqName=this.useJson?"json.filter":"fq"},CurrentSearchWidgeting.prototype={useJson:!1,renderItem:null,init:function(t){c.pass(this,CurrentSearchWidgeting,"init",t),this.manager=t},registerWidget:function(t,e){this.facetWidgets[t.id]=e},afterTranslation:function(t){var e=this,n=[],a=this.manager.getParameter("q"),i=this.manager.getAllValues(this.fqName);a.value&&!a.value.match(/^(\*:)?\*$/)&&n.push(e.renderItem({title:a.value,count:"x",onMain:function(){return a.value="",e.manager.doRequest(),!1}}).addClass("tag_fixed"));for(var r=0,s=null!=i?i.length:0;r<s;r++){var o,l=i[r],u=null;for(var c in e.facetWidgets)if(u=(o=e.manager.getListener(c)).fqParse(l))break;if(null!=u){Array.isArray(u)||(u=[u]);for(var d=0,h=u.length;d<h;++d){var p,g=u[d],f="function"==typeof o.prepareTag?o.prepareTag(g):{title:g,count:"x",color:o.color,onMain:o.unclickHandler(g)};n.push(p=e.renderItem(f).addClass("tag_selected "+(f.onAux?"tag_open":"tag_fixed"))),1<h&&p.addClass("tag_combined")}1<h&&p.addClass("tag_last")}}n.length?(n.push(e.renderItem({title:"Clear",onMain:function(){for(var t in a.value="",e.facetWidgets)e.manager.getListener(t).clearValues();return e.manager.doRequest(),!1}}).addClass("tag_selected tag_clear tag_fixed")),this.target.empty().addClass("tags").append(n)):this.target.removeClass("tags").html("<li>No filters selected!</li>")}},u.CurrentSearchWidget=c(CurrentSearchWidgeting),u.Switching=function(t){c.extend(!0,this,c.common(t,u.Switching.prototype));var n=this,e=d(n.switchSelector,d(t.target)[0]),a=_.get(n,n.switchField);"boolean"==typeof a?e[0].checked=a:e.val(a),e.on("change",function(t){var e=d(this).val();c.path(n,n.switchField,"boolean"==typeof a?this.checked||"on"===e:e),c.act(n,n.onSwitching,t),t.stopPropagation()})},u.Switching.prototype={switchSelector:".switcher",switchField:null,onSwitching:null},u.Running=function(t){c.extend(!0,this,c.common(t,u.Running.prototype));var e=this,n=d(e.runSelector,d(t.target)[0]),a=e.runTarget||e;n.on("click",function(t){c.act(a,e.runMethod,this,t),t.stopPropagation()})},u.Running.prototype={runSelector:".switcher",runMethod:null,runTarget:null},u.tables={updateControls:function(t,e){var n,a,i=d(".jtox-controls",this.rootElement);this.settings.showControls?(null==t&&(t=this.settings.pageStart),null==e&&(e=this.settings.pageSize),u.ui.updateTree(i,{pagesize:e,pagestart:0<e?t+1:0,pageend:t+e}),n=d(".jtox-handler[data-handler=nextPage]",i),null==this.entriesCount||t+e<this.entriesCount?d(n).addClass("paginate_enabled_next").removeClass("paginate_disabled_next"):d(n).addClass("paginate_disabled_next").removeClass("paginate_enabled_next"),a=d(".jtox-handler[data-handler=prevPage]",i),0<t?d(a).addClass("paginate_enabled_previous").removeClass("paginate_disabled_previous"):d(a).addClass("paginate_disabled_previous").removeClass("paginate_enabled_previous")):i.hide()},modifyColDef:function(n,t,e,a){if(t.title===undefined||null==t.title)return null;var i=t.title.toLowerCase(),r=function(t){var e=n.settings.columns[t];return null!=e&&(a?null!=(e=e[a])&&(null!=e.visible&&(e[i]=e[i]||{},e[i].visible=!!e[i].visible||!!e.visible),e=e[i]):e=e[i]),null==e&&(e={}),e};return null==(t=d.extend(t,a?r("_"):{},r(e))).visible||t.visible?t:null},sortColDefs:function(t){for(var e=0,n=t.length;e<n;++e)t[e].naturalOrder=e;t.sort(function(t,e){var n=(t.order||0)-(e.order||0);return 0==n&&(n=t.naturalOrder-e.naturalOrder),n})},processColumns:function(t,e){var n=[],a=t.settings.columns[e];for(var i in a){var r=this.modifyColDef(t,a[i],e);null!=r&&n.push(r)}return this.sortColDefs(n),n},renderMulti:function(t,n,a){return"string"==typeof a&&(a=_.property(a)),t.length<2?"<div>"+a(t[0],n)+"</div>":"<table>"+_.map(t,function(t,e){return'<tr class="'+(e%2==0?"even":"odd")+'"><td>'+a(t,n,e)+"</td></tr>"}).join("")+"</table>"},getTable:function(t){return d(t).closest("table.dataTable").DataTable()},getRowData:function(t){var e=this.getTable(t),n=d(t).closest("tr")[0];return e&&e.row(n).data()},getCellData:function(t){var e=this.getTable(t),n=d(t).closest("td")[0];return e&&e.cell(n).data()},putTable:function(a,t,e,n){var i=a.settings.onRow;i===undefined&&null!=n&&(i=n.onRow);var r=d.extend({paging:!1,processing:!0,lengthChange:!1,autoWidth:!1,dom:a.settings.dom||"rt<Fip>",language:a.settings.oLanguage,serverSide:!1,createdRow:function(t,e,n){if("function"==typeof i&&!1===u.fireCallback(i,a,t,e,n))return;u.tables.equalizeHeights.apply(window,d("td.jtox-multi table tbody",t).toArray()),u.ui.installHandlers(a,t,u.tables.commonHandlers)}},n);null==r.columns&&(r.columns=u.tables.processColumns(a,e)),null==r.language&&delete r.language;var s=d(t).dataTable(r);return d(s).DataTable().columns.adjust(),s},insertRenderer:function(t,s,o){o=o||{};var l=t.render,e=l?function(t,e,n){var a=l(t,e,n),i=s(t,e,n),r=o.separator||"";return Array.isArray(i)&&(i=i.join(r)),"before"===o.position?i+r+a:a+r+i}:s;return Array.isArray(s)&&(s=_.over(s)),o.inplace?t.render=e:t=d.extend({},t,{render:e}),t},getDetailsRenderer:function(t,e){var n='<i class="jtox-details-open fa fa-folder jtox-handler" data-handler="'+(e||"toggleDetails")+'" title="Press to open/close detailed info for this '+t+'"></i>';return function(t,e){return"display"===e?n:t}},getSelectionRenderer:function(a,i){return function(t,e,n){return"display"!==e?t:'<input type="checkbox" value="'+t+'" class="jtox-selection jtox-handler" data-handler="'+(i||"toggleSelection")+'" title="Add this '+(a||"entry")+' to the selection"/>'}},equalizeHeights:function(){for(var t=[],e=0;e<arguments.length;++e)t[e]=arguments[e].firstElementChild;for(;;){for(var n=0,e=0;e<t.length;++e)null!=t[e]&&(d(t[e]).hasClass("lock-height")||""==t[e].style.height||(t[e].style.height="auto"),t[e].offsetHeight>n&&(n=t[e].offsetHeight));if(0==n)break;for(e=0;e<t.length;++e)null!=t[e]&&(d(t[e]).height(n),t[e]=t[e].nextElementSibling)}},extractTables:function(t,e){var n,a={transpose:!1,ignoreCols:null},i=0,r=null,s=null;return a instanceof d?e=t:"boolean"==typeof t?a.transpose=t:a=t,e.map(function(t,e){return null==r?(r=d(e).clone(),s=d("tr",r),void(null!=a.ignoreCols&&d(a.ignoreCols,r).remove())):void d("tr",e).each(function(t,e){var n=d(e).children();null!=a.ignoreCols&&(n=n.not(a.ignoreCols)),n.clone().appendTo(s[t]),i=Math.max(i,s[t].children.length)})}),d(".fa.jtox-handler",r).remove(),a.transpose&&(0==i&&s.each(function(t,e){i=Math.max(i,e.children.length)}),n=_.times(i,function(t){return document.createElement("tr")}),s.each(function(t,e){d(e).children().each(function(t,e){d(e).appendTo(n[t])})}),r.empty().append(n)),r.html()},commonHandlers:{nextPage:function(){(null==this.entriesCount||this.pageStart+this.pageSize<this.entriesCount)&&this.queryEntries(this.pageStart+this.pageSize)},prevPage:function(){0<this.pageStart&&this.queryEntries(this.pageStart-this.pageSize)},toggleDetails:function(t){var e=d(t.target),n=e.closest("tr")[0],a=e.closest("td")[0];if(e.toggleClass("fa-folder fa-folder-open jtox-openned"),e.hasClass("jtox-openned")){var i=document.createElement("tr"),r=document.createElement("td");return i.appendChild(r),d(r).addClass("jtox-details"),r.setAttribute("colspan",d(n).children().length-1),n.parentNode.insertBefore(i,n.nextElementSibling),a.setAttribute("rowspan","2"),u.fireCallback(this.settings.onDetails,this,r,u.tables.getRowData(n),e[0])}return a.removeAttribute("rowspan"),d(d(n).next()).remove(),null}}},u.ambit={processEntry:function(t,e,n){for(var a in n=n||defaultSettings.fnAccumulate,t.values){var i=e[a];if(i){var r=t.values[a];if(i.accumulate&&r&&i.data){var s="function"==typeof i.accumulate?i.accumulate:n,o=i.data;d.isArray(o)||(o=[o]);for(var l=0;l<o.length;++l)_.set(t,o[l],u.fireCallback(s,this,a,_.get(t,o[l]),r,e))}}}return t},extractFeatures:function(t,e,n){var a=[];for(var i in e){var r=d.extend({},e[i]);r.value=t.values[i],r.title&&!1!==u.fireCallback(n,null,r,i,a.length)&&(r.value||(r.value="-"),a.push(r))}return a},parseFeatureId:function(t){var e=t.match(/(https?\:\/\/.*)\/property\/([^\/]+)\/([^\/]+)\/(.+)/);return null==e?null:{baseUri:e[1],topcategory:e[2].replace("+"," "),category:e[3].replace("+"," "),suffix:e[4]}},buildFeatureId:function(t,e){return t.baseUri+"/property/"+t.topcategory.replace(" ","+")+"/"+t.category.replace(" ","+")+"/"+t.suffix},diagramUri:function(t){return t&&"string"==typeof t?t.replace(/(.+)(\/conformer.*)/,"$1")+"?media=image/png":""},enumSameAs:function(t,e,n){for(var a=e[t],i=t.replace(/(http.+\/feature\/).*/g,"$1"),r=t;u.fireCallback(n,null,a,r),null!=a.sameAs&&a.sameAs!=t&&t!=i+a.sameAs;){if(e[a.sameAs]!==undefined)r=a.sameAs;else{if(e[i+a.sameAs]===undefined)break;r=i+a.sameAs}a=e[r]}return r},processFeatures:function(t,e){for(var n in null==e&&(e=u.ambit.baseFeatures),t=d.extend(t,e)){var a=t[n];a.URI||(a.URI=n),this.enumSameAs(n,t,function(t,e){var n=t.sameAs;t=d.extend(!0,t,a),a=d.extend(!0,a,t),t.sameAs=n})}return t},processDataset:function(t,e,n,a){e||(this.processFeatures(t.feature),e=t.feature),n=n||defaultSettings.fnAccumulate,a=a||0;for(var i=0,r=t.dataEntry.length;i<r;++i)this.processEntry(t.dataEntry[i],e,n),t.dataEntry[i].number=i+1+a,t.dataEntry[i].index=i;return t},getDatasetValue:function(t,e,n){return _.compact(_.union(e,null!=n?n.trim().toLowerCase().split("|"):[n]))},getDiagramUri:function(t){return t&&"string"==typeof t?t.replace(/(.+)(\/conformer.*)/,"$1")+"?media=image/png":""},grabPaging:function(t,e){var n,a,i=u.parseURL(e);return i.params.pagesize!==undefined&&(0<(n=parseInt(i.params.pagesize))&&(t.settings.pageSize=t.pageSize=n),e=u.removeParameter(e,"pagesize")),i.params.page!==undefined&&(0<=(a=parseInt(i.params.page))&&(t.settings.pageStart=t.pageStart=a*t.settings.pageSize),e=u.removeParameter(e,"page")),e},call:function(a,i,t,r){"function"==typeof t&&(r=t,t=undefined);var e=(o=d.extend(!0,{},a.settings.ajaxSettings,t)).plainText?"text/plain":o.jsonp?"application/x-javascript":"application/json";o.data?o.method||(o.method="POST"):(o.jsonp&&(o.data={media:e}),o.method||(o.method="GET")),o.dataType||(o.dataType=o.plainText?"text":o.jsonp?"jsonp":"json"),o.type||(o.type=o.method),0!=i.indexOf("http")&&(i=a.settings.baseUrl+i);var s=self.callId++,o=d.extend(o,{url:i,headers:{Accept:e},crossDomain:o.crossDomain||o.jsonp,timeout:parseInt(o.timeout),jsonp:!!o.jsonp&&"callback",error:function(t,e,n){u.fireCallback(o.onError,a,i,e,t,s),u.fireCallback(r,a,null,t)},success:function(t,e,n){u.fireCallback(o.onSuccess,a,i,e,n,s),u.fireCallback(r,a,t,n)}});u.fireCallback(o.onConnect,a,o,s),d.ajax(o)},taskPoller:function(n,a,i,r){var s=null,o=null;return null==r&&(r=5e3),null==i&&(i=250),o=function(t,e){if(null==t||null==t.task||t.task.length<1)a(t,e);else if(-1<(t=t.task[0]).completed||t.error)a(t,e);else{if(null==s)s=Date.now();else if(Date.now()-s>r)return void a(t,e);setTimeout(function(){u.ambit.call(n,t.result,{method:"GET"},o)},i)}}},baseFeatures:{"http://www.opentox.org/api/1.1#REACHRegistrationDate":{title:"REACH Date",data:"compound.reachdate",accumulate:!0,basic:!0},"http://www.opentox.org/api/1.1#CASRN":{title:"CAS",data:"compound.cas",accumulate:!0,basic:!0,primary:!0},"http://www.opentox.org/api/1.1#ChemicalName":{title:"Name",data:"compound.name",accumulate:!0,basic:!0},"http://www.opentox.org/api/1.1#TradeName":{title:"Trade Name",data:"compound.tradename",accumulate:!0,basic:!0},"http://www.opentox.org/api/1.1#IUPACName":{title:"IUPAC Name",data:["compound.name","compound.iupac"],accumulate:!0,basic:!0},"http://www.opentox.org/api/1.1#EINECS":{title:"EINECS",data:"compound.einecs",accumulate:!0,basic:!0,primary:!0},"http://www.opentox.org/api/1.1#InChI":{title:"InChI",data:"compound.inchi",shorten:!0,accumulate:!0,basic:!0},"http://www.opentox.org/api/1.1#InChI_std":{title:"InChI",data:"compound.inchi",shorten:!0,accumulate:!0,sameAs:"http://www.opentox.org/api/1.1#InChI",basic:!0},"http://www.opentox.org/api/1.1#InChIKey":{title:"InChI Key",data:"compound.inchikey",accumulate:!0,basic:!0},"http://www.opentox.org/api/1.1#InChIKey_std":{title:"InChI Key",data:"compound.inchikey",accumulate:!0,sameAs:"http://www.opentox.org/api/1.1#InChIKey",basic:!0},"http://www.opentox.org/api/1.1#InChI_AuxInfo":{title:"InChI Aux",data:"compound.inchiaux",accumulate:!0,basic:!0},"http://www.opentox.org/api/1.1#InChI_AuxInfo_std":{title:"InChI Aux",data:"compound.inchiaux",accumulate:!0,sameAs:"http://www.opentox.org/api/1.1#InChI_AuxInfo",basic:!0},"http://www.opentox.org/api/1.1#IUCLID5_UUID":{title:"IUCLID5 UUID",data:"compound.i5uuid",shorten:!0,accumulate:!0,basic:!0,primary:!0},"http://www.opentox.org/api/1.1#SMILES":{title:"SMILES",data:"compound.smiles",shorten:!0,accumulate:!0,basic:!0},"http://www.opentox.org/api/dblinks#CMS":{title:"CMS",accumulate:!0,basic:!0},"http://www.opentox.org/api/dblinks#ChEBI":{title:"ChEBI",accumulate:!0,basic:!0},"http://www.opentox.org/api/dblinks#Pubchem":{title:"PubChem",accumulate:!0,basic:!0},"http://www.opentox.org/api/dblinks#ChemSpider":{title:"ChemSpider",accumulate:!0,basic:!0},"http://www.opentox.org/api/dblinks#ChEMBL":{title:"ChEMBL",accumulate:!0,basic:!0},"http://www.opentox.org/api/dblinks#ToxbankWiki":{title:"Toxbank Wiki",accumulate:!0,basic:!0},"http://www.opentox.org/api/1.1#Diagram":{title:"Diagram",search:!1,visibility:"main",primary:!0,data:"compound.URI",column:{className:"paddingless",width:"125px"},render:function(t,e,n){return dUri=u.ambit.getDiagramUri(t),"display"!=e?dUri:'<div class="jtox-diagram borderless"><i class="icon fa fa-search-plus jtox-handler" data-handler="alignTables" data-handler-delay="50"></i><a target="_blank" href="'+t+'"><img src="'+dUri+'" class="jtox-smalldiagram"/></a></div>'}},"#IdRow":{used:!0,basic:!0,data:"number",column:{className:"center"},render:function(t,e,n){return"display"!=e?t:"&nbsp;-&nbsp;"+t+"&nbsp;-&nbsp;"}},"#DetailedInfoRow":{title:"InfoRow",search:!1,data:"compound.URI",basic:!0,primary:!0,visibility:"none",column:{className:"jtox-hidden jtox-ds-details paddingless",width:"0px"},render:function(t,e,n){return""}}},formatters:{extIdentifiers:function(t){for(var e="",n=0;n<t.length;++n){0<n&&(e+="<br/>");var a=t[n].id;try{a.startsWith("http")&&(a="<a href='"+a+"' target=_blank class='qxternal'>"+a+"</a>")}catch(i){}e+=t[n].type+"&nbsp;=&nbsp;"+a}return e},formatDate:function(t){var e=new Date(t),n=e.getDate(),a=e.getMonth()+1;return(n<10?"0":"")+n+"."+(a<10?"0":"")+a+"."+e.getFullYear()},formatConcentration:function(t){var e=t.value;return null==e&&(e=t.lowerValue,null!=t.upperValue&&(e=e+"-"+t.upperValue)),u.valueAndUnits(null==e?"?":e,t.unit||"%&nbsp;(w/w)")}}}}(jToxKit,asSys,jQuery);