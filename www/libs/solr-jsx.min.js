/** SolrJsX library - a neXt, lightweight Solr queries JavaScript library. Copyright Â© 2016-2019, IDEAConsult Ltd. All rights reserved. @license MIT.*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("as-sys"),require("lodash")):"function"==typeof define&&define.amd?define(["as-sys","lodash"],t):(e=e||self).Solr=t(e.asSys,e._)}(this,(function(e,t){"use strict";var a=/^\s*\(\s*|\s*\)\s*$/g,r=/^([^()]+)\(([^)]+)\)$/g,n={version:"1.0.0",escapeValue:e=>("string"!=typeof e&&(e=e.toString()),!e.match(/[ :\/"]/)||e.match(/[\[\{]\S+ TO \S+[\]\}]/)||e.match(/^["\(].*["\)]$/)?e:'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'),escapeField:e=>e.replace(/\s/g,"\\$&"),parseParameter(e){var t={},a=e.match(/^([^=]+)=(?:\{!([^\}]*)\})?(.*)$/);if(a){if(null!=a[2])for(var r;r=/([^\s=]+)=?(\S*)?/g.exec(a[2]);)t.domain===undefined&&(t.domain={}),null==r[2]?t.domain.type=r[1]:t.domain[r[1]]=r[2],a[2]=a[2].replace(r[0],"");t.name=a[1];var n=a[3].split(",");t.value=n.length>1?n:a[3]}return t},facetValue:e=>Array.isArray(e)?1==e.length?Solr.escapeValue(e[0]):"("+e.map((function(e){return Solr.escapeValue(e)})).join(" ")+")":Solr.escapeValue(e),parseFacet(e){var t,r;if(r=e.length>(e=e.replace(a,"")).length,t=e.replace(/\\"/g,"%0022").match(/[^\s:\/"]+|"[^"]+"/g),!r&&t.length>1)return null;for(var n=0,i=t.length;n<i;++n)t[n]=t[n].replace(/^"|"$/g,"").replace("%0022",'"');return i>1?t:t[0]},facetStats(e,t,a){e.addParameter("stats",!0);var n={};_.each(a,(function(e,a){var i=e.match(r);if(i){var s=i[2],u=i[1],o=n[s];o===undefined&&(n[s]=o={},o.tag=t),o[u]=!0,o.key=a}})),_.each(n,(function(t,a){e.addParameter("stats.field",a,t)}))},stringifyDomain(e){var t=[];return _.each(e.domain,(function(e,a){t.push(("type"!==a?a+"=":"")+e)})),t.length>0?"{!"+t.join(" ")+"}":""},stringifyValue(e){var t=e.value||"";if(Array.isArray(t))return t.join(",");if("object"!=typeof t)return t.toString();var a=[];return _.each(t,(function(e,t){a.push(Solr.escapeField(t)+":"+Solr.escapeValue(e))})),a.join(" ")},stringifyParameter(e){var t=Solr.stringifyDomain(e);return e.value||t?e.name+"="+encodeURIComponent(t+Solr.stringifyValue(e)):null},buildUrl(e,t,a){var r=(e||"")+(t||""),n=a.join("&");return r+(r.indexOf("?")>0?"&":"?")+n}},paramIsMultiple=function(e){return e.match(/^(?:bf|bq|facet\.date|facet\.date\.other|facet\.date\.include|facet\.field|facet\.pivot|facet\.range|facet\.range\.other|facet\.range\.include|facet\.query|fq|fl|json\.query|json\.filter|group\.field|group\.func|group\.query|pf|qf|stats\.field)$/)};function Configuring(t){this.parameterHistory=[],e.setup(this,t),this.resetParameters(),this.mergeParameters(t&&t.parameters)}function Compatibility(t){e.setup(this,t),this.store.root=this}function QueryingURL(t){e.setup(this,t)}Configuring.prototype={addParameter:function(a,r,n){var i;if("object"!=typeof a?(i=a,a={name:a,value:r},null!=n&&(a.domain=n)):i=a.name,paramIsMultiple(i))if(this.parameterStore[i]===undefined)this.parameterStore[i]=[a];else{var s=!1;if(t.each(this.parameterStore[i],(function(t){s=s||e.equal(!0,a,t)})),s)return!1;this.parameterStore[i].push(a)}else this.parameterStore[i]=a;return a},findParameters:function(a,r){var n,i=[];return this.parameterStore[a]!==undefined&&("function"==typeof r?n=function(e,t){r(e,t)&&i.push(t)}:null==r?n=function(e,t){i.push(t)}:(("object"!=typeof r||r instanceof RegExp||Array.isArray(r))&&(r={value:r}),n=function(t,a){e.similar(t,r)&&i.push(a)}),t.each(paramIsMultiple(a)?this.parameterStore[a]:[this.parameterStore[a]],n)),i},removeParameters:function(e,t){if(this.parameterStore[e]!==undefined){if("number"==typeof t?t=[t]:Array.isArray(t)||(t=this.findParameters(e,t)),paramIsMultiple(e)&&t.length!=this.parameterStore[e].length){t.sort((function(e,t){return e<t?-1:e>t?1:0}));for(var a=t.length-1;a>=0;--a)this.parameterStore[e].splice(t[a],1)}else delete this.parameterStore[e];return t.length}return!1},getParameter:function(e,t){var a=paramIsMultiple(e);return this.parameterStore[e]===undefined?a&&null==t?[]:{name:e}:null!=t&&a?this.parameterStore[e][t]:this.parameterStore[e]},getAllValues:function(e){var t=null;return this.parameterStore[e]!==undefined&&(t=paramIsMultiple(e)?this.parameterStore[e].map((function(e){return e.value})):this.parameterStore[e].value),t},mergeParameters:function(e){var a=this;t.each(e,(function(e,t){"string"==typeof e?a.addParameter(n.parseParameter(t+"="+e)):a.addParameter(t,e)}))},enumerateParameters:function(e,a){"boolean"!=typeof e&&(a=e,e=!0),t.each(this.parameterStore,(function(r){e&&Array.isArray(r)?t.each(r,a):r!==undefined&&a(r)}))},resetParameters:function(){this.parameterStore={}},pushParameters:function(e){this.parameterHistory.push(this.parameterStore),this.parameterStore="object"==typeof e?e:!1===e?{}:t.merge({},this.parameterStore)},popParameters:function(){var e=this.parameterStore;return this.parameterStore=this.parameterHistory.pop(),e}},Compatibility.prototype={store:{addByValue:function(e,t,a){return this.root.addParameter(e,t,a)},removeByValue:function(e,t){return this.root.removeParameters(e,indices)},find:function(e,t){return this.root.findParameters(e,neddle)}}},QueryingURL.prototype={__expects:["enumerateParameters"],serverUrl:null,servlet:"select",prepareQuery:function(e){var t=[];return this.enumerateParameters((function(e){var a=n.stringifyParameter(e);null!=a&&t.push(a)})),{url:n.buildUrl(this.serverUrl,e||this.servlet,t)}},parseResponse:function(e){return e}};function QueryingJson(t){e.setup(this,t)}function Persisting(t){e.setup(this,t),this.storage={}}function Paging(t){e.setup(this,t),this.manager=null,this.currentPage=this.totalPages=this.totalEntries=null}function Eventing(t){e.setup(this,t),this.manager=null}function Spying(t){e.setup(this,t),this.manager=null}function Patterning(e){this.valuePattern=e&&e.valuePattern||this.valuePattern;var a=this.fqRegExp.toString().replace(/^\/\^?|\$?\/$/g,""),r="^"+t.escapeRegExp(this.valuePattern.replace(/\{\{!?-\}\}/g,"-?").replace("{{v}}","__v__")).replace("__v__",a).replace("--?","-?").replace("--","");this.fqRegExp=new RegExp(r)}function Texting(t){e.setup(this,t),this.manager=null}QueryingJson.prototype={__expects:["enumerateParameters"],useBody:!0,servlet:"select",serverUrl:null,prepareQuery:function(){var e=[],a={params:{}},paramValue=function(a){if(!a.name.match(/^(json\.nl|json\.wrf|q|wt|start)/)){return"string"==typeof a.value?n.stringifyDomain(a)+a.value:a.domain!==undefined?t.extend({},a.value,{domain:a.domain}):a.value}e.push(n.stringifyParameter(a))};return this.enumerateParameters(!1,(function(e){var r=Array.isArray(e)?e.map(paramValue):paramValue(e),n=Array.isArray(e)?e[0].name:e.name,i=function(e){var t=e.match(/^json\.?(.*)/);return t&&t[1]}(n);r!=undefined&&(null!==i?t.set(a,i,r):a.params[n]=r)})),a=JSON.stringify(a),this.useBody?{url:n.buildUrl(this.serverUrl,this.servlet,e),data:a,contentType:"application/json",type:"POST",method:"POST"}:(e.push(encodeURIComponent(a)),{url:n.buildUrl(this.serverUrl,this.servlet,e)})},parseResponse:function(e){if(e.responseHeader.params&&null!=e.responseHeader.params.json){var a=JSON.parse(e.responseHeader.params.json);t.extend(e.responseHeader.params,a,a.params),delete e.responseHeader.params.json}return e}},Persisting.prototype={persistentParams:[],addParameter:function(t,a,r){return e.pass(this,"addParameter",Solf.Configuring,t,a,r),t},removeParameters:function(t){e.pass(this,"removeParameters",Solf.Configuring,t)},onPrepare:function(e){}},Paging.prototype={pageSize:20,domain:null,init:function(e){this.manager=e,this.manager.addParameter("rows",this.pageSize)},setPage:function(e){return null!=this.totalPages&&("next"===e||">"===e?e=this.currentPage+1:"prev"===e||"previous"===e||"<"===e?e=this.currentPage-1:"first"===e||"start"===e?e=1:"last"===e||"end"===e?e=this.totalPages:"number"!=typeof e&&(e=parseInt(e)),!(e>this.totalPages||e<1||e===this.currentPage)&&(this.currentPage=e,this.manager.addParameter("start",(e-1)*this.pageSize,this.domain)))},page:function(e){return e!==undefined&&this.setPage(e),this.currentPage},previousPage:function(){return this.currentPage>1?this.currentPage-1:null},nextPage:function(){return this.currentPage<this.totalPages?this.currentPage+1:null},afterResponse:function(){var e=parseInt(this.manager.response.responseHeader&&this.manager.response.responseHeader.params&&this.manager.response.responseHeader.params.start||this.manager.getParameter("start").value||0);this.pageSize=parseInt(this.manager.response.responseHeader&&this.manager.response.responseHeader.params&&this.manager.response.responseHeader.params.rows||this.manager.getParameter("rows").value||this.pageSize),this.totalEntries=parseInt(this.manager.response.response.numFound),this.currentPage=Math.floor(e/this.pageSize)+1,this.totalPages=Math.ceil(this.totalEntries/this.pageSize)},clickHandler:function(e){var t=this;return function(){return t.setPage(e)&&t.manager.doRequest(),!1}}},Eventing.prototype={resetPage:!0,customResponse:null,init:function(t){e.pass(this,Eventing,"init",t),this.manager=t},doRequest:function(){this.resetPage&&this.manager.addParameter("start",0),this.manager.doRequest(self.customResponse)},updateHandler:function(){var e=this,t=arguments;return function(){var a=e.addValue.apply(e,t);return a&&e.doRequest(),a}},clickHandler:function(){var e=this,t=arguments;return function(a){return e.addValue.apply(e,t)&&e.doRequest(),!1}},unclickHandler:function(){var e=this,t=arguments;return function(a){return e.removeValue.apply(e,t)&&e.doRequest(),!1}}},Spying.prototype={servlet:null,init:function(t){e.pass(this,Spying,"init",t),this.manager=t},doSpying:function(e,a){var r=this.manager;r.pushParameters(!0),"function"==typeof e?e(r):t.each(e,(function(e,a){null==e?r.removeParameters(a):Array.isArray(e)?t.each(e,(function(e){r.addParameter(a,e)})):"object"==typeof e?r.addParameter(e):r.addParameter(a,e)})),r.doRequest(this.servlet,a||this.onSpyResponse),r.popParameters()}},Patterning.prototype={valuePattern:"{{-}}{{v}}",fqValue:function(e,t){return this.valuePattern.replace("{{-}}",t?"-":"").replace("{{!-}}",t?"":"-").replace("{{v}}",a$.pass(this,Solr.Patterning,"fqValue",e,t)).replace("--","")}},Texting.prototype={__expects:["doRequest"],domain:null,escapeNeedle:!1,init:function(t){e.pass(this,Texting,"init",t),this.manager=t},addValue:function(t){var a=this.escapeNeedle&&t?t.replace(/\s+/g,"\\ "):t,r=this.manager.getParameter("q"),n=this.manager.addParameter("q",a,this.domain);return after=this.manager.getParameter("q"),n&&!e.equal(r,after)},clear:function(){return this.manager.removeParameters("q")},removeValue:function(){this.clear()},clickHandler:function(e){var t=this;return function(){return el||(el=this),t.addValue("function"==typeof el.val?el.val():el.value)&&t.doRequest(),!1}}};var i={prefix:null,sort:null,limit:null,offset:null,mincount:null,missing:null,method:null,"enum.cache.minDf":null};function Faceting(t){this.id=this.field=null,e.setup(this,t),this.manager=null,this.multivalue||(this.aggregate=!1),this.jsonLocation||(this.jsonLocation="json.facet."+this.id),this.facet=t&&t.facet||{},this.fqRegExp=new RegExp("^-?"+n.escapeField(this.field).replace("\\","\\\\")+":([^]+)$")}function Ranging(a){this.field=this.id=null,e.setup(this,a),this.manager=null,this.fqRegExp=new RegExp("^-?"+n.escapeField(this.field).replace("\\","\\\\")+":\\s*\\[\\s*([^\\s])+\\s+TO\\s+([^\\s])+\\s*\\]"),this.fqName=this.useJson?"json.filter":"fq",this.exclusion&&(this.domain=t.merge(this.domain,{tag:this.id+"_tag"}))}function Pivoting(t){e.setup(this,t),this.manager=null,this.faceters={},this.id=t.id,this.settings=t,this.rootId=null}function Listing(t){e.setup(this,t),this.manager=null}function RawAdapter(t){e.setup(this,t)}function NestedAdapter(e){this.nestingField=e&&e.nestingField||"type_s"}return Faceting.prototype={multivalue:!1,aggregate:!1,exclusion:!1,domain:null,nesting:null,useJson:!1,jsonLocation:null,domain:null,statistics:null,init:function(a){e.pass(this,Faceting,"init",a),this.manager=a;var r=null;if(this.nesting&&(this.facet.domain=t.extend({blockChildren:this.nesting},this.facet.domain)),this.exclusion&&(this.domain=t.extend(this.domain,{tag:this.id+"_tag"}),r=this.id+"_tag"),this.useJson){var s={type:"terms",field:this.field,mincount:1,limit:-1};this.statistics&&(s.facet=this.statistics),null!=r&&(s.domain={excludeTags:r}),this.fqName="json.filter",this.manager.addParameter(this.jsonLocation,t.merge(s,this.facet))}else{var u=this,o=t.merge({},i),l={key:this.id};null!=r&&(l.ex=r),this.fqName="fq",this.manager.addParameter("facet",!0),this.facet.date!==undefined?(this.manager.addParameter("facet.date",this.field,l),t.extend(o,{"date.start":null,"date.end":null,"date.gap":null,"date.hardend":null,"date.other":null,"date.include":null})):this.facet.range!==undefined?(this.manager.addParameter("facet.range",this.field,l),t.extend(o,{"range.start":null,"range.end":null,"range.gap":null,"range.hardend":null,"range.other":null,"range.include":null})):(this.facet.field=!0,this.statistics&&(l.stats=this.id+"_stats",n.facetStats(this.manager,l.stats,this.statistics)),this.manager.addParameter("facet.field",this.field,l)),o=e.common(this.facet,o),t.each(o,(function(e,t){u.manager.addParameter("f."+n.escapeField(u.field)+".facet."+t,e)}))}},addValue:function(e,t){var a;if(this.multivalue||this.clearValues(),!this.aggregate||!(a=this.manager.findParameters(this.fqName,this.fqRegExp)).length)return this.manager.addParameter(this.fqName,this.fqValue(e,t),this.domain);var r=this.manager.getParameter(this.fqName,a[0]),n=this.fqParse(r.value),i=!1;Array.isArray(e)||(e=[e]);for(var s,u=0,o=e.length;u<o;++u)n!=(s=e[u])&&(Array.isArray(n)&&n.indexOf(s)>=0||("string"==typeof n&&(n=[n]),n.push(s),i=!0));return!!i&&(r.value=this.fqValue(n,t),!0)},removeValue:function(e){if(this.multivalue){var t=this,a=!1;return this.manager.removeParameters(this.fqName,(function(r){var i,s;return!!r.value.match(t.fqRegExp)&&(t.aggregate?(i=t.fqParse(r.value),Array.isArray(e)||(e=[e]),Array.isArray(i)?!(i=i.filter((function(t){return-1==e.indexOf(t)||(a=!0,!1)}))).length||(1==i.length&&(i=i[0]),r.value=t.fqValue(i),!1):(a=a||(s=e.indexOf(i)>=0),s)):(a=a||(s=r.value.indexOf(n.facetValue(e))>=0),s))})),a}return this.clearValues()},hasValue:function(e){for(var t,a=this.manager.findParameters(this.fqName,this.fqRegExp),r=0,n=a.length;r<n;++r)if(t=this.manager.getParameter(this.fqName,a[r]),this.fqParse(t.value).indexOf(e)>-1)return!0;return!1},getValues:function(){for(var e,t,a=this.manager.findParameters(this.fqName,this.fqRegExp),r=[],n=0,i=a.length;n<i;++n)t=this.manager.getParameter(this.fqName,a[n]),e=this.fqParse(t.value),Array.isArray(e)?Array.prototype.push.apply(r,e):r.push(e);return r},clearValues:function(){return this.manager.removeParameters(this.fqName,this.fqRegExp)},getFacetCounts:function(e){var t;if(!0===this.useJson)return null==e&&(e=this.manager.response.facets),e.count>0?e[this.id].buckets:[];if(null==e&&(e=this.manager.response.facet_counts),this.facet.field!==undefined?t="facet_fields":this.facet.date!==undefined?t="facet_dates":this.facet.range!==undefined&&(t="facet_ranges"),t!==undefined)switch(this.manager.getParameter("json.nl").value){case"map":return this.getFacetCountsMap(e,t);case"arrarr":return this.getFacetCountsArrarr(e);default:return this.getFacetCountsFlat(e)}throw'Cannot get facet counts unless one of the following properties is set to "true" on widget "'+this.id+'": "facet.field", "facet.date", or "facet.range".'},getFacetCountsMap:function(e,t){var a=[];for(var r in e[t][this.id])a.push({val:r,count:parseInt(e[t][this.id][r])});return a},getFacetCountsArrarr:function(e,t){for(var a=[],r=0,n=e[t][this.id].length;r<n;r++)a.push({val:e[t][this.id][r][0],count:parseInt(e[t][this.id][r][1])});return a},getFacetCountsFlat:function(e,t){for(var a=[],r=0,n=e[t][this.id].length;r<n;r+=2)a.push({val:e[t][this.id][r],count:parseInt(e[t][this.id][r+1])});return a},fqValue:function(e,t){return(t?"-":"")+n.escapeField(this.field)+":"+n.facetValue(e)},fqParse:function(e){var t=e.match(this.fqRegExp);return null!=t?n.parseFacet(t[1]):null}},Ranging.prototype={multirange:!1,exclusion:!1,domain:null,useJson:!1,domain:null,init:function(t){e.pass(this,Ranging,"init",t),this.manager=t},addValue:function(e,t){return this.clearValues(),this.manager.addParameter(this.fqName,this.fqValue(e,t),this.domain)},removeValue:function(e){return this.clearValues()},hasValue:function(e){return null!=this.manager.findParameters(this.fqName,this.fqRegExp)},clearValues:function(){return this.manager.removeParameters(this.fqName,this.fqRegExp)},fqValue:function(e,t){return(t?"-":"")+n.escapeField(this.field)+":"+function rangeValue(e){return Array.isArray(e)?"["+n.escapeValue(e[0]||"*")+" TO "+n.escapeValue(e[1]||"*")+"]":n.escapeValue(e)}(e)},fqParse:function(e){var t=e.match(this.fqRegExp);return t?(t.shift(),t):null}},Pivoting.prototype={pivot:null,useJson:!1,statistics:null,domain:null,addFaceter:function(e,t){return new Faceting(e)},init:function(a){e.pass(this,Solr.Pivoting,"init",a),this.manager=a;var r=this.statistics;if(!this.useJson){var n={};r&&(n.stats=this.id+"_stats",Solr.facetStats(this.manager,n.stats,r),r=null),this.exclusion&&(n.ex=this.id+"_tag"),this.manager.addParameter("facet.pivot",this.pivot.map((function(e){return"string"==typeof e?e:e.field})).join(","),n)}for(var i="json",s=0,u=this.pivot.length;s<u;++s){var o=this.pivot[s],l=t.merge({},this.settings,"string"==typeof o?{id:o,field:o,disabled:!0}:o);i+=".facet."+l.id,this.useJson&&(l.jsonLocation=i),null==this.rootId&&(this.rootId=l.id),l.exclusion=!1,null==o.nesting&&s>0&&delete l.nesting,l.statistics=r,(this.faceters[l.id]=this.addFaceter(l,s)).init(a)}},getPivotEntry:function(e){var t=this.pivot[e];return t===undefined?null:"object"==typeof t?t:{id:t,field:t}},getFaceterEntry:function(e){var t=this.pivot[e];return this.faceters["string"==typeof t?t:t.id]},getPivotCounts:function(e){if(!0===this.useJson)return null==e&&(e=this.manager.response.facets),e.count>0?e[this.rootId].buckets:[];throw null==e&&(e=this.manager.response.pivot),{error:"Not supported for now!"}},addValue:function(e,t){var a=this.parseValue(e);return this.faceters[a.id].addValue(a.value,t)},removeValue:function(e){var t=this.parseValue(e);return this.faceters[t.id].removeValue(t.value)},clearValues:function(){t.each(this.faceters,(function(e){e.clearValues()}))},hasValue:function(e){var t=this.parseValue(e);return null!=t.id&&this.faceters[t.id].hasValue(t.value)},parseValue:function(e){var t=e.match(/^(\w+):(.+)$/);return t&&this.faceters[t[1]]!==undefined?{value:t[2],id:t[1]}:{value:e}},fqParse:function(e){var t=this.parseValue(e),a=null;if(null!=t.id)a=this.faceters[t.id].fqParse(t.value);else for(var r in this.faceters)if(a=this.faceters[r].fqParse(t.value)){t.id=r;break}return Array.isArray(a)?a=a.map((function(e){return t.id+":"+e})):null!=a&&(a=t.id+":"+a),a}},Listing.prototype={nestingRules:null,nestingField:null,nestLevel:null,listingFields:["*"],init:function(a){if(e.pass(this,Listing,"init",a),null!=this.nestLevel){var r=this.nestingRules[this.nestLevel],n=r.field||this.nestingField,i=this.nestingRules[r.parent]&&this.nestingRules[r.parent].field||this.nestingField;a.addParameter("fl","[child parentFilter="+i+":"+r.parent+" childFilter="+n+":"+this.nestLevel+" limit="+r.limit+"]")}t.each(this.listingFields,(function(e){a.addParameter("fl",e)}))}},RawAdapter.prototype={collapseRules:{study:{fields:/topcategory[_sh]*|endpointcategory[_sh]*|guidance[_sh]*|reference[_sh]*|reference_owner[_sh]*|reference_year[_sh]*|guidance[_sh]*/},composition:{fields:/CORE|COATING|CONSTITUENT|ADDITIVE|IMPURITY|FUNCTIONALISATION|DOPING/}},init:function(t){e.pass(this,RawAdapter,"init",t)},parseResponse:function(a){for(var r=[],n=this,i=e.pass(this,RawAdapter,"parseResponse",a)||a,filterProps=function(e,a){t.each(n.collapseRules,(function(r,n){var i={};t.each(a,(function(e,t){t.match(r.fields)&&(delete a[t],Array.isArray(e)&&1==e.length&&(e=e[0]),i[t]=e)})),e._extended_===undefined&&(e._extended_={}),e._extended_[n]===undefined?e._extended_[n]=[i]:e._extended_[n].push(i)})),t.each(a,(function(t,a){Array.isArray(t)&&1==t.length&&(t=t[0]),e[a]=t}))},s=0,u=i.response.docs.length;s<u;++s){var o=i.response.docs[s],l=i.expanded[o.s_uuid],h={};filterProps(h,o);for(var f=0,c=l.docs.length;f<c;++f)filterProps(h,l.docs[f]);r.push(h)}return{entries:r,stats:t.extend({},i.stats,i.responseHeader),facets:t.extend({},i.facet_counts.facet_fields||i.facets,i.facet_counts.facet_pivot),paging:{start:i.response.start,count:i.response.docs.length,total:i.response.numFound,pageSize:parseInt(i.responseHeader.params.rows)}}}},NestedAdapter.prototype={init:function(t){e.pass(this,NestedAdapter,"init",t)},parseResponse:function(a){for(var r=e.pass(this,NestedAdapter,"parseResponse",a)||a,n=r.response.docs,i=0,s=n.length;i<s;++i){var u=n[i],o={};if(u._childDocuments_){for(var l=0,h=u._childDocuments_.length;l<h;++l){var f=u._childDocuments_[l],c=f[this.nestingField];o[c]===undefined&&(o[c]=[]),o[c].push(f)}delete u._childDocuments_,u._extended_=o}}return{entries:n,stats:t.extend({},r.stats,r.responseHeader),facets:r.facets,paging:{start:r.response.start,count:r.response.docs.length,total:r.response.numFound,pageSize:parseInt(r.responseHeader.params.rows)}}}},n.Configuring=Configuring,n.Compatibility=Compatibility,n.QueryingURL=QueryingURL,n.QueryingJson=QueryingJson,n.Persisting=Persisting,n.Paging=Paging,n.Eventing=Eventing,n.Spying=Spying,n.Patterning=Patterning,n.Texting=Texting,n.Faceting=Faceting,n.Ranging=Ranging,n.Pivoting=Pivoting,n.Listing=Listing,n.RawAdapter=RawAdapter,n.NestedAdapter=NestedAdapter,n}));