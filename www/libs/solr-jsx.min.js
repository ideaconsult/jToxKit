/** SolrJsX library - a neXt, lightweight Solr queries JavaScript library. Copyright Â© 2016-2019, IDEAConsult Ltd. All rights reserved. @license MIT.*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("as-sys"),require("lodash")):"function"==typeof define&&define.amd?define(["as-sys","lodash"],t):(e=e||self).Solr=t(e.asSys,e._)}(this,(function(e,t){"use strict";var r=/^\s*\(\s*|\s*\)\s*$/g,a=/^([^()]+)\(([^)]+)\)$/g,n={version:"1.0.1",escapeValue:e=>("string"!=typeof e&&(e=e.toString()),!e.match(/[ :\/"]/)||e.match(/[\[\{]\S+ TO \S+[\]\}]/)||e.match(/^["\(].*["\)]$/)?e:'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'),escapeField:e=>e.replace(/\s/g,"\\$&"),parseParameter(e){var t={},r=e.match(/^([^=]+)=(?:\{!([^\}]*)\})?(.*)$/);if(r){if(null!=r[2])for(var a;a=/([^\s=]+)=?(\S*)?/g.exec(r[2]);)t.domain===undefined&&(t.domain={}),null==a[2]?t.domain.type=a[1]:t.domain[a[1]]=a[2],r[2]=r[2].replace(a[0],"");t.name=r[1];var n=r[3].split(",");t.value=n.length>1?n:r[3]}return t},facetValue:e=>Array.isArray(e)?1==e.length?Solr.escapeValue(e[0]):"("+e.map((function(e){return Solr.escapeValue(e)})).join(" ")+")":Solr.escapeValue(e),parseFacet(e){var t,a;if(a=e.length>(e=e.replace(r,"")).length,t=e.replace(/\\"/g,"%0022").match(/[^\s:\/"]+|"[^"]+"/g),!a&&t.length>1)return null;for(var n=0,i=t.length;n<i;++n)t[n]=t[n].replace(/^"|"$/g,"").replace("%0022",'"');return i>1?t:t[0]},facetStats(e,t,r){e.addParameter("stats",!0);var n={};_.each(r,(function(e,r){var i=e.match(a);if(i){var s=i[2],o=i[1],u=n[s];u===undefined&&(n[s]=u={},u.tag=t),u[o]=!0,u.key=r}})),_.each(n,(function(t,r){e.addParameter("stats.field",r,t)}))},stringifyDomain(e){var t=[];return _.each(e.domain,(function(e,r){t.push(("type"!==r?r+"=":"")+e)})),t.length>0?"{!"+t.join(" ")+"}":""},stringifyValue(e){var t=e.value||"";if(Array.isArray(t))return t.join(",");if("object"!=typeof t)return t.toString();var r=[];return _.each(t,(function(e,t){r.push(Solr.escapeField(t)+":"+Solr.escapeValue(e))})),r.join(" ")},stringifyParameter(e){var t=Solr.stringifyDomain(e);return e.value||t?e.name+"="+encodeURIComponent(t+Solr.stringifyValue(e)):null}},paramIsMultiple=function(e){return e.match(/^(?:bf|bq|facet\.date|facet\.date\.other|facet\.date\.include|facet\.field|facet\.pivot|facet\.range|facet\.range\.other|facet\.range\.include|facet\.query|fq|fl|json\.query|json\.filter|group\.field|group\.func|group\.query|pf|qf|stats\.field)$/)};function Configuring(e){this.parameterHistory=[],this.resetParameters(),this.mergeParameters(e&&e.parameters)}Configuring.prototype.addParameter=function(r,a,n){var i;if("object"!=typeof r?(i=r,r={name:r,value:a},null!=n&&(r.domain=n)):i=r.name,paramIsMultiple(i))if(this.parameterStore[i]===undefined)this.parameterStore[i]=[r];else{var s=!1;if(t.each(this.parameterStore[i],(function(t){s=s||e.equal(!0,r,t)})),s)return!1;this.parameterStore[i].push(r)}else this.parameterStore[i]=r;return r},Configuring.prototype.findParameters=function(r,a){var n,i=[];return this.parameterStore[r]!==undefined&&("function"==typeof a?n=function(e,t){a(e,t)&&i.push(t)}:null==a?n=function(e,t){i.push(t)}:(("object"!=typeof a||a instanceof RegExp||Array.isArray(a))&&(a={value:a}),n=function(t,r){e.similar(t,a)&&i.push(r)}),t.each(paramIsMultiple(r)?this.parameterStore[r]:[this.parameterStore[r]],n)),i},Configuring.prototype.removeParameters=function(e,t){if(this.parameterStore[e]!==undefined){if("number"==typeof t?t=[t]:Array.isArray(t)||(t=this.findParameters(e,t)),paramIsMultiple(e)&&t.length!=this.parameterStore[e].length){t.sort((function(e,t){return e<t?-1:e>t?1:0}));for(var r=t.length-1;r>=0;--r)this.parameterStore[e].splice(t[r],1)}else delete this.parameterStore[e];return t.length}return!1},Configuring.prototype.getParameter=function(e,t){var r=paramIsMultiple(e);return this.parameterStore[e]===undefined?r&&null==t?[]:{name:e}:null!=t&&r?this.parameterStore[e][t]:this.parameterStore[e]},Configuring.prototype.getAllValues=function(e){var t=null;return this.parameterStore[e]!==undefined&&(t=paramIsMultiple(e)?this.parameterStore[e].map((function(e){return e.value})):this.parameterStore[e].value),t},Configuring.prototype.mergeParameters=function(e){var r=this;t.each(e,(function(e,t){"string"==typeof e?r.addParameter(n.parseParameter(t+"="+e)):r.addParameter(t,e)}))},Configuring.prototype.enumerateParameters=function(e,r){"boolean"!=typeof e&&(r=e,e=!0),t.each(this.parameterStore,(function(a){e&&Array.isArray(a)?t.each(a,r):a!==undefined&&r(a)}))},Configuring.prototype.resetParameters=function(){this.parameterStore={}},Configuring.prototype.pushParameters=function(e){this.parameterHistory.push(this.parameterStore),this.parameterStore="object"==typeof e?e:!1===e?{}:t.merge({},this.parameterStore)},Configuring.prototype.popParameters=function(){var e=this.parameterStore;return this.parameterStore=this.parameterHistory.pop(),e};var i={store:{addByValue:function(e,t,r){return this.root.addParameter(e,t,r)},removeByValue:function(e,t){return this.root.removeParameters(e,indices)},find:function(e,t){return this.root.findParameters(e,neddle)}}};var s={serverUrl:null,servlet:"select"};function QueryingURL(t){e.setup(this,s,t)}QueryingURL.prototype.__expects=["enumerateParameters","buildUrl"],QueryingURL.prototype.prepareQuery=function(e){var t=[];return this.enumerateParameters((function(e){var r=n.stringifyParameter(e);null!=r&&t.push(r)})),{url:this.buildUrl(e||this.servlet,t)}},QueryingURL.prototype.parseResponse=function(e){return e};var o={useBody:!0,servlet:"select",serverUrl:null};function QueryingJson(t){e.setup(this,o,t)}QueryingJson.prototype.__expects=["enumerateParameters","buildUrl"],QueryingJson.prototype.prepareQuery=function(){var e=[],r={params:{}},paramValue=function(r){if(!r.name.match(/^(json\.nl|json\.wrf|q|wt|start)/)){return"string"==typeof r.value?n.stringifyDomain(r)+r.value:r.domain!==undefined?t.extend({},r.value,{domain:r.domain}):r.value}e.push(n.stringifyParameter(r))};return this.enumerateParameters(!1,(function(e){var a=Array.isArray(e)?e.map(paramValue):paramValue(e),n=Array.isArray(e)?e[0].name:e.name,i=function(e){var t=e.match(/^json\.?(.*)/);return t&&t[1]}(n);a!=undefined&&(null!==i?t.set(r,i,a):r.params[n]=a)})),r=JSON.stringify(r),this.useBody?{url:this.buildUrl(this.servlet,e),data:r,contentType:"application/json",type:"POST",method:"POST"}:(e.push(encodeURIComponent(r)),{url:this.buildUrl(this.servlet,e)})},QueryingJson.prototype.parseResponse=function(e){if(e.responseHeader.params&&null!=e.responseHeader.params.json){var r=JSON.parse(e.responseHeader.params.json);t.extend(e.responseHeader.params,r,r.params),delete e.responseHeader.params.json}return e};var u={persistentParams:[]};function Persisting(e){this.persistentParams=e&&e.persistentParams||u.persistentParams,this.storage={}}Persisting.prototype.addParameter=function(t,r,a){return e.pass(this,"addParameter",Solf.Configuring,t,r,a),t},Persisting.prototype.removeParameters=function(t){e.pass(this,"removeParameters",Solf.Configuring,t)},Persisting.prototype.onPrepare=function(e){};var l={pageSize:20,domain:null};function Paging(t){e.setup(this,l,t),this.manager=null,this.currentPage=this.totalPages=this.totalEntries=null}Paging.prototype.init=function(e){this.manager=e,this.manager.addParameter("rows",this.pageSize)},Paging.prototype.setPage=function(e){return null!=this.totalPages&&("next"===e||">"===e?e=this.currentPage+1:"prev"===e||"previous"===e||"<"===e?e=this.currentPage-1:"first"===e||"start"===e?e=1:"last"===e||"end"===e?e=this.totalPages:"number"!=typeof e&&(e=parseInt(e)),!(e>this.totalPages||e<1||e===this.currentPage)&&(this.currentPage=e,this.manager.addParameter("start",(e-1)*this.pageSize,this.domain)))},Paging.prototype.page=function(e){return e!==undefined&&this.setPage(e),this.currentPage},Paging.prototype.previousPage=function(){return this.currentPage>1?this.currentPage-1:null},Paging.prototype.nextPage=function(){return this.currentPage<this.totalPages?this.currentPage+1:null},Paging.prototype.afterResponse=function(e,t,r){var a=t.responseJSON,n=parseInt(a.responseHeader&&a.responseHeader.params&&a.responseHeader.params.start||this.manager.getParameter("start").value||0);this.pageSize=parseInt(a.responseHeader&&a.responseHeader.params&&a.responseHeader.params.rows||this.manager.getParameter("rows").value||this.pageSize),this.totalEntries=parseInt(a.response.numFound),this.currentPage=Math.floor(n/this.pageSize)+1,this.totalPages=Math.ceil(this.totalEntries/this.pageSize)},Paging.prototype.clickHandler=function(e){var t=this;return function(){return t.setPage(e)&&t.manager.doRequest(),!1}};var p={servlet:null,resetPage:!0,privateRequest:!1,customResponse:null};function Eventing(t){e.setup(this,p,t),this.manager=null}Eventing.prototype.__expects=["addValue","removeValue"],Eventing.prototype.init=function(t){e.pass(this,Eventing,"init",t),this.manager=t},Eventing.prototype.doRequest=function(){this.resetPage&&this.manager.addParameter("start",0),this.manager.doRequest(this.servlet,self.privateRequest,self.customResponse)},Eventing.prototype.updateHandler=function(){var e=this,t=arguments;return function(){var r=e.addValue.apply(e,t);return r&&e.doRequest(),r}},Eventing.prototype.clickHandler=function(){var e=this,t=arguments;return function(r){return e.addValue.apply(e,t)&&e.doRequest(),!1}},Eventing.prototype.unclickHandler=function(){var e=this,t=arguments;return function(r){return e.removeValue.apply(e,t)&&e.doRequest(),!1}};var f={valuePattern:"{{-}}{{v}}"};function Patterning(e){this.valuePattern=e&&e.valuePattern||f.valuePattern;var r=this.fqRegExp.toString().replace(/^\/\^?|\$?\/$/g,""),a="^"+t.escapeRegExp(this.valuePattern.replace(/\{\{!?-\}\}/g,"-?").replace("{{v}}","__v__")).replace("__v__",r).replace("--?","-?").replace("--","");this.fqRegExp=new RegExp(a)}Patterning.prototype.fqValue=function(e,t){return this.valuePattern.replace("{{-}}",t?"-":"").replace("{{!-}}",t?"":"-").replace("{{v}}",a$.pass(this,Solr.Patterning,"fqValue",e,t)).replace("--","")};var h={domain:null,escapeNeedle:!1};function Texting(t){e.setup(this,h,t),this.manager=null}Texting.prototype.__expects=["doRequest"],Texting.prototype.init=function(t){e.pass(this,Texting,"init",t),this.manager=t},Texting.prototype.addValue=function(t){var r=this.escapeNeedle&&t?t.replace(/\s+/g,"\\ "):t,a=this.manager.getParameter("q"),n=this.manager.addParameter("q",r,this.domain),i=this.manager.getParameter("q");return n&&!e.equal(a,i)},Texting.prototype.clear=function(){return this.manager.removeParameters("q")},Texting.prototype.removeValue=function(){this.clear()},Texting.prototype.clickHandler=function(e){var t=this;return function(){return el||(el=this),t.addValue("function"==typeof el.val?el.val():el.value)&&t.doRequest(),!1}};var c={prefix:null,sort:null,limit:null,offset:null,mincount:null,missing:null,method:null,"enum.cache.minDf":null},g={multivalue:!1,aggregate:!1,exclusion:!1,domain:null,nesting:null,useJson:!1,jsonLocation:null,domain:null,statistics:null};function Faceting(t){e.setup(this,g,t),this.id=t.id,this.field=t.field,this.manager=null,this.multivalue||(this.aggregate=!1),this.jsonLocation||(this.jsonLocation="json.facet."+this.id),this.facet=t&&t.facet||{},this.fqRegExp=new RegExp("^-?"+n.escapeField(this.field).replace("\\","\\\\")+":([^]+)$")}Faceting.prototype.init=function(r){e.pass(this,Faceting,"init",r),this.manager=r;var a=null;if(this.nesting&&(this.facet.domain=t.extend({blockChildren:this.nesting},this.facet.domain)),this.exclusion&&(this.domain=t.extend(this.domain,{tag:this.id+"_tag"}),a=this.id+"_tag"),this.useJson){var i={type:"terms",field:this.field,mincount:1,limit:-1};this.statistics&&(i.facet=this.statistics),null!=a&&(i.domain={excludeTags:a}),this.fqName="json.filter",this.manager.addParameter(this.jsonLocation,t.merge(i,this.facet))}else{var s=this,o=t.merge({},c),u={key:this.id};null!=a&&(u.ex=a),this.fqName="fq",this.manager.addParameter("facet",!0),this.facet.date!==undefined?(this.manager.addParameter("facet.date",this.field,u),t.extend(o,{"date.start":null,"date.end":null,"date.gap":null,"date.hardend":null,"date.other":null,"date.include":null})):this.facet.range!==undefined?(this.manager.addParameter("facet.range",this.field,u),t.extend(o,{"range.start":null,"range.end":null,"range.gap":null,"range.hardend":null,"range.other":null,"range.include":null})):(this.facet.field=!0,this.statistics&&(u.stats=this.id+"_stats",n.facetStats(this.manager,u.stats,this.statistics)),this.manager.addParameter("facet.field",this.field,u)),o=e.common(this.facet,o),t.each(o,(function(e,t){s.manager.addParameter("f."+n.escapeField(s.field)+".facet."+t,e)}))}},Faceting.prototype.addValue=function(e,t){var r;if(this.multivalue||this.clearValues(),!this.aggregate||!(r=this.manager.findParameters(this.fqName,this.fqRegExp)).length)return this.manager.addParameter(this.fqName,this.fqValue(e,t),this.domain);var a=this.manager.getParameter(this.fqName,r[0]),n=this.fqParse(a.value),i=!1;Array.isArray(e)||(e=[e]);for(var s,o=0,u=e.length;o<u;++o)n!=(s=e[o])&&(Array.isArray(n)&&n.indexOf(s)>=0||("string"==typeof n&&(n=[n]),n.push(s),i=!0));return!!i&&(a.value=this.fqValue(n,t),!0)},Faceting.prototype.removeValue=function(e){if(this.multivalue){var t=this,r=!1;return this.manager.removeParameters(this.fqName,(function(a){var i,s;return!!a.value.match(t.fqRegExp)&&(t.aggregate?(i=t.fqParse(a.value),Array.isArray(e)||(e=[e]),Array.isArray(i)?!(i=i.filter((function(t){return-1==e.indexOf(t)||(r=!0,!1)}))).length||(1==i.length&&(i=i[0]),a.value=t.fqValue(i),!1):(r=r||(s=e.indexOf(i)>=0),s)):(r=r||(s=a.value.indexOf(n.facetValue(e))>=0),s))})),r}return this.clearValues()},Faceting.prototype.hasValue=function(e){for(var t,r=this.manager.findParameters(this.fqName,this.fqRegExp),a=0,n=r.length;a<n;++a)if(t=this.manager.getParameter(this.fqName,r[a]),this.fqParse(t.value).indexOf(e)>-1)return!0;return!1},Faceting.prototype.getValues=function(){for(var e,t,r=this.manager.findParameters(this.fqName,this.fqRegExp),a=[],n=0,i=r.length;n<i;++n)t=this.manager.getParameter(this.fqName,r[n]),e=this.fqParse(t.value),Array.isArray(e)?Array.prototype.push.apply(a,e):a.push(e);return a},Faceting.prototype.clearValues=function(){return this.manager.removeParameters(this.fqName,this.fqRegExp)},Faceting.prototype.getFacetCounts=function(e){var t;if(!e)return[];if(!0===this.useJson)return e.count>0?e[this.id].buckets:[];if(this.facet.field!==undefined?t="facet_fields":this.facet.date!==undefined?t="facet_dates":this.facet.range!==undefined&&(t="facet_ranges"),t!==undefined)switch(this.manager.getParameter("json.nl").value){case"map":return this.getFacetCountsMap(e,t);case"arrarr":return this.getFacetCountsArrarr(e);default:return this.getFacetCountsFlat(e)}throw'Cannot get facet counts unless one of the following properties is set to "true" on widget "'+this.id+'": "facet.field", "facet.date", or "facet.range".'},Faceting.prototype.getFacetCountsMap=function(e,t){var r=[];for(var a in e[t][this.id])r.push({val:a,count:parseInt(e[t][this.id][a])});return r},Faceting.prototype.getFacetCountsArrarr=function(e,t){for(var r=[],a=0,n=e[t][this.id].length;a<n;a++)r.push({val:e[t][this.id][a][0],count:parseInt(e[t][this.id][a][1])});return r},Faceting.prototype.getFacetCountsFlat=function(e,t){for(var r=[],a=0,n=e[t][this.id].length;a<n;a+=2)r.push({val:e[t][this.id][a],count:parseInt(e[t][this.id][a+1])});return r},Faceting.prototype.fqValue=function(e,t){return(t?"-":"")+n.escapeField(this.field)+":"+n.facetValue(e)},Faceting.prototype.fqParse=function(e){var t=e.match(this.fqRegExp);return null!=t?n.parseFacet(t[1]):null};var d={multirange:!1,exclusion:!1,domain:null,useJson:!1,domain:null};function Ranging(r){e.setup(this,d,r),this.id=r.id,this.field=r.field,this.manager=null,this.fqRegExp=new RegExp("^-?"+n.escapeField(this.field).replace("\\","\\\\")+":\\s*\\[\\s*([^\\s])+\\s+TO\\s+([^\\s])+\\s*\\]"),this.fqName=this.useJson?"json.filter":"fq",this.exclusion&&(this.domain=t.merge(this.domain,{tag:this.id+"_tag"}))}Ranging.prototype.init=function(t){e.pass(this,Ranging,"init",t),this.manager=t},Ranging.prototype.addValue=function(e,t){return this.clearValues(),this.manager.addParameter(this.fqName,this.fqValue(e,t),this.domain)},Ranging.prototype.removeValue=function(e){return this.clearValues()},Ranging.prototype.hasValue=function(e){return null!=this.manager.findParameters(this.fqName,this.fqRegExp)},Ranging.prototype.clearValues=function(){return this.manager.removeParameters(this.fqName,this.fqRegExp)},Ranging.prototype.fqValue=function(e,t){return(t?"-":"")+n.escapeField(this.field)+":"+function rangeValue(e){return Array.isArray(e)?"["+n.escapeValue(e[0]||"*")+" TO "+n.escapeValue(e[1]||"*")+"]":n.escapeValue(e)}(e)},Ranging.prototype.fqParse=function(e){var t=e.match(this.fqRegExp);return t?(t.shift(),t):null};var m={pivot:null,useJson:!1,statistics:null,domain:null};function Pivoting(t){e.setup(this,m,t),this.manager=null,this.faceters={},this.id=t.id,this.settings=t,this.rootId=null}Pivoting.prototype.addFaceter=function(e,t){return new Faceting(e)},Pivoting.prototype.init=function(r){e.pass(this,Solr.Pivoting,"init",r),this.manager=r;var a=this.statistics;if(!this.useJson){var n={};a&&(n.stats=this.id+"_stats",Solr.facetStats(this.manager,n.stats,a),a=null),this.exclusion&&(n.ex=this.id+"_tag"),this.manager.addParameter("facet.pivot",this.pivot.map((function(e){return"string"==typeof e?e:e.field})).join(","),n)}for(var i="json",s=0,o=this.pivot.length;s<o;++s){var u=this.pivot[s],l=t.merge({},this.settings,"string"==typeof u?{id:u,field:u,disabled:!0}:u);i+=".facet."+l.id,this.useJson&&(l.jsonLocation=i),null==this.rootId&&(this.rootId=l.id),l.exclusion=!1,null==u.nesting&&s>0&&delete l.nesting,l.statistics=a,(this.faceters[l.id]=this.addFaceter(l,s)).init(r)}},Pivoting.prototype.getPivotEntry=function(e){var t=this.pivot[e];return t===undefined?null:"object"==typeof t?t:{id:t,field:t}},Pivoting.prototype.getFaceterEntry=function(e){var t=this.pivot[e];return this.faceters["string"==typeof t?t:t.id]},Pivoting.prototype.getPivotCounts=function(e){if(e){if(!0===this.useJson)return e.count>0?e[this.rootId].buckets:[];throw{error:"Not supported for now!"}}return[]},Pivoting.prototype.addValue=function(e,t){var r=this.parseValue(e);return this.faceters[r.id].addValue(r.value,t)},Pivoting.prototype.removeValue=function(e){var t=this.parseValue(e);return this.faceters[t.id].removeValue(t.value)},Pivoting.prototype.clearValues=function(){t.each(this.faceters,(function(e){e.clearValues()}))},Pivoting.prototype.hasValue=function(e){var t=this.parseValue(e);return null!=t.id&&this.faceters[t.id].hasValue(t.value)},Pivoting.prototype.parseValue=function(e){var t=e.match(/^(\w+):(.+)$/);return t&&this.faceters[t[1]]!==undefined?{value:t[2],id:t[1]}:{value:e}},Pivoting.prototype.fqParse=function(e){var t=this.parseValue(e),r=null;if(null!=t.id)r=this.faceters[t.id].fqParse(t.value);else for(var a in this.faceters)if(r=this.faceters[a].fqParse(t.value)){t.id=a;break}return Array.isArray(r)?r=r.map((function(e){return t.id+":"+e})):null!=r&&(r=t.id+":"+r),r};var v={nestingRules:null,nestingField:null,nestLevel:null,listingFields:["*"]};function Listing(t){e.setup(this,v,t),this.manager=null}Listing.prototype.init=function(r){if(e.pass(this,Listing,"init",r),null!=this.nestLevel){var a=this.nestingRules[this.nestLevel],n=a.field||this.nestingField,i=this.nestingRules[a.parent]&&this.nestingRules[a.parent].field||this.nestingField;r.addParameter("fl","[child parentFilter="+i+":"+a.parent+" childFilter="+n+":"+this.nestLevel+" limit="+a.limit+"]")}t.each(this.listingFields,(function(e){r.addParameter("fl",e)}))};var y={collapseRules:{study:{fields:/topcategory[_sh]*|endpointcategory[_sh]*|guidance[_sh]*|reference[_sh]*|reference_owner[_sh]*|reference_year[_sh]*|guidance[_sh]*/},composition:{fields:/CORE|COATING|CONSTITUENT|ADDITIVE|IMPURITY|FUNCTIONALISATION|DOPING/}}};function RawAdapter(t){e.setup(this,y,t)}function NestedAdapter(e){this.nestingField=e&&e.nestingField||"type_s"}return RawAdapter.prototype.init=function(t){e.pass(this,RawAdapter,"init",t)},RawAdapter.prototype.parseResponse=function(r){for(var a=[],n=this,i=e.pass(this,RawAdapter,"parseResponse",r)||r,filterProps=function(e,r){t.each(n.collapseRules,(function(a,n){var i={};t.each(r,(function(e,t){t.match(a.fields)&&(delete r[t],Array.isArray(e)&&1==e.length&&(e=e[0]),i[t]=e)})),e._extended_===undefined&&(e._extended_={}),e._extended_[n]===undefined?e._extended_[n]=[i]:e._extended_[n].push(i)})),t.each(r,(function(t,r){Array.isArray(t)&&1==t.length&&(t=t[0]),e[r]=t}))},s=0,o=i.response.docs.length;s<o;++s){var u=i.response.docs[s],l=i.expanded[u.s_uuid],p={};filterProps(p,u);for(var f=0,h=l.docs.length;f<h;++f)filterProps(p,l.docs[f]);a.push(p)}return{entries:a,stats:t.extend({},i.stats,i.responseHeader),facets:t.extend({},i.facet_counts.facet_fields||i.facets,i.facet_counts.facet_pivot),paging:{start:i.response.start,count:i.response.docs.length,total:i.response.numFound,pageSize:parseInt(i.responseHeader.params.rows)}}},NestedAdapter.prototype={init:function(t){e.pass(this,NestedAdapter,"init",t)},parseResponse:function(r){for(var a=e.pass(this,NestedAdapter,"parseResponse",r)||r,n=a.response.docs,i=0,s=n.length;i<s;++i){var o=n[i],u={};if(o._childDocuments_){for(var l=0,p=o._childDocuments_.length;l<p;++l){var f=o._childDocuments_[l],h=f[this.nestingField];u[h]===undefined&&(u[h]=[]),u[h].push(f)}delete o._childDocuments_,o._extended_=u}}return{entries:n,stats:t.extend({},a.stats,a.responseHeader),facets:a.facets,paging:{start:a.response.start,count:a.response.docs.length,total:a.response.numFound,pageSize:parseInt(a.responseHeader.params&&a.responseHeader.params.rows||0)}}}},n.Configuring=Configuring,n.Compatibility=function Compatibility(t){e.setup(this,i,t),this.store.root=this},n.QueryingURL=QueryingURL,n.QueryingJson=QueryingJson,n.Persisting=Persisting,n.Paging=Paging,n.Eventing=Eventing,n.Patterning=Patterning,n.Texting=Texting,n.Faceting=Faceting,n.Ranging=Ranging,n.Pivoting=Pivoting,n.Listing=Listing,n.RawAdapter=RawAdapter,n.NestedAdapter=NestedAdapter,n}));