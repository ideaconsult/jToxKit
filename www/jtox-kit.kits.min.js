!function(e,u,c){function AnnotationKit(t){e.extend(!0,this,AnnotationKit.defaults,t);var a=this;this.selector=t.selector,this.annoTip=new AnnoTip({onSelection:function(t){return a.analyzeAnno(t)},onAction:function(t,e){return a.onAction(t,e)},onClose:null}),t.autoStart&&this.start()}AnnotationKit.prototype.start=function(){this.annoTip.attach(this.selector)},AnnotationKit.prototype.onAction=function(t,e){if("edit"===t)return e.content=c.formatString(c.ui.templates["anno-form"],this),this.annoTip.update(e),"function"==typeof this.controlsSetup&&(e=this.controlsSetup(a,e)),this.beautify();var a;"ok"===t&&((a=this.dataPacker(e)).suggestion=_.set({},a.operation.scope,a.suggestion),a.timestamp=(new Date).toUTCString(),"function"==typeof this.dataPostprocess&&(a=this.dataPostprocess(a,e)),a&&u.ajax(u.extend(!0,this.ajaxSettings,{data:a})),this.applyAnno(e)),u(".annotip-buttonset",this.annoTip.getFrame()).buttonset("destroy"),this.annoTip.discard()},AnnotationKit.prototype.analyzeAnno=function(i){var t=this.dataExtractor(i),s=t.data,e=u(i.element).parentsUntil(t.target).addBack().add(t.target),a=this.matchers,n=c.ui.kit(i.root),o=this;i.context=n&&"function"==typeof n.getContext&&n.getContext(),i.reference=null;for(var r=0;r<a.length;++r){var l=a[r],d=!1;if(e.filter(l.selector).each(function(t,e){var a=null;"function"==typeof l.processor?a=l.processor.call(o,s,i,e):"string"==typeof l.processor||Array.isArray(l.processor)?a=_.set({},l.processor,_.get(s,l.processor)):null!=l.processor&&(a=l.processor),null!=a&&(i.reference=u.extend(!0,i.reference||{},a)),d=!0}),d&&l.exclusive)break}return null!==i.reference},AnnotationKit.prototype.applyAnno=function(t){u(t.element).css({"background-color":"yellow"})},AnnotationKit.prototype.beautify=function(){var t=this.annoTip.getFrame();u(".annotip-buttonset",t).buttonset(),u("input",t).attr("size",this.inputSize-1),u("textarea",t).attr("cols",this.inputSize),u(t).addClass("openned")},AnnotationKit.prototype.dataPreprocess=function(e,t){return u("form",this.annoTip.getFrame()).serializeArray().forEach(function(t){_.set(e,t.name,t.value)}),e},AnnotationKit.prototype.dataPacker=function(t){return this.dataPreprocess({context:t.context,reference:t.reference,suggestion:t.suggestion,operation:{selected:t.selection,reverseSelector:t.reverseSelector}},t)},AnnotationKit.prototype.controlsSetup=function(n,o){var r=this,l=this.annoTip.getFrame(),t=_.map(o.scopes,function(t){return{value:t,title:r.pathHandlers[t]&&r.pathHandlers[t].title||lookup[t]||t}});return u(".annotip-scope select",l).html(_.map(t,function(t){return c.formatString(c.ui.templates["anno-select-option"],t)})).on("change",function(t){var e=u(this).val(),a=r.pathHandlers[e],i=a&&a.control,s=u(".annotip-suggestion",l).empty();if("string"==typeof i)s.append(c.formatString(i,{name:e,value:a.title}));else{if("function"!=typeof i)return;i.call(r,s,n,o)}s.children("input, select, textarea").addClass("ui-widget ui-corner-all padded-control")}),o},AnnotationKit.prototype.buildScopes=function(e,t,a,i){var s=this.pathHandlers[e]&&this.pathHandlers[e].idFields,n={};return t=t?t.split(/\s+/):[""],s=s&&_.difference(s,t),i.scopes.push(e),_.each(t.concat(s),function(t){""!=t?(-1==_.indexOf(s,t)&&i.scopes.push(e+"."+t),t=t.split("."),_.set(n,t,_.get(a,t,null))):n=u.extend(n,a)}),n},AnnotationKit.getAnnoRenderer=function(t){return function(t,e,a){}},AnnotationKit.defaults={context:null,ajaxSettings:null,connector:null,inputSize:30,matchers:[{selector:"*",processor:null,exclusive:!1}]},c.ui.Annotation=AnnotationKit}(asSys,jQuery,jToxKit),function(c,p){var e=0;function CompositionKit(t){c(this.rootElement=t.target).addClass("jtox-toolkit"),this.settings=c.extend(!0,{},CompositionKit.defaults,t),this.instanceNo=e++,this.settings.compositionUri&&this.queryComposition(this.settings.compositionUri)}CompositionKit.prototype.prepareTable=function(t,e,a){var i=this,s=this.settings.columns.composition&&this.settings.columns.composition.Name;s&&this.settings.handlers.toggleSelection&&(p.tables.insertRenderer(s,p.tables.getSelectionRenderer("substance"),{inplace:!0}),s.sWidth="60px");for(var n,o=p.tables.processColumns(this,"composition"),r=0,l=o.length;r<l;++r)if("Also"==o[r].title){o[r].title="",o[r].render=function(t,e,a){return t?'<a href="'+i.settings.baseUrl+"substance?type=related&compound_uri="+encodeURIComponent(t)+'" target="_blank">Also contained in...</a>':""};break}!i.settings.showDiagrams||(n=p.ambit.baseFeatures["http://www.opentox.org/api/1.1#Diagram"])&&n.column&&o.push(c.extend({},n.column,{title:"Structure",data:"component",render:function(t,e,a){return n.render(t.compound.URI,e,t)}}));var d=p.tables.putTable(i,c("table.composition-table",e).attr("id","jtox-comp-info-"+i.instanceNo+"-"+a)[0],"composition",{columns:o});c(d).DataTable().rows.add(t).draw();var u=c("th.colspan-2",d);return c(u).attr("colspan",2),c(c(u).next()).remove(),d},CompositionKit.prototype.queryComposition=function(t){var l=this;this.settings.baseUrl=p.formBaseUrl(this.compositionUri=t),p.ambit.call(l,t,function(t){if(t&&t.composition){var e={};p.ambit.processFeatures(t.feature);for(var a=0,i=t.composition.length;a<i;++a){var s=t.composition[a];p.ambit.processEntry(s.component,t.feature,p.ambit.getDatasetValue);var n=e[s.compositionUUID];n===undefined&&(e[s.compositionUUID]=n={name:"",purity:"",maxvalue:0,uuid:s.compositionUUID,composition:[]}),n.composition.push(s),""!=s.compositionName&&null!=s.compositionName&&(n.name=s.compositionName);var o=s.proportion.typical;"HAS_CONSTITUENT"==s.relation&&""==n.name&&(n.name=s.component.compound.name+" ("+p.ambit.formatters.formatConcentration(o)+")"),"HAS_CONSTITUENT"==s.relation&&n.maxvalue<o.value&&(n.maxvalue=o.value,o=s.proportion.real,n.purity=p.valueAndUnits(o.lowerValue+"-"+o.upperValue,o.unit||"%&nbsp;(w/w)"))}for(var a in p.fireCallback(l.settings.onLoaded,l,t.composition),e){var r=p.ui.putTemplate("all-composition",e[a],l.rootElement);l.settings.showBanner||c(".composition-info",r).remove(),l.prepareTable(e[a].composition,r[0],a)}}else p.fireCallback(l.settings.onLoaded,l,t.composition);p.ui.notifyParents(l.rootElement,function(t){"function"==typeof t.equalizeTables&&t.equalizeTables()}),p.fireCallback(l.settings.onComplete,l,t.composition)})},CompositionKit.prototype.query=function(t){c(self.rootElement).empty(),this.queryComposition(t)},CompositionKit.prototype.getContext=function(){return{subject:"composition",compositionUri:this.compositionUri}},CompositionKit.defaults={showBanner:!0,showDiagrams:!1,dom:"rt<Ffp>",onLoaded:null,onComplete:null,handlers:{},columns:{composition:{Type:{title:"Type",className:"left",width:"10%",data:"relation",render:function(t,e,a){if("display"!=e)return""+t;var i="HAS_ADDITIVE"==t?a.proportion.function_as_additive:"";return'<span class="camelCase">'+t.substr(4).toLowerCase()+"</span>"+(i===undefined||null===i||""==i?"":" ("+i+")")}},Name:{title:"Name",className:"camelCase left",width:"15%",data:"component.compound.name",render:function(t,e,a){return"display"!=e?""+t:'<a href="'+a.component.compound.URI+'" target="_blank" title="Click to view the compound"><span class="fa fa-action fa-link" style="float: left; margin-right: .3em;"></span></a>'+t}},"EC No.":{title:"EC No.",className:"left",width:"10%",data:"component.compound.einecs"},"CAS No.":{title:"CAS No.",className:"left",width:"10%",data:"component.compound.cas"},"Typical concentration":{title:"Typical concentration",className:"center",width:"15%",data:"proportion.typical",render:function(t,e,a){return"display"!=e?""+t.value:p.ambit.formatters.formatConcentration(t)}},"Concentration ranges":{title:"Concentration ranges",className:"center colspan-2",width:"20%",data:"proportion.real",render:function(t,e,a){return"display"!=e?""+t.lowerValue:p.ambit.formatters.formatConcentration(t)}},"Upper range":{title:"Upper range",className:"center",width:"20%",data:"proportion.real",render:function(t,e,a){return"display"!=e?""+t.upperValue:p.ambit.formatters.formatConcentration(t)}},Also:{title:"Also",className:"center",orderable:!1,data:"component.compound.URI",defaultContent:"-"}}}},p.ui.Composition=CompositionKit}((asSys,jQuery),jToxKit),function(d,w,C){var e=0;function CompoundKit(t){w(this.rootElement=t.target).addClass("jtox-toolkit"),this.settings=d.defaultsDeep({},t,CompoundKit.defaults,{baseFeatures:C.ambit.baseFeatures}),null!=t&&null!=t.groups&&(this.settings.groups=t.groups),this.instanceNo=e++,this.settings.rememberChecks&&this.settings.showTabs&&(this.featureStates={}),!t.onDetails&&t.hasDetails&&(this.settings.onDetails=function(t,e){this.expandedData(t,e)}),this.settings.datasetUri?this.settings.initialQuery&&this.queryDataset(this.settings.datasetUri):this.datasetUri=this.settings.baseUrl+this.settings.defaultService}CompoundKit.prototype.init=function(){this.feature=null,this.dataset=null,this.groups=null,this.fixTable=this.varTable=null,this.entriesCount=null,this.suspendEqualization=!1,this.orderList=[],this.pageStart=this.settings.pageStart,this.pageSize=this.settings.pageSize,C.ui.putTemplate("all-compound",{instanceNo:this.instanceNo},this.rootElement),C.ui.installHandlers(this,this.rootElement,C.tables.commonHandlers),C.tables.updateControls.call(this),this.$errDiv=w(".jt-error",this.rootElement)},CompoundKit.prototype.clear=function(){w(this.rootElement).empty()},CompoundKit.prototype.emptyTable=function(){w(this.fixTable).dataTable().fnClearTable(),w(this.varTable).dataTable().fnClearTable()},CompoundKit.prototype.prepareTabs=function(t,e,a,i){var s=w("<div>").css("display","none").appendTo(t),n=w("<ul>").appendTo(s),o=function(t,e){var a=w("<li>").appendTo(n);return w("<a>").attr("href","#"+t).html(e).appendTo(a),a},r=[],l=0;for(var d in i||this.groups){var u="jtox-ds-"+d.replace(/\s/g,"_")+"-"+this.instanceNo+(e?"":"-details"),c=d.replace(/_/g," "),p=o(u,c);e&&p.attr("title","Select which columns to be displayed");var h,m=w("<div>").attr("id",u).appendTo(s);this.settings.groupSelection&&e&&(h=C.ui.getTemplate("compound-one-tab"),m.append(h),w(".multi-select",h).on("click",function(t){var e=w(this).closest(".ui-tabs-panel"),a=w(this).hasClass("select");w("input",e).each(function(){this.checked=a,w(this).trigger("change")}),t.stopPropagation()})),a(m[0],d)&&(this.settings.hideEmpty?(m.remove(),p.remove(),--l):r.push(l)),++l,C.fireCallback(this.settings.onTab,this,m[0],p[0],c,e)}if(e&&this.settings.showExport){var f="jtox-ds-export-"+this.instanceNo,g=o(f,"Export").addClass("jtox-ds-export"),m=C.ui.getTemplate("compound-export",{id:f});s.append(m),m=w(".jtox-exportlist",m);for(var b=0,v=this.settings.exports.length;b<v;++b){var x=this.settings.exports[b],y=C.ui.getTemplate("compound-download",{link:C.addParameter(this.datasetUri,"media="+encodeURIComponent(x.type)),type:x.type,icon:x.icon});m.append(y)}C.fireCallback(this.settings.onTab,this,m[0],g[0],"Export",e)}return s.css("display","block"),s.tabs({collapsible:e,active:(!this.settings.tabsFolded||!e)&&0,disabled:r,heightStyle:e?"content":"auto"==this.settings.detailsHeight?"auto":"fill"})},CompoundKit.prototype.equalizeTables=function(){var r,l,t=this;t.suspendEqualization||null==t.fixTable||null==t.varTable||(C.tables.equalizeHeights(t.fixTable.tHead,t.varTable.tHead),C.tables.equalizeHeights(t.fixTable.tBodies[0],t.varTable.tBodies[0]),r=w(".jtox-ds-tables",t.rootElement)[0],l=w(".jtox-ds-variable",r).width(),w(".jtox-details-box",t.rootElement).each(function(t){var e,a,i,s,n,o=w(this).data("rootCell");o&&(this.style.display="none",e=function positionTo(t,e){var a={left:-e.offsetLeft,top:-e.offsetTop};for(e=e.offsetParent;t&&t!=e;t=t.offsetParent)a.left+=t.offsetLeft,a.top+=t.offsetTop;return a}(o,r),this.style.top=e.top+"px",this.style.left=e.left+"px",a=w(o).parents(".dataTables_wrapper").width()-o.offsetLeft,this.style.width=a+l+"px",this.style.display="block",i=w(o).parents("tr").height(),s=o.offsetHeight,n=w(this).height(),s<i&&w(o).height(s=i),s<n&&w(o).height(s=n),n<s&&(w(this).height(s),w(".ui-tabs").tabs("refresh")))}))},CompoundKit.prototype.getFeatureValue=function(t,e,a){var i=this.feature[t],s=i.data!==undefined?d.get(e,w.isArray(i.data)?i.data[0]:i.data):e.values[t];return"function"==typeof i.render?i.render(s,a||"filter",e):C.ui.renderRange(s,i.units,a)},CompoundKit.prototype.getFeatureUri=function(t){return this.feature[t].URI||t},CompoundKit.prototype.getFeatureData=function(s,t,n){null==n&&(n="details");var o=this,r=[];return d.each(t,function(t){var e,a=w.extend({},o.feature[t]),i=a.visibility;i&&i!=n||(e=a.title,a.value=o.getFeatureValue(t,s,n),!e||o.settings.hideEmptyDetails&&!a.value||(a.value||(a.value="-"),r.push(a)))}),r},CompoundKit.prototype.prepareColumn=function(i,s){if("details"==s.visibility)return null;var o,r,t={title:s.title?C.valueAndUnits(s.title.replace(/_/g," "),this.settings.showUnits?s.units:null):"",defaultContent:"-"};return"function"==typeof s.column?t=s.column.call(this,t,i):null!=s.column&&(t=w.extend(t,s.column)),t.data=null!=s.data?s.data:"values",null!=s.render?t.render=null!=s.data?s.render:function(t,e,a){return s.render(a.values[i],e,a)}:s.shorten?t.render=function(t,e,a){return s.data||(t=t[i]),t=t||"","display"!=e?""+t:C.ui.shortenedData(t,"Press to copy the value in the clipboard")}:null==s.data&&(t.render=(o=i,r=s.unit,function(t,e,a){var i=a.values[o]||"-";if("object"!=typeof i)return i;w.isArray(i)||(i=[i]);for(var s="",n=0;n<i.length;++n)s+="display"==e?"<div>":"",s+=C.ui.renderRange(i[n],r,e),s+="display"==e?"</div>":",";return s})),s.shorten&&(t.width="75px"),t},CompoundKit.prototype.prepareTables=function(){var r=this,n=[],o=[],t=r.settings.baseFeatures["#IdRow"];this.settings.onDetails&&(t=C.tables.insertRenderer(t,C.tables.getDetailsRenderer("compound"),{separator:"<br/>"})),o.push(r.prepareColumn("#IdRow",t),{className:"jtox-hidden",data:"index",defaultContent:"-",orderable:!0,render:function(t,e,a){return null==r.orderList?0:r.orderList[t]}}),n.push({className:"jtox-hidden jtox-ds-details paddingless",data:"index",render:function(t,e,a){return""}});var l=function(){var t=w(this).data(),e=w(t.sel+" table tr ."+t.column,r.rootElement);this.checked?(w(e).show(),w("table tr .blank-col",r.rootElement).addClass("jtox-hidden")):(w(e).hide(),0==w(t.sel+" table tr *:visible",r.rootElement).length&&w("table tr .blank-col",r.rootElement).removeClass("jtox-hidden")),r.settings.rememberChecks&&(r.featureStates[t.id]=this.checked),r.equalizeTables()};for(var e in r.settings.hasDetails&&(r.settings.handlers.toggleDetails=function(t){var e,a,i,s=w(t.target).closest("tr"),n=s.data("jtox-index"),o=w(".jtox-ds-details",s)[0];(null==r.settings.preDetails||C.fireCallback(r.settings.preDetails,r,n,o))&&o&&(s.toggleClass("jtox-detailed-row"),w(".jtox-details-open",s).toggleClass("fa-folder fa-folder-open"),e=w("#jtox-var-"+r.instanceNo+"-"+n+">td.jtox-ds-details",r.rootElement).toggleClass("jtox-hidden"),s.hasClass("jtox-detailed-row")?(a=w(e).nextAll().detach(),e.data("removedCells",a),e.prop("colspan",a.length+1),i=w("<div></div>").addClass("jtox-details-box jtox-details"),null!=r.settings.detailsHeight&&i.height(r.settings.detailsHeight),i.appendTo(e),C.fireCallback(r.settings.onDetails,r,i[0],r.dataset.dataEntry[n],o)):(e.prop("colspan",1),e.data("removedCells").appendTo(e.parent())),r.equalizeTables())}),r.groups)d.each(r.groups[e],function(t){var e,a,i=r.feature[t],s=r.prepareColumn(t,i);s&&(a="col-"+(e=i.primary?o:n).length,s.className=(s.className?s.className+" ":"")+a,w('.jtox-ds-features input.jtox-checkbox[value="'+t+'"]',r.rootElement).data({sel:i.primary?".jtox-ds-fixed":".jtox-ds-variable",column:a,id:t}).on("change",l),e.push(s))});null!=r.settings.fixedWidth&&w(".jtox-ds-fixed",r.rootElement).width(r.settings.fixedWidth),C.tables.sortColDefs(o),r.fixTable=w(".jtox-ds-fixed table",r.rootElement).dataTable({paging:!1,lengthChange:!1,autoWidth:!1,dom:"rt",columns:o,ordering:!1,createdRow:function(t,e){var a=e.index;w(t).data("jtox-index",a),C.fireCallback(r.settings.onRow,r,t,e,a),C.ui.installHandlers(r,t,C.tables.commonHandlers)},language:{emptyTable:'<span class="jt-feeding">'+(r.settings.language.process||r.settings.language.loadingRecords||"No data yet...")+"</span>"}})[0],n.push({className:"center blank-col"+(1<n.length?" jtox-hidden":""),data:"index",render:function(t,e,a){return"display"!=e?t:"..."}}),C.tables.sortColDefs(n),r.varTable=w(".jtox-ds-variable table",r.rootElement).dataTable({paging:!1,processing:!0,lengthChange:!1,autoWidth:!1,dom:"rt",ordering:!0,columns:n,scrollCollapse:!0,createdRow:function(t,e){var a=e.index;t.id="jtox-var-"+r.instanceNo+"-"+a,C.tables.equalizeHeights.apply(window,w("td.jtox-multi table tbody",t).toArray()),w(t).addClass("jtox-row"),w(t).data("jtox-index",a),C.fireCallback(r.settings.onRow,r,t,e,a),C.ui.installHandlers(r,t,C.tables.commonHandlers)},drawCallback:function(t){for(var e=w(".jtox-row",this),a=0,i=e.length;a<i;++a){var s=w(e[a]).data("jtox-index");r.orderList[s]=a}0<i&&w(r.fixTable).dataTable().fnSort([[1,"asc"]])},language:{emptyTable:"-"}})[0]},CompoundKit.prototype.expandedData=function(t,s,e){var n=this;return this.prepareTabs(t,!1,function(t,e){var a,i=n.getFeatureData(s,n.groups[e]);return(0<i.length||!n.settings.hideEmpty)&&((a=w("<table>").appendTo(w(t).addClass("jtox-details-table"))).dataTable({paging:!1,processing:!0,lengthChange:!1,autoWidth:!1,dom:"rt<f>",columns:C.tables.processColumns(n,"compound"),ordering:!0}),a.dataTable().fnAddData(i),a.dataTable().fnAdjustColumnSizing()),0==i.length},e)},CompoundKit.prototype.updateTables=function(){this.settings.hasDetails&&w("div.jtox-details-box",this.rootElement).remove(),this.filterEntries(w(".jtox-controls input",this.rootElement).val())},CompoundKit.prototype.prepareGroups=function(t){var i=this,s={},e=i.settings.groups;for(var n in"function"==typeof e&&(e=e(t,i)),i.groups={},e){var a,o=e[n];null!=o&&(a="function"==typeof o||"string"==typeof o?C.fireCallback(o,i,n,t,s):o,i.groups[n]=[],d.each(a,function(t,e){var a=!1;CompoundKit.enumSameAs(t,i.feature,function(t,e){a|=e in s}),"name"==e||a||(i.groups[n].push(t),s[t]=!0)}))}},CompoundKit.prototype.enumerateFeatures=function(t){var e=!1;for(var a in this.groups){for(var i=0,s=this.groups[a].length;i<s&&!(e=t(this.groups[a][i],a));++i);if(e)break}return e},CompoundKit.prototype.filterEntries=function(s){var n=this,t=[];if(""!=(s=null==s?"":s.toLowerCase()))for(var e=0,a=n.dataset.dataEntry.length;e<a;++e){var o=n.dataset.dataEntry[e];n.enumerateFeatures(function(t,e){var a=n.feature[t];if(a.search!==undefined&&!a.search)return!1;var i=n.getFeatureValue(t,o,"sort");return null!=i&&0<=i.toString().toLowerCase().indexOf(s)})&&t.push(o)}else t=n.dataset.dataEntry;w(n.fixTable).dataTable().fnClearTable(),w(n.varTable).dataTable().fnClearTable(),t&&t.length&&(w(n.fixTable).dataTable().fnAddData(t),w(n.varTable).dataTable().fnAddData(t)),w(".jt-feeding",n.rootElement).html(n.settings.language.zeroRecords||"No records matching the filter."),C.ui.updateTree(w(".jtox-controls",n.rootElement)[0],{"filtered-text":s?' (filtered to <span class="high">'+t.length+"</span>) ":" "}),n.settings.showTabs&&(n.suspendEqualization=!0,w(".jtox-ds-features .jtox-checkbox",n.rootElement).trigger("change"),n.suspendEqualization=!1),n.equalizeTables()},CompoundKit.prototype.getQueryUri=function(t){return this.datasetUri?(null==t&&(t={from:this.pageStart,size:this.pageSize}),t.from<0&&(t.from=0),null==t.size&&(t.size=this.pageSize),C.addParameter(this.datasetUri,"page="+Math.floor(t.from/t.size)+"&pagesize="+t.size)):null},CompoundKit.prototype.getFeatureUri=function(t){return t||this.settings.featureUri||this.settings.feature_uri||C.addParameter(this.datasetUri,"page=0&pagesize=1")},CompoundKit.prototype.queryEntries=function(t,e,a){var i=this,s={from:t,size:e},n=i.getQueryUri(s);w(".jtox-controls select",i.rootElement).val(s.size);var o=function(t,e){var a;t||200==e.status?t?(i.pageSize=s.size,a=i.pageStart=Math.floor(s.from/s.size)*s.size,t.dataEntry.length<i.pageSize&&(i.entriesCount=a+t.dataEntry.length),i.dataset=CompoundKit.processDataset(t,w.extend(!0,{},t.feature,i.feature),i.settings.fnAccumulate,i.pageStart),C.fireCallback(i.settings.onLoaded,i,t),i.updateTables(),i.settings.showControls&&C.tables.updateControls.call(i,a,t.dataEntry.length)):C.fireCallback(i.settings.onLoaded,i,t):i.$errDiv.show().find(".message").html("Server error: "+e.statusText),C.fireCallback(i.settings.onComplete,i)};(i.dataset=null)!=a?o(a):C.ambit.call(i,n,o)},CompoundKit.prototype.queryFeatures=function(t,i){var n=this;this.lastFeatureUri=t||this.getFeatureUri(t),C.ambit.call(n,this.lastFeatureUri,function(t,e){var a;t||200==e.status||n.$errDiv.show().find(".message").html("Server error: "+e.statusText),t&&(n.feature=t.feature,CompoundKit.processFeatures(n.feature,n.settings.baseFeatures),a={dataEntry:t.dataEntry,feature:n.feature},n.prepareGroups(a),n.settings.showTabs&&n.prepareTabs(w(".jtox-ds-features",n.rootElement)[0],!0,function(i,t){var s=!0;return d.each(n.groups[t],function(t){var e,a=(n.feature[t]||{}).visibility;a&&"main"!=a||(s=!1,(e=n.feature[t].title)&&function(t,e,a){var i=C.ui.getTemplate("compound-one-feature",{title:e.replace(/_/g," "),uri:n.getFeatureUri(t)});w(a).append(i);var s=w('input[type="checkbox"]',i)[0];if(s)s.value=t,n.settings.rememberChecks&&(s.checked=n.featureStates[t]===undefined||n.featureStates[t])}(t,e,i))}),s}),C.fireCallback(n.settings.onPrepared,n,a,n),n.prepareTables(),n.equalizeTables(),i(t))})},CompoundKit.prototype.queryDataset=function(t,e,a){var i;t=C.ambit.grabPaging(this,t),this.settings.baseUrl=this.settings.baseUrl||C.formBaseUrl(t),this.datasetUri=(0!=t.indexOf("http")?this.settings.baseUrl:"")+t,e=this.getFeatureUri(e),this.lastFeatureUri&&e==this.lastFeatureUri&&!0!==a?(this.$errDiv.hide(),this.queryEntries(this.pageStart,this.pageSize)):(this.clear(),this.init(),this.$errDiv.hide(),(i=this).queryFeatures(e,function(){i.queryEntries(i.pageStart,i.pageSize)}))},CompoundKit.prototype.query=function(t,e){this.queryDataset(t,null,e)},CompoundKit.processEntry=function(t,e,a){for(var i in a=a||CompoundKit.defaults.fnAccumulate,t.values){var s=e[i];if(s){var n=t.values[i];if(s.accumulate&&n&&s.data){var o="function"==typeof s.accumulate?s.accumulate:a,r=s.data;w.isArray(r)||(r=[r]);for(var l=0;l<r.length;++l)d.set(t,r[l],C.fireCallback(o,this,i,d.get(t,r[l]),n,e))}}}return t},CompoundKit.extractFeatures=function(t,e,a){var i=[];for(var s in e){var n=w.extend({},e[s]);n.value=t.values[s],n.title&&!1!==C.fireCallback(a,null,n,s,i.length)&&(n.value||(n.value="-"),i.push(n))}return i},CompoundKit.enumSameAs=function(t,e,a){for(var i=e[t],s=t.replace(/(http.+\/feature\/).*/g,"$1"),n=t;;){if(C.fireCallback(a,null,i,n),null==i){console.warn("Reference to a unspecified feature: "+n);break}if(null==i.sameAs||i.sameAs==t||t==s+i.sameAs)break;if(e[i.sameAs]!==undefined)n=i.sameAs;else{if(e[s+i.sameAs]===undefined)break;n=s+i.sameAs}i=e[n]}return n},CompoundKit.processFeatures=function(t,e){for(var a in null==e&&(e=C.Ambit.baseFeatures),t=w.extend(t,e)){var i=t[a];i.URI||(i.URI=a),CompoundKit.enumSameAs(a,t,function(t,e){var a=t.sameAs;t=w.extend(!0,t,i),i=w.extend(!0,i,t),t.sameAs=a})}return t},CompoundKit.processDataset=function(t,e,a,i){e||(CompoundKit.processFeatures(t.feature),e=t.feature),a=a||CompoundKit.defaults.fnAccumulate,i=i||0;for(var s=0,n=t.dataEntry.length;s<n;++s)CompoundKit.processEntry(t.dataEntry[s],e,a),t.dataEntry[s].number=s+1+i,t.dataEntry[s].index=s;return t},CompoundKit.defaults={showTabs:!0,tabsFolded:!1,showExport:!0,showControls:!0,showUnits:!0,hideEmpty:!1,groupSelection:!0,hasDetails:!0,hideEmptyDetails:!0,detailsHeight:"auto",fixedWidth:null,pageSize:20,pageStart:0,rememberChecks:!1,featureUri:null,defaultService:"query/compound/search/all",initialQuery:!0,metricFeature:"http://www.opentox.org/api/1.1#Similarity",onTab:null,onLoaded:null,onComplete:null,onPrepared:null,onDetails:null,preDetails:null,language:{},fnAccumulate:function(t,e,a,i){return null==a?e:(a=a.toString(),null==e||0<=a.toLowerCase().indexOf(e.toLowerCase())?a:0<=e.toLowerCase().indexOf(a.toLowerCase())?e:e+", "+a)},handlers:{sizeChange:function(t){this.queryEntries(this.pageStart,parseInt(w(t.target).val()))},filter:function(){this.updateTables()},alignTables:function(){w(this.fixTable).dataTable().fnAdjustColumnSizing(),this.equalizeTables()}},groups:{Identifiers:["http://www.opentox.org/api/1.1#Diagram","#DetailedInfoRow","http://www.opentox.org/api/1.1#CASRN","http://www.opentox.org/api/1.1#EINECS","http://www.opentox.org/api/1.1#IUCLID5_UUID"],Names:["http://www.opentox.org/api/1.1#ChemicalName","http://www.opentox.org/api/1.1#TradeName","http://www.opentox.org/api/1.1#IUPACName","http://www.opentox.org/api/1.1#SMILES","http://www.opentox.org/api/1.1#InChIKey","http://www.opentox.org/api/1.1#InChI","http://www.opentox.org/api/1.1#REACHRegistrationDate"],Calculated:function(t,e){var a=[];for(var i in 0<e.dataEntry.length&&null!=e.dataEntry[0].compound.metric&&a.push(this.settings.metricFeature),e.feature){var s=e.feature[i];null==s.source||null==s.source.type||s.basic||"algorithm"!=s.source.type.toLowerCase()&&"model"!=s.source.type.toLowerCase()||a.push(i)}return a},Other:function(t,e,a){var i=[];for(var s in e.feature)s in a||e.feature[s].basic||i.push(s);return i}},exports:[{type:"chemical/x-mdl-sdfile",icon:"/assets/img/types/sdf64.png"},{type:"chemical/x-cml",icon:"/assets/img/types/cml64.png"},{type:"chemical/x-daylight-smiles",icon:"/assets/img/types/smi64.png"},{type:"chemical/x-inchi",icon:"/assets/img/types/inchi64.png"},{type:"text/uri-list",icon:"/assets/img/types/lnk64.png"},{type:"application/pdf",icon:"/assets/img/types/pdf64.png"},{type:"text/csv",icon:"/assets/img/types/csv64.png"},{type:"text/plain",icon:"/assets/img/types/txt64.png"},{type:"text/x-arff",icon:"/assets/img/types/arff.png"},{type:"text/x-arff-3col",icon:"/assets/img/types/arff-3.png"},{type:"application/rdf+xml",icon:"/assets/img/types/rdf64.png"},{type:"application/json",icon:"/assets/img/types/json64.png"},{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",icon:"/assets/img/types/xlsx.png"}],baseFeatures:{"http://www.opentox.org/api/1.1#Similarity":{title:"Similarity",data:"compound.metric",search:!0}},columns:{compound:{Name:{title:"Name",data:"title",render:function(t,e,a){return"<span>"+t+"</span>"+C.ui.fillHtml("info-ball",{href:a.URI||"#",title:"Compound's detailed info"})}},Value:{title:"Value",data:"value",defaultContent:"-"},SameAs:{title:"SameAs",data:"sameAs",defaultContent:"-"},Source:{title:"Source",data:"source",defaultContent:"-",render:function(t,e,a){return t&&t.type?'<a target="_blank" href="'+t.URI+'">'+t.type+"</a>":"-"}}}}},C.ui.Compound=CompoundKit}(_,jQuery,jToxKit),function(c,p,l){var d=[{regex:/^[\s=]*([\(\[])\s*(\-?\d*[\.eE]?\-?\d*)\s*,\s*(\-?\d*[\.eE]?\-?\d*)\s*([\)\]])\s*([^\d,]*)\s*$/,fields:["","loQualifier","loValue","upValue","upQualifier","unit"],adjust:function(t,e){t.upValue?t.upQualifier="]"==e[4]?"<=":"<":delete t.upQualifier,t.loValue?t.loQualifier="["==e[1]?">=":">":delete t.loQualifier}},{regex:/^\s*(>|>=)?\s*(\-?\d+[\.eE]?\-?\d*)\s*([^\d,<=>]*)[,\s]+(<|<=)?\s*(\-?\d*[\.eE]?\-?\d*)\s*([^\d,<=>]*)\s*$/,fields:["","loQualifier","loValue","unit","upQualifier","upValue","unit"]},{regex:/^\s*(>|>=|=)?\s*(\-?\d+[\.eE]?\-?\d*)\s*([^\d,<=>]*)\s*$/,fields:["","loQualifier","loValue","unit"],adjust:function(t,e){t.loQualifier||(t.loQualifier="=")}},{regex:/^\s*(<|<=)\s*(\-?\d+[\.eE]?\-?\d*)\s*([^\d,<=>]*)\s*$/,fields:["","upQualifier","upValue","unit"]},{regex:/^\s*(\-?\d+[\.eE]?\-?\d*)\s*(<|<=)\s*([^\d,<=>]*)\s*$/,fields:["","upValue","upQualifier","unit"]},{regex:/^\s*(\-?\d+[\.eE]?\-?\d*)\s*(>|>=)\s*([^\d,<=>]*)\s*$/,fields:["","loValue","loQualifier","unit"]}];function extractLast(t){return t?t.split(/[,\(\)\s]*/).pop():t}function EndpointKit(t){p(this.rootElement=t.target).addClass("jtox-toolkit"),l.ui.putTemplate("all-endpoint"," ? ",this.rootElement),this.settings=p.extend(!0,{},EndpointKit.defaults,t),l.ui.installHandlers(this,this.rootElement,c.defaults(this.settings.handlers,l.tables.commonHandlers));var s=this;s.settings.showEditors&&!s.settings.onDetails&&(s.edittedValues={},s.settings.onDetails=function(t,i,e){s.edittedValues[i.endpoint]={},l.ui.attachEditors(s,l.ui.getTemplate("endpoint-one-editor",{}).appendTo(t),{category:i.endpoint,top:i.subcategory,conditions:s.settings.showConditions,onChange:function(t,e,a){c.set(s.edittedValues[i.endpoint],e,a)}})});var a,e=l.tables.processColumns(s,"endpoint");p(".jtox-categories",s.rootElement).accordion({heightStyle:s.settings.heightStyle}),s.tables={},p("table",s.rootElement).each(function(){var t=this.className;s.tables[t]=l.tables.putTable(s,this,"endpoint",{columns:e,infoCallback:s.updateStats(t),orderFixed:[[1,"asc"]],onRow:function(t,e,a){p(t).addClass(e.endpoint)}})}),s.settings.hideFilter?p(".filter-box",s.rootElement).remove():(a=null,p(".filter-box input",s.rootElement).on("keydown",function(t){a&&clearTimeout(a);var e=t.currentTarget;a=setTimeout(function(){p("table",s.rootElement).each(function(){p(this).dataTable().fnFilter(e.value)})},300)})),s.settings.showMultiselect||p("h3 a",s.rootElement).remove(),!!this.settings.endpointUri!=undefined&&this.settings.loadOnInit&&this.loadEndpoints(this.settings.endpointUri)}EndpointKit.prototype.getValues=function(e){var t=null,t=e?"function"!=typeof e?function(t){return 0<=t.indexOf(e)}:e:function(t){return!0};for(var a in this.edittedValues)if(t(a))return this.edittedValues[a];return null},EndpointKit.prototype.updateStats=function(d){var u=this;return function(t,e,a,i,s,n){var o=p("h3[data-cat="+d+"]",u.rootElement),r=this.fnGetData(),l=c.sumBy(r,"count");return p("div.jtox-details span",o).html(0<s?"["+l+"]":""),n}},EndpointKit.prototype.fillEntries=function(t){for(var i=this,s={},e=0,a=t.length;e<a;++e){var n=t[e],o=s[n.subcategory];null==o&&(s[n.subcategory]=o=[]),o.push(n)}p("h3",i.rootElement).each(function(){var t=p(this).data("cat"),e=i.tables[t];e.fnClearTable();var a=s[t.replace("_"," ")];null!=a&&e.fnAddData(a)})},EndpointKit.prototype.query=EndpointKit.prototype.loadEndpoints=function(t){var a=this;null==t?t=a.settings.baseUrl+"query/study":a.settings.baseUrl||(a.settings.baseUrl=l.formBaseUrl(t,"query")),l.ambit.call(a,t,function(t,e){t||200==e.status||(t={facet:[]}),t?(a.summary=t.facet,l.fireCallback(a.settings.onLoaded,a,t),a.fillEntries(t.facet)):(a.facet=null,l.fireCallback(a.settings.onLoaded,a,t))})},EndpointKit.prototype.getFeatureInfoHtml=function(t,e,a){for(var i=[],s=[],n=t.annotation.length,o=0;o<n;++o){var r=t.annotation[o];i.push(l.formatString('<th class="conditions">{{p}}</th>',r)),s.push(l.formatString("<td>{{o}}</td>",r))}return n<1&&s.push(l.formatString("<td>-</td>",r)),l.ui.fillHtml("endpoint-info-panel",{conditionsHeaders:i.join(""),conditionsValues:s.join(""),conditionsCount:n,endpoint:t.title,guidance:t.creator,value:l.ui.renderRange(e,t.units,"display"),reason:e.remarks||null,deleteBoxClass:a?"":"jtox-hidden"})},EndpointKit.prototype.getFeatureEditHtml=function(t,e,a){var i=p.extend(!0,{},this.settings.columns._,this.settings.columns[t.id.category]),s=c.map(this.settings.editors,function(t){var e=c.defaults(c.get(i,t.path,{}),t,{autoClass:"no-auto"});return!e.visible||e.preloaded?"":l.ui.fillHtml("endpoint-one-editor",e)}),n=c.map(i.conditions,function(t,e){return"object"!=typeof t||!1===t.visible?"":l.ui.fillHtml("endpoint-one-editor",c.defaults({id:e,title:t.title||e,autoClass:"tags-auto",path:"effects.conditions."+e},i.conditions[e]))});return l.ui.fillHtml("endpoint-edit-panel",c.defaults({editorsHtml:s.join(""),conditionsClass:0<n.length?"":"jtox-hidden",conditionsHtml:n.join("")},a))},EndpointKit.attachEditors=function(n,t,o,r){var i=[].concat(n.settings.loTags,n.settings.hiTags,n.settings.units);field=null,r=r||{},p(".ajax-auto",t).autocomplete({appendTo:t,source:function(t,e){var a=p(this.element).data("id");c.set(r.ajax,r.searchPath,t.term),l.ambit.call(n,p(this.element).data("service"),r.ajax,function(t){e(t?p.map(t.facet,function(t){var e=t[a]||"";return{label:e+(t.count?" ["+t.count+"]":""),value:e}}):[])})},change:function(t,e){var a=p(this).data("id"),i=p(this).data("path")||c.find(n.settings.editors,{id:a}).path,s=e.item?e.item.value:c.trim(this.value);r.onChange&&!1===r.onChange.call(n,t,a,i,s)||c.set(o,i,s)},minLength:n.settings.minLength||0}),p(".tags-auto",t).autocomplete({appendTo:t,change:function(t,e){var a=p(this).data("id"),i=p(this).data("path")||c.find(n.settings.editors,{id:a}).path,s=function parseValue(t){for(var e={},a=0;a<d.length;++a){var i=t.match(d[a].regex);if(i){for(var s=1;s<i.length;++s){i[s]&&(e[d[a].fields[s]]=i[s])}d[a].adjust&&d[a].adjust(e,i),e.unit&&(e.unit=e.unit.trim());break}}return a>=d.length&&(e.textValue=c.trim(t)),e}(this.value);r.onChange&&!1===r.onChange.call(n,t,a,i,s)||c.set(o,i,s)},source:function(t,e){var a=p.ui.autocomplete.filter(i,extractLast(t.term));""==t.term&&(a=""),e(a)},focus:function(){return!1},select:function(t,e){var a=this.value,i=extractLast(a);return this.value=a.substr(0,a.length-i.length)+e.item.value+" ",!1}}).bind("keydown",function(t){t.keyCode===p.ui.keyCode.TAB&&autoEl.menu.active&&t.preventDefault()}),p(".no-auto",t).on("change",function(t){var e=p(this).data("id"),a=p(this).data("path")||c.find(n.settings.editors,{id:e}).path,i=p(this).val();r.onChange&&!1===r.onChange.call(n,t,e,a,i)||c.set(o,a,i)})},EndpointKit.defaults={heightStyle:"content",hideFilter:!1,maxHits:10,showMultiselect:!0,showEditors:!1,showConditions:!0,onLoaded:null,loadOnInit:!1,units:["uSv","kg","mg/l","mg/kg bw","Â°C","mg/kg bw/day","ppm","%","h","d"],loTags:[">",">=","="],hiTags:["<","<="],dom:"<i>rt",language:{loadingRecords:"No endpoints found.",zeroRecords:"No endpoints found.",emptyTable:"No endpoints available.",info:"Showing _TOTAL_ endpoint(s) (_START_ to _END_)"},handlers:{multipleSelect:function(t){var e=p(t.target),a=e.closest("h3").data("cat"),i=p("."+a,e.closest("div.jtox-categories")),s=e.data("action")||"on";i&&p("on"!==s?"input.jtox-selection:checked":"input.jtox-selection:not(:checked)",i).prop("checked","on"===s).trigger("change")}},editors:[{id:"endpoint",path:"effects.endpoint",title:"Endpoint name",service:"query/experiment_endpoints",autoClass:"ajax-auto"},{id:"value",path:"value",title:"Value range"},{id:"interpretation_result",path:"interpretation.result",title:"Intepretation of the results",service:"query/interpretation_result",autoClass:"ajax-auto"},{id:"value",path:"effect.result",title:"Effects result"},{id:"value",path:"effects.text",title:"Effects result"},{id:"type",path:"reliability.r_studyResultType",title:"Study type",preloaded:!0},{id:"reference",path:"citation.title",title:"Reference",preloaded:!0},{id:"justification",path:"protocol.guideline[0]",title:"Guideline or Justification",preloaded:!0},{id:"remarks",path:"interpretation.criteria",title:"Remarks",preloaded:!0}],columns:{endpoint:{Id:{title:"",data:"uri",orderable:!1,width:"30px",render:function(t,e,a){return""}},Name:{title:"Name",data:"value",defaultContent:"-",render:function(t,e,a){return t+'<span class="float-right jtox-details">[<span title="Number of values">'+a.count+"</span>]"+l.ui.fillHtml("info-ball",{href:a.uri,title:"Endpoints detailed info"})+"</span>"}}}}},l.ui.Endpoint=EndpointKit}(_,(asSys,jQuery),jToxKit),function(p,h,m,f){var n={},e={servlet:"select",multipleSelection:!0,keepAllFacets:!0,connector:m,onPrepare:function(t){var e=t.url.indexOf("?");this.proxyUrl?(t.data={query:t.url.substr(e+1)},t.url=this.proxyUrl,t.type=t.method="POST"):t.url+=(e<0?"?":"&")+"wt=json"},topSpacing:10,nestingField:"type_s",nestingRules:{composition:{parent:"substance",limit:100},study:{parent:"substance",limit:1e4},params:{parent:"study",limit:1e4},conditions:{parent:"study",limit:1e4}},exportTypes:[],exportSolrDefaults:[{name:"echoParams",value:"none"},{name:"rows",value:999998}],exportDefaultDef:{callbacksMap:{lookup:function(t){return n[t]||t}}},savedQueries:[],listingFields:[],facets:[],summaryRenderers:{}},u=function(t){var e,a=e=t.title.replace(/^\"(.+)\"$/,"$1"),a=e.replace(/^caNanoLab\./,"").replace(/^http\:\/\/dx\.doi\.org/,"");a=(n[a]||a).replace("NPO_","").replace(" nanoparticle","");var i=m("<span/>").html(t.count||0);"function"==typeof t.onAux&&i.click(t.onAux);var s=m("<li/>").append(m('<a href="#" class="tag" title="'+e+" "+(t.hint||"")+(a!=e?" ["+e+"]":"")+'">'+a+"</a>").append(i));return"function"==typeof t.onMain&&s.click(t.onMain),t.color&&s.addClass(t.color),s},c=function(t){f.TagWidget.prototype.init.call(this,t),t.getListener("current").registerWidget(this)},g=function(t){var e=this.getHeaderText();e.textContent=f.ui.updateCounter(e.textContent,t),h.act(this,this.header.data("refreshPanel"))},b=function(t){var e="OR"==t.value.toUpperCase(),a=this.getValues();this.clearValues(),this.aggregate=!e,t.value=e?"AND":"OR";for(var i=0;i<a.length;++i)this.addValue(a[i]);this.doRequest()};f.ui.FacetedSearch=function(t){this.id=null,h.extend(!0,this,e,t),this.serverUrl=this.solrUrl,"string"==typeof this.lookupMap&&(this.lookupMap=window[this.lookupMap]),null==this.lookupMap&&(this.lookupMap={}),n=this.lookupMap,m(t.target).html(f.ui.templates["faceted-search-kit"]),delete this.target,this.initDom(),this.initComm(),this.initExport(),this.initQueries()},f.ui.FacetedSearch.prototype={initDom:function(){this.accordion=m("#accordion"),this.accordion.accordion({heightStyle:"content",collapsible:!0,animate:200,active:!1,activate:function(t,e){var a,i,s,n,o;e.newPanel&&e.newPanel[0]&&(a=e.newHeader[0],i=e.newPanel[0],s=m("input.widget-filter",i),n=s.outerHeight(!0),m("span.ui-icon-search",a).length?o=e.newPanel.data("refreshPanel"):(o=function(){i.scrollHeight>i.clientHeight||""!=s.val()||m(a).hasClass("nested-tab")?(m(i).scrollTop(n),s.show(),m("span.ui-icon-search",a).removeClass("unused")):(s.hide(),m("span.ui-icon-search",a).addClass("unused"))},e.newPanel.data("refreshPanel",o),e.newHeader.data("refreshPanel",o),e.newHeader.append(m('<span class="ui-icon ui-icon-search"></span>').on("click",function(t){e.newPanel.animate({scrollTop:0<e.newPanel.scrollTop()?0:n},300,function(){0<e.newPanel.scrollTop()?m("input.widget-filter",i).blur():m("input.widget-filter",i).focus()}),t.stopPropagation(),t.preventDefault()}))),s.val(""),o())}}),m(document).on("click","ul.tag-group",function(t){m(this).toggleClass("folded"),m(this).parents(".widget-root").data("refreshPanel").call()}),m(document).on("keyup","#accordion input.widget-filter",function(t){var a,i=m(this).val().toLowerCase(),e=m(this).parents("div.widget-root")[0];27==(t.keyCode||t.which)&&m(this).val(i=""),""==i?m("li,ul",e).show():m("li>a",e).each(function(){var t=m(this).closest("ul.tag-group"),e=m(this).parent();a=t.data("hidden")||0,e.hasClass("category")||(0<=this.title.toLowerCase().indexOf(i)||0<=this.innerText.toLowerCase().indexOf(i)?e.show():(e.hide(),++a)),t.length&&a&&t.data("hidden",a)}),m("ul.tag-group",e).each(function(){var t=m(this);a=parseInt(t.data("hidden"))||0,t.children().length>a+1?t.show().removeClass("folded"):t.hide().addClass("folded"),t.data("hidden",null)})});var a=m("#result-tabs"),i=this;a.tabs({}),m("#accordion-resizer").resizable({minWidth:150,maxWidth:450,grid:[10,10],handles:"e",start:function(t,e){resSize={width:a.width(),height:a.height()}},resize:function(t,e){i.accordion.accordion("refresh"),m("#query-sticky-wrapper").width(i.accordion.width()),m(this).width(function(t,e){return e-7})}}),m(".query-left#query").sticky({topSpacing:this.topSpacing,widthFromWrapper:!1})},initComm:function(){var t,n,e,a=h(p.Requesting,p.Spying,p.Pivoting,f.PivotWidgeting,f.RangeWidgeting),i=h(p.Requesting,p.Faceting,f.AccordionExpansion,f.TagWidget,f.Running),s=m("#docs");this.manager=t=new(h(p.Management,p.Configuring,p.QueryingJson,f.Translation,f.NestedSolrTranslation))(this),t.addListeners(new f.ResultWidget(m.extend(!0,{},this,{id:"result",target:s,itemId:"s_uuid",nestLevel:"composition",onClick:function(t,e){var a,i;n.findItem(e.s_uuid)<0&&(n.addItem(e),a="",(i=m('a[href="#basket_tab"]')).html(f.ui.updateCounter(i.html(),n.length)),n.enumerateItems(function(t){a+=t.s_uuid+";"}),(a=f.modifyURL(window.location.href,"basket",a))&&window.history.pushState({query:window.location.search},document.title,a),m("footer",this).toggleClass("add none"))},onCreated:function(t){m("footer",this).addClass("add")}}))),t.addListeners(new(h(p.Widgets.Pager))({id:"pager",target:m("#pager"),prevLabel:"&lt;",nextLabel:"&gt;",innerWindow:1,renderHeader:function(t,e,a){m("#pager-header").html("<span>displaying "+Math.min(a,e+1)+" to "+Math.min(a,e+t)+" of "+a+"</span>")}}));for(var o=0,r=this.facets.length;o<r;++o){var l=this.facets[o],d=new i(m.extend({target:this.accordion,expansionTemplate:"tab-topcategory",subtarget:"ul",runMethod:b,multivalue:this.multipleSelection,aggregate:this.aggregateFacets,exclusion:this.multipleSelection||this.keepAllFacets,useJson:!0,renderItem:u,init:c,onUpdated:g,nesting:"type_s:substance",domain:{type:"parent",which:"type_s:substance"},classes:l.color},l));d.afterTranslation=function(t){this.populate(this.getFacetCounts(t.facets))},m(d.target).closest("div.widget-content").find("input.switcher").val(d.aggregate?"OR":"AND"),t.addListeners(d)}t.addListeners(new a({id:"studies",target:this.accordion,subtarget:"ul",expansionTemplate:"tab-topcategory",before:"#cell_header",field:"loValue_d",lookupMap:this.lookupMap,pivot:this.pivot,statistics:{min:"min(loValue_d)",max:"max(loValue_d)",avg:"avg(loValue_d)"},slidersTarget:m("#sliders"),multivalue:this.multipleSelection,aggregate:this.aggregateFacets,exclusion:this.multipleSelection||this.keepAllFacets,useJson:!0,renderTag:u,classes:"dynamic-tab",nesting:"type_s:substance",domain:{type:"parent",which:"type_s:substance"}})),t.addListeners(new f.CurrentSearchWidget({id:"current",target:m("#selection"),renderItem:u,useJson:!0})),this.basket=n=new(h(f.ListWidget,f.ItemListWidget))(m.extend(!0,{},this,{id:"basket",target:m("#basket-docs"),summaryRenderers:this.summaryRenderers,itemId:"s_uuid",onClick:function(t,e){var a,i,s;!1!==n.eraseItem(e.s_uuid)?(m(this).remove(),a="",i=m('a[href="#basket_tab"]'),s=m("#result_"+e.s_uuid),i.html(f.ui.updateCounter(i.html(),n.length)),n.enumerateItems(function(t){a+=t.s_uuid+";"}),(a=f.modifyURL(window.location.href,"basket",a))&&window.history.pushState({query:window.location.search},document.title,a),0<s.length&&m("footer",s[0]).toggleClass("add none")):console.log("Trying to remove from basket an inexistent entry: "+JSON.stringify(e))},onCreated:function(t){m("footer",this).addClass("remove")}})),t.addListeners(e=new p.UrlPersistency({id:"persist",storedParams:["q","fq","json.filter"]})),h.act(this,this.onPreInit,t),t.init(),e.restore(),t.doRequest()},updateButtons:function(t){var e,a,i=m("button",t);m("#export_dataset").buttonset("option","disabled")?i.button("option","label","No target dataset selected...").button("disable"):m(t).find("input[name=export_dataset]").val()&&(e=m("#export_dataset :radio:checked + label").text().toLowerCase(),a=m(t.export_format).data("name").toUpperCase(),i.button("enable").each(function(){var t=m(this);t.button("option","label",f.formatString(t.data("format"),{source:e,format:a}))}))},initQueries:function(){var e=this;this.queries=new(h(f.ListWidget))({id:"queries",target:m("#predefined-queries")}),this.queries.renderItem=function(t){return el$=f.ui.getTemplate("query-item",t),el$.data("query",t.filters),el$.on("click",function(t){e.executeQuery(m(this).data("query")),m("#result-tabs").tabs("option","active",0)}),el$},this.queries.populate(this.savedQueries)},initExport:function(){var o=this;this.prepareFormats(),this.prepareTypes(),m("#export_dataset").buttonset(),m("#export_dataset input").on("change",function(t){o.updateButtons(this.form)}),m("#export_tab button").button({disabled:!0});var i=m("#export_go");i.on("click",function(t){var e=i.button("option","label"),a=(new Date).getTime();i.button("option","label","Downloading..."),o.makeExport(m("#export_tab form")[0],function(t){null!=t&&(console.error(t),"object"==typeof t&&(t=t.message||"Wrong request!")),setTimeout(function(){i.button("option","label",(t||e).substr(0,40))},Math.max(0,a+900-(new Date).getTime()))})}),m("#result-tabs").tabs({activate:function(t,e){var a,i,s,n;"export_tab"==e.newPanel[0].id&&(i=0<((a=o.manager.getParameter("q").value)&&a.length)||0<o.manager.getParameter("json.filter").length,s=!!o.basket.length,n=i||s,m("#export_dataset").buttonset(n?"enable":"disable"),m("#export_select").toggleClass("disabled",!n),m("div.warning-message")[n?"hide":"show"](),m(".data_formats").toggleClass("disabled",!n),m("input#selected_data").prop("checked",s).prop("disabled",!s).toggleClass("disabled",!s),m("input#filtered_data").prop("checked",i&&!s).prop("disabled",!i).toggleClass("disabled",!i),m(".data_formats .jtox-ds-download a").first().trigger("click"),m(".data_formats .jtox-ds-download a").first().trigger("click"),m("#export_dataset").buttonset("refresh"),o.updateButtons(o.form))}})},executeQuery:function(t){var e=this.manager;e.removeParameters("fq"),e.removeParameters("json.filter"),e.getParameter("q").value="",t.forEach(function(t){t.id?e.getListener(t.id).addValue(t.value):e.addParameter(t)}),e.doRequest()},makeExport:function(e,i){var a=this,s=this.exportFormats[m(".data_formats .selected").data("index")],t=this.exportTypes[parseInt(e.export_select.value)],n=_.defaultsDeep(m.extend(!0,{},t.definition),this.exportDefaultDef),o=t.server||s.server,r=this.getSelectedIds(e),l=function(t){e.search.value=t.join(" "),e.action=a.ambitUrl+"query/substance/study/uuid?media="+encodeURIComponent(e.export_format.value)},s=s.name;Array.prototype.unshift.apply(n.extraParams,this.exportSolrDefaults);var d,u,c=new(h(f.Exporting,p.Configuring,p.QueryingJson))({exportDefinition:n,useJson:!1,expectJson:!0});return c.init(this.manager),"ambitUrl"==o?r?l(r):m.ajax(c.prepareExport([{name:"wt",value:"json"},{name:"fl",value:"s_uuid_hs"}],r).getAjax(a.serverUrl,{async:!1,dataType:"json",success:function(t){var a=[];m.each(t.response.docs,function(t,e){a.push(e.s_uuid_hs)}),l(a),i()},error:function(t,e,a){i(a)}})):(d=c.prepareExport("tsv"==s?[{name:"wt",value:"json"},{name:"json2tsv",value:!0}]:[{name:"wt",value:"xlsx"===s?"json":s}],r,!1).getAjax(this.solrUrl),u=function(t){f.activateDownload(null,t,"Report-"+(new Date).toISOString().replace(":","_")+"."+s,!0),i()},n.template&&"xlsx"===s?Promise.all([m.ajax(d),f.promiseXHR(m.extend({url:n.template,settings:{responseType:"arraybuffer"}},this.ajaxSettings))]).then(function(t){var a=t[0],e=t[1];"function"==typeof n.onData&&n.onData(a),XlsxPopulate.fromDataAsync(e).then(function(t){try{new XlsxDataFill(new XlsxDataFill.XlsxPopulateAccess(t,XlsxPopulate),n).fillData(a),t.outputAsync().then(u)}catch(e){i(e)}})["catch"](i)})["catch"](i):(d.dataType="application/json",d.settings={responseType:"arraybuffer"},f.promiseXHR(d).then(u)["catch"](i))),!0},getSelectedIds:function(t){var e=null;return"filtered"!=t.export_dataset.value&&(e=[],this.basket.enumerateItems(function(t){e.push(t.s_uuid)})),e},prepareFormats:function(){for(var t=m("#export_tab div.data_formats"),s=this,e=0,a=this.exportFormats.length;e<a;++e){var i=f.ui.getTemplate("export-format",this.exportFormats[e]);i.data("index",e),t.append(i),m("a",t[0]).on("click",function(t){var e,a=m(this),i=a.closest("form")[0];return a.hasClass("disabled")||a.hasClass("selected")||(e=a.closest("div.data_formats"),i.export_format.value=a.data("mime"),m(i.export_format).data("name",a.data("name")),s.updateButtons(i),m("div",e[0]).removeClass("selected"),e.addClass("selected"),a.closest(".jtox-fadable").addClass("selected")),!1})}},prepareTypes:function(){for(var e=this,t=m("#export_select"),a=function(t){m(".data_formats a").addClass("disabled"),t.split(",").forEach(function(t){m(".data_formats a[data-name="+t+"]").removeClass("disabled")}),m(".data_formats a:visible").not(".disabled").first().trigger("click")},i=0,s=this.exportTypes.length;i<s;++i)t.append(f.ui.getTemplate("select-one-option",m.extend({value:i,selected:0==i?"selected":""},this.exportTypes[i])));t.on("change",function(t){return a(e.exportTypes[parseInt(this.value)].formats),!1}),a(this.exportTypes[0].formats)}}}(Solr,asSys,jQuery,jToxKit),function(s,n,o){o.ui.Logging=function(t){var e,i,a=n(t.target);s.extend(!0,this,s.common(t,this)),this.target=t.target,a.html(o.ui.templates["logger-main"]),a.addClass("jtox-toolkit jtox-log"),"number"==typeof this.lineHeight&&(this.lineHeight=this.lineHeight.toString()+"px"),"number"!=typeof this.keepMessages&&(this.keepMessages=parseInt(this.keepMessages)),this.listRoot=n(".list-root",this.target)[0],this.statusEl=n(".status",this.target)[0],this.rightSide?(this.statusEl.style.right="0px",a.addClass("right-side")):this.statusEl.style.left="0px",this.setStatus(""),this.events={},this.autoHide&&(a.bind("click",function(t){n(this).toggleClass("hidden")}),a.bind("mouseleave",function(t){n(this).addClass("hidden")})),this.mountDestination&&(e="object"==typeof this.mountDestination?this.mountDestination:_.get(window,this.mountDestination),i=this,e.onPrepare=function(t){return i.beforeRequest(t)},e.onSuccess=function(t,e,a){return i.afterRequest(t,a,e)},e.onError=function(t,e){return i.afterFailure(t,e)})},o.ui.Logging.prototype={mountDestination:null,statusDelay:1500,keepMessages:50,lineHeight:"20px",rightSide:!1,hasDetails:!0,autoHide:!0,formatEvent:function(t,e){var a={};return null!=t&&(a.header=t.method.toUpperCase()+": "+t.service,a.details="..."),null!=e&&(a.details=e.status+" "+e.statusText+"<br/>"+e.getAllResponseHeaders()),a},formatUrl:function(t){return t.protocol+"://"+t.host+t.path},setIcon:function(t,e){"error"==e?t.addClass("ui-state-error"):t.removeClass("ui-state-error"),t.data("status",e),"error"==e?n(".icon",t).addClass("ui-icon ui-icon-alert").removeClass("loading ui-icon-check"):"success"==e?n(".icon",t).addClass("ui-icon ui-icon-check").removeClass("loading ui-icon-alert"):(n(".icon",t).removeClass("ui-icon ui-icon-check ui-icon-alert"),"connecting"==e&&n(".icon",t).addClass("loading"))},setStatus:function(t){var e=this;n(".icon",e.statusEl).removeClass("jt-faded"),e.setIcon(n(e.statusEl),t),"error"!=t&&"success"!=t||setTimeout(function(){n(".icon",e.statusEl).addClass("jt-faded");var t=!1;n(".logline",e.listRoot).each(function(){"connecting"==n(e).data("status")&&(t=!0)}),t&&e.setStatus("connecting")},e.statusDelay)},addLine:function(t){var a=this,i=o.ui.getTemplate("logger-line",t);for(i.height("0px"),this.listRoot.insertBefore(i[0],this.listRoot.firstElementChild),setTimeout(function(){i.height(a.lineHeight)},150),a.hasDetails&&n(".icon",i[0]).on("click",function(t){var e;i.toggleClass("openned"),i.hasClass("openned")?(n(".info-field",i[e=0]).each(function(){e+=this.offsetHeight}),i.height(e+6)):i.height(a.lineHeight),t.stopPropagation()});this.listRoot.childNodes.length>a.keepMessages;)this.listRoot.removeChild(this.listRoot.lastElementChild);return i},beforeRequest:function(t){t.service=this.formatUrl(o.parseURL(t.url));var e=this.formatEvent(t),a=this.addLine(e);this.setStatus("connecting"),this.events[t.logId=Date.now()]=a,this.setIcon(a,"connecting"),a.data("status","connecting")},afterResponse:function(t,e,a){var i=this.events[e.logId];this.setStatus(t),i?(delete this.events[e.logId],i.html(o.formatString(o.ui.templates["logger-line"],this.formatEvent(null,a)))):(e.service||(e.service=this.formatUrl(o.parseURL(e.url))),i=this.addLine(this.formatEvent(e,a))),this.setIcon(i,t)},afterRequest:function(t,e,a){this.afterResponse("success",e,a)},afterFailure:function(t,e){this.afterResponse("error",e,t),console&&console.log("Error ["+e.service+"]: "+t.statusText)}}}(asSys,jQuery,jToxKit),function(S,r,k,E){var o={target:{code:"T",tag:"target",name:"Target"},source:{code:"S",tag:"source",name:"Source"},cm:{code:"CM",tag:"cm",name:"Category Member"},"?":{code:"?",tag:"ukn",name:"Unspecified"}};function MatrixKit(t){var e=this;k(this.rootElement=t.target).addClass("jtox-toolkit"),E.ui.putTemplate("all-matrix"," ? ",this.rootElement),this.settings=k.extend(!0,{baseFeatures:E.ambit.baseFeatures},MatrixKit.defaults,t),E.ui.rebindRenderers(this,this.settings.baseFeatures,!0),this.reboundHandlers=S.defaults(S.mapValues(this.settings.handlers,function(t){return S.bind(t,e)}),E.tables.commonHandlers),E.ui.installHandlers(this,this.rootElement,this.reboundHandlers),S.defaults(this.settings.formatters,E.ambit.formatters),this.bundleSummary={compound:0,substance:0,property:0,matrix:0},this.matrixGroups=null,"string"==typeof this.settings.studyTypeList&&(this.settings.studyTypeList=S.get(window,this.settings.studyTypeList,{}));var a=function(t){t&&E.fireCallback(e[k(t).data("loader")],e,t.id,t,!0),k(".jq-buttonset.auto-setup input:checked",t).trigger("change")};return k(this.rootElement).tabs({disabled:[1,2,3,4,5],heightStyle:"content",select:function(t,e){a(e.panel)},activate:function(t,e){e.newPanel&&a(e.newPanel[0])},create:function(t,e){e.panel&&a(e.panel[0])}}),k(".jq-buttonset",this.rootElement).buttonset(),this.onIdentifiers(null,k("#jtox-identifiers",this.rootElement)[0]),this.settings.bundleUri&&this.loadBundle(this.settings.bundleUri),this}MatrixKit.prototype.loadBundle=function(t){var s=this;E.ambit.call(s,t,function(t){t&&(t=t.dataset[0],s.bundleUri=t.URI,s.bundle=t,s.baseUrl=s.settings.baseUrl=E.formBaseUrl(s.bundleUri),s.createForm&&(E.ui.updateTree(s.createForm,t,s.settings.formatters),k("#status-"+t.status).prop("checked",!0),s.starHighlight(k(".data-stars-field div",s.createForm)[0],t.stars),s.createForm.stars.value=t.stars,k(s.createForm.assFinalize).show(),k(s.createForm.assNewVersion).show(),k(s.createForm.assStart).hide()),k(s.rootElement).tabs("enable",1),E.ambit.call(s,t.URI+"/summary",function(t){if(t)for(var e=0,a=t.facet.length;e<a;++e){var i=t.facet[e];s.bundleSummary[i.value]=i.count}s.updateTabs()}),s.loadUsers(),E.fireCallback(s.settings.onLoaded,s))})},MatrixKit.prototype.beginAmbitCall=function(t){return new jBox("Notice",{animation:"flip",color:"green",content:this.settings.language.tasks[t+".progress"]||t,delayOnHover:!0,delayClose:1e3,showCountdown:!1,offset:{y:50}})},MatrixKit.prototype.endAmbitCall=function(t,e,a){e.setContent(200!==a.status?'<span style="color: #d20">'+(this.settings.language.tasks[t+".error"]||"Error on saving "+t+"!")+"</span>":this.settings.language.tasks[t+".done"]||t+" saved."|"Saved.")},MatrixKit.prototype.pollAmbit=function(t,e,a,i){var s="bundle",n=this,o=t&&(this.bundleUri||"")+t||e.uri;a&&(s="string"==typeof a?a:k(a).addClass("loading").data("subject")||"bundle");var r=this.beginAmbitCall(s);E.ambit.call(this,o,e,E.ambit.taskPoller(this,function(t,e){if(a&&k(a).removeClass("loading"),n.endAmbitCall(s,r,e),"function"==typeof i)return i(t)}))},MatrixKit.prototype.getTagButtonsRenderer=function(i){var s=this;return function(t,e,a){return"display"!==e?t:E.ui.fillHtml("matrix-tag-buttons",{subject:i,tag:(t[s.bundleUri]||{}).tag||""})}},MatrixKit.prototype.getMoveRenderer=function(s,n){return function(t,e,a){if("display"!==e)return t;var i=[];return i.push(E.ui.fillHtml("matrix-sel-arrow",{subject:s,direction:"up"})),"function"==typeof n&&i.push(n(t,e,a)),i.push(E.ui.fillHtml("matrix-sel-arrow",{subject:s,direction:"down"})),i.join("<br/>")}},MatrixKit.prototype.starHighlight=function(t,e){k("span",t).each(function(t){t<e?k(this).removeClass("transparent"):k(this).addClass("transparent")})},MatrixKit.prototype.loadUsers=function(){var a=this;a.bundle&&k(".jtox-users-select",this.rootElement).each(function(){var t=k(this).data("jtox-widget"),e="users-read"==this.id?"R":"W";t.settings.baseUrl=a.baseUrl,t.loadUsers("mode="+e+"&bundle_uri="+encodeURIComponent(a.bundleUri))})},MatrixKit.prototype.onIdentifiers=function(t,e){var a,i,s,n,o=this;e&&!k(e).hasClass("initialized")&&(k(e).addClass("initialized"),k(".label-box label",e).each(function(){var t=o.settings.language.labels[this.htmlFor];null==t||("string"==typeof t?this.innerHTML=t:"object"==typeof t&&"hide"===t.action&&k(this).closest(".label-box").hide().find("input,select,textarea").removeAttr("required"))}),o.createForm=k("form",e)[0],o.createForm.onsubmit=function(t){t.preventDefault(),t.stopPropagation(),E.validateForm(o.createForm)&&(this.bundleUri=null,o.pollAmbit(o.settings.baseUrl+"bundle",{method:"POST",data:k(o.createForm).serializeArray()},k(t.currentTarget),function(t,e){t?(E.addHistory(E.addParameter(window.location.href,"bundleUri="+encodeURIComponent(t.uri)),"Bundle editing"),o.loadBundle(t.uri)):console.log("Error on creating bundle ["+e.status+"]: "+e.statusText)}))},o.createForm.assFinalize.onclick=function(t){var e;t.preventDefault(),t.stopPropagation(),o.bundleUri&&((e=k(this)).addClass("loading"),E.ambit.call(o,o.bundleUri,{method:"PUT",data:{status:"published"}},function(t){e.removeClass("loading"),t?k('.data-field[data-field="status"]').html(formatStatus("published")):o.load(o.bundleUri)}))},o.createForm.assNewVersion.onclick=function(t){var e;t.preventDefault(),t.stopPropagation(),o.bundleUri&&((e=k(this)).addClass("loading"),E.ambit.call(o,o.bundleUri,{method:"PUT",data:{status:"archived"}},function(t){e.removeClass("loading"),t||o.load(o.bundleUri)}),E.ambit.call(o,o.bundleUri+"/version",{method:"POST"},function(t,e){t?o.load(t):console.log("Error on creating bundle ["+e.status+": "+e.statusText)}))},k(o.createForm.assFinalize).hide(),k(o.createForm.assNewVersion).hide(),(a=k(".data-stars-field",o.createForm)[0]).innerHTML+=E.ui.putStars(o,0,"Assessment rating"),k("span.fa-star",a).on("mouseover",function(t){for(var e=this;e;e=e.previousElementSibling)k(e).removeClass("transparent");for(e=this.nextElementSibling;e;e=e.nextElementSibling)k(e).addClass("transparent")}).on("click",function(t){for(var e=0,a=this;a;a=a.previousElementSibling,++e);o.createForm.stars.value=e,k(o.createForm.stars).trigger("change")}).parent().on("mouseout",function(t){o.starHighlight(this,parseInt(o.createForm.stars.value))}),k("input, select, textarea",o.createForm).on("change",function(t){var e;o.bundleUri&&E.validateForm(o.createForm)&&!k(this).hasClass("ignore-auto")&&(t.preventDefault(),t.stopPropagation(),(e={})[this.name]=this.value,o.pollAmbit("",{method:"PUT",data:e},k(this),function(t){t||o.loadBundle(o.bundleUri)}))}),i=k("#source-link")[0],s=k("#source"),i.href=s[0].value,s.on("change",function(){i.href=this.value}),n=r(E.AutocompleteWidget,E.UserWidget),k(".jtox-users-select",this.rootElement).each(function(){var t=new n({target:this,baseUrl:o.settings.baseUrl,initialState:"disabled",tokenMode:!0,permission:k(this).data("permission"),onChange:function(){var e=this,t=this.findBox.val().split(","),a=S.map(t,function(t){return e.settings.permission+"="+t});return a.push("bundle_number="+o.bundle.number),o.pollAmbit(null,{uri:o.settings.baseUrl+"myaccount/users",method:"POST",data:a.join("&")},"user",function(t){Array.isArray(t)&&e.fillData(t)}),!0}});k(this).data("jtox-widget",t),t.init()}))},MatrixKit.prototype.onStructures=function(t,e){var i,a,s;this.queryKit||(i=this,a=E.tables.insertRenderer(this.settings.baseFeatures["#SelectionCol"],this.getTagButtonsRenderer("structure"),{separator:"<br/>"}),this.browserKit=E.ui.initKit(k("#struct-browser"),{baseUrl:this.settings.baseUrl,baseFeatures:S.defaults({"#SelectionCol":a},this.settings.baseFeatures),groups:this.settings.groupSets.structure,handlers:this.reboundHandlers,formatters:this.settings.formatters,columns:this.settings.columns,onLoaded:function(t){"selected"===i.queryKit.queryType()&&(i.bundleSummary.compound=t.dataEntry.length,i.updateTabs())},onComplete:function(){"function"==typeof i.loadedMonitor&&i.loadedMonitor("structure",i.browserKit)},onDetails:function(t,e){var a=E.formBaseUrl(this.datasetUri);new E.ui.Substance({baseUrl:this.baseUrl,target:t,substanceUri:a+"substance?type=related&compound_uri="+encodeURIComponent(e.compound.URI),showControls:!1,onLoaded:null,onRow:null,handlers:i.reboundHandlers,onDetails:function(t,e){new E.ui.Study({baseUrl:this.settings.baseUrl,target:t,substanceUri:e.URI})}})}}),s=!1,this.queryKit=E.ui.initKit(k("#struct-query"),{mainKit:this.browserKit,onSelected:function(t,e){"selected"==e?s=!0:s&&(this.getMainKit().emptyTable(),s=!1)},customSearches:{selected:{title:"Selected",description:"List selected structures",onSelected:function(t){k("div.search-pane",t).hide(),i.browserKit.query(i.bundleUri+"/compound")}}}})),e&&this.queryKit.query()},MatrixKit.prototype.onSubstances=function(t,e){var s,n;this.substanceKit||(s=this,n=E.tables.insertRenderer(E.ui.Substance.defaults.columns.substance.Id,S.bind(E.tables.getSelectionRenderer("substance","substanceSelect"),this),{separator:"<br/>",position:"before"}),this.substanceKit=E.ui.initKit(k("#substance-selector"),{baseUrl:this.settings.baseUrl,baseFeatures:this.settings.baseFeatures,groups:this.settings.groupSets.substance,formatters:this.settings.formatters,handlers:this.reboundHandlers,columns:{structure:this.settings.columns.substance},onComplete:function(){"function"==typeof s.loadedMonitor&&s.loadedMonitor("substance",s.substanceKit)},onDetails:function(t,e){var a=E.formBaseUrl(this.datasetUri),i=a+"substance?type=related&addDummySubstance=true&compound_uri="+encodeURIComponent(e.compound.URI)+"&filterbybundle="+encodeURIComponent(s.bundleUri)+"&bundle_uri="+encodeURIComponent(s.bundleUri);new E.ui.Substance({baseUrl:a,target:t,substanceUri:i,showDiagrams:!0,handlers:s.reboundHandlers,embedComposition:!0,showControls:!1,onDetails:null,columns:{substance:{Id:n,"#ConstituentContainedAs":s.settings.baseFeatures["#ConstituentContainedAs"]}},onComplete:function(){s.updateTabs(),"function"==typeof s.loadedMonitor&&s.loadedMonitor("relation",this)},onRow:function(t,e,a){var i;e.bundles&&(i=e.bundles[s.bundleUri],k("input.jtox-handler",t).prop("checked",!!i&&"selected"==i.tag))}})}}),k(".details-expand-all",e).on("click",function(){k(".jtox-details-open.fa-folder",e).trigger("click")}),k(".details-collapse-all",e).on("click",function(){k(".jtox-details-open.fa-folder-open",e).trigger("click")})),e&&this.substanceKit.query(this.bundleUri+"/compound")},MatrixKit.prototype.onEndpoints=function(t,e){var s,a;this.endpointKit||(s=this,a=E.tables.insertRenderer(E.ui.Endpoint.defaults.columns.endpoint.Id,S.bind(E.tables.getSelectionRenderer("endpoint","endpointSelect"),this),{separator:"<br/>",position:"before"}),this.endpointKit=E.ui.initKit(k("#endpoint-selector"),{handlers:this.reboundHandlers,formatters:this.settings.formatters,showMultiselect:!0,columns:k.extend({endpoint:{Id:a}},this.settings.columns),onRow:function(t,e,a){var i;e.bundles&&(i=e.bundles[s.bundleUri],k("input.jtox-handler",t).prop("checked",!!i&&"selected"==i.tag))}}))},MatrixKit.prototype.saveMatrixEdit=function(t,e){var a;t&&(a=this).pollAmbit("/matrix"+("effects_to_delete"in t?"/deleted":""),{method:"PUT",data:JSON.stringify({study:t}),contentType:"application/json"},e,function(t){a.queryMatrix("working")})},MatrixKit.prototype.queryMatrix=function(t){var e=k("#jtox-matrix"),a="initial"==t?"/dataset?mergeDatasets=true":"/matrix/"+t,i="working"==t;"initial"==t||0<this.bundleSummary.matrix?(k(".jtox-toolkit",e).show(),k(".create-button",e).hide()):(k(".jtox-toolkit",e).hide(),k(".create-button",e).show()),this.matrixEditable=i,this.matrixKit.query(this.bundleUri+a,this.resetFeatures),this.resetFeatures=!1},MatrixKit.prototype.getFeatureRenderer=function(w,C,j){var T=this;return function(t,e,a){if("display"!=e)return E.simplifyValues(t);var i="";for(var s in w.dataset.feature){var n=w.dataset.feature[s];if(n.sameAs==C.sameAs&&null!=t[s]){for(var o,r=E.ambit.parseFeatureId(s).category,l=k.extend(!0,{},w.settings.columns._,w.settings.columns[r]),d=t[s],u=!1!==S.get(l,"effects.endpoint.bVisible")?"<strong>"+n.title+"</strong>":null,c="&nbsp;<span class='fa "+(n.isModelPredictionFeature?"fa-calculator":"fa-tag")+"' title='"+n.source.type+"'></span>",p=[],h=[],m=[],f=0,g=n.annotation.length;f<g;f++){var b,v=n.annotation[f];"conditions"==v.type&&1==S.get(l,'conditions["'+v.p.toLowerCase()+'"].inMatrix',!1)?(b=S.get(l,'conditions["'+v.p.toLowerCase()+'"].sTitle',"")||v.p,m.push(b+" = "+v.o)):"parameters"==v.type&&h.push(v.o)}0<h.length&&p.push("<span>"+h.join(", ")+"</span>"),0<m.length&&p.push("<span>"+m.join(", ")+"</span>"),S.get(l,"protocol.guideline.inMatrix",!1)&&n.creator&&"null"!=n.creator&&"no data"!=n.creator&&p.push('<span class="shortened" title="'+n.creator+'">'+n.creator+"</span>"),o=0<p.length?"("+p.join(", ")+")":"",n.isMultiValue&&Array.isArray(d)||(d=[d]);for(var f=0,x=d.length;f<x;++f){var y=d[f];y.deleted&&!T.matrixEditable||(i+='<div class="feature-entry" data-feature="'+s+'" data-index="'+f+'">',T.matrixEditable&&(i+='<span class="fa '+(y.deleted?"fa-info":"fa-minus-circle")+' fa-action jtox-handler" data-handler="openPopup" data-action="delete"></span>&nbsp;'),i+='<a class="'+(y.deleted?"deleted":"")+' jtox-handler" data-handler="openPopup" data-action="info" href="#">'+E.ui.renderRange(y,n.units,"display",u)+"</a>"+c+" "+o,i+=E.ui.fillHtml("info-ball",{href:a.compound.URI+"/study?property_uri="+encodeURIComponent(s),title:s+" property detailed info"}),i+="</div>")}}}return T.matrixEditable&&(i+='<span class="fa fa-plus-circle fa-action feature-entry jtox-handler" data-handler="openPopup" data-action="add" data-feature="'+j+'"></span>'),i}},MatrixKit.prototype.getMatrixGrouper=function(){var l=this;return function(a,t){var e={Identifiers:l.settings.groupSets.matrix.Identifiers},i={};for(var s in a.feature){var n,o=a.feature[s];null==o.sameAs||o.sameAs.indexOf("echaEndpoints.owl#")<0||(null==(r=e[n=E.ambit.parseFeatureId(s).topcategory])&&(e[n]=r=[]),null==i[o.sameAs]&&(i[o.sameAs]=!0,o.title||(o.title=o.sameAs.substr(o.sameAs.indexOf("#")+1)),o.data="values",o.render=l.getFeatureRenderer(t,o,s),o.column={className:"breakable",width:"80px",orderable:!1},r.push(s)))}for(var r in e)"Identifiers"!=r&&e[r].sort(function(t,e){return a.feature[t].title==a.feature[e].title?0:a.feature[t].title<a.feature[e].title?-1:1});return e}},MatrixKit.prototype.openFeatureBox=function(t,e){var a,i,s,n,o,r=e.data("feature"),l=e.data("index"),d=E.tables.getRowData(e),u=S.extend({id:E.ambit.parseFeatureId(r)},this.matrixKit.dataset.feature[r]);boxOptions={title:u.title||u.id.category||"Endpoint",closeButton:"box",closeOnEsc:!0,overlay:!0,closeOnClick:"body",addClass:"jtox-toolkit "+t,theme:"TooltipBorder",animation:"move",maxWidth:800,onCloseComplete:function(){this.destroy()}},self=this,"add"===t||"edit"===t?(null==this.studyOptionsHtml&&(this.studyOptionsHtml=S.map(this.settings.studyTypeList,function(t,e){return'<option value="'+e+'">'+t.title+"</option>"})),a={owner:{substance:{uuid:d.compound.i5uuid}},protocol:{topcategory:u.id.topcategory,category:{code:u.id.category},endpoint:u.title,guideline:""},citation:{year:(new Date).getFullYear().toString()},parameters:{},interpretation:{},reliability:{},effects:{result:{},conditions:{}}},i=function(){a.effects=[a.effects],a.protocol.guideline=[a.protocol.guideline],"add"===t?self.saveMatrixEdit(a,"annotation-add"):"edit"===t&&self.editMatrixFeature(u,l,a)},boxOptions=k.extend(boxOptions,{content:this.endpointKit.getFeatureEditHtml(u,s,{studyOptionsHtml:this.studyOptionsHtml}),confirmButton:"Add",confirm:i,onConfirm:i,onOpen:function(){E.ui.Endpoint.attachEditors(self.endpointKit,this.content,a,{ajax:{method:"GET",data:{category:u.id.category,top:u.id.topcategory,max:self.endpointKit.settings.maxHits}},searchTerm:"data.search"})}})):(u.id.suffix="*",s=d.values[r],n=E.ambit.buildFeatureId(u.id),u.isMultiValue&&Array.isArray(s)&&(s=s[l]),"delete"===t?(o={owner:{substance:{uuid:d.compound.i5uuid}},effects_to_delete:[{result:{idresult:s.idresult,deleted:!0}}]},k.extend(boxOptions,{title:this.matrixKit.feature[n]&&this.matrixKit.feature[n].title||boxOptions.title,content:this.endpointKit.getFeatureInfoHtml(u,s,"info"!==t),confirmButton:"info"!==t?"Delete":"Ok",cancelButton:"info"!==t?"Cancel":"Dismiss",confirm:function(){self.saveMatrixEdit(o,"annotation-delete")},onConfirm:function(){self.saveMatrixEdit(o,"annotation-delete")},onOpen:function(){E.ui.Endpoint.attachEditors(self.endpointKit,this.content,o)}})):k.extend(boxOptions,{target:e,overlay:!1,outside:"xy",title:this.matrixKit.feature[n]&&this.matrixKit.feature[n].title||boxOptions.title,content:this.endpointKit.getFeatureInfoHtml(u,s,"info"!==t)})),new jBox("info"===t?"Tooltip":"Confirm",boxOptions).open()},MatrixKit.prototype.getMatrixFeatures=function(){var i=this,t={},s=this.getTagButtonsRenderer("substance");return t["#IdRow"]={primary:!0,render:this.getMoveRenderer("substance",this.settings.baseFeatures["#IdRow"].render)},t["#SelectionCol"]={render:function(t,e,a){return"display"!==e?t:i.matrixEditable?s(t,e,a):i.settings.baseFeatures["#TagCol"].render(t,e,a)}},t["#TagCol"]={title:"",primary:!0,data:"composition",column:{className:"jtox-multi"},render:function(t,e,a){return"display"!==e?S.map(t,["component","bundles",i.bundleUri,"tag"]).join(","):E.tables.renderMulti(t,a,function(t){return i.settings.baseFeatures["#TagCol"].render(t.component.bundles,e,t)})}},t["#MultiDiagram"]={primary:!0,data:"composition",column:{className:"jtox-multi"},render:function(t,e,a){return"display"!==e?S.map(t,"component.compound.URI").join(","):E.tables.renderMulti(t,a,function(t){return i.settings.baseFeatures["http://www.opentox.org/api/1.1#Diagram"].render(t.component.compound.URI,e,t)})}},S.defaultsDeep(t,this.settings.baseFeatures)},MatrixKit.prototype.onMatrix=function(t,e){var a,i;this.matrixKit||(a=a=this,i=k("#matrix-table"),this.matrixKit=E.ui.initKit(i,{formatters:this.settings.formatters,handlers:this.reboundHandlers,hasDetails:!1,groups:this.settings.groupSets.matrix,featureUri:this.bundleUri+"/property",baseFeatures:this.getMatrixFeatures(),groups:this.getMatrixGrouper(),onLoaded:function(t){E.ui.Compound.processFeatures(t.feature,this.feature);for(var e=0,a=t.dataEntry.length;e<a;++e){var i=t.dataEntry[e];if(null!=i.composition)for(var s=0;s<i.composition.length;++s)E.ui.Compound.processEntry(i.composition[s].component,t.feature)}},onComplete:function(){"function"==typeof a.loadedMonitor&&a.loadedMonitor("matrix",a.matrixKit)},onRow:function(t,e,a){k("td.jtox-multi .jtox-diagram .jtox-handler",t).on("click",function(){setTimeout(function(){E.tables.equalizeHeights.apply(window,k("td.jtox-multi table tbody",t).toArray())},10)})}}),k(".create-button",e).on("click",function(){a.pollAmbit("/matrix/working",{method:"POST",data:{deletematrix:!1}},k(this),function(t){t&&(k("#xfinal").button("enable"),a.bundleSummary.matrix++,a.queryMatrix("working"))})})),this.resetFeatures=!0,this.onEndpoints()},MatrixKit.prototype.onReport=function(t,s){var n=this,o=0,r=3,l=function(t){return k(t).find("td>.source>button:not(.source),td>.target>button:not(.target),td>.cm>button:not(.cm)").remove(),t};n.loadedMonitor=function(t,e){var a,i=k("table.dataTable",e.rootElement);++o,"matrix"==t?(n.loadedTables.composition=l(E.tables.extractTable(i[0])),n.loadedTables.matrix=l(E.tables.extractTable(i,{transpose:!0,stripSizes:!0,ignoreCols:[6,11]}))):"substance"==t?(a=k(".jtox-details-open.jtox-handler",e.rootElement),r+=a.length,n.loadedTables.substance=k("table.dataTable",n.substanceKit.rootElement),setTimeout(function(){a.trigger("click")},50)):"relation"==t?(n.loadedTables.relation||(n.loadedTables.relation=[]),n.loadedTables.relation.push(l(E.tables.extractTable(i)))):n.loadedTables[t]=l(E.tables.extractTable(i)),r<=o&&(n.loadedTables.substance=E.tables.extractTable(n.loadedTables.substance),k(".report-box",s).html(E.ui.fillHtml("matrix-full-report",k.extend({bundleId:n.bundle.id,dataTables:S.mapValues(n.loadedTables,function(t){return Array.isArray(t)?null:t.html()})},n.bundle),n.settings.formatters)),E.ui.installHandlers(n,s),n.loadedMonitor=null)},k(".report-box",s).html("<h2>Preparing the report...</h2>"),this.loadedTables={},this.onStructures(),this.onSubstances(),this.onMatrix(),this.queryKit.queryType("selected").query(),this.substanceKit.query(this.bundleUri+"/compound"),this.queryMatrix("final")},MatrixKit.prototype.prepareWordReport=function(t){var n=[],i=k.extend({},this.bundle),s=this,a=function(t){var e=k(t),a=e.find("img"),i=a.prop("src");if(!i)return e.text();var s={url:i,index:n.length,width:a[0].width,height:a[0].height};return n.push(s),s},e=["number","tag","cas","name","i5uuid","source"];i.created=this.settings.formatters.formatDate(this.bundle.created),i.updated=this.settings.formatters.formatDate(this.bundle.updated),i.structures=E.tables.extractData(this.loadedTables.structure,["index","tag","image","casrn","ecnum","names","rationale"],a).slice(1),S.each(this.loadedTables.relation,function(t,e){i.structures[e].substances=E.tables.extractData(t,["i","name","uuid","type","pubname","refuuid","owner","info","contained"],a).slice(1)}),i.matrix=E.tables.extractData(this.loadedTables.composition,["number","tag","cas","substancename","i5uuid","datasource","structuretag","image","constituentname","content","containedas"],a).slice(1);var o=E.tables.extractData(this.loadedTables.matrix,["title"],function(t,e){if("title"==e)return k(t).text();var a=[];return k(".feature-entry",t).each(function(){a.push('<w:r><w:rPr><w:color w:val="'+(0<k(".ui-icon-calculator",this).length?"FF0000":"0000FF")+'" /></w:rPr><w:t xml:space="preserve">'+S.escape(k(this).text())+"</w:t></w:r>")}),0<a.length?'<w:p><w:pPr><w:pStyle w:val="Style16"/><w:rPr></w:rPr></w:pPr>'+a.join("<w:r><w:br /></w:r>")+"</w:p>":k(t).text()});i.matrixGroups=[];for(var r=0;r<i.matrix.length;r+=3){for(var l={values:[]},d=0;d<o.length;++d){var u=e[d],c=l;u||(u="value",c={});for(var p=1;p<=3;++p)c[u+p]=o[d][r+p]||"";"value"==u&&(c.title=o[d].title,l.values.push(c))}i.matrixGroups.push(l)}var h=S.map(n,function(t){return E.promiseXHR(k.extend({url:t.url,settings:{responseType:"arraybuffer"}},s.settings.ajaxSettings))});h.push(E.promiseXHR(k.extend({url:this.settings.reportTemplate,settings:{responseType:"arraybuffer"}},s.settings.ajaxSettings))),Promise.all(h).then(function(e){var t=new Docxgen,a=new ImageModule({centered:!1});a.getSizeFromData=function(t){return[t.width/2,t.height/2]},a.getImageFromData=function(t){return e[t.index]},t.attachModule(a),t.load(e[e.length-1]),t.setData(i),t.render(),E.activateDownload(null,t.getZip().generate({type:"blob",compression:"DEFLATE"}),E.formatString(s.settings.reportName,{bundleId:s.bundleId,date:(new Date).toISOString().replace(":","_")},s.settings.formatters),!0)})},MatrixKit.prototype.updateTabs=function(){var a=this.bundleSummary;k("li>a.jtox-summary-entry",this.rootElement).each(function(){var t=a[k(this).data("summary")],e=this.innerHTML;k(this).html(E.ui.updateCounter(e,t))}),k(this.rootElement).tabs(0<this.bundleSummary.compound?"enable":"disable",2),k(this.rootElement).tabs(0<this.bundleSummary.substance?"enable":"disable",3),k(this.rootElement).tabs(0<this.bundleSummary.property?"enable":"disable",4),k(this.rootElement).tabs(0<this.bundleSummary.matrix?"enable":"disable",5),k("#xfinal").button(0<this.bundleSummary.matrix?"enable":"disable")},MatrixKit.prototype.tagStructure=function(a){var i=a.data("tag"),t=a.closest("tr"),s=E.tables.getRowData(t),n=!s.bundles[this.bundleUri]||s.bundles[this.bundleUri].tag!=i,o=this;this.pollAmbit("/compound",{method:"PUT",data:{compound_uri:s.compound.URI,command:n?"add":"delete",tag:i}},a,function(t){var e;t&&(n?o.bundleUri in s.bundles?(s.bundles[o.bundleUri].tag=i,s.bundles[o.bundleUri].remarks=""):(s.bundles[o.bundleUri]={tag:i,remarks:""},o.bundleSummary.compound++):(delete s.bundles[o.bundleUri],o.bundleSummary.compound--),(e=E.tables.getTable(a).row(s.index)).invalidate().draw(),E.ui.installHandlers(o.browserKit,e.node()),E.tables.getTable(o.browserKit.varTable).row(s.index).invalidate().draw(),o.updateTabs())})},MatrixKit.prototype.reasonStructure=function(a){var i=E.tables.getRowData(a),t=i.bundles[this.bundleUri],s=this;t?this.pollAmbit("/compound",{method:"PUT",data:{compound_uri:i.compound.URI,command:"add",tag:t.tag,remarks:a.val()}},a,function(t){var e;t&&(i.bundles[s.bundleUri].remarks=a.val(),(e=E.tables.getTable(s.browserKit.varTable).row(i.index)).invalidate().draw(),E.ui.installHandlers(s.browserKit,e.node()))}):console.warn("Empty bundle info came for: "+JSON.stringify(i))},MatrixKit.prototype.selectSubstance=function(e){var t=E.tables.getCellData(e),a=this,i=e.prop("checked");this.pollAmbit("/substance",{method:"PUT",data:{substance_uri:t,command:i?"add":"delete"}},e,function(t){t||e.prop("checked",!i),i?a.bundleSummary.substance++:a.bundleSummary.substance--,a.updateTabs()})},MatrixKit.prototype.selectEndpoint=function(e){var t=E.tables.getRowData(e),a=e.prop("checked"),i=this;this.pollAmbit("/property",{method:"PUT",data:{topcategory:t.subcategory,endpointcategory:t.endpoint,command:a?"add":"delete"}},e,function(t){t?a?i.bundleSummary.property++:i.bundleSummary.property--:e.prop("checked",!a),i.featuresInitialized=!1,i.updateTabs()})},MatrixKit.prototype.tagSubstance=function(t){var a=k(t).data("tag"),i=E.tables.getRowData(t),s=E.tables.getTable(t),n=this;this.pollAmbit("/substance",{method:"PUT",data:{substance_uri:i.compound.URI,command:"add",tag:a}},t,function(t){t&&(i.bundles[n.bundleUri].tag=a);var e=s.row(i.index);e.invalidate().draw(),E.ui.installHandlers(n.matrixKit,e.node())})},MatrixKit.defaults={rootElement:null,maxStars:10,studyTypeList:{},reportTemplate:"../../../assets/report_templates/assessment-report.docx",reportName:"report-{{date}}.docx",handlers:{structureTag:function(t){return this.tagStructure(k(t.currentTarget))},structureReason:function(t){return this.reasonStructure(el$=k(t.currentTarget))},substanceSelect:function(t){this.selectSubstance(k(t.currentTarget))},expandAll:function(t){var e=k(t.currentTarget).closest(".ui-tabs-panel");k(".jtox-details-open.fa-folder",e).trigger("click")},collapseAll:function(t){var e=k(t.currentTarget).closest(".ui-tabs-panel");k(".jtox-details-open.fa-folder-open",e).trigger("click")},endpointSelect:function(t){this.selectEndpoint(k(t.currentTarget))},endpointMode:function(t){var e=encodeURIComponent(this.bundleUri),a=this.settings.baseUrl+"query/study?mergeDatasets=true&bundle_uri="+e;"erelevant"==k(t.currentTarget).attr("id")&&(a+="&selected=substances&filterbybundle="+e),this.endpointKit.query(a)},openPopup:function(t){var e=k(t.currentTarget);t.preventDefault(),t.stopPropagation(),this.openFeatureBox(e.data("action"),e.closest(".feature-entry"))},matrixMode:function(t){this.queryMatrix(k(t.currentTarget).attr("id").substr(1))},createWorkingCopy:function(t){this.createWorkingCopy()},substanceTag:function(t){this.tagSubstance(k(t.currentTarget))},substanceMove:function(t){var e=k(t.currentTarget),a=e.data("direction"),i=E.tables.getTable(e),s=E.tables.getRowData(e),n=i.row(s.index+("up"==a?-1:1)).data(),o=E.tables.getTable(this.matrixKit.varTable),r=s.index;s.index=n.index,n.index=r,i.row(s.index).data(s),i.row(n.index).data(n).draw();var l=o.row(s.index).data();o.row(s.index).data(o.row(n.index).data()),o.row(n.index).data(l).draw(),this.matrixKit.equalizeTables(),E.ui.installHandlers(this.matrixKit,i.row(s.index).node()),E.ui.installHandlers(this.matrixKit,i.row(n.index).node()),E.ui.installHandlers(this.matrixKit,o.row(s.index).node()),E.ui.installHandlers(this.matrixKit,o.row(n.index).node())},reportWord:function(t){this.prepareWordReport(k(t.currentTarget))}},groupSets:{structure:{Identifiers:["#SelectionCol","http://www.opentox.org/api/1.1#Diagram","#DetailedInfoRow","http://www.opentox.org/api/1.1#CASRN","http://www.opentox.org/api/1.1#EINECS"],Names:["http://www.opentox.org/api/1.1#ChemicalName"],Calculated:E.ui.Compound.defaults.groups.Calculated,Other:["http://www.opentox.org/api/1.1#Reasoning"]},substance:{Identifiers:["http://www.opentox.org/api/1.1#Diagram","#DetailedInfoRow","http://www.opentox.org/api/1.1#CASRN","http://www.opentox.org/api/1.1#EINECS","http://www.opentox.org/api/1.1#ChemicalName"],Other:["http://www.opentox.org/api/1.1#Reasoning","#TagCol"]},matrix:{Identifiers:["#SelectionCol","http://www.opentox.org/api/1.1#CASRN","#SubstanceName","#SubstanceUUID","http://www.opentox.org/api/1.1#SubstanceDataSource","#TagCol","#MultiDiagram","#ConstituentName","#ConstituentContent","#ConstituentContainedAs"]}},formatters:{formatStatus:function(t){return{draft:"Draft Version",published:"Final Assessment",archived:"Archived Version"}[t]}},language:{labels:{title:"Assessment title",maintainer:"Owner",number:"Assessment ID",seeAlso:"Assessment code",source:"Assessment Doclink(s)",license:{action:"hide"},rightsHolder:{action:"hide"},stars:{action:"hide"}},tasks:{"bundle.progress":"Changing bundle...","bundle.done":"Bundle altered.","bundle.error":"Error changing the bundle!","bundle-start.progress":"Creating a new bundle...","bundle-start.done":"New bundle created.","bundle-start.error":"Error on creating a new bundle!","bundle-finalize.progress":"Finalizing the bundle...","bundle-finalize.done":"Bundle finalized.","bundle-finalize.error":"Error on bundle finalizing!","bundle-version.progress":"Making new version of the bundle...","bundle-version.done":"New version created.","bundle-version.error":"Error on creating a new version!","matrix.progress":"Creating matrix working copy...","matrix.done":"Matrix working copy created.","matrix.error":"Error on matrix working copy creation!","structure-reason.progress":"Updating structure selection reason...","structure-reason.done":"Updated structure selection reason.","structure-reason.error":"Error on updating structure selection reason!","structure-tag.progress":"Tagging the selected structure...","structure-tag.done":"Structured tagged.","structure-tag.error":"Error on structure tagging!","annotation-add.progress":"Adding a study annotation...","annotation-add.done":"Added study annotation.","annotation-add.error":"Error on adding study annotation!","annotation-delete.progress":"Deleting a study annotation...","annotation-delete.error":"Error on deleting study annotation!","annotation-delete.done":"Study annotation deleted.","substance.progress":"Updating substance selection...","substance.done":"Substance selection updated.","substance.error":"Error updating substance selection!","substance-tag.progress":"Tagging substance...","substance-tag.done":"Substance tagged.","substance-tag.error":"Error on tagging substance!","substance-reason.progress":"Saving substance selection reason...","substance-reason.done":"Substance selection reason saved.","substance-reason.error":"Error saving substance selection reason!","endpoint.progress":"Updating endpoint selection...","endpoint.done":"Endpoint selection updated.","endpoint.error":"Error updating endpoint selection!","user.progress":"Updating user access rights...","user.done":"User permissions updated.","user.error":"Error updating user permissions!"}},baseFeatures:{"#SelectionCol":{data:"bundles",column:{className:"center",width:"60px"},search:!0,primary:!0},"#TagCol":{title:"Tag",data:"bundles",column:{className:"center",width:"60px"},search:!0,primary:!1,render:function(t,e,a){var i=t[this.bundleUri],s=i&&i.tag||"?",n=o[s];return n&&"display"===e?E.ui.fillHtml("matrix-tag-indicator",S.defaults({subject:"substance"},n)):s}},"http://www.opentox.org/api/1.1#Reasoning":{title:"Rationale",data:"compound.URI",search:!0,primary:!1,column:{width:"300px",className:"paddingless"},render:function(t,e,a){var i=a.bundles[this.bundleUri]||{};return t=i.tag&&i.remarks||"","display"!=e?t:'<textarea class="remark jtox-handler" data-handler="structureReason" data-subject="structure-reason" placeholder="Reason for selection_"'+(i.tag?"":' disabled="true"')+'">'+t+"</textarea>"}},"http://www.opentox.org/api/1.1#CompositionInfo":{visibility:"details",title:"Composition",data:"compound.URI",column:{bVisible:!1},basic:!0,render:function(t,e,a){return"details"!=e?"-":'<span class="jtox-details-composition"></span>'}},"http://www.opentox.org/api/1.1#ChemicalName":{render:function(t,e,a){return t.replace(/\|/g," | ")}},"#SubstanceName":{title:"Substance Name",data:"compound.name",primary:!0,basic:!0,column:{className:"breakable word-break"},render:function(t,e,a){return t||a.compound.tradename}},"#SubstanceUUID":{title:"I5UUID",data:"compound.i5uuid",primary:!0,render:function(t,e,a){return"display"!=e?t:E.ui.shortenedData('<a target="_blank" href="'+a.compound.URI+'/study">'+t+"</a>","Press to copy the UUID in the clipboard",t)}},"http://www.opentox.org/api/1.1#SubstanceDataSource":{title:"Data source",data:"compound.ownerName",accumulate:!0,primary:!0,column:{className:"breakable"}},"#ConstituentName":{title:"Constituent Name",data:"composition",accumulate:!1,primary:!0,column:{className:"breakable work-break jtox-multi"},render:function(t,e,a){return"display"!==e?S.map(t,"component.compound.name").join(","):E.tables.renderMulti(t,a,"component.compound.name")}},"#ConstituentContent":{title:"Content",data:"composition",accumulate:!1,primary:!0,column:{className:"center jtox-multi"},render:function(t,e,a){return"display"!==e?S.map(t,"proportion.typical").join(","):E.tables.renderMulti(t,a,function(t){return E.ambit.formatters.formatConcentration(t.proportion.typical)})}},"#ConstituentContainedAs":{title:"Contained As",data:"composition",accumulate:!1,primary:!0,column:{className:"center jtox-multi"},render:function(t,e,a){return"display"!==e?S.map(t,"relation").join(","):E.tables.renderMulti(t,a,function(t){return"<span>"+t.relation.substring(4).toLowerCase()+"</span>"+E.ui.fillHtml("info-ball",{href:t.substance.URI+"/composition",title:t.compositionName})})}}}},E.ui.Matrix=MatrixKit}(_,asSys,jQuery,jToxKit),function(o,p,h){function buildValueRange(t,e){var a=" = ";return a+=null==t.min?"-&#x221E;":t.min,t.avg&&(a+="&#x2026;"+t.avg),a+="&#x2026;"+(null==t.max?"&#x221E;":t.max),e&&(a+=" "+h.formatUnits(t.val).replace(/<sup>(2|3)<\/sup>/g,"&#x00B$1;").replace(/<sup>(\d)<\/sup>/g,"^$1")),a}function InnerTagWidgeting(t){this.id=t.id,this.pivotWidget=t.pivotWidget}var m=/\W/g;InnerTagWidgeting.prototype={pivotWidget:null,hasValue:function(t){return this.pivotWidget.hasValue(this.id+":"+t)},clickHandler:function(t){return this.pivotWidget.clickHandler(this.id+":"+t)},modifyTag:function(t){return t.hint=t.unit?"\n"+t.unit.buckets.map(function(t){return buildValueRange(t,!0)}).join("\n"):t.buildValueRange(t),t.color=this.color,t}};var f=o(h.TagWidget,InnerTagWidgeting);h.PivotWidgeting=function(t){o.extend(!0,this,o.common(t,this)),this.target=t.target,this.targets={},this.lastEnabled=0,this.initialPivotCounts=null},h.PivotWidgeting.prototype={__expects:["getFaceterEntry","getPivotEntry","getPivotCounts","auxHandler"],automatic:!1,renderTag:null,multivalue:!1,aggregate:!1,exclusion:!1,init:function(t){o.pass(this,h.PivotWidgeting,"init",t),this.manager=t,this.manager.getListener("current").registerWidget(this,!0)},addFaceter:function(t,e){var a=o.pass(this,h.PivotWidgeting,"addFaceter",t,e);return"object"==typeof t&&(a.color=t.color),e>this.lastEnabled&&!t.disabled&&(this.lastEnabled=e),a},afterTranslation:function(t){var e=this.getPivotCounts(t.facets);for(o.pass(this,h.PivotWidgeting,"afterTranslation",t),i=0;i<e.length;++i){var a=e[i],s=a.val.replace(m,"_"),n=this.targets[s];n?n.target.children("ul").hide():(this.targets[s]=n=new h.AccordionExpansion(p.extend(!0,{},this.settings,this.getFaceterEntry(0),{id:s,title:a.val})),n.updateHandler=this.updateHandler(n),n.target.children().last().remove()),this.traversePivot(n.target,a,1),n.updateHandler(a.count)}this.target.accordion("refresh")},updateHandler:function(t){var e=t.getHeaderText();return function(t){e.textContent=h.ui.updateCounter(e.textContent,t)}},prepareTag:function(t){var e=this.parseValue(t);return{title:e.value,color:this.faceters[e.id].color,count:"i",onMain:this.unclickHandler(t),onAux:this.auxHandler(t)}},traversePivot:function(t,e,a){var i=[],s=this.getPivotEntry(a),n=e[s.id].buckets;if(a===this.lastEnabled){var o=t.data("widget");o?t.children().slice(1).remove():((o=new f({id:s.id,color:s.color,renderItem:this.renderTag,pivotWidget:this,target:t,multivalue:this.multivalue,aggregate:this.aggregate,exclusion:this.exclusion})).init(this.manager),t.data({widget:o,id:s.id})),o.populate(n,!0),i=[]}else if(null!=n)for(var r=0,l=n.length;r<l;++r){var d,u=n[r],c=u.val.replace(m,"_");1<t.children().length?d=p("#"+c,t[0]).show():(d=h.ui.getTemplate("tag-facet",s).attr("id",c),u.title=u.val,u.onMain=this.clickHandler(s.id+":"+u.val),u.hint=buildValueRange(u),d.append(this.renderTag(u).addClass("category title").addClass(s.color)),i.push(d)),this.traversePivot(d,u,a+1)}t.append(i)}}}((Solr,asSys),jQuery,jToxKit),function(x,y,w){var n={auto:"/query/compound/search/all",uri:"/query/compound/url/all",similarity:"/query/similarity",smarts:"/query/smarts"};function QueryKit(t){this.settings=y.extend(!0,{},QueryKit.defaults,t),y(this.rootElement=t.target).addClass("jtox-toolkit").append(w.ui.getTemplate("kit-query-all",this.settings)),this.search={mol:"",type:"",queryType:"auto"};var a=y("form",this.rootElement)[0];if(a.onsubmit=function(){return!1},this.settings.hideOptions)for(var e=this.settings.hideOptions.split(","),i=0;i<e.length;++i)y("#search"+e[i],this.rootElement).remove(),y('label[for="search'+e[i]+'"]',this.rootElement).remove();a.searchcontext&&(a.searchcontext.value=this.settings.contextUri,y(a.searchcontext).on("change",function(t){this.settings.contextUri=this.value}));var s=this;y(a.searchbox).on("change",function(){s.setAuto()}),this.settings.slideInput&&y(a.searchbox).on("focus",function(){var t=y(a).width()-y(o).width()-30-y(".search-pane").width(),e=y(this).data("oldSize")||y(this).width();y(this).data("oldSize",e),y(this).css("width",e+t+"px")}).on("blur",function(){y(this).css("width","")});var n=!1;0<y("#searchuri",this.rootElement).length&&(n=!0,y(a.searchbox).autocomplete({minLength:2,open:function(){y(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){y(this).removeClass("ui-corner-top").addClass("ui-corner-all")},source:function(t,e){w.ambit.call(this,"/dataset?search=^"+t.term,function(t){e(t?y.map(t.dataset,function(t){var e=t.URI.lastIndexOf("/");return{label:(0<=e?"D"+t.URI.substring(e+1)+": ":"")+t.title,value:t.URI}}):[])})}}));var o=y(".jq-buttonset",this.rootElement);y.each(this.settings.customSearches,function(t,e){e.id=t,w.ui.getTemplate("kit-query-option",e).appendTo(o)}),o=o.buttonset();var r=function(){a.searchbox.placeholder=y(this).data("placeholder"),y(".search-pane .auto-hide",s.rootElement).addClass("hidden"),y(".search-pane ."+this.id,s.rootElement).removeClass("hidden"),s.search.queryType=this.value,"uri"==this.value?(y("div.search-pane",a).show(),y(a.drawbutton).addClass("hidden"),n&&y(a.searchbox).autocomplete("enable")):s.settings.customSearches&&s.settings.customSearches[this.value]?w.fireCallback(s.settings.customSearches[this.value].onSelected,this,s,a):(y("div.search-pane",a).show(),y(a.drawbutton).removeClass("hidden"),n&&y(a.searchbox).autocomplete("disable")),w.fireCallback(s.settings.onSelected,s,a,this.value)};y(".jq-buttonset input",this.rootElement).on("change",r);var l=y("#search"+this.settings.option,this.rootElement)[0];if(null!=l?y(l).trigger("click"):w.fireCallback(r,y(".jq-buttonset input",this.rootElement)[0]),window[this.settings.smartsList]){for(var d=window[this.settings.smartsList],u=[],c={},i=0,p=d.length;i<p;++i){var h=d[i];c[h.family]===undefined&&(c[h.family]=u.length,u.push([])),u[c[h.family]].push(h)}var m=document.createDocumentFragment();for(fi=0,fl=u.length;fi<fl;++fi){var f=document.createElement("optgroup");for(f.label=u[fi][0].family,i=0,el=u[fi].length;i<el;++i){var g=u[fi][i],b=document.createElement("option");b.innerHTML=g.name,b.value=g.smarts,g.hint&&y(b).attr("data-hint",g.hint),f.appendChild(b)}m.appendChild(f)}a.smarts.appendChild(m),a.smarts.firstElementChild.checked=!0,y(a.smarts).on("change",function(){var t=y(this[this.selectedIndex]).data("hint");a.smarts.title=t||"",s.setAuto(this.value)})}this.initComposer(a);var v=!1;this.settings.b64search?(this.setMol(window.atob(this.settings.b64search)),v=!0):this.settings.search&&(this.setAuto(this.settings.search),v=!0),w.ui.installHandlers(this),v&&this.settings.initialQuery&&x.defer(function(t){t.query()},this)}QueryKit.prototype.initComposer=function(a){document.getElementById("mol-composer")||y(document.body).append(w.ui.getTemplate("kit-query-composer",this.settings));var i=this,s=function(){var t=document.getElementById("ketcher-mol-frame");return"contentDocument"in t?t.contentWindow.ketcher:document.frames.ifKetcher.window.ketcher};y("#mol-composer").on("shown.bs.modal",function(t){var e=i.search.mol||a.searchbox.value;e&&s().setMolecule(e)}),y("#mol-composer button.mol-apply").on("click",function(t){var e=s();i.setMol(e.getMolfile()),a.searchbox.value=e.getSmiles()})},QueryKit.prototype.getMainKit=function(){return this.mainKit||("string"==typeof this.settings.mainKit?this.mainKit=w.ui.kit(y(this.settings.mainKit)):this.settings.mainKit instanceof Element?this.mainKit=w.ui.kit(this.settings.mainKit):"object"==typeof this.settings.mainKit&&(this.mainKit=this.settings.mainKit)),this.mainKit},QueryKit.prototype.queryType=function(t){return null==t?this.search.queryType:(this.search.queryType=t,this)},QueryKit.prototype.query=function(t){t&&this.setAuto(t);var e=x.trimEnd(w.formBaseUrl(this.settings.datasetUri||this.getMainKit().datasetUri),"/"),a=y("form",this.rootElement)[0],i={type:this.search.type},s=this.search.queryType;s in n?("auto"===s&&"auto"===i.type&&0==a.searchbox.value.indexOf("http")&&(s="uri"),e+=n[s]+"?",this.search.mol?i.b64search=window.btoa(this.search.mol):(i.search=a.searchbox.value,i.search||(i.search=this.settings.defaultNeedle),this.setAuto(i.search)),"auto"===s&&a.regexp.checked?i.condition="regexp":"smarts"===s?i.filterBySubstance=a.smartsbysubstance.checked:"similarity"===s&&(i.threshold=a.threshold.value,i.filterBySubstance=a.similaritybysubstance.checked),this.settings.contextUri&&(i.datasetUri=this.settings.contextUri),e=w.addParameter(e,y.param(i)),this.getMainKit().query(e)):s in this.settings.customSearches?w.fireCallback(this.settings.customSearches[s].onSelected,this,y("form",this.rootElement)[0]):console.warn("QueryKit: Unknown query type selected: "+s)},QueryKit.prototype.getNeedle=function(){return"mol"==this.search.type?this.search.mol:y("form",this.rootElement)[0].searchbox.value},QueryKit.prototype.setAuto=function(t){this.search.mol=null,this.search.type="auto";var e=y("form",this.rootElement)[0].searchbox;this.search.oldplace&&(e.placeholder=this.search.oldplace),null!=t&&(e.value=t)},QueryKit.prototype.setMol=function(t){var e=y("form",this.rootElement)[0].searchbox;this.search.mol=t,this.search.type="mol",this.search.oldplace=e.placeholder,e.placeholder="MOL formula saved_",e.value=""},QueryKit.defaults={defaultNeedle:"50-00-0",smartsList:"funcgroups",hideOptions:"",customSearches:null,slideInput:!1,contextUri:null,initialQuery:!1,onSelected:null,handlers:{query:function(){this.query()}}},w.ui.Query=QueryKit}(_,jQuery,jToxKit),function(p,r,u,c){function SimpleRanger(t){this.sliderRoot=t.sliderRoot}SimpleRanger.prototype.__expects=["addValue","doRequest"],SimpleRanger.prototype.targetValue=null,SimpleRanger.prototype.updateHandler=function(){var e=this;return function(t){e.addValue(t)&&(e.sliderRoot.updateRequest=!0,e.doRequest())}},SimpleRanger.prototype.doRequest=function(){this.manager.doRequest()},SingleRangeWidget=r(p.Ranging,p.Patterning,c.SliderWidget,SimpleRanger,p.Delaying);var s={facet:!0,rows:0,fl:"id","facet.limit":-1,"facet.mincount":1,echoParams:"none"};c.RangeWidgeting=function(t){r.extend(!0,this,r.common(t,this)),this.slidersTarget=u(t.slidersTarget),this.lookupMap=t.lookupMap||{},this.pivotMap=null,this.rangeWidgets=[],Array.isArray(this.titleSkips)||(this.titleSkips=[this.titleSkips])},c.RangeWidgeting.prototype={__expects:["getPivotEntry","getPivotCounts","parseValue"],field:null,titleSkips:null,init:function(t){r.pass(this,c.RangeWidgeting,"init",t),this.manager=t;var e=this;e.applyCommand=u("#sliders-controls a.command.apply").on("click",function(t){return e.skipClear=!0,e.manager.doRequest(),!1}),u("#sliders-controls a.command.close").on("click",function(t){return e.rangeRemove(),!1})},afterTranslation:function(t){var e=this.getPivotCounts(t.facets);if(r.pass(this,c.RangeWidgeting,"afterTranslation",t),this.pivotMap)if(this.updateRequest){if(0<this.rangeWidgets.length)for(var a=this.buildPivotMap(e),i=0;i<this.rangeWidgets.length;++i){var s=this.rangeWidgets[i],n=a[s.targetValue];s.updateSlider([n[i].min,n[i].max])}}else this.rangeRemove();else{var o=this.manager.getParameter("q").value||"";o&&"*:*"!=o||this.manager.getParameter(this.useJson?"json.filter":"fq").value||(this.pivotMap=this.buildPivotMap(e))}this.updateRequest=!1},getPivotFromId:function(t){for(var e=null,a=0;(e=this.getPivotEntry(a)).id!=t;++a);return e},buildPivotMap:function(t){for(var d=this,u={},c=function(t,e,a,i){var s,n,o=d.getPivotEntry(e);if(o.disabled||(i=o.id+":"+t.val),a+=(t.val?o.field+":"+p.escapeValue(t.val):"-"+o.field+":*")+" ",s=t,null!=(n=d.getPivotEntry(e+1))&&(t=t[n.id].buckets),null!=n&&t.length)for(var r=0,l=t.length;r<l;++r)c(t[r],e+1,a,i);else(u[i]=u[i]||[]).push({id:o.id,pattern:a,color:o.color,min:s.min,max:s.max,avg:s.avg,val:s.val,count:s.count})},e=0;e<t.length;++e)c(t[e],0,"");return u},rangeRemove:function(){this.slidersTarget.empty().parent().removeClass("active");for(var t=0,e=this.rangeWidgets.length;t<e;++t)this.rangeWidgets[t].clearValues();this.rangeWidgets=[],this.lastPivotValue=null},buildTitle:function(t,e){for(var a=t.pattern.replace(/\\"/g,"%0022").match(/\w+:([^\s:\/"]+|"[^"]+")/g),i=[],s=0;s<a.length;++s){var n=a[s].match(/(\w+):([^\s:\/"]+|"[^"]+")/),o=n[2].replace(/^\s*\(\s*|\s*\)\s*$/g,"");n[1].match(e)||i.push(this.lookupMap[o]||o)}return i.join("/")+" <i>("+t.count+")</i>"},ensurePivotMap:function(e){if(null!=this.pivotMap)return e(this.pivotMap);var a=this.useJson?"json.filter":"fq",i=this;return this.doSpying(function(t){t.removeParameters(a),t.removeParameters("fl"),t.getParameter("q").value="",t.mergeParameters(s)},function(t){e(i.pivotMap=i.buildPivotMap(i.getPivotCounts(t.facets)))}),!1},openRangers:function(t){var e=this.pivotMap[t],a=this.buildPivotMap(this.getPivotCounts())[t];this.lastPivotValue=t,this.slidersTarget.empty().parent().addClass("active");for(var i=0,s=a.length;i<s;++i){var n=a[i],o=e.find(function(t){return t.pattern===n.pattern})||n,r=c.ui.getTemplate("slider-one"),l={id:n.id,targetValue:t,color:o.color,field:this.field,limits:[o.min,o.max],initial:[n.min,n.max],target:r,isRange:!0,valuePattern:n.pattern+"{{v}}",automatic:!0,title:this.buildTitle(n,/^unit[_shd]*|^effectendpoint[_shd]*/),units:"unit"==n.id?c.formatUnits(n.val):"",useJson:this.useJson,domain:this.domain,sliderRoot:this};this.slidersTarget.append(r),l.width=parseInt(this.slidersTarget.width()-u("#sliders-controls").width()-20)/(Math.min(s,2)+.1);var d=new SingleRangeWidget(l);this.rangeWidgets.push(d),d.init(this.manager)}},auxHandler:function(a){var i=this;return(this.getPivotFromId(this.parseValue(a).id)||{}).ranging?function(t){t.stopPropagation();var e=i.lastPivotValue;return i.rangeRemove(),a!=e&&i.ensurePivotMap(function(){i.openRangers(a)}),!1}:undefined},clearValues:function(){this.rangeRemove(),r.pass(this,c.RangeWidgeting,"clearValues")}}}(Solr,asSys,jQuery,jToxKit),function(t,l,n,o){var r='<a href="{{href}}" title="{{hint}}" target="{{target}}" class="{{css}}">{{value}}</a>';o.ItemListWidget=function(t){t.baseUrl=o.fixBaseUrl(t.baseUrl),l.extend(!0,this,l.common(t,this)),this.lookupMap=t.lookupMap||{},this.target=t.target,this.id=t.id,this.imagesRoot.match(/(\/|\\)$/)||(this.imagesRoot+="/")},o.ItemListWidget.prototype={baseUrl:"",summaryPrimes:["RESULTS"],imagesRoot:"../img/",tagDbs:{},onCreated:null,onClick:null,summaryRenderers:{RESULTS:function(t,e){var a=this;return t.map(function(t){return t.split(".").map(function(t){return a.lookupMap[t]||t}).join(".")})},REFOWNERS:function(t,e){return{topic:"Study Providers",content:t.map(function(t){return o.formatString(r,{href:"#",hint:"Freetext search",target:"_self",value:t,css:"freetext_selector"})})}},REFS:function(t,e){return{topic:"References",content:t.map(function(t){var e=null!=(e=t.match(/^doi:(.+)$/))?"https://www.doi.org/"+e[1]:t;return o.formatString(e.match(/^https?:\/\//)?r:'<span title="{{hint}}" class="{{css}}">{{value}}</span>',{href:e,hint:"External reference",target:"ref",value:t})})}}},renderLinks:function(t){var e=this.getBaseUrl(t)+"substance/",a={};if(null==t.content)a.link=e+t.s_uuid,a.link_target=t.s_uuid,a.footer='<a href="'+e+t.s_uuid+'" title="Substance" target="'+t.s_uuid+'">Material</a><a href="'+e+t.s_uuid+'/structure" title="Composition" target="'+t.s_uuid+'">Composition</a><a href="'+e+t.s_uuid+'/study" title="Study" target="'+t.s_uuid+'">Studies</a>',a.composition=this.renderComposition(t,'<a href="'+e+t.s_uuid+'/structure" title="Composition" target="'+t.s_uuid+'">&hellip;</a>').join("<br/>");else{a.link_target="external",a.composition=this.renderComposition(t),a.link_title=this.tagDbs[t.dbtag_hss]&&this.tagDbs[t.dbtag_hss].title||"External database",a.footer="";for(var i=0;i<t.content.length;++i)t.content[i].match(/^https?:\/\//)&&(a.link||(a.link=t.content[i]),a.footer+='<a href="'+t.content[i]+'" target="external">'+a.link_title+"</a>&nbsp;")}return a},renderItem:function(e){var a=this,i=n(this.renderSubstance(e));return i.length&&(n(this.target).append(i),"function"==typeof this.onClick&&n("a.command",i[0]).on("click",function(t){a.onClick.call(i[0],t,e,a)}),"function"==typeof this.onCreated&&this.onCreated.call(i,e,this),n("a.more",i[0]).on("click",function(t){t.preventDefault(),t.stopPropagation();var e=n(this),a=n(".more-less",e.parent()[0]);return a.is(":visible")?(a.hide(),e.text("more")):(a.show(),e.text("less")),!1})),null},renderSubstance:function(t){var e=o.ui.templates["summary-item"],a=this.buildSummary(t),i=function(t){return t.map(function(t){return o.formatString(e,t)}).join("")},s={logo:this.tagDbs[t.dbtag_hss]&&this.tagDbs[t.dbtag_hss].icon||this.imagesRoot+"external.png",link_title:this.tagDbs[t.dbtag_hss]&&this.tagDbs[t.dbtag_hss].title||"Substance",link_target:"_blank",link:"#",title:(t.publicname||t.name)+(t.pubname===t.name?"":"  ("+t.name+")")+(null==t.substanceType?"":" "+(this.lookupMap[t.substanceType]||t.substanceType)),summary:0<a.length?i(a.splice(0,this.summaryPrimes.length)):"",item_id:(this.prefix||this.id||"item")+"_"+t.s_uuid};return 0<a.length&&(s.summary+='<a href="#" class="more">more</a><div class="more-less" style="display:none;">'+i(a)+"</div>"),o.ui.getTemplate("result-item",n.extend(s,this.renderLinks(t)))},getBaseUrl:function(t){return o.fixBaseUrl(this.tagDbs[t.dbtag_hss]&&this.tagDbs[t.dbtag_hss].server||this.settings&&this.settings.baseUrl||this.baseUrl)},renderComposition:function(t,s){var a,n=[],e=t._extended_&&t._extended_.composition;return e&&(a={},l.each(e,function(t){var e=a[t.component_s],i=[];e===undefined&&(a[t.component_s]=e=[]),l.each(t,function(t,e){var a=e.match(/^(\w+)_[shd]+$/);(e=a&&a[1]||e).match(/type|id|component/)||i.push(o.formatString(r,{href:"#",hint:"Freetext search on '"+e+"'",target:"_self",value:t,css:"freetext_selector"}))}),e.push(i.join(", "))}),l.each(a,function(t,e){for(var a="",i=0;i<t.length;++i)""!=t[i]&&(a+=0==i?": ":"; ",1<t.length&&(a+="<strong>["+(i+1)+"]</strong>&nbsp;"),a+=t[i]);""===a&&s&&(a=":&nbsp;"+s),n.push(e+" ("+t.length+")"+a)})),n},buildSummary:function(t){var o=this,r=[];return l.each(t,function(t,e){var a,i,s,n=e.match(/^SUMMARY\.([^_]+)_?[hsd]*$/);n&&(n=n[1],(i="function"==typeof(a=o.summaryRenderers[n]||o.summaryRenderers._)?a.call(o,t,n):t)&&("object"!=typeof i||Array.isArray(i)?i={topic:n.toLowerCase(),values:i}:null==i.topic&&(i.topic=n.toLowerCase()),i.content||(i.content=Array.isArray(i.values)?i.values.join(", "):i.values.toString()),-1<(s=o.summaryPrimes.indexOf(n))&&s<r.length?r.splice(s,0,i):r.push(i)))}),r}},o.ResultWidgeting=function(t){l.extend(!0,this,l.common(t,this))},o.ResultWidgeting.prototype={__expects:["populate"],init:function(t){l.pass(this,o.ResultWidgeting,"init",t),this.manager=t},beforeRequest:function(){n(this.target).html(n("<img>").attr("src",this.imagesRoot+"ajax-loader.gif"))},afterFailure:function(t,e){n(this.target).html("Error retrieving data!")},afterTranslation:function(t){n(this.target).empty(),this.populate(t.entries)}},o.ResultWidget=l(t.Listing,o.ListWidget,o.ItemListWidget,o.ResultWidgeting)}(Solr,asSys,jQuery,jToxKit),function(b,v){var i=0,l=function(t){this.rootElement=t.target,this.instanceNo=i++,b(this.rootElement).addClass("jtox-toolkit"),this.settings=b.extend(!0,{},l.defaults,t),this.settings.tab=this.settings.tab||v.ui.fullUrl.hash,this.settings.errorDefault&&(l.defaults.errorDefault=this.settings.errorDefault);var e=v.ui.putTemplate("all-studies",{instanceNo:this.instanceNo},this.rootElement),a=this;this.tabs=e.tabs({select:function(t,e){a.loadPanel(e.panel)},beforeActivate:function(t,e){e.newPanel&&a.loadPanel(e.newPanel[0])}}),e.on("click","div.jtox-study-tab div button",function(t){var e=b(this).parents(".jtox-study-tab")[0];b(this).hasClass("expand-all")?b(".jtox-foldable",e).removeClass("folded"):b(this).hasClass("collapse-all")&&b(".jtox-foldable",e).addClass("folded")}),this.settings.substanceUri?this.querySubstance(this.settings.substanceUri):this.settings.substanceId&&this.querySubstance(this.settings.baseUrl+"substance/"+this.settings.substanceId)};l.prototype.loadPanel=function(e){var t,a=this;b(e).hasClass("unloaded")&&(t=a.addParameters(b(e).data("jtox-uri")),v.ambit.call(a,t,function(t){t&&(b(".jtox-study.folded",e).removeClass("folded"),b(e).removeClass("unloaded").addClass("loaded"),a.processStudies(e,t.study,!0),v.fireCallback(a.settings.onStudy,a,t.study))}))},l.prototype.createCategory=function(t,e){var a,i=b("."+e+".jtox-study",t);return i.length||(a=v.ui.putTemplate("one-study",{}).addClass(e),i=b(t).append(a)),i[0]},l.prototype.addParameters=function(t){for(var e=["property_uri","top","category"],a=0;a<e.length;++a){var i=e[a];this.settings[i]&&(t=v.addParameter(t,i+"="+this.settings[i]))}return t},l.prototype.ensureTable=function(t,e){var o,a,i,n=this,r=e.protocol.category.code,s=b("."+r+" .jtox-study-table",t)[0];return b(s).hasClass("dataTable")?b(s).DataTable().clear():(o=[],a=function(t,e){var a,i=0,s=[];for(var n in t){-1<s.indexOf(n)||(t[n+" unit"]!==undefined&&s.push(n+" unit"),null!=(a=e(n))&&(o.push(a),i++))}return i},(i=function(t,e,a){for(var i=0;i<e;++i){var s=b.extend({},l.defaultColumns[i+t]);null!=(s=v.tables.modifyColDef(n,s,r,a))&&o.push(s)}})(0,1,"main"),a(e.parameters,function(i){if(e.effects[0].conditions[i]!==undefined||e.effects[0].conditions[i+" unit"]!==undefined)return undefined;var t={title:i,className:"center middle",data:"parameters."+i,defaultContent:"-"};return null==(t=v.tables.modifyColDef(n,t,r,"parameters"))?null:(t.render=function(t,e,a){return v.ui.renderRange(t,a[i+" unit"],e)},t)}),a(e.effects[0].conditions,function(i){var t={title:i,className:"center middle jtox-multi",data:"effects"};return null==(t=v.tables.modifyColDef(n,t,r,"conditions"))?null:(t.render=function(t,a,e){return"display"!==a?_.map(t,["conditions",i]).join(","):v.tables.renderMulti(t,e,function(t,e){return v.ui.renderRange(t.conditions[i],t.conditions[i+" unit"],a)})},t)}),i(1,3,"effects"),a(e.interpretation,function(t){var e={title:t,className:"center middle jtox-multi",data:"interpretation."+t,defaultContent:"-"};return v.tables.modifyColDef(n,e,r,"interpretation")}),i(4,5,"protocol"),v.tables.sortColDefs(o),b(s).dataTable({paging:!0,processing:!0,lengthChange:!1,autoWidth:!1,dom:n.settings.dom,columns:o,infoCallback:function(t,e,a,i,s,n){var o=b(".title .counter",b(this).parents(".jtox-study"))[0];return o.innerHTML=v.ui.updateCounter(o.innerHTML,s),n},createdRow:function(t){v.tables.equalizeHeights.apply(window,b("td.jtox-multi table tbody",t).toArray())},language:n.settings.language}),b(s).DataTable().columns.adjust()),s},l.prototype.processSummary=function(t){var i=this,s={},n={"P-CHEM":"P-Chem",ENV_FATE:"Env Fate",ECOTOX:"Eco Tox",TOX:"Tox"};b(".jtox-study",i.rootElement).remove(),t.sort(function(t,e){var a=t.category.order||t.category.description||t.category.title,i=e.category.order||e.category.description||e.category.title;return null==a?-1:null==i?1:a==i?0:a<i?-1:1});var o=0,r=null;for(var e=0,a=t.length;e<a;++e){var l,d,u=t[e],c=u.topcategory.title;c&&(c=c.replace(/ /g,"_"),l=(l=b(".jtox-study-tab."+c,i.rootElement)[0])||function addStudyTab(t,e){var a=v.ui.addTab(i.tabs,n[t]||e.topcategory.title,"jtox-"+t.toLowerCase()+"-"+i.instanceNo,v.ui.getTemplate("one-category",i.substance));return a.tab.data("type",t),a.content.addClass(t).data("jtox-uri",e.topcategory.uri),o++,r=t,a.content[0]}(c,u),(d=u.category.title)?i.createCategory(l,d):s[c]=u.count)}1==o&&(i.settings.tab=r),b("ul li a",i.rootElement).each(function(t){var e,a,i=b(this).data("type");i&&(e=s[i],(a=b(this)[0]).innerHTML=v.ui.updateCounter(a.innerHTML,e))});for(var p=null,h=function(t){p&&clearTimeout(p);var i=t.currentTarget,s=b(this).parents(".jtox-study-tab")[0];p=setTimeout(function(){for(var t=b(".jtox-study-table",s),e=0,a=t.length;e<a;++e)b(t[e]).DataTable().search(i.value).draw()},300)},m=b(".jtox-study-tab"),f=0,g=m.length;f<g;f++)b(".jtox-study-filter",m[f])[0].onkeydown=h},l.prototype.processStudies=function(t,e,a){var i={},s=0;if(a)for(var n=0,o=e.length;n<o;++n){var r=e[n];a&&(i[r.protocol.category.code]===undefined?(i[r.protocol.category.code]=[r],s++):i[r.protocol.category.code].push(r))}else i[e[0].protocol.category.code]=e;for(var l in i){var d=i[l],u=b("."+l+".jtox-study",t);if(!(u.length<1)){v.ui.updateTree(u,{title:d[0].protocol.category.title+" (0)"});for(var e={},n=0,c=d.length;n<c&&(b.extend(!0,e,d[n]),b.isEmptyObject(e.parameters)||b.isEmptyObject(e.effects[0].conditions));++n);var p=this.ensureTable(t,e);b(p).DataTable().rows.add(d).draw(),b(p.tBodies[0]).children().each(function(){v.tables.equalizeHeights.apply(window,b("td.jtox-multi table tbody",this).toArray())}),1<s&&b(p).parents(".jtox-study").addClass("folded"),b(".jtox-multi",p[0]).each(function(){this.style.height=this.offsetHeight+"px"})}}},l.prototype.querySummary=function(t){var s=this;t=s.addParameters(t),v.ambit.call(s,t,function(t){if(t&&t.facet&&s.processSummary(t.facet),v.fireCallback(s.settings.onSummary,s,t.facet),s.settings.tab){var e=b(".jtox-study-tab."+decodeURIComponent(s.settings.tab).replace(/ /g,"_").toUpperCase(),s.root)[0];if(e){for(var a=0,i=e.parentNode.children.length;a<i&&e.parentNode.children[a].id!=e.id;++a);--a,b(s.tabs).tabs("option","active",a),b(s.tabs).tabs("option","selected",a)}}})},l.prototype.insertComposition=function(t){var e=b(".jtox-compo-tab",this.rootElement)[0];b(e).empty(),new v.ui.Composition(b.extend({},this.settings,{target:e,compositionUri:t}))},l.prototype.querySubstance=function(t){var a=this;this.settings.baseUrl=v.formBaseUrl(t),v.ambit.call(a,t,function(e){e&&e.substance&&0<e.substance.length?((e=e.substance[0]).showname=e.publicname||e.name,e.IUCFlags=v.ambit.formatters.extIdentifiers(e.externalIdentifiers),a.substance=e,v.ui.updateTree(b(".jtox-substance",a.rootElement),e,v.ambit.formatters),v.ambit.call(a,e.referenceSubstance.uri,function(t){t&&0<t.dataEntry.length&&(v.ambit.processDataset(t,null,v.ambit.getDatasetValue),v.ui.updateTree(b(".jtox-substance",a.rootElement),b.extend(e,t.dataEntry[0])))}),v.fireCallback(a.settings.onLoaded,a,e.substance),a.querySummary(e.URI+"/studysummary"),a.insertComposition(e.URI+"/composition")):v.fireCallback(a.settings.onLoaded,a,null),v.ui.notifyParents(a.rootElement,function(t){"function"==typeof t.equalizeTables&&t.equalizeTables()}),v.fireCallback(a.settings.onComplete,a)})},l.prototype.query=function(t){this.querySubstance(t)},l.prototype.getContext=function(){return{subject:"study",substanceUri:this.substance.URI,substanceId:this.substance.i5uuid,owner:this.substance.ownerName}},l.getFormatted=function(t,e,a){return"function"==typeof a?a.call(this,t,e):"string"==typeof a||"number"==typeof a?t[a]:t[0]},l.defaults={tab:null,dom:"rt<Fip>",language:{processing:'<img src="/assets/img/waiting_small.gif" border="0">',loadingRecords:"No studies found.",zeroRecords:"No studies found.",emptyTable:"No studies available.",info:"Showing _TOTAL_ study(s) (_START_ to _END_)",lengthMenu:'Display <select><option value="10">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option><option value="-1">all</option></select> studies.'},errorDefault:"Err",onSummary:null,onComposition:null,onStudy:null,onLoaded:null,onComplete:null,columns:{study:{_:{main:{},parameters:{},conditions:{},effects:{},protocol:{},interpretation:{}}}}},l.defaultColumns=[{title:"Name",className:"center middle",width:"15%",data:"protocol.endpoint"},{title:"Endpoint",className:"center middle jtox-multi",width:"10%",data:"effects",render:function(t,e,a){return v.tables.renderMulti(t,a,function(t){return l.getFormatted(t,e,"endpoint")+(t.endpointtype&&" ("+t.endpointtype+")"||"")})}},{title:"Result",className:"center middle jtox-multi",width:"10%",data:"effects",render:function(t,e,a){return v.tables.renderMulti(t,a,function(t){return v.ui.renderRange(t.result,null,e)+(t.result.errorValue&&" ("+t.result.errQualifier+" "+t.result.errorValue+")"||"")})}},{title:"Text",className:"center middle jtox-multi",width:"10%",data:"effects",render:function(t,e,a){return v.tables.renderMulti(t,a,function(t){return t.result.textValue||"-"})}},{title:"Guideline",className:"center middle",width:"15%",data:"protocol.guideline",render:"[,]",defaultContent:"-"},{title:"Owner",className:"center middle",width:"10%",data:"citation.owner",defaultContent:"-"},{title:"Citation",className:"center middle",width:"10%",data:"citation",render:function(t){return(t.title||"")+" "+(!!t.year||"")}},{title:"Reliability",className:"center middle",width:"10%",data:"reliability",render:function(t){return t.r_value}},{title:"UUID",className:"center middle",width:"15%",data:"uuid",searchable:!1,render:function(t,e){return"display"!=e?""+t:v.ui.shortenedData(t,"Press to copy the UUID in the clipboard")}}],v.ui.Study=l}((asSys,jQuery),jToxKit),function(l,d){function SubstanceKit(t){this.rootElement=t.target,l(this.rootElement).addClass("jtox-toolkit"),this.settings=l.extend(!0,{},SubstanceKit.defaults,t),this.pageStart=this.settings.pageStart,this.pageSize=this.settings.pageSize;var a=this;this.settings.embedComposition&&null==this.settings.onDetails&&(this.settings.onDetails=function(t,e){new d.ui.Composition(l.extend({target:t,compositionUri:e.URI+"/composition"},"object"==typeof a.settings.embedComposition?typeof a.settings.embedComposition:null))}),d.ui.putTemplate("all-substance"," ? ",this.rootElement),this.init(t),this.settings.substanceUri&&this.querySubstance(a.settings.substanceUri)}SubstanceKit.prototype.init=function(){var r=this,t=r.settings.columns.substance.Id,e={inplace:!0,separator:"<br/>"};"function"==typeof this.settings.onDetails&&d.tables.insertRenderer(t,d.tables.getDetailsRenderer("substance"),e),"function"==typeof this.settings.handlers.toggleSelection&&d.tables.insertRenderer(t,d.tables.getSelectionRenderer("substance"),e),r.settings.columns.substance.Owner.render=function(t,e,a){return"display"!=e?t:'<a target="_blank" href="'+r.settings.baseUrl+"substanceowner/"+a.ownerUUID+'/substance">'+t+"</a>"};var a={dom:"rti"};r.settings.showControls?(d.ui.installHandlers(this,this.rootElement,d.tables.commonHandlers),d.tables.updateControls.call(r),a.infoCallback=function(t,e,a,i,s,n){var o=l(".filterbox",r.rootElement).val();return l(".filtered-text",r.rootElement).html(o?' (filtered to <span class="high">'+s+"</span>) ":" "),""}):l(".jtox-controls",r.rootElement).remove(),r.table=d.tables.putTable(r,l("table",r.rootElement)[0],"substance",a)},SubstanceKit.prototype.queryEntries=function(s,n){s<0&&(s=0),(!n||n<0)&&(n=this.pageSize);var t=Math.floor(s/n),e=d.addParameter(this.substanceUri,"page="+t+"&pagesize="+n),o=this;d.ambit.call(this,e,function(t,e){if(t&&200==e.status){o.pageSize=n,o.pageStart=s;for(var a=0,i=t.substance.length;a<i;++a)t.substance[a].index=a+s+1;o.substance=t.substance,t.substance.length<o.pageSize&&(o.entriesCount=s+t.substance.length),d.fireCallback(o.settings.onLoaded,o,t),l(o.table).dataTable().fnClearTable(),t.substance.length&&l(o.table).dataTable().fnAddData(t.substance),d.tables.updateControls.call(o,s,t.substance.length)}else d.fireCallback(o.settings.onLoaded,o,t);d.ui.notifyParents(o.rootElement,function(t){"function"==typeof t.equalizeTables&&t.equalizeTables()}),d.fireCallback(o.settings.onComplete,o,t)})},SubstanceKit.prototype.querySubstance=function(t){this.substanceUri=d.ambit.grabPaging(this,t),this.settings.baseUrl=d.formBaseUrl(t),this.queryEntries(this.pageStart)},SubstanceKit.prototype.query=function(t){this.querySubstance(t)},SubstanceKit.defaults={showControls:!0,embedComposition:null,onDetails:null,onLoaded:null,onComplete:null,language:{loadingRecords:"No substances found.",zeroRecords:"No substances found.",emptyTable:"No substances available.",info:"Showing _TOTAL_ substance(s) (_START_ to _END_)"},pageStart:0,pageSize:10,handlers:{sizeChange:function(t){this.queryEntries(this.pageStart,parseInt(l(t.target).val()))},filter:function(t){l(this.table).dataTable().filter(l(t.target).val()).draw()},alignTables:function(){l(this.table).dataTable().fnAdjustColumnSizing()}},columns:{substance:{Id:{title:"Id",data:"URI",defaultContent:"-",className:"center",width:"60px",render:function(t,e,a){return"display"!=e?a.index:"&nbsp;-&nbsp;"+a.index+"&nbsp;-&nbsp;"}},"Substance Name":{title:"Substance Name",data:"name",render:function(t,e,a){return null!=t&&"null"!=t||(t="-"),"display"!=e?t:d.ui.linkedData('<a target="_blank" href="'+a.URI+'/study">'+t+"</a>","Click to view study details",t)}},"Substance UUID":{title:"Substance UUID",data:"i5uuid",render:function(t,e,a){return null==t||"null"==t?"":"display"!=e?t:d.ui.shortenedData('<a target="_blank" href="'+a.URI+'/study">'+t+"</a>","Press to copy the UUID in the clipboard",t)}},"Substance Type":{title:"Substance Type",data:"substanceType",width:"15%",defaultContent:"-"},"Public name":{title:"Public name",data:"publicname",defaultContent:"-"},"Reference substance UUID":{title:"Reference substance UUID",data:"referenceSubstance",render:function(t,e,a){return t&&t.i5uuid&&"null"!=t.i5uuid?"display"!=e?t.i5uuid:d.ui.shortenedData('<a target="_blank" href="'+t.uri+'">'+t.i5uuid+"</a>","Press to copy the UUID in the clipboard",t.i5uuid):""}},Owner:{title:"Owner",data:"ownerName",defaultContent:"-"},Info:{title:"Info",data:"externalIdentifiers",render:function(t,e,a){return t?"display"!=e?_.map(t,"id").join(", "):d.ambit.formatters.extIdentifiers(t):""}}}}},d.ui.Substance=SubstanceKit}((asSys,jQuery),jToxKit),function(a,e,i,s){function UserWidget(t){this.settings=i.extend(!0,{},UserWidget.defaults,t)}UserWidget.prototype.__expects=["resetValue","onFound"],UserWidget.defaults={extraParam:"",baseUrl:"",permission:"canRead"},UserWidget.prototype.init=function(t){e.pass(this,UserWidget,"init",t)},UserWidget.prototype.callAmbit=function(t){var e=this,a=this.settings.baseUrl+"myaccount/users";"string"==typeof t&&(a+="?"+t,t=null),this.findBox.addClass("loading"),s.ambit.call(this,a,t,function(t){e.findBox.removeClass("loading"),e.fillData(t)})},UserWidget.prototype.doRequest=function(t){this.callAmbit("q="+t)},UserWidget.prototype.loadUsers=function(t){this.callAmbit(t)},UserWidget.prototype.fillData=function(t){var e=a.map(t||[],function(t){return{value:t.id,label:t.name}});return this.reportCallback?this.onFound(e):this.resetValue(e)},UserWidget.prototype.onChange=function(){return this.settings.onChange&&this.settings.onChange.apply(this,arguments)},s.UserWidget=UserWidget}(_,asSys,jQuery,jToxKit),jT.ui.templates["anno-input"]='<input name="{{ name }}" placeholder="{{ value }} " class="ui-widget ui-corner-all padded-control" />',jT.ui.templates["anno-select-option"]='<option value="{{ value }}">{{ title }}</option>',jT.ui.templates["anno-form"]='<form><p>Scope:</p><div class="annotip-scope"><select name="operation.scope" class="ui-widget ui-corner-all padded-control"></select></div><div class="annotip-suggestion"></div><div class="annotip-description"><textarea name="description" rows="3" class="ui-widget ui-corner-all padded-control"></textarea></div><p class="go-right">Operation:</p><div class="annotip-buttonset annotip-action go-right"><input type="radio" value="add" name="operation.action" id="annotip-action-add" /><label for="annotip-action-add">Add</label><input type="radio" value="replace" name="operation.action" id="annotip-action-replace" /><label for="annotip-action-replace">Replace</label><input type="radio" value="delete" name="operation.action" id="annotip-action-delete" /><label for="annotip-action-delete">Delete</label><input type="radio" value="synonyms" name="operation.action" id="annotip-action-synonyms" /><label for="annotip-action-synonyms">Synonyms</label></div><p class="go-right">Severity:</p><div class="annotip-buttonset annotip-severity go-right"><input type="radio" value="low" name="operation.severity" id="annotip-severity-low"/><label for="annotip-severity-low">Low</label><input type="radio" value="medium" name="operation.severity" id="annotip-severity-medium" /><label for="annotip-severity-medium">Medium</label><input type="radio" value="high" name="operation.severity" id="annotip-severity-high" /><label for="annotip-severity-high">High</label></div></form>',jT.ui.templates["select-one-option"]='<option value="{{ value }}" {{ selected }}>{{ name }}</button>',jT.ui.templates["info-ball"]='<sup class="helper"><a target="_blank" href="{{ href }}" title="{{ title }}"><span class="fa fa-action fa-info-circle"></span></a></sup>',jT.ui.templates["all-composition"]='<div class="jtox-composition unloaded"><table class="dataTable composition-info font-small display jtox-annotatable"><thead><tr><th>Composition name:</th><td class="camelCase">{{ name }}</td></tr><tr><th>Composition UUID:</th><td>{{ uuid }}</td></tr><tr><th>Purity of IUC Substance:</th><td>{{ purity }}</td></tr></thead></table><table class="composition-table display"></table></div>',jT.ui.templates["all-compound"]='<div class="jtox-compound"><div class="jtox-ds-features"></div><div class="jtox-controls">Showing from<span class="high">{{ pagestart }}</span> to <span class="high">{{ pageend }}</span><span>{{ filtered-text }}</span>in pages of<select value="{{ pagesize }}" class="jtox-handler" data-handler="sizeChange"><option value="10" selected="yes">10</option><option value="20">20</option><option value="30">30</option><option value="50">50</option><option value="100">100</option></select> entries<a class="paginate_disabled_previous jtox-handler" data-handler="prevPage" tabindex="0" role="button">Previous</a><a class="paginate_enabled_next jtox-handler" data-handler="nextPage" tabindex="0" role="button">Next</a><input type="text" class="filterbox jtox-handler" data-handler="filter" data-handler-delay="350" data-handler-event="keydown" placeholder="Filter..." /></div><div class="jtox-ds-tables"><div class="jt-error"><span class="message"></span></div><div class="jtox-ds-fixed"><table class="display"></table></div><div class="jtox-ds-variable"><table class="display"></table></div></div></div>',jT.ui.templates["compound-one-tab"]='<div class="jtox-selection"><a href="#" class="multi-select select">select all</a>&nbsp;<a href="#" class="multi-select unselect">unselect all</a></div>',jT.ui.templates["compound-one-feature"]='<div class="jtox-ds-feature"><input type="checkbox" checked="yes"class="jtox-checkbox" /><span class="jtox-title">{{ title }}</span><sup class="helper"><a target="_blank"href="{{ uri }}"><i class="fa fa-action fa-info-circle"></i></a></sup></div>',jT.ui.templates["compound-download"]='<div class="jtox-inline jtox-ds-download"><a target="_blank" href="{{ link }}"><img class="borderless" title="{{ type }}" src="{{ icon }}" alt="{{ type }}"/></a></div>',jT.ui.templates["compound-export"]='<div id="{{ id }}"><div class="jtox-inline">Download dataset as: </div><div class="jtox-inline jtox-exportlist"></div></div>',jT.ui.templates["all-endpoint"]='<div class="jtox-endpoint"><div class="size-full filter-box" style="height: 35px"><input type="text" class="float-right ui-input"placeholder="Filter..." /></div><div class="jtox-categories"><h3 data-cat="P-CHEM">P-Chem<div class="float-right jtox-inline jtox-details"><ahref="#" class="jtox-handler" data-handler="multipleSelect">select all</a>&nbsp;<ahref="#" class="jtox-handler" data-handler="multipleSelect" data-action="off">unselect all</a><span style="margin-left: 10px"></span></div></h3><div><table class="P-CHEM"></table></div><h3 data-cat="ENV_FATE">Env Fate<div class="float-right jtox-inline jtox-details"><ahref="#" class="jtox-handler" data-handler="multipleSelect">select all</a>&nbsp;<ahref="#" class="jtox-handler" data-handler="multipleSelect" data-action="off">unselect all</a><span style="margin-left: 10px"></span></div></h3><div><table class="ENV_FATE"></table></div><h3 data-cat="ECOTOX">Eco Tox<div class="float-right jtox-inline jtox-details"><ahref="#" class="jtox-handler" data-handler="multipleSelect">select all</a>&nbsp;<ahref="#" class="jtox-handler" data-handler="multipleSelect" data-action="off">unselect all</a><span style="margin-left: 10px"></span></div></h3><div><table class="ECOTOX"></table></div><h3 data-cat="TOX">Tox<div class="float-right jtox-inline jtox-details"><a href="#"class="jtox-handler" data-handler="multipleSelect">select all</a>&nbsp;<ahref="#" class="jtox-handler" data-handler="multipleSelect" data-action="off">unselect all</a><span style="margin-left: 10px"></span></div></h3><div><table class="TOX"></table></div></div></div>',jT.ui.templates["endpoint-one-editor"]='<div class="jtox-medium-box"><div class="jtox-details font-heavy {{ requiredClass }}">{{ title }}</div><input class="{{ autoClass }}" type="text" data-id="{{ id }}" data-service="{{ service }}" data-path="{{ path }}" placeholder="{{ title }}_" value="{{ value }}"/></div>',jT.ui.templates["endpoint-info-panel"]='<div class="endpoint-panel"><table><thead><tr><th rowspan="2">Endpoint</th><th rowspan="2">Value</th><th class="conditions center" colspan="{{ conditionsCount }}">Conditions</th><th rowspan="2">Guideline or Justification</th></tr><tr class="conditions">{{ conditionsHeaders}}</tr></thead><tbody><tr><td class="the-endpoint">{{ endpoint }}</td><td class="the-value non-breakable">{{ value }}</td>{{ conditionsValues }}<td>{{ guidance }}</td></tr></tbody></table><div class="size-full delete-box {{ deleteBoxClass }}"><div class="jtox-inline size-full"><textarea class="no-auto" data-id="reason" data-path="effects_to_delete[0].result.remarks" placeholder="Reason for deleting_">{{ reason }}</textarea></div></div></div>',jT.ui.templates["endpoint-edit-panel"]='<div class="endpoint-panel">{{ editorsHtml }}<div class="size-full box-conditions {{ conditionsClass }}"><div class="jtox-details font-heavy">Conditions</div><div class="jtox-border-box">{{ conditionsHtml }}</div></div><div class="jtox-medium-box"><div class="jtox-details font-heavy jtox-required">Study type</div><select class="type-list no-auto" data-id="type"><option value="-1"> - Select type - </option>{{ studyOptionsHtml }}</select></div><div class="jtox-medium-box"><div class="jtox-details font-heavy jtox-required">Reference</div><input type="text no-auto" data-id="reference" placeholder="Reference_" value="{{ reference }}"/></div><div class="jtox-medium-box size-full"><div class="jtox-details font-heavy jtox-required">Guideline or Justification</div><textarea class="no-auto" data-id="justification" placeholder="Justification_">{{ justification }}</textarea></div><div class="jtox-medium-box size-full"><div class="jtox-details font-heavy">Remarks</div><textarea class="no-auto" data-id="remarks" placeholder="Remarks_">{{ remarks }}</textarea></div></div>',jT.ui.templates["faceted-search-kit"]='<div class="query-container">\x3c!-- left --\x3e<div id="query" class="query-left"><div id="accordion-resizer" class="ui-widget-content"><div id="accordion"></div></div></div>\x3c!-- right --\x3e<div id="result-tabs" class="query-right"><ul><li><a href="#hits_tab">Hits list</a></li><li><a href="#basket_tab">Selection</a></li><li><a href="#queries_tab">Predefined Queries</a></li><li class="jtox-ds-export"><a href="#export_tab">Export</a></li></ul><div id="hits_tab"><div class="row remove-bottom"><ul class="tags remove-bottom" id="selection"></ul><footer><div id="sliders-controls"><a href="#" class="jtox-fadable command close">Close</a></div><div id="sliders"></div></footer></div><div id="navigation"><ul id="pager"></ul><div id="pager-header"></div></div><div class="docs_wrapper"><section id="docs" class="item-list"></section></div></div><div id="basket_tab"><section id="basket-docs" class="item-list"></section><div style="padding-top: 70px;"></div></div><div id="queries_tab"><section id="predefined-queries" class="item-list"></section><div style="padding-top: 70px;"></div></div><div id="export_tab"><form target="_blank" method="post"><input type="hidden" name="search" /><h6>Select dataset to export</h6><div id="export_dataset"><input type="radio" value="filtered" name="export_dataset" id="filtered_data"checked="checked" /><label for="filtered_data">Filtered entries</label><input type="radio" value="selected" name="export_dataset" id="selected_data" /><label for="selected_data">Selected entries</label></div><h6>Select export/report type</h6><select id="export_select" name="export_select"></select><h6>Select output format</h6><input type="hidden" name="export_format" id="export_format" /><div class="data_formats"></div><br /><button id="export_go" type="button" name="export_go" data-format="Download {{source}} as {{format}}">?</button><div class="ui-state-error ui-corner-all warning-message" style="padding: 0 .7em;"><p><span class="ui-icon ui-icon-alert"style="float: left; margin-right: .3em;"></span><strong>Warning: </strong>Please, either add entries to the selection or some filters to the query.</p></div></form></div></div>\x3c!-- query container --\x3e</div>',jT.ui.templates["result-item"]='<article id="{{item_id}}" class="item"><header>{{title}}</header><a href="{{link}}" title="{{link_title}}" class="avatar" target="{{link_target}}"><img src="{{logo}}" /></a><div class="composition">{{composition}}</div>{{summary}}<footer class="links">{{footer}}<a href="#" class="add jtox-fadable command">Add to Selection</a><a href="#" class="remove jtox-fadable command">Remove from Selection</a><a href="#" class="none jtox-fadable command">Already added</a></footer></article>',jT.ui.templates["summary-item"]='<div class="one-summary"><span class="topic">{{topic}}:</span><span class="value">{{content}}</span></div>',jT.ui.templates["tag-facet"]='<ul class="tags tag-group folded"></ul>',jT.ui.templates["query-item"]='<article id="{{id}}" class="item"><header>{{title}}</header><div class="composition">{{description}}<a href="#" title="Apply the query" style="width: 100%;"><span style="float:right;margin:0;">Apply</span></a></div></article>',jT.ui.templates["tab-topcategory"]='<h3 id="{{id}}_header" class="nested-tab">{{title}}</h3><div id="{{id}}" class="widget-content widget-root"><div><input type="text" placeholder="Filter_" class="widget-filter" /><input type="button" class="switcher" value="OR" /></div><ul class="widget-content tags remove-bottom" data-color="{{color}}"></ul></div>',jT.ui.templates["slider-one"]='<input type="hidden" />',jT.ui.templates["export-format"]='<div class="jtox-inline jtox-ds-download jtox-fadable"><a target="_blank" data-name="{{name}}" data-mime="{{mime}}" href="#"><img class="borderless" src="{{icon}}" /></a></div>',jT.ui.templates["logger-main"]='<div class="list-wrap"><div class="list-root"></div></div><div class="status"><div class="icon jtox-fadable"></div></div>',jT.ui.templates["logger-line"]='<div class="logline"><div class="icon"></div><span class="content info-field">{{header}}</span><div class="details info-field">{{details}}</div></div>',jT.ui.templates["all-matrix"]='<div class="jtox-matrix-kit"><ul><li><a href="#jtox-identifiers">Assessment identifier</a></li><li><a class="jtox-summary-entry" data-summary="compound" href="#jtox-structures">Collect structures</a></li><li><a class="jtox-summary-entry" data-summary="substance" href="#jtox-substances">Select substances</a></li><li><a class="jtox-summary-entry" data-summary="property" href="#jtox-endpoints">Select endpoints</a></li><li><a class="jtox-summary-entry" data-summary="matrix" href="#jtox-matrix">Assessment details</a></li><li><a href="#jtox-report">Report</a></li></ul><div id="jtox-identifiers" data-loader="onIdentifiers"><form><table class="dataTable"><thead><tr class="label-box"><th class="right size-third"><label for="title">Title</label>*<a href=\'#\' class=\'chelp a_name\'>?</a>:</th><td><input class="first-time" value="{{title}}" name="title" id="title" required /></td></tr><tr class="label-box"><th class="right size-third"><label for="maintainer">Maintainer</label>*<a href=\'#\' class=\'chelp a_maintainer\'>?</a>:</th><td><input class="first-time" value="{{maintainer}}" name="maintainer" id="maintainer" required /></td></tr><tr class="label-box"><th class="right top size-third"><label for="description">Purpose</label>*<a href=\'#\' class=\'chelp a_description\'>?</a>:</th><td><textarea class="nomargin " name="description" id="description" required>{{description}}</textarea></td></tr><tr class="label-box"><th class="right size-third">Version <a href=\'#\' class=\'chelp a_version\'>?</a>:</th><td>{{version}}</td></tr><tr class="label-box"><th class="right size-third">Version start date <a href=\'#\' class=\'chelp a_version_date\'>?</a>:</th><td>{{created|formatDate}}</td></tr><tr class="label-box"><th class="right size-third">Version last modified on <a href=\'#\' class=\'chelp a_version_date\'>?</a>:</th><td>{{updated|formatDate}}</td></tr><tr class="label-box"><th class="right size-third">Status<a href=\'#\' class=\'chelp a_published\'>?</a>:</th><td>{{status|formatStatus}}</td></tr><tr class="label-box"><th class="right size-third"><label for="license">License</label>*:</th><td><input class="first-time" value="{{rights.URI}}" name="license" id="license" required /></td></tr><tr class="label-box"><th class="right size-third"><label for="rightsHolder">Rights holder</label>*<a href=\'#\' class=\'chelp a_rightsholder\'>?</a>:</th><td><input class="first-time" value="{{rightsHolder}}" name="rightsHolder" id="rightsHolder" required /></td></tr><tr class="label-box"><th class="right size-third"><label for="seeAlso">See also</label>*<a href=\'#\' class=\'chelp a_code\'>?</a>:</th><td><input class="first-time" value="{{seeAlso}}" name="seeAlso" id="seeAlso" required /></td></tr><tr class="label-box"><th class="right size-third"><label for="source">Source URL</label>*<a href=\'#\' class=\'chelp a_doclink\'>?</a>:</th><td><input class="first-time" value="{{source}}" name="source" id="source" required /><a href="" id="source-link" target="_blank" class="fa fa-action fa-external-link">open link</a></td></tr><tr class="label-box"><th class="right size-third"><label for="number">Identifier</label><a href=\'#\' class=\'chelp assessment\'>?</a>:</th><td>{{number}}</td></tr><tr class="label-box"><th class="right size-third"><label for="stars">Rating</label> <a href=\'#\' class=\'chelp a_rating\'>?</a>:</th><td class="data-stars-field"><input type="hidden" name="stars" value="0" /></td></tr><tr class="label-box"><th class="right size-third top"><label for="users-write">Users with write access</label><a href=\'#\' class=\'chelp bundle_rw\'>?</a>:</th><td class="jtox-user-rights"><input name="users-write" id="users-write" class="jtox-users-select ignore-auto" data-permission="canWrite" /></td></tr><tr class="label-box"><th class="right size-third top"><label for="users-read">Users with read access</label><a href=\'#\' class=\'chelp bundle_rw\'>?</a>:</th><td class="jtox-user-rights"><input name="users-read" id="users-read" class="jtox-users-select ignore-auto" data-permission="canRead" /></td></tr></thead></table><div class="actions"><button name="assStart" type="submit" data-subject="bundle-start">Start</button><button name="assFinalize" type="button" data-subject="bundle-finalize">Finalize Assessment</button><button name="assNewVersion" type="button" data-subject="bundle-version">Generate new version</button></div></form></div><div id="jtox-structures" data-loader="onStructures"><div id="struct-query" class="jtox-kit"data-kit="Query"data-initial-query="false"data-search="[Ag]"data-hide-options="uri,context"></div><div id="struct-browser" class="jtox-kit"data-kit="Compound"data-show-tabs="false"data-hide-empty="true"data-details-height="500px"data-show-diagrams="true"></div></div><div id="jtox-substances" data-loader="onSubstances"><div class="jtox-inline tab-substance"><div class="float-right"><button type="button" class="details-expand-all jtox-handler" data-handler="expandAll">Expand all</button><button type="button" class="details-collapse-all jtox-handler" data-handler="collapseAll">Collapse all</button></div></div><div id="substance-selector" class="jtox-kit"data-kit="Compound"data-show-tabs="false"data-hide-empty="true"data-show-diagrams="true"></div></div><div id="jtox-endpoints" data-loader="onEndpoints"><div class="jq-buttonset center auto-setup"><input type="radio" id="erelevant" name="eaction" checked="true" class="jtox-handler" data-handler="endpointMode"><label for="erelevant">Relevant endpoints</label></input><input type="radio" id="eall" name="eaction" class="jtox-handler" data-handler="endpointMode"><label for="eall">All endpoints</label></input></div><div id="endpoint-selector" class="jtox-kit"data-kit="Endpoint"data-hide-filter="false"></div></div><div id="jtox-matrix" data-loader="onMatrix"><div class="jq-buttonset center auto-setup"><input type="radio" id="xinitial" name="xaction" class="jtox-handler" data-handler="matrixMode" checked="true"><label for="xinitial">Initial matrix</label></input><input type="radio" id="xworking" name="xaction" class="jtox-handler" data-handler="matrixMode"><label for="xworking">Working matrix</label></input><input type="radio" id="xfinal" name="xaction" class="jtox-handler" data-handler="matrixMode"><label for="xfinal">Final matrix</label></input></div><button class="create-button jtox-handler" data-handler="createWorkingCopy" data-subject="matrix">Create working copy</button><div id="matrix-table" class="jtox-kit"data-kit="Compound"data-show-diagrams="true"data-show-units="false"data-tabs-folded="true"data-hide-empty="true"data-remember-checks="true"data-fixed-width="650px"></div></div><div id="jtox-report" class="jtox-report" data-loader="onReport"><div class="report-box"></div></div></div>',jT.ui.templates["matrix-tag-buttons"]='<div class="{{ tag }}"><button class="jt-toggle jtox-handler target" data-subject="{{subject}}-tag" data-handler="{{subject}}Tag" data-tag="target" title="Select the {{subject}} as Target">T</button><br/><button class="jt-toggle jtox-handler source" data-subject="{{subject}}-tag" data-handler="{{subject}}Tag" data-tag="source" title="Select the {{subject}} as Source">S</button><br/><button class="jt-toggle jtox-handler cm" data-subject="{{subject}}-tag" data-handler="{{subject}}Tag" data-tag="cm" title="Select the {{subject}} as Category Member">CM</button><br/></div>',jT.ui.templates["matrix-tag-indicator"]='<button class="jt-toggle {{tag}} active" data-tag="{{tag}}" title="This {{subject}} is selected as {{name}}">{{code}}</button>',jT.ui.templates["matrix-sel-arrow"]='<i class="jtox-{{direction}} fa fa-arrow-{{direction}} jtox-handler" data-handler="substanceMove" data-direction="{{direction}}" title="Move the {{subject}} up in the list"></i>',jT.ui.templates["matrix-full-report"]='<p><a href="#" class="jtox-handler" data-handler="reportWord">Download Word file with the report</a></p><div id="jtox-report-cover"><h1>Ambit Assessment Report</h1><h2>{{ title }}</h2><dl><dt>Author:</dt><dd>{{ maintainer }}</dd><dt>Date:</dt><dd>{{ created|formatDate }}</dd><dt>Assessment code:</dt><dd>{{ number }}</dd><dt>Purpose:</dt><dd>{{ description }}</dd></dl></div><section id="jtox-report-identifiers"><h2>Assessment Identifiers</h2><table class="dataTable"><thead><tr><th class="right size-third">Assessment title:</th><td>{{ title }}</td></tr><tr><th class="right size-third">Owner:</th><td>{{ maintainer }}</td></tr><tr><th class="right top size-third">Purpose:</th><td>{{ description }}</td></tr><tr><th class="right size-third">Version:</th><td>{{ version }}</td></tr><tr><th class="right size-third">Status:</th><td>{{ status|formatStatus }}</td></tr><tr><th class="right size-third">Version start date:</th><td>{{ created|formatDate }}</td></tr><tr><th class="right size-third">Version last modified on:</th><td>{{ updated|formatDate }}</td></tr><tr><th class="right size-third">Published:</th><td>{{ published|formatDate }}</td></tr><tr><th class="right size-third">Assessment code:</th><td>{{ seeAlso }}</td></tr><tr><th class="right size-third">Assessment DocLink:</th><td>{{ source|formatLink }}</td></tr><tr><th class="right size-third">Assessment ID:</th><td>{{ number }}</td></tr></thead></table><p>The original assessment in Ambit can be found via <a href="{{baseUrl}}ui/assessment?bundle_uri={{bundleUri}}">Assessment ID</a></p></section><section id="jtox-report-structlist"><h2>List of structures for assessment</h2><p>In the assessment, similar structures were selected from exact structure, substructure and/or similarity searches, or were added manually. The rationale for the selection is given in the table.</p><div class="jtox-ds-variable dataTables_wrapper dt-jqueryui no-footer"><table class="table-box dataTable">{{ dataTables.structure }}</table></div></section><section id="jtox-report-substances"><h2>List of substances related to the structures</h2><p>In the following, for each structure listed in chapter 2, substances were selected and the rationale is given.</p><div class="jtox-ds-variable dataTables_wrapper dt-jqueryui no-footer"><table class="table-box dataTable">{{ dataTables.substance }}</table></div></section><section id="jtox-report-matrix"><h2>Substance composition matrix</h2><p>In the following, for each substance, the associated structure(s) and the composition are given.</p><div class="jtox-ds-variable dataTables_wrapper dt-jqueryui no-footer"><table class="table-box dataTable">{{ dataTables.composition }}</table></div></section><section id="jtox-report-final"><h2>Assessment data matrix</h2><p>In the following, for each substance, the associated endpoint data are given, either experimental data, waiving or read-across.</p><p>For detailed data or rationale for waiving and read-across, click hyperlinks in the table. These data or rationales can also be found in the annex of the report.</p><div class="jtox-ds-variable"><table class="table-box dataTable">{{ dataTables.matrix }}</table></div></section><section id="jtox-report-justification"><h2>Justification for read-across / category</h2><div><textarea id="report-justification" name="report-justification">{{ reportJustification }}</textarea></div></section><section class="annex" id="jtox-report-experimental-data"><h2>Experimental data</h2><p><a href="{{bundleUri}}/substance?media=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" id="export-substance">Create Excel file with all used experimental data</a></p></section><section class="annex" id="jtox-report-gap-filling"><h2>Rationale for gap filling</h2>\x3c!-- <table class="table-box"></div>table> --\x3e</section><section class="annex" id="jtox-report-deleting-data"><h2>Rationale for deleting experimental data</h2>\x3c!-- <table class="table-box"></div>table> --\x3e</section><section class="annex" id="jtox-report-initial-matrix"><h2>Initial matrix</h2><p><a href="{{bundleUri}}/dataset?media=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" id="export-initial-matrix">Create Excel file with the initial matrix</a></p></section><section class="annex" id="jtox-report-working-matrix"><h2>Working matrix</h2><p><a href="{{bundleUri}}/matrix?media=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" id="export-working-matrix">Create Excel file with the working matrix</a></p></section><p><a href="#" class="jtox-handler" data-handler="reportWord">Download Word file with the report</a></p>',jT.ui.templates["kit-query-all"]='<div class="jtox-query"><form><div class="jq-buttonset jtox-inline"><input type="radio" id="searchauto" value="auto" name="searchtype" checked="checked" data-placeholder="Enter CAS, EINECS, Chemical name, SMILES or InChI_" /><label for="searchauto" title="Exact structure or search by an identifier. CAS, Chemical name, SMILES or InChI. The input type is guessed automatically.">Exact structure</label><input type="radio" id="searchsimilarity" value="similarity" name="searchtype" data-placeholder="Enter Chemical name, SMILES or InChI_" /><label for="searchsimilarity" title="Enter SMILES or draw structure">Similarity</label><input type="radio" id="searchsmarts" value="smarts" name="searchtype" data-placeholder="Enter SMARTS_" /><label for="searchsmarts" title="Enter or draw a SMARTS query">Substructure</label><input type="radio" id="searchuri" value="uri" name="searchtype" data-placeholder="Enter URL to be examined..." /><label for="searchuri" title="Enter dataset URL">URL</label></div><div class="float-right search-pane"><div class="dynamic auto-hide searchauto hidden jtox-inline"><input type="checkbox" name="regexp" id="toxquery-regexp" /><label for="toxquery-regexp">Enable fragment search<sup class="helper"><a target="_blank" href="http://en.wikipedia.org/wiki/Regular_expression"><i class="fa fa-action fa-info-circle"></i></a></sup></label></div><div class="dynamic auto-hide searchsimilarity hidden jtox-inline"><input type="checkbox" name="similaritybysubstance" value="true" id="similaritybysubstance" /><label for="similaritybysubstance">Only hits with substance data</label><select name=\'threshold\' title=\'Tanimoto similarity threshold\'><option value=\'0.9\' selected="selected">0.9</option><option value=\'0.8\'>0.8</option><option value=\'0.7\'>0.7</option><option value=\'0.6\'>0.6</option><option value=\'0.5\'>0.5</option><option value=\'0.4\'>0.4</option><option value=\'0.3\'>0.3</option><option value=\'0.2\'>0.2</option><option value=\'0.1\'>0.1</option></select></div><div class="dynamic auto-hide searchsmarts hidden jtox-inline"><input type="checkbox" name="smartsbysubstance" value="true" id="smartsbysubstance" /><label for="smartsbysubstance">Only hits with substance data</label><select name="smarts" title="Predefined functional groups"></select></div><div class="jtox-inline"><input type="text" name="searchbox" /><button name="searchbutton" class="jtox-handler" title="Search/refresh" data-handler="query"><i class="fa fa-search"></i></button><button name="drawbutton" class="dynamic" title="Draw the (sub)structure" data-toggle="modal" data-target="#mol-composer"><i class="fa fa-action fa-edit"></i></button></div></div><div id="searchcontext" class="size-full"><input type="text" name="searchcontext" placeholder="Restrict the search within given dataset_" /></div></form></div>',jT.ui.templates["kit-query-composer"]='<div class="modal fade" id="mol-composer" tabindex="-1" role="dialog" aria-labelledby="mol-composer" aria-hidden="true"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="mol-composer">Molecule Composer</h5><button type="button" class="close" data-dismiss="modal" aria-label="Discard"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><iframe id="ketcher-mol-frame" src="/assets/lib/ketcher/ketcher.html?api_path={{baseUrl}}" class="col-12" height="600" scrolling="no"></iframe></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Discard</button><button type="button" class="btn btn-primary mol-apply" data-dismiss="modal">Apply &amp; Use</button></div></div></div></div>',jT.ui.templates["kit-query-option"]='<input type="radio" id="search{{id}}" value="{{id}}" name="searchtype" data-placeholder="..." /><label for="search{{id}}" title="{{description}}">{{title}}</label>',jT.ui.templates["all-studies"]='<div><ul><li><a href="#jtox-substance-{{instanceNo}}">IUC Substance</a></li><li><a href="#jtox-compo-tab-{{instanceNo}}">Composition</a></li></ul><div id="jtox-substance-{{instanceNo}}" class="jtox-substance"><table class="dataTable display"><thead><tr><th class="right size-third">IUC Substance name:</th><td class="camelCase">{{ name }}</td></tr><tr><th class="right">IUC Substance UUID:</th><td>{{ i5uuid }}</td></tr><tr><th class="right">IUC Public name:</th><td class="camelCase">{{ publicname }}</td></tr><tr><th class="right">Legal entity:</th><td>{{ ownerName }}</td></tr><tr><th class="right">Legal entity UUID:</th><td>{{ ownerUUID }}</td></tr><tr><th class="right">Type substance composition:</th><td>{{ substanceType }}</td></tr><tr class="borderless-bottom"><th class="right">IUC Substance Reference Identifier</th><td></td></tr><tr class="borderless-top borderless-bottom"><td class="right">CAS:</td><td>{{ compound.cas }}</td></tr><tr class="borderless-top borderless-bottom"><td class="right">EC:</td><td>{{ compound.einecs }}</td></tr><tr class="borderless-top borderless-bottom"><td class="right">Chemical name:</td><td>{{ compound.name }}</td></tr><tr class="borderless-top borderless-bottom"><td class="right">IUPAC name:</td><td>{{ compound.iupac }}</td></tr><tr class="borderless-top borderless-bottom"><td class="right">UUID:</td><td>{{ referenceSubstance.i5uuid }}</td></tr><tr class="borderless-top"><td class="right">IUC Flags:</td><td>{{ IUCFlags }}</td></tr></thead></table></div><div id="jtox-compo-tab-{{instanceNo}}" class="jtox-compo-tab"></div></div>',jT.ui.templates["one-category"]='<div class="jtox-study-tab unloaded"><div class="float-right"><button class="expand-all">Expand all</button><button class="collapse-all">Collapse all</button></div><p><input type="text" class="jtox-study-filter ui-input" placeholder="Filter..." /></p><h4 class="camelCase">{{ showname }}</h4></div>',jT.ui.templates["one-study"]='<div class="jtox-study jtox-foldable folded"><div class="title"><p class="counter">{{ title }}</p></div><div class="content"><table class="jtox-study-table content display"></table></div></div>',jT.ui.templates["all-substance"]='<div class="jtox-substance"><div class="jtox-controls">Showing from<span class="high jtox-live-data">{{ pagestart }}</span> to <span class="high jtox-live-data">{{ pageend }}</span><span class="filtered-text"> </span>in pages of<select value="{{ pagesize }}" class="jtox-handler" data-handler="sizeChange"><option value="10" selected="yes">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option><option value="200">200</option><option value="500">500</option></select> substances<a class="paginate_disabled_previous jtox-handler" data-handler="prevPage" tabindex="0" role="button">Previous</a><a class="paginate_enabled_next jtox-handler" data-handler="nextPage" tabindex="0" role="button">Next</a><input type="text" class="filterbox jtox-handler" data-handler="filter" placeholder="Filter..." /></div><table class="display"></table></div>';