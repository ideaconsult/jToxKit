!function(d,u){function CompositionKit(t){d(this.rootElement=t.target).addClass("jtox-toolkit"),this.settings=d.extend(!0,{},CompositionKit.defaults,t),this.settings.compositionUri&&this.queryComposition(this.settings.compositionUri)}CompositionKit.prototype.prepareTable=function(t,e){var i=this,a=i.settings.configuration.columns.composition.Name;i.settings.selectionHandler&&(u.tables.putActions(i,a),a.sWidth="60px");for(var n=u.tables.processColumns(i,"composition"),s=0,o=n.length;s<o;++s)if("Also"==n[s].title){n[s].title="",n[s].render=function(t,e,a){return t?'<a href="'+i.settings.baseUrl+"/substance?type=related&compound_uri="+encodeURIComponent(t)+'" target="_blank">Also contained in...</a>':""};break}if(i.settings.showDiagrams){var r=u.ambit.baseFeatures["http://www.opentox.org/api/1.1#Diagram"];r&&r.column&&n.push(d.extend({},r.column,{title:"Structure",data:"component",render:function(t,e,a){return r.render(t.compound.URI,e,t)}}))}i.table=u.tables.putTable(i,d("table.composition-table",e)[0],"composition",{columns:n}),d(i.table).DataTable().rows.add(t).draw();var l=d("th.colspan-2",i.table);return d(l).attr("colspan",2),d(d(l).next()).remove(),i.table},CompositionKit.prototype.queryComposition=function(t){var l=this;l.compositionUri=t,u.ambit.call(l,t,function(t){if(t&&t.composition){var e={};u.ambit.processFeatures(t.feature);for(var a=0,i=t.composition.length;a<i;++a){var n=t.composition[a];u.ambit.processEntry(n.component,t.feature,u.ambit.getDatasetValue);var s=e[n.compositionUUID];s===undefined&&(e[n.compositionUUID]=s={name:"",purity:"",maxvalue:0,uuid:n.compositionUUID,composition:[]}),s.composition.push(n),""!=n.compositionName&&null!=n.compositionName&&(s.name=n.compositionName);var o=n.proportion.typical;"HAS_CONSTITUENT"==n.relation&&""==s.name&&(s.name=n.component.compound.name+" ("+u.valueAndUnits(o.value,o.unit||"%&nbsp;(w/w)",o.precision)+")"),"HAS_CONSTITUENT"==n.relation&&s.maxvalue<o.value&&(s.maxvalue=o.value,o=n.proportion.real,s.purity=u.valueAndUnits(o.lowerValue+"-"+o.upperValue,o.unit||"%&nbsp;(w/w)"))}if(u.fireCallback(l.settings.onLoaded,l,t.composition),!l.settings.noInterface)for(var a in e){var r=d(u.ui.templates["all-composition"])[0];d(l.rootElement).append(r),l.settings.showBanner?u.ui.fillTree(d(".composition-info",r)[0],e[a]):d(".composition-info",r).remove(),l.prepareTable(e[a].composition,r)}}else u.fireCallback(l.settings.onLoaded,l,t.composition)})},CompositionKit.prototype.query=function(t){d(self.rootElement).empty(),this.queryComposition(t)},CompositionKit.defaults={selectionHandler:null,showBanner:!0,showDiagrams:!1,noInterface:!1,sDom:"rt<Ffp>",onLoaded:null,configuration:{columns:{composition:{Type:{title:"Type","class":"left",width:"10%",data:"relation",render:function(t,e,a){if("display"!=e)return""+t;var i="HAS_ADDITIVE"==t?a.proportion.function_as_additive:"";return'<span class="camelCase">'+t.substr(4).toLowerCase()+"</span>"+(i===undefined||null===i||""==i?"":" ("+i+")")}},Name:{title:"Name","class":"camelCase left",width:"15%",data:"component.compound.name",render:function(t,e,a){return"display"!=e?""+t:'<a href="'+a.component.compound.URI+'" target="_blank" title="Click to view the compound"><span class="ui-icon ui-icon-link" style="float: left; margin-right: .3em;"></span></a>'+t}},"EC No.":{title:"EC No.","class":"left",width:"10%",data:"component.compound.einecs"},"CAS No.":{title:"CAS No.","class":"left",width:"10%",data:"component.compound.cas"},"Typical concentration":{title:"Typical concentration","class":"center",width:"15%",data:"proportion.typical",render:function(t,e,a){return"display"!=e?""+t.value:u.valueAndUnits(t.value,t.unit||"%&nbsp;(w/w)",t.precision)}},"Concentration ranges":{title:"Concentration ranges","class":"center colspan-2",width:"20%",data:"proportion.real",render:function(t,e,a){return"display"!=e?""+t.lowerValue:u.valueAndUnits(t.value,t.unit||"%&nbsp;(w/w)",t.precision)}},"Upper range":{title:"Upper range","class":"center",width:"20%",data:"proportion.real",render:function(t,e,a){return"display"!=e?""+t.upperValue:u.valueAndUnits(t.value,t.unit||"%&nbsp;(w/w)",t.precision)}},Also:{title:"Also","class":"center",sortable:!1,data:"component.compound.URI",defaultContent:"-"}}}}},u.ui.Composition=CompositionKit}((asSys,jQuery),jToxKit),function(e,t){CurrentSearchWidgeting=function(t){e.extend(!0,this,e.common(t,this)),this.target=t.target,this.id=t.id,this.manager=null,this.facetWidgets={},this.fqName=this.useJson?"json.filter":"fq"},CurrentSearchWidgeting.prototype={useJson:!1,renderItem:null,init:function(t){e.pass(this,CurrentSearchWidgeting,"init",t),this.manager=t},registerWidget:function(t,e){this.facetWidgets[t.id]=e},afterTranslation:function(t){var e=this,a=[],i=this.manager.getParameter("q"),n=this.manager.getAllValues(this.fqName);i.value&&!i.value.match(/^(\*:)?\*$/)&&a.push(e.renderItem({title:i.value,count:"x",onMain:function(){return i.value="",e.manager.doRequest(),!1}}).addClass("tag_fixed"));for(var s=0,o=null!=n?n.length:0;s<o;s++){var r,l=n[s],d=null;for(var u in e.facetWidgets)if(d=(r=e.manager.getListener(u)).fqParse(l))break;if(null!=d){Array.isArray(d)||(d=[d]);for(var c=0,p=d.length;c<p;++c){var h,g=d[c],f="function"==typeof r.prepareTag?r.prepareTag(g):{title:g,count:"x",color:r.color,onMain:r.unclickHandler(g)};a.push(h=e.renderItem(f).addClass("tag_selected "+(f.onAux?"tag_open":"tag_fixed"))),1<p&&h.addClass("tag_combined")}1<p&&h.addClass("tag_last")}}a.length?(a.push(e.renderItem({title:"Clear",onMain:function(){for(var t in i.value="",e.facetWidgets)e.manager.getListener(t).clearValues();return e.manager.doRequest(),!1}}).addClass("tag_selected tag_clear tag_fixed")),this.target.empty().addClass("tags").append(a)):this.target.removeClass("tags").html("<li>No filters selected!</li>")}},t.CurrentSearchWidget=e(CurrentSearchWidgeting)}((Solr,asSys),(jQuery,jToxKit)),function(c,p,h,g){var s={},f={},a={servlet:"select",multipleSelection:!0,keepAllFacets:!0,connector:h,onPrepare:function(t){var e=t.url.indexOf("?");this.proxyUrl?(t.data={query:t.url.substr(e+1)},t.url=this.proxyUrl,t.type=t.method="POST"):t.url+=(e<0?"?":"&")+"wt=json"},topSpacing:10,nestingField:"type_s",nestingRules:{composition:{parent:"substance",limit:100},study:{parent:"substance",limit:1e4},params:{parent:"study",limit:1e4},conditions:{parent:"study",limit:1e4}},exportTypes:[],exportSolrDefaults:[{name:"facet",value:"false"},{name:"echoParams",value:"none"},{name:"rows",value:999999}],savedQueries:[],listingFields:[],summaryReports:[],facets:[],summaryRenderers:{}},e=null,o=function(){null!=e&&clearTimeout(e),e=setTimeout(function(){var t=g.modifyURL(window.location.href,"ui",encodeURIComponent(JSON.stringify(f)));t&&window.history.pushState({query:window.location.search},document.title,t),e=null},1e3)},m=function(t){var e,a=e=t.title.replace(/^\"(.+)\"$/,"$1");a=e.replace(/^caNanoLab\./,"").replace(/^http\:\/\/dx\.doi\.org/,""),a=(s[a]||a).replace("NPO_","").replace(" nanoparticle","");var i=h("<span/>").html(t.count||0);"function"==typeof t.onAux&&i.click(t.onAux);var n=h("<li/>").append(h('<a href="#" class="tag" title="'+e+" "+(t.hint||"")+(a!=e?" ["+e+"]":"")+'">'+a+"</a>").append(i));return"function"==typeof t.onMain&&n.click(t.onMain),t.color&&n.addClass(t.color),n},v=function(t){g.TagWidget.prototype.init.call(this,t),t.getListener("current").registerWidget(this)},b=function(t){var e=this.getHeaderText();e.textContent=g.ui.updateCounter(e.textContent,t),p.act(this,this.header.data("refreshPanel"));var a=f[this.id]||{};a.values=this.getValues(),f[this.id]=a,o()},y=function(t){var e="OR"==t.value.toUpperCase(),a=this.getValues();this.clearValues(),this.aggregate=!e,t.value=e?"AND":"OR";for(var i=0;i<a.length;++i)this.addValue(a[i]);this.doRequest();var n=f[this.id]||{};n.aggregate=!e,f[this.id]=n,o()};g.ui.FacetedSearch=function(t){this.id=null,p.extend(!0,this,a,t),this.serverUrl=this.solrUrl,"string"==typeof this.lookupMap&&(this.lookupMap=window[this.lookupMap]),null==this.lookupMap&&(this.lookupMap={}),s=this.lookupMap,h(t.target).html(g.ui.templates["faceted-search-kit"]),delete this.target;var e=g.parseURL(window.location.href).params.ui;null!=e&&(f=JSON.parse(decodeURIComponent(e))),this.initDom(),this.initComm(),this.initExport(),this.initQueries()},g.ui.FacetedSearch.prototype={initDom:function(){this.accordion=h("#accordion"),this.accordion.accordion({heightStyle:"content",collapsible:!0,animate:200,active:!1,activate:function(t,e){if(e.newPanel&&e.newPanel[0]){var a,i=e.newHeader[0],n=e.newPanel[0],s=h("input.widget-filter",n),o=s.outerHeight(!0);h("span.ui-icon-search",i).length?a=e.newPanel.data("refreshPanel"):(a=function(){n.scrollHeight>n.clientHeight||""!=s.val()||h(i).hasClass("nested-tab")?(h(n).scrollTop(o),s.show(),h("span.ui-icon-search",i).removeClass("unused")):(s.hide(),h("span.ui-icon-search",i).addClass("unused"))},e.newPanel.data("refreshPanel",a),e.newHeader.data("refreshPanel",a),e.newHeader.append(h('<span class="ui-icon ui-icon-search"></span>').on("click",function(t){e.newPanel.animate({scrollTop:0<e.newPanel.scrollTop()?0:o},300,function(){0<e.newPanel.scrollTop()?h("input.widget-filter",n).blur():h("input.widget-filter",n).focus()}),t.stopPropagation(),t.preventDefault()}))),s.val(""),a()}}}),h(document).on("click","ul.tag-group",function(t){h(this).toggleClass("folded"),h(this).parents(".widget-root").data("refreshPanel").call()}),h(document).on("keyup","#accordion input.widget-filter",function(t){var a,i=h(this).val().toLowerCase(),e=h(this).parents("div.widget-root")[0];27==(t.keyCode||t.which)&&h(this).val(i=""),""==i?h("li,ul",e).show():h("li>a",e).each(function(){var t=h(this).closest("ul.tag-group"),e=h(this).parent();a=t.data("hidden")||0,e.hasClass("category")||(0<=this.title.toLowerCase().indexOf(i)||0<=this.innerText.toLowerCase().indexOf(i)?e.show():(e.hide(),++a)),t.length&&a&&t.data("hidden",a)}),h("ul.tag-group",e).each(function(){var t=h(this);a=parseInt(t.data("hidden"))||0,t.children().length>a+1?t.show().removeClass("folded"):t.hide().addClass("folded"),t.data("hidden",null)})});var a=h("#result-tabs"),i=this;a.tabs({}),h("#accordion-resizer").resizable({minWidth:150,maxWidth:450,grid:[10,10],handles:"e",start:function(t,e){resSize={width:a.width(),height:a.height()}},resize:function(t,e){i.accordion.accordion("refresh"),h("#query-sticky-wrapper").width(i.accordion.width()),h(this).width(function(t,e){return e-7})}}),h(".query-left#query").sticky({topSpacing:this.topSpacing,widthFromWrapper:!1})},initComm:function(){var t,s,e=p(c.Requesting,c.Spying,c.Pivoting,g.PivotWidgeting,g.RangeWidgeting),a=p(c.Requesting,c.Faceting,g.AccordionExpansion,g.TagWidget,g.Running);this.manager=t=new(p(c.Management,c.Configuring,c.QueryingJson,g.Translation,g.NestedSolrTranslation))(this),t.addListeners(new g.ResultWidget(h.extend(!0,{id:"result",target:h("#docs"),itemId:"s_uuid",nestLevel:"composition",onClick:function(t,e){if(s.findItem(e.s_uuid)<0){s.addItem(e);var a="",i=h('a[href="#basket_tab"]');i.html(g.ui.updateCounter(i.html(),s.length)),s.enumerateItems(function(t){a+=t.s_uuid+";"}),(a=g.modifyURL(window.location.href,"basket",a))&&window.history.pushState({query:window.location.search},document.title,a),h("footer",this).toggleClass("add none")}},onCreated:function(t){h("footer",this).addClass("add")}},this))),t.addListeners(new(p(c.Widgets.Pager))({id:"pager",target:h("#pager"),prevLabel:"&lt;",nextLabel:"&gt;",innerWindow:1,renderHeader:function(t,e,a){h("#pager-header").html("<span>displaying "+Math.min(a,e+1)+" to "+Math.min(a,e+t)+" of "+a+"</span>")}}));for(var i=0,n=this.facets.length;i<n;++i){var o=this.facets[i],r=f[o.id];(u=new a(h.extend({target:this.accordion,expansionTemplate:"#tab-topcategory",subtarget:"ul",runMethod:y,multivalue:this.multipleSelection,aggregate:r===undefined||r.aggregate===undefined?this.aggregateFacets:r.aggregate,exclusion:this.multipleSelection||this.keepAllFacets,useJson:!0,renderItem:m,init:v,onUpdated:b,nesting:"type_s:substance",domain:{type:"parent",which:"type_s:substance"},classes:o.color},o))).afterTranslation=function(t){this.populate(this.getFacetCounts(t.facets))},h(u.target).closest("div.widget-content").find("input.switcher").val(u.aggregate?"OR":"AND"),t.addListeners(u)}for(var l in t.addListeners(new e({id:"studies",target:this.accordion,subtarget:"ul",expansionTemplate:"#tab-topcategory",before:"#cell_header",field:"loValue_d",lookupMap:this.lookupMap,pivot:this.pivot,statistics:{min:"min(loValue_d)",max:"max(loValue_d)",avg:"avg(loValue_d)"},slidersTarget:h("#sliders"),multivalue:this.multipleSelection,aggregate:this.aggregateFacets,exclusion:this.multipleSelection||this.keepAllFacets,useJson:!0,renderTag:m,classes:"dynamic-tab",nesting:"type_s:substance",domain:{type:"parent",which:"type_s:substance"}})),t.addListeners(new g.CurrentSearchWidget({id:"current",target:h("#selection"),renderItem:m,useJson:!0})),this.basket=s=new(p(g.ListWidget,g.ItemListWidget))(h.extend(!0,{id:"basket",target:h("#basket-docs"),summaryRenderers:this.summaryRenderers,itemId:"s_uuid",onClick:function(t,e){if(!1!==s.eraseItem(e.s_uuid)){h(this).remove();var a="",i=h('a[href="#basket_tab"]'),n=h("#result_"+e.s_uuid);i.html(g.ui.updateCounter(i.html(),s.length)),s.enumerateItems(function(t){a+=t.s_uuid+";"}),(a=g.modifyURL(window.location.href,"basket",a))&&window.history.pushState({query:window.location.search},document.title,a),0<n.length&&h("footer",n[0]).toggleClass("add none")}else console.log("Trying to remove from basket an inexistent entry: "+JSON.stringify(e))},onCreated:function(t){h("footer",this).addClass("remove")}},this)),p.act(this,this.onPreInit,t),t.init(),f){var d=f[l].values,u=t.getListener(l);p.each(d,function(t){u.addValue(t)})}t.doRequest()},updateButtons:function(t){var e=h("button",t);if(h("#export_dataset").buttonset("option","disabled"))e.button("option","label","No target dataset selected...").button("disable");else if(h(t).find("input[name=export_dataset]").val()){var a=h("#export_dataset :radio:checked + label").text().toLowerCase(),i=h(t.export_format).data("name").toUpperCase();e.button("enable").each(function(){var t=h(this);t.button("option","label",g.formatString(t.data("format"),{source:a,format:i}))})}},initQueries:function(){var a=this.manager;this.queries=new(p(g.ListWidget))({id:"queries",target:h("#predefined-queries")}),this.queries.renderItem=function(t){return el$=g.ui.fillTemplate("#query-item",t),el$.data("query",t.filters),el$.on("click",function(t){var e=h(this).data("query");a.removeParameters("fq"),a.removeParameters("json.filter"),a.getParameter("q").value="",e.forEach(function(t){t.faceter?a.getListener(t.faceter).addValue(t.value):"object"==typeof t.parameter?a.addParameter(t.parameter):a.addParameter(t.name,t.value,t.domain)}),a.doRequest(),h("#result-tabs").tabs("option","active",0)}),el$},this.queries.populate(this.savedQueries)},initExport:function(){var d=this;this.prepareFormats(),this.prepareTypes(),h("#export_dataset").buttonset(),h("#export_type").buttonset(),h("#export_dataset input").on("change",function(t){d.updateButtons(this.form)}),h("#export_tab button").button({disabled:!0}),h("#report_go").on("click",function(t){var a=h(this),i=a.button("option","label");a.button("option","label","Generating the report..."),d.buildSummaryReport(function(t,e){a.button("option","label",!t&&e||i),t&&g.activateDownload(null,t,"Report-"+(new Date).toISOString().replace(":","_")+".xlsx",!0)})});var a=h("#report_select");h.each(d.summaryReports,function(t,e){a.append('<option id="'+e.id+'"'+(0==t?' selected="true"':"")+">"+e.name+"</option>")}),h("#export_tab form").on("submit",function(t){var e=this,a=(a=e.export_format.value).substr(a.indexOf("/")+1),i=d.exportFormats[h(".data_formats .selected").data("index")],n=d.exportTypes[h(e).find("input[name=export_type]:checked").data("index")],s=n.server||i.server,o=d.getSelectedIds(e),r=function(){e.search.value=o.join(" "),e.action=d.ambitUrl+"query/substance/study/uuid?media="+encodeURIComponent(e.export_format.value)},l=new(p(g.Exporting,c.Configuring,c.QueryingURL))({exportDefinition:n,useJson:!1,expectJson:!0});return l.init(d.manager),"ambitUrl"==s?o?r():h.ajax(l.prepareExport([{name:"wt",value:"json"},{name:"fl",value:"s_uuid_hs"}],o).getAjax(d.serverUrl,{async:!1,dataType:"json",success:function(t){var a=[];h.each(t.response.docs,function(t,e){a.push(e.s_uuid_hs)}),r()}})):e.action=l.prepareExport(d.exportSolrDefaults.concat("tsv"==a?[{name:"wt",value:"json"},{name:"json2tsv",value:!0}]:[{name:"wt",value:a}]),o).getAjax(d[s]).url,!0}),h("#result-tabs").tabs({activate:function(t,e){if("export_tab"==e.newPanel[0].id){var a=d.manager.getParameter("q").value,i=0<(a&&a.length)||0<d.manager.getParameter("json.filter").length,n=!!d.basket.length,s=i||n;h("#export_dataset").buttonset(s?"enable":"disable"),h("#export_type").buttonset(s?"enable":"disable"),h("div.warning-message")[s?"hide":"show"](),h(".data_formats").toggleClass("disabled",!s),h("input#selected_data").prop("checked",n).prop("disabled",!n).toggleClass("disabled",!n),h("input#filtered_data").prop("checked",i&&!n).prop("disabled",!i).toggleClass("disabled",!i),h(".data_formats .jtox-ds-download a").first().trigger("click"),h(".data_formats .jtox-ds-download a").first().trigger("click"),h("#export_dataset").buttonset("refresh"),d.updateButtons(d.form)}}})},getSelectedIds:function(t){var e=null;return"filtered"!=(t=t||h("#export_tab form")[0]).export_dataset.value&&(e=[],this.basket.enumerateItems(function(t){e.push(t.s_uuid)})),e},prepareFormats:function(){for(var t=h("#export_tab div.data_formats"),n=this,e=0,a=this.exportFormats.length;e<a;++e){var i=g.ui.fillTemplate("#export-format",this.exportFormats[e]);i.data("index",e),t.append(i),h("a",t[0]).on("click",function(t){var e=h(this),a=e.closest("form")[0];if(!e.hasClass("disabled")&&!e.hasClass("selected")){var i=e.closest("div.data_formats");a.export_format.value=e.data("mime"),h(a.export_format).data("name",e.data("name")),n.updateButtons(a),h("div",i[0]).removeClass("selected"),i.addClass("selected"),e.closest(".jtox-fadable").addClass("selected")}return!1})}},prepareTypes:function(){for(var t=h("#export_tab div#export_type"),e=this,a=function(t){h(".data_formats a").addClass("disabled"),e.exportTypes[t].formats.split(",").forEach(function(t){h(".data_formats a[data-name="+t+"]").removeClass("disabled")}),h(".data_formats a:visible").not(".disabled").first().trigger("click")},i=0,n=this.exportTypes.length;i<n;++i){this.exportTypes[i].selected=0==i?'checked="checked"':"";var s=g.ui.fillTemplate("#export-type",this.exportTypes[i]);s.data("index",i),t.append(s)}h("input[name=export_type]").on("change",function(t){return a(h(this).data("index")),!1}),a(0)},buildSummaryReport:function(i){var n=h.extend(!0,{callbacksMap:{lookup:function(t){return s[t]||t}}},this.summaryReports[h("#report_select")[0].selectedIndex].definition);Exporter=new(p(g.Exporting,c.Configuring,c.QueryingJson))({exportDefinition:n,useJson:!0,expectJson:!0}),selectedIds=this.getSelectedIds(),errFn=function(t){console.log(JSON.stringify(t).substr(0,256)),i(null,"string"==typeof t?"Err: "+t:"Error occurred!")},Exporter.init(this.manager),Promise.all([g.promiseXHR({url:n.template,settings:{responseType:"arraybuffer"}}),h.ajax(Exporter.prepareExport(null,selectedIds).getAjax(this.solrUrl))]).then(function(t){var e=t[0],a=t[1];"function"==typeof n.onData&&n.onData(a),XlsxPopulate.fromDataAsync(e).then(function(t){try{new XlsxDataFill(new XlsxDataFill.XlsxPopulateAccess(t,XlsxPopulate),n).fillData(a),t.outputAsync().then(i,errFn)}catch(e){errFn(e.message)}},errFn)},errFn)}}}(Solr,asSys,jQuery,jToxKit),function(n,s,o){o.ui.Logging=function(t){var e=s(t.target);if(n.extend(!0,this,n.common(t,this)),this.target=t.target,e.html(o.ui.templates["logger-main"]),e.addClass("jtox-toolkit jtox-log"),"number"==typeof this.lineHeight&&(this.lineHeight=this.lineHeight.toString()+"px"),"number"!=typeof this.keepMessages&&(this.keepMessages=parseInt(this.keepMessages)),this.listRoot=s(".list-root",this.target)[0],this.statusEl=s(".status",this.target)[0],this.rightSide?(this.statusEl.style.right="0px",e.addClass("right-side")):this.statusEl.style.left="0px",this.setStatus(""),this.events={},this.autoHide&&(e.bind("click",function(t){s(this).toggleClass("hidden")}),e.bind("mouseleave",function(t){s(this).addClass("hidden")})),this.mountDestination){var a="object"==typeof this.mountDestination?this.mountDestination:_.get(window,this.mountDestination),i=this;a.onPrepare=function(t){return i.beforeRequest(t)},a.onSuccess=function(t,e,a){return i.afterRequest(t,a,e)},a.onError=function(t,e){return i.afterFailure(t,e)}}},o.ui.Logging.prototype={mountDestination:null,statusDelay:1500,keepMessages:50,lineHeight:"20px",rightSide:!1,hasDetails:!0,autoHide:!0,formatEvent:function(t,e){var a={};return null!=t&&(a.header=t.method.toUpperCase()+": "+t.service,a.details="..."),null!=e&&(a.details=e.status+" "+e.statusText+"<br/>"+e.getAllResponseHeaders()),a},formatUrl:function(t){return t.protocol+"://"+t.host+t.path},setIcon:function(t,e){"error"==e?t.addClass("ui-state-error"):t.removeClass("ui-state-error"),t.data("status",e),"error"==e?s(".icon",t).addClass("ui-icon ui-icon-alert").removeClass("loading ui-icon-check"):"success"==e?s(".icon",t).addClass("ui-icon ui-icon-check").removeClass("loading ui-icon-alert"):(s(".icon",t).removeClass("ui-icon ui-icon-check ui-icon-alert"),"connecting"==e&&s(".icon",t).addClass("loading"))},setStatus:function(t){var e=this;s(".icon",e.statusEl).removeClass("jt-faded"),e.setIcon(s(e.statusEl),t),"error"!=t&&"success"!=t||setTimeout(function(){s(".icon",e.statusEl).addClass("jt-faded");var t=!1;s(".logline",e.listRoot).each(function(){"connecting"==s(e).data("status")&&(t=!0)}),t&&e.setStatus("connecting")},e.statusDelay)},addLine:function(t){var a=this,i=o.ui.fillTemplate("#jtox-logline",t);for(i.height("0px"),this.listRoot.insertBefore(i[0],this.listRoot.firstElementChild),setTimeout(function(){i.height(a.lineHeight)},150),a.hasDetails&&s(".icon",i[0]).on("click",function(t){if(i.toggleClass("openned"),i.hasClass("openned")){var e=0;s(".data-field",i[0]).each(function(){e+=this.offsetHeight}),i.height(e+6)}else i.height(a.lineHeight);t.stopPropagation()});this.listRoot.childNodes.length>a.keepMessages;)this.listRoot.removeChild(this.listRoot.lastElementChild);return i},beforeRequest:function(t){t.service=this.formatUrl(o.parseURL(t.url));var e=this.formatEvent(t),a=this.addLine(e);this.setStatus("connecting"),this.events[t.logId=Date.now()]=a,this.setIcon(a,"connecting"),a.data("status","connecting")},afterResponse:function(t,e,a){var i=this.events[e.logId];this.setStatus(t),i?(delete this.events[e.logId],o.ui.fillTree(i[0],this.formatEvent(null,a))):(e.service||(e.service=this.formatUrl(o.parseURL(e.url))),i=this.addLine(this.formatEvent(e,a))),this.setIcon(i,t)},afterRequest:function(t,e,a){this.afterResponse("success",e,a)},afterFailure:function(t,e){this.afterResponse("error",e,t),console&&console.log("Error ["+e.service+"]: "+t.statusText)}}}(asSys,jQuery,jToxKit),function(o,p,h){function buildValueRange(t,e){var a=" = ";return a+=null==t.min?"-&#x221E;":t.min,t.avg&&(a+="&#x2026;"+t.avg),a+="&#x2026;"+(null==t.max?"&#x221E;":t.max),e&&(a+=" "+h.formatUnits(t.val).replace(/<sup>(2|3)<\/sup>/g,"&#x00B$1;").replace(/<sup>(\d)<\/sup>/g,"^$1")),a}function InnerTagWidgeting(t){this.id=t.id,this.pivotWidget=t.pivotWidget}var g=/\W/g;InnerTagWidgeting.prototype={pivotWidget:null,hasValue:function(t){return this.pivotWidget.hasValue(this.id+":"+t)},clickHandler:function(t){return this.pivotWidget.clickHandler(this.id+":"+t)},modifyTag:function(t){return t.hint=t.unit?"\n"+t.unit.buckets.map(function(t){return buildValueRange(t,!0)}).join("\n"):t.buildValueRange(t),t.color=this.color,t}};var f=o(h.TagWidget,InnerTagWidgeting);h.PivotWidgeting=function(t){o.extend(!0,this,o.common(t,this)),this.target=t.target,this.targets={},this.lastEnabled=0,this.initialPivotCounts=null},h.PivotWidgeting.prototype={__expects:["getFaceterEntry","getPivotEntry","getPivotCounts","auxHandler"],automatic:!1,renderTag:null,multivalue:!1,aggregate:!1,exclusion:!1,init:function(t){o.pass(this,h.PivotWidgeting,"init",t),this.manager=t,this.manager.getListener("current").registerWidget(this,!0)},addFaceter:function(t,e){var a=o.pass(this,h.PivotWidgeting,"addFaceter",t,e);return"object"==typeof t&&(a.color=t.color),e>this.lastEnabled&&!t.disabled&&(this.lastEnabled=e),a},afterTranslation:function(t){var e=this.getPivotCounts(t.facets);for(o.pass(this,h.PivotWidgeting,"afterTranslation",t),i=0;i<e.length;++i){var a=e[i],n=a.val.replace(g,"_"),s=this.targets[n];s?s.target.children("ul").hide():(this.targets[n]=s=new h.AccordionExpansion(p.extend(!0,{},this.settings,this.getFaceterEntry(0),{id:n,title:a.val})),s.updateHandler=this.updateHandler(s),s.target.children().last().remove()),this.traversePivot(s.target,a,1),s.updateHandler(a.count)}this.target.accordion("refresh")},updateHandler:function(t){var e=t.getHeaderText();return function(t){e.textContent=h.ui.updateCounter(e.textContent,t)}},prepareTag:function(t){var e=this.parseValue(t);return{title:e.value,color:this.faceters[e.id].color,count:"i",onMain:this.unclickHandler(t),onAux:this.auxHandler(t)}},traversePivot:function(t,e,a){var i=[],n=this.getPivotEntry(a),s=e[n.id].buckets;if(a===this.lastEnabled){var o=t.data("widget");o?t.children().slice(1).remove():((o=new f({id:n.id,color:n.color,renderItem:this.renderTag,pivotWidget:this,target:t,multivalue:this.multivalue,aggregate:this.aggregate,exclusion:this.exclusion})).init(this.manager),t.data({widget:o,id:n.id})),o.populate(s,!0),i=[]}else if(null!=s)for(var r=0,l=s.length;r<l;++r){var d,u=s[r],c=u.val.replace(g,"_");1<t.children().length?d=p("#"+c,t[0]).show():(d=h.ui.fillTemplate(p("#tag-facet"),n).attr("id",c),u.title=u.val,u.onMain=this.clickHandler(n.id+":"+u.val),u.hint=buildValueRange(u),d.append(this.renderTag(u).addClass("category title").addClass(n.color)),i.push(d)),this.traversePivot(d,u,a+1)}t.append(i)}}}((Solr,asSys),jQuery,jToxKit),function(p,r,u,c){function SimpleRanger(t){this.sliderRoot=t.sliderRoot}SimpleRanger.prototype.__expects=["addValue","doRequest"],SimpleRanger.prototype.targetValue=null,SimpleRanger.prototype.updateHandler=function(){var e=this;return function(t){e.addValue(t)&&(e.sliderRoot.updateRequest=!0,e.doRequest())}},SimpleRanger.prototype.doRequest=function(){this.manager.doRequest()},SingleRangeWidget=r(p.Ranging,p.Patterning,c.SliderWidget,SimpleRanger,p.Delaying);var n={facet:!0,rows:0,fl:"id","facet.limit":-1,"facet.mincount":1,echoParams:"none"};c.RangeWidgeting=function(t){r.extend(!0,this,r.common(t,this)),this.slidersTarget=u(t.slidersTarget),this.lookupMap=t.lookupMap||{},this.pivotMap=null,this.rangeWidgets=[],Array.isArray(this.titleSkips)||(this.titleSkips=[this.titleSkips])},c.RangeWidgeting.prototype={__expects:["getPivotEntry","getPivotCounts","parseValue"],field:null,titleSkips:null,init:function(t){r.pass(this,c.RangeWidgeting,"init",t),this.manager=t;var e=this;e.applyCommand=u("#sliders-controls a.command.apply").on("click",function(t){return e.skipClear=!0,e.manager.doRequest(),!1}),u("#sliders-controls a.command.close").on("click",function(t){return e.rangeRemove(),!1})},afterTranslation:function(t){var e=this.getPivotCounts(t.facets);if(r.pass(this,c.RangeWidgeting,"afterTranslation",t),this.pivotMap)if(this.updateRequest){if(0<this.rangeWidgets.length)for(var a=this.buildPivotMap(e),i=0;i<this.rangeWidgets.length;++i){var n=this.rangeWidgets[i],s=a[n.targetValue];n.updateSlider([s[i].min,s[i].max])}}else this.rangeRemove();else{var o=this.manager.getParameter("q").value||"";o&&"*:*"!=o||this.manager.getParameter(this.useJson?"json.filter":"fq").value||(this.pivotMap=this.buildPivotMap(e))}this.updateRequest=!1},getPivotFromId:function(t){for(var e=null,a=0;(e=this.getPivotEntry(a)).id!=t;++a);return e},buildPivotMap:function(t){for(var d=this,u={},c=function(t,e,a,i){var n,s,o=d.getPivotEntry(e);if(o.disabled||(i=o.id+":"+t.val),a+=(t.val?o.field+":"+p.escapeValue(t.val):"-"+o.field+":*")+" ",n=t,null!=(s=d.getPivotEntry(e+1))&&(t=t[s.id].buckets),null!=s&&t.length)for(var r=0,l=t.length;r<l;++r)c(t[r],e+1,a,i);else(u[i]=u[i]||[]).push({id:o.id,pattern:a,color:o.color,min:n.min,max:n.max,avg:n.avg,val:n.val,count:n.count})},e=0;e<t.length;++e)c(t[e],0,"");return u},rangeRemove:function(){this.slidersTarget.empty().parent().removeClass("active");for(var t=0,e=this.rangeWidgets.length;t<e;++t)this.rangeWidgets[t].clearValues();this.rangeWidgets=[],this.lastPivotValue=null},buildTitle:function(t,e){for(var a=t.pattern.replace(/\\"/g,"%0022").match(/\w+:([^\s:\/"]+|"[^"]+")/g),i=[],n=0;n<a.length;++n){var s=a[n].match(/(\w+):([^\s:\/"]+|"[^"]+")/),o=s[2].replace(/^\s*\(\s*|\s*\)\s*$/g,"");s[1].match(e)||i.push(this.lookupMap[o]||o)}return i.join("/")+" <i>("+t.count+")</i>"},ensurePivotMap:function(e){if(null!=this.pivotMap)return e(this.pivotMap);var a=this.useJson?"json.filter":"fq",i=this;return this.doSpying(function(t){t.removeParameters(a),t.removeParameters("fl"),t.getParameter("q").value="",t.mergeParameters(n)},function(t){e(i.pivotMap=i.buildPivotMap(i.getPivotCounts(t.facets)))}),!1},openRangers:function(t){var e=this.pivotMap[t],a=this.buildPivotMap(this.getPivotCounts())[t];this.lastPivotValue=t,this.slidersTarget.empty().parent().addClass("active");for(var i=0,n=a.length;i<n;++i){var s=a[i],o=e.find(function(t){return t.pattern===s.pattern})||s,r=c.ui.fillTemplate("#slider-one"),l={id:s.id,targetValue:t,color:o.color,field:this.field,limits:[o.min,o.max],initial:[s.min,s.max],target:r,isRange:!0,valuePattern:s.pattern+"{{v}}",automatic:!0,title:this.buildTitle(s,/^unit[_shd]*|^effectendpoint[_shd]*/),units:"unit"==s.id?c.formatUnits(s.val):"",useJson:this.useJson,domain:this.domain,sliderRoot:this};this.slidersTarget.append(r),l.width=parseInt(this.slidersTarget.width()-u("#sliders-controls").width()-20)/(Math.min(n,2)+.1);var d=new SingleRangeWidget(l);this.rangeWidgets.push(d),d.init(this.manager)}},auxHandler:function(a){var i=this;return(this.getPivotFromId(this.parseValue(a).id)||{}).ranging?function(t){t.stopPropagation();var e=i.lastPivotValue;return i.rangeRemove(),a!=e&&i.ensurePivotMap(function(){i.openRangers(a)}),!1}:undefined},clearValues:function(){this.rangeRemove(),r.pass(this,c.RangeWidgeting,"clearValues")}}}(Solr,asSys,jQuery,jToxKit),function(t,l,s,o){var r='<a href="{{href}}" title="{{hint}}" target="{{target}}" class="{{css}}">{{value}}</a>';o.ItemListWidget=function(t){t.baseUrl=o.fixBaseUrl(t.baseUrl)+"/",l.extend(!0,this,l.common(t,this)),this.lookupMap=t.lookupMap||{},this.target=t.target,this.id=t.id,this.imagesRoot.match(/(\/|\\)$/)||(this.imagesRoot+="/")},o.ItemListWidget.prototype={baseUrl:"",summaryPrimes:["RESULTS"],imagesRoot:"images/",tagDbs:{},onCreated:null,onClick:null,summaryRenderers:{RESULTS:function(t,e){var a=this;return t.map(function(t){return t.split(".").map(function(t){return a.lookupMap[t]||t}).join(".")})},REFOWNERS:function(t,e){return{topic:"Study Providers",content:t.map(function(t){return o.formatString(r,{href:"#",hint:"Freetext search",target:"_self",value:t,css:"freetext_selector"})})}},REFS:function(t,e){return{topic:"References",content:t.map(function(t){var e=t.match(/^doi:(.+)$/);return e=null!=e?"https://www.doi.org/"+e[1]:t,o.formatString(e.match(/^https?:\/\//)?r:'<span title="{{hint}}" class="{{css}}">{{value}}</span>',{href:e,hint:"External reference",target:"ref",value:t})})}}},renderLinks:function(t){var e=this.getBaseUrl(t),a={};if(null==t.content)a.link=e+t.s_uuid,a.link_target=t.s_uuid,a.footer='<a href="'+e+t.s_uuid+'" title="Substance" target="'+t.s_uuid+'">Material</a><a href="'+e+t.s_uuid+'/structure" title="Composition" target="'+t.s_uuid+'">Composition</a><a href="'+e+t.s_uuid+'/study" title="Study" target="'+t.s_uuid+'">Studies</a>',a.composition=this.renderComposition(t,'<a href="'+e+t.s_uuid+'/structure" title="Composition" target="'+t.s_uuid+'">&hellip;</a>').join("<br/>");else{a.link_target="external",a.composition=this.renderComposition(t),a.link_title=this.tagDbs[t.dbtag_hss]&&this.tagDbs[t.dbtag_hss].title||"External database",a.footer="";for(var i=0;i<t.content.length;++i)t.content[i].match(/^https?:\/\//)&&(a.link||(a.link=t.content[i]),a.footer+='<a href="'+t.content[i]+'" target="external">'+a.link_title+"</a>&nbsp;")}return a},renderItem:function(e){var a=this,i=s(this.renderSubstance(e));return i.length&&(s(this.target).append(i),"function"==typeof this.onClick&&s("a.command",i[0]).on("click",function(t){a.onClick.call(i[0],t,e,a)}),"function"==typeof this.onCreated&&this.onCreated.call(i,e,this),s("a.more",i[0]).on("click",function(t){t.preventDefault(),t.stopPropagation();var e=s(this),a=s(".more-less",e.parent()[0]);return a.is(":visible")?(a.hide(),e.text("more")):(a.show(),e.text("less")),!1})),null},renderSubstance:function(t){var e=s("#summary-item").html(),a=this.buildSummary(t),i=function(t){return t.map(function(t){return o.formatString(e,t)}).join("")},n={logo:this.tagDbs[t.dbtag_hss]&&this.tagDbs[t.dbtag_hss].icon||this.imagesRoot+"external.png",link_title:this.tagDbs[t.dbtag_hss]&&this.tagDbs[t.dbtag_hss].title||"Substance",link_target:"_blank",link:"#",title:(t.publicname||t.name)+(t.pubname===t.name?"":"  ("+t.name+")")+(null==t.substanceType?"":" "+(this.lookupMap[t.substanceType]||t.substanceType)),summary:0<a.length?i(a.splice(0,this.summaryPrimes.length)):"",item_id:(this.prefix||this.id||"item")+"_"+t.s_uuid};return 0<a.length&&(n.summary+='<a href="#" class="more">more</a><div class="more-less" style="display:none;">'+i(a)+"</div>"),o.ui.fillTemplate("#result-item",s.extend(n,this.renderLinks(t)))},getBaseUrl:function(t){if(this.tagDbs[t.dbtag_hss]===undefined)return this.baseUrl;var e=this.tagDbs[t.dbtag_hss].server,a=e.substr(-1);return e+("/"!=a?"/substance/":"substance/")},renderComposition:function(t,n){var s=[],e=t._extended_&&t._extended_.composition;if(e){var a={};l.each(e,function(t){var e=a[t.component_s],i=[];e===undefined&&(a[t.component_s]=e=[]),l.each(t,function(t,e){var a=e.match(/^(\w+)_[shd]+$/);(e=a&&a[1]||e).match(/type|id|component/)||i.push(o.formatString(r,{href:"#",hint:"Freetext search on '"+e+"'",target:"_self",value:t,css:"freetext_selector"}))}),e.push(i.join(", "))}),l.each(a,function(t,e){for(var a="",i=0;i<t.length;++i)""!=t[i]&&(a+=0==i?": ":"; ",1<t.length&&(a+="<strong>["+(i+1)+"]</strong>&nbsp;"),a+=t[i]);""===a&&n&&(a=":&nbsp;"+n),s.push(e+" ("+t.length+")"+a)})}return s},buildSummary:function(t){var o=this,r=[];return l.each(t,function(t,e){var a=e.match(/^SUMMARY\.([^_]+)_?[hsd]*$/);if(a){a=a[1];var i=o.summaryRenderers[a]||o.summaryRenderers._,n="function"==typeof i?i.call(o,t,a):t;if(n){"object"!=typeof n||Array.isArray(n)?n={topic:a.toLowerCase(),values:n}:null==n.topic&&(n.topic=a.toLowerCase()),n.content||(n.content=Array.isArray(n.values)?n.values.join(", "):n.values.toString());var s=o.summaryPrimes.indexOf(a);-1<s&&s<r.length?r.splice(s,0,n):r.push(n)}}}),r}},o.ResultWidgeting=function(t){l.extend(!0,this,l.common(t,this))},o.ResultWidgeting.prototype={__expects:["populate"],init:function(t){l.pass(this,o.ResultWidgeting,"init",t),this.manager=t},beforeRequest:function(){s(this.target).html(s("<img>").attr("src",this.imagesRoot+"ajax-loader.gif"))},afterFailure:function(t,e){s(this.target).html("Error retrieving data!")},afterTranslation:function(t){s(this.target).empty(),this.populate(t.entries)}},o.ResultWidget=l(t.Listing,o.ListWidget,o.ItemListWidget,o.ResultWidgeting)}(Solr,asSys,jQuery,jToxKit),function(C,_){var l=function(t){this.rootElement=t.target,this.instanceNo=l.instanceCount++,C(this.rootElement).addClass("jtox-toolkit"),this.settings=C.extend(!0,{},l.defaults,t),this.settings.tab=this.settings.tab||_.ui.fullUrl.hash,this.settings.baseUrl+="/";var e=C(this.rootElement).append(_.ui.templates["all-studies"]),a=this;_.ui.changeTabsIds(e[0],"_"+this.instanceNo),this.tabs=e.tabs({select:function(t,e){a.loadPanel(e.panel)},beforeActivate:function(t,e){e.newPanel&&a.loadPanel(e.newPanel[0])}}),e.on("click","div.jtox-study-tab div button",function(t){var e=C(this).parents(".jtox-study-tab")[0];C(this).hasClass("expand-all")?C(".jtox-foldable",e).removeClass("folded"):C(this).hasClass("collapse-all")&&C(".jtox-foldable",e).addClass("folded")}),null!=this.settings.substanceUri&&this.querySubstance(this.settings.substanceUri)};l.prototype.loadPanel=function(e){var a=this;if(C(e).hasClass("unloaded")){var t=a.addParameters(C(e).data("jtox-uri"));_.ambit.call(a,t,function(t){t&&(C(".jtox-study.folded",e).removeClass("folded"),C(e).removeClass("unloaded").addClass("loaded"),a.processStudies(e,t.study,!0),_.fireCallback(a.settings.onStudy,a,t.study))})}},l.prototype.createCategory=function(t,e){var a=C("."+e+".jtox-study",t);return a.length||(a=C(t).append(C(_.ui.templates["one-study"]).addClass(e))),a[0]},l.prototype.addParameters=function(t){for(var e=["property_uri","top","category"],a=0;a<e.length;++a){var i=e[a];this.settings[i]&&(t=_.addParameter(t,i+"="+this.settings[i]))}return t},l.prototype.ensureTable=function(t,e){var s=this,o=e.protocol.category.code,a=C("."+o+" .jtox-study-table",t)[0];if(C(a).hasClass("dataTable"))C(a).DataTable().clear();else{var r=[],i=function(t,e){var a=0,i=[];for(var n in t)if(!(-1<i.indexOf(n))){t[n+" unit"]!==undefined&&i.push(n+" unit");var s=e(n);null!=s&&(r.push(s),a++)}return a},n=function(t,e,a){for(var i=0;i<e;++i){var n=C.extend({},l.defaultColumns[i+t]);null!=(n=_.tables.modifyColDef(s,n,o,a))&&r.push(n)}};n(0,1,"main"),i(e.parameters,function(i){if(e.effects[0].conditions[i]!==undefined||e.effects[0].conditions[i+" unit"]!==undefined)return undefined;var t={title:i,className:"center middle",data:"parameters."+i,defaultContent:"-"};return null==(t=_.tables.modifyColDef(s,t,o,"parameters"))?null:(t.render=function(t,e,a){return _.ui.renderRange(t,a[i+" unit"],e)},t)}),i(e.effects[0].conditions,function(i){var t={title:i,className:"center middle jtox-multi",data:"effects"};return null==(t=_.tables.modifyColDef(s,t,o,"conditions"))?null:(t.render=function(t,e,a){return _.tables.renderMulti(t,e,a,function(t,e){return _.ui.renderRange(t.conditions[i],t.conditions[i+" unit"],e)})},t)}),n(1,3,"effects"),i(e.interpretation,function(t){var e={title:t,className:"center middle jtox-multi",data:"interpretation."+t,defaultContent:"-"};return _.tables.modifyColDef(s,e,o,"interpretation")}),n(4,5,"protocol"),_.tables.sortColDefs(r),C(a).dataTable({paging:!0,processing:!0,lengthChange:!1,autoWidth:!1,dom:s.settings.dom,columns:r,infoCallback:function(t,e,a,i,n,s){var o=C(".title .data-field",C(this).parents(".jtox-study"))[0];return o.innerHTML=_.ui.updateCounter(o.innerHTML,n),s},createdRow:function(t){_.tables.equalizeHeights.apply(window,C("td.jtox-multi table tbody",t).toArray())},language:C.extend({processing:"<img src='"+s.settings.baseUrl+"/images/24x24_ambit.gif' border='0'>",loadingRecords:"No studies found.",zeroRecords:"No studies found.",emptyTable:"No studies available.",info:"Showing _TOTAL_ study(s) (_START_ to _END_)",lengthMenu:'Display <select><option value="10">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option><option value="-1">all</option></select> studies.'},s.settings.language)}),C(a).DataTable().columns.adjust()}return a},l.prototype.processSummary=function(t){var e=this,n={},a={"P-CHEM":"P-Chem",ENV_FATE:"Env Fate",ECOTOX:"Eco Tox",TOX:"Tox"};C(".jtox-study",e.rootElement).remove(),t.sort(function(t,e){var a=t.category.order||t.category.description||t.category.title,i=e.category.order||e.category.description||e.category.title;return null==a?-1:null==i?1:a==i?0:a<i?-1:1});var i,s,o,r,l=0,d=null;for(var u=0,c=t.length;u<c;++u){var p=t[u];if(h=p.topcategory.title){var h=h.replace(/ /g,"_"),g=C(".jtox-study-tab."+h,e.rootElement)[0];g||(i=h,s=p,o=void 0,o=C(_.ui.templates["one-category"]),r=_.ui.addTab(e.tabs,(a[i]||s.topcategory.title)+" (0)","jtox-"+i.toLowerCase()+"_"+e.instanceNo,o[0]).tab,C(r).data("type",i),o.addClass(i).data("jtox-uri",s.topcategory.uri),_.ui.fillTree(o[0],e.substance),l++,d=i,g=o[0]);var f=p.category.title;f?e.createCategory(g,f):n[h]=p.count}}1==l&&(e.settings.tab=d),C("ul li a",e.rootElement).each(function(t){var e=C(this).data("type");if(e){var a=n[e],i=C(this)[0];i.innerHTML=_.ui.updateCounter(i.innerHTML,a)}});for(var m=null,v=function(t){m&&clearTimeout(m);var i=t.currentTarget,n=C(this).parents(".jtox-study-tab")[0];m=setTimeout(function(){for(var t=C(".jtox-study-table",n),e=0,a=t.length;e<a;++e)C(t[e]).DataTable().filter(i.value).draw()},300)},b=C(".jtox-study-tab"),y=0,x=b.length;y<x;y++)C(".jtox-study-filter",b[y])[0].onkeydown=v},l.prototype.processStudies=function(t,e,a){var i={},n=0;if(a)for(var s=0,o=e.length;s<o;++s){var r=e[s];a&&(i[r.protocol.category.code]===undefined?(i[r.protocol.category.code]=[r],n++):i[r.protocol.category.code].push(r))}else i[e[0].protocol.category.code]=e;for(var l in i){var d=i[l],u=C("."+l+".jtox-study",t)[0];if(u!==undefined){_.ui.fillTree(u,{title:d[0].protocol.category.title+" (0)"});e={},s=0;for(var c=d.length;s<c&&(C.extend(!0,e,d[s]),C.isEmptyObject(e.parameters)||C.isEmptyObject(e.effects[0].conditions));++s);var p=this.ensureTable(t,e);C(p).DataTable().rows.add(d).draw(),C(p.tBodies[0]).children().each(function(){_.tables.equalizeHeights.apply(window,C("td.jtox-multi table tbody",this).toArray())}),1<n&&C(p).parents(".jtox-study").addClass("folded"),C(".jtox-multi",p[0]).each(function(){this.style.height=this.offsetHeight+"px"})}}},l.prototype.querySummary=function(t){var n=this;t=n.addParameters(t),_.ambit.call(n,t,function(t){if(t&&t.facet&&n.processSummary(t.facet),_.fireCallback(n.settings.onSummary,n,t.facet),n.settings.tab){var e=C(".jtox-study-tab."+decodeURIComponent(n.settings.tab).replace(/ /g,"_").toUpperCase(),n.root)[0];if(e){for(var a=0,i=e.parentNode.children.length;a<i&&e.parentNode.children[a].id!=e.id;++a);--a,C(n.tabs).tabs("option","active",a),C(n.tabs).tabs("option","selected",a)}}})},l.prototype.insertComposition=function(t){var e=C(".jtox-compo-tab",this.rootElement)[0];C(e).empty(),new _.ui.Composition(C.extend({},this.settings,{target:e,compositionUri:t}))},l.prototype.querySubstance=function(t){var e=this;_.ambit.call(e,t,function(t){t&&t.substance&&0<t.substance.length?((t=t.substance[0]).showname=t.publicname||t.name,t.IUCFlags=_.ambit.formatExtIdentifiers(t.externalIdentifiers,"display",t),e.substance=t,_.ui.fillTree(e.rootElement,t),_.ambit.call(e,t.referenceSubstance.uri,function(t){t&&0<t.dataEntry.length&&(_.ambit.processDataset(t,null,_.ambit.getDatasetValue),_.ui.fillTree(C(".jtox-substance",e.rootElement)[0],t.dataEntry[0]))}),_.fireCallback(e.settings.onLoaded,e,t.substance),e.querySummary(t.URI+"/studysummary"),e.insertComposition(t.URI+"/composition")):_.fireCallback(e.settings.onLoaded,e,null)})},l.prototype.query=function(t){this.querySubstance(t)},l.getFormatted=function(t,e,a){return"function"==typeof a?a.call(this,t,e):"string"==typeof a||"number"==typeof a?t[a]:t[0]},l.defaults={tab:null,dom:"rt<Fip>",language:null,errorDefault:"Err",onSummary:null,onComposition:null,onStudy:null,onLoaded:null,configuration:{columns:{_:{main:{},parameters:{},conditions:{},effects:{},protocol:{},interpretation:{}}}}},l.defaultColumns=[{title:"Name",className:"center middle",width:"15%",data:"protocol.endpoint"},{title:"Endpoint",className:"center middle jtox-multi",width:"10%",data:"effects",render:function(t,e,a){return _.tables.renderMulti(t,e,a,function(t,e){var a=l.getFormatted(t,e,"endpoint");return null!=t.endpointtype&&(a+=" ("+t.endpointtype+")"),a})}},{title:"Result",className:"center middle jtox-multi",width:"10%",data:"effects",render:function(t,e,a){return _.tables.renderMulti(t,e,a,function(t,e){var a=_.ui.renderRange(t.result,null,e);return null!=t.result.errorValue&&(a+=" ("+t.result.errQualifier+" "+t.result.errorValue+")"),a})}},{title:"Text",className:"center middle jtox-multi",width:"10%",data:"effects",render:function(t,e,a){return _.tables.renderMulti(t,e,a,function(t){return t.result.textValue||"-"})}},{title:"Guideline",className:"center middle",width:"15%",data:"protocol.guideline",render:"[,]",defaultContent:"-"},{title:"Owner",className:"center middle",width:"10%",data:"citation.owner",defaultContent:"-"},{title:"Citation",className:"center middle",width:"10%",data:"citation",render:function(t){return(t.title||"")+" "+(!!t.year||"")}},{title:"Reliability",className:"center middle",width:"10%",data:"reliability",render:function(t){return t.r_value}},{title:"UUID",className:"center middle",width:"15%",data:"uuid",searchable:!1,render:function(t,e){return"display"!=e?""+t:_.ui.shortenedData(t,"Press to copy the UUID in the clipboard")}}],l.instanceCount=0,_.ui.Study=l}((asSys,jQuery),jToxKit),function(l,d){function SubstanceKit(t){if(this.rootElement=t.target,l(this.rootElement).addClass("jtox-toolkit"),this.settings=l.extend(!0,{},SubstanceKit.defaults,t),this.pageStart=this.settings.pageStart,this.pageSize=this.settings.pageSize,!this.settings.noInterface){var i=this;this.settings.embedComposition&&null==this.settings.onDetails&&(this.settings.onDetails=function(t,e,a){new d.ui.Composition(t,l.extend({},i.settings,"object"==typeof i.settings.embedComposition?i.settings.embedComposition:{},{compositionUri:e.URI+"/composition"}))}),l(this.rootElement).append(d.ui.templates["all-substance"]),this.init(t)}this.settings.substanceUri&&this.querySubstance(i.settings.substanceUri)}SubstanceKit.prototype.init=function(t){var r=this,e=r.settings.configuration.columns.substance.Id;d.tables.putActions(r,e),e.title="",r.settings.configuration.columns.substance.Owner.render=function(t,e,a){return"display"!=e?t:'<a target="_blank" href="'+r.settings.baseUrl+"/substanceowner/"+a.ownerUUID+'/substance">'+t+"</a>"};var a={sDom:"rti"};r.settings.showControls?(d.tables.bindControls(r,{nextPage:function(){r.nextPage()},prevPage:function(){r.prevPage()},sizeChange:function(){r.queryEntries(r.pageStart,parseInt(l(this).val()))},filter:function(){l(r.table).DataTable().filter(l(this).val()).draw()}}),a.infoCallback=function(t,e,a,i,n,s){var o=l(".filterbox",r.rootElement).val();return l(".filtered-text",r.rootElement).html(o?' (filtered to <span class="high">'+n+"</span>) ":" "),""}):l(".jtox-controls",r.rootElement).remove(),r.settings.configuration=l.extend(!0,r.settings.configuration,t.configuration),r.table=d.tables.putTable(r,l("table",r.rootElement)[0],"substance",a)},SubstanceKit.prototype.queryEntries=function(n,s){n<0&&(n=0),(!s||s<0)&&(s=this.pageSize);var t=Math.floor(n/s),e=d.addParameter(o.substanceUri,"page="+t+"&pagesize="+s),o=this;d.ambit.call(o,e,function(t,e){if(t||200==e.status||(t={substabce:[]}),t){o.pageSize=s,o.pageStart=n;for(var a=0,i=t.substance.length;a<i;++a)t.substance[a].index=a+n+1;o.substance=t.substance,t.substance.length<o.pageSize&&(o.entriesCount=n+t.substance.length),d.fireCallback(o.settings.onLoaded,o,t),o.settings.noInterface||(l(o.table).DataTable().clear(),l(o.table).DataTable().add(t.substance).draw(),o.updateControls(n,t.substance.length))}else d.fireCallback(o.settings.onLoaded,o,t)})},SubstanceKit.prototype.querySubstance=function(t){this.substanceUri=d.ambit.grabPaging(this,t),this.queryEntries(this.pageStart)},SubstanceKit.prototype.query=function(t){this.querySubstance(t)},SubstanceKit.prototype.nextPage=d.tables.nextPage,SubstanceKit.prototype.prevPage=d.tables.prevPage,SubstanceKit.prototype.updateControls=d.tables.updateControls,SubstanceKit.defaults={showControls:!0,selectionHandler:null,embedComposition:null,noInterface:!1,onDetails:null,onLoaded:null,language:{loadingRecords:"No substances found.",zeroRecords:"No substances found.",emptyTable:"No substances available.",info:"Showing _TOTAL_ substance(s) (_START_ to _END_)"},pageStart:0,pageSize:10,configuration:{columns:{substance:{Id:{title:"Id",data:"URI",defaultContent:"-",width:"60px",render:function(t,e,a){return"display"!=e?a.index:"&nbsp;-&nbsp;"+a.index+"&nbsp;-&nbsp;"}},"Substance Name":{title:"Substance Name",data:"name",render:function(t,e,a){return null!=t&&"null"!=t||(t="-"),"display"!=e?t:d.ui.linkedData('<a target="_blank" href="'+a.URI+'/study">'+t+"</a>","Click to view study details",t)}},"Substance UUID":{title:"Substance UUID",data:"i5uuid",render:function(t,e,a){return null==t||"null"==t?"":"display"!=e?t:d.ui.shortenedData('<a target="_blank" href="'+a.URI+'/study">'+t+"</a>","Press to copy the UUID in the clipboard",t)}},"Substance Type":{title:"Substance Type",data:"substanceType",width:"15%",defaultContent:"-"},"Public name":{title:"Public name",data:"publicname",defaultContent:"-"},"Reference substance UUID":{title:"Reference substance UUID",data:"referenceSubstance",render:function(t,e,a){return null==t.i5uuid||"null"==t.i5uuid?"":"display"!=e?t.i5uuid:d.ui.shortenedData('<a target="_blank" href="'+t.uri+'">'+t.i5uuid+"</a>","Press to copy the UUID in the clipboard",t.i5uuid)}},Owner:{title:"Owner",data:"ownerName",defaultContent:"-"},Info:{title:"Info",data:"externalIdentifiers",render:function(t,e,a){return d.ambit.formatExtIdentifiers(t,e,a)}}}}}},d.ui.Substance=SubstanceKit}((asSys,jQuery),jToxKit),jT.ui.templates["all-composition"]='<div class="jtox-composition unloaded"><table class="dataTable composition-info font-small display"><thead><tr><th>Composition name:</th><td class="data-field camelCase" data-field="name"> ? </td></tr><tr><th>Composition UUID:</th><td class="data-field" data-field="uuid"> ? </td></tr><tr><th>Purity of IUC Substance:</th><td class="data-field" data-field="purity"> ? </td></tr></thead></table><table class="composition-table display"></table></div>',jToxKit.ui.templates["faceted-search-kit"]='<div class="query-container">\x3c!-- left --\x3e<div id="query" class="query-left"><div id="accordion-resizer" class="ui-widget-content"><div id="accordion"></div></div></div>\x3c!-- right --\x3e<div id="result-tabs" class="query-right"><ul><li><a href="#hits_tab">Hits list</a></li><li><a href="#basket_tab">Selection</a></li><li><a href="#queries_tab">Predefined Queries</a></li><li class="jtox-ds-export"><a href="#export_tab">Export</a></li></ul><div id="hits_tab"><div class="row remove-bottom"><ul class="tags remove-bottom" id="selection"></ul><footer><div id="sliders-controls"><a href="#" class="jtox-fadable command close">Close</a></div><div id="sliders"></div></footer></div><div id="navigation"><ul id="pager"></ul><div id="pager-header"></div></div><div class="docs_wrapper"><section id="docs" class="item-list"></section></div></div><div id="basket_tab"><section id="basket-docs" class="item-list"></section><div style="padding-top: 70px;"></div></div><div id="queries_tab"><section id="predefined-queries" class="item-list"></section><div style="padding-top: 70px;"></div></div><div id="export_tab"><form target="_blank" method="post"><input type="hidden" name="search" /><h6>Select dataset to export</h6><div id="export_dataset"><input type="radio" value="filtered" name="export_dataset" id="filtered_data"checked="checked" /><label for="filtered_data">Filtered entries</label><input type="radio" value="selected" name="export_dataset" id="selected_data" /><label for="selected_data">Selected entries</label></div><h6>Select export type</h6><div id="export_type"></div><h6>Select output format</h6><input type="hidden" name="export_format" id="export_format" /><div class="data_formats"></div><br /><button id="export_go" type="submit" name="export_go" data-format="Download {{source}} as {{format}}">?</button><br /><select id="report_select" style="width: auto;"></select><button id="report_go" type="button" name="report_go" data-format="Generate summary report for {{source}}">?</button><div class="ui-state-error ui-corner-all warning-message" style="padding: 0 .7em;"><p><span class="ui-icon ui-icon-alert"style="float: left; margin-right: .3em;"></span><strong>Warning: </strong>Please, either add entries to the selection or some filters to the query.</p></div></form></div></div>\x3c!-- query container --\x3e</div>',jToxKit.ui.templates["faceted-search-templates"]='<section id="result-item"><article id="{{item_id}}" class="item"><header>{{title}}</header><a href="{{link}}" title="{{link_title}}" class="avatar" target="{{link_target}}"><img jt-src="{{logo}}" /></a><div class="composition">{{composition}}</div>{{summary}}<footer class="links">{{footer}}<a href="#" class="add jtox-fadable command">Add to Selection</a><a href="#" class="remove jtox-fadable command">Remove from Selection</a><a href="#" class="none jtox-fadable command">Already added</a></footer></article></section><div id="summary-item"><div class="one-summary"><span class="topic">{{topic}}:</span><span class="value">{{content}}</span></div></div><div id="tag-facet"><ul class="tags tag-group folded"></ul></div><section id="query-item"><article id="{{id}}" class="item"><header>{{title}}</header><div class="composition">{{description}}<a href="#" title="Apply the query" style="width: 100%;"><span style="float:right;margin:0;">Apply</span></a></div></article></section><div id="tab-topcategory"><h3 id="{{id}}_header" class="nested-tab">{{title}}</h3><div id="{{id}}" class="widget-content widget-root"><div><input type="text" placeholder="Filter_" class="widget-filter" /><input type="button" class="switcher" value="OR" /></div><ul class="widget-content tags remove-bottom" data-color="{{color}}"></ul></div></div><div id="slider-one"><input type="hidden" /></div><div id="export-type"><input type="radio" value="{{fields}}" {{selected}} name="export_type" id="{{name}}" /><label for="{{name}}">{{name}}</label></div><div id="export-format"><div class="jtox-inline jtox-ds-download jtox-fadable"><a target="_blank" data-name="{{name}}" data-mime="{{mime}}" href="#"><img class="borderless"jt-src="{{icon}}" /></a></div></div>',jT.ui.templates["logger-main"]='<div class="list-wrap"><div class="list-root"></div></div><div class="status"><div class="icon jtox-fadable"></div></div>',jT.ui.templates["logger-line"]='<div id="jtox-logline"><div class="logline"><div class="icon"></div><span class="content data-field" data-field="header">{{header}}</span><div class="details data-field" data-field="details">{{details}}</div></div></div>',jT.ui.templates["all-studies"]='<div><ul><li><a href="#jtox-substance">IUC Substance</a></li><li><a href="#jtox-compo-tab">Composition</a></li></ul><div id="jtox-substance" class="jtox-substance"><table class="dataTable display"><thead><tr><th class="right size-third">IUC Substance name:</th><td class="data-field camelCase" data-field="name"> ? </td></tr><tr><th class="right">IUC Substance UUID:</th><td class="data-field" data-field="i5uuid"> ? </td></tr><tr><th class="right">IUC Public name:</th><td class="data-field camelCase" data-field="publicname"> ? </td></tr><tr><th class="right">Legal entity:</th><td class="data-field" data-field="ownerName"> ? </td></tr><tr><th class="right">Legal entity UUID:</th><td class="data-field" data-field="ownerUUID"> ? </td></tr><tr><th class="right">Type substance composition:</th><td class="data-field" data-field="substanceType"> ? </td></tr><tr class="borderless-bottom"><th class="right">IUC Substance Reference Identifier</th><td></td></tr><tr class="borderless-top borderless-bottom"><td class="right">CAS:</td><td class="data-field" data-field="compound.cas"> ? </td></tr><tr class="borderless-top borderless-bottom"><td class="right">EC:</td><td class="data-field" data-field="compound.einecs"> ? </td></tr><tr class="borderless-top borderless-bottom"><td class="right">Chemical name:</td><td class="data-field" data-field="compound.name"> ? </td></tr><tr class="borderless-top borderless-bottom"><td class="right">IUPAC name:</td><td class="data-field" data-field="compound.iupac"> ? </td></tr><tr class="borderless-top borderless-bottom"><td class="right">UUID:</td><td class="data-field" data-field="referenceSubstance.i5uuid"> ? </td></tr><tr class="borderless-top"><td class="right">IUC Flags:</td><td class="data-field" data-field="IUCFlags"> ? </td></tr></thead></table></div><div id="jtox-compo-tab" class="jtox-compo-tab"></div></div>',jT.ui.templates["one-category"]='<div class="jtox-study-tab unloaded"><div class="float-right"><button class="expand-all">Expand all</button><button class="collapse-all">Collapse all</button></div><p><input type="text" class="jtox-study-filter ui-input" placeholder="Filter..." /></p><h4 class="data-field camelCase" data-field="showname"> ? </h4></div>',jT.ui.templates["one-study"]='<div class="jtox-study jtox-foldable folded"><div class="title"><p class="data-field" data-field="title">? (0)</p></div><div class="content"><table class="jtox-study-table content display"></table></div></div>',jT.ui.templates["all-substance"]='<div class="jtox-substance"><div class="jtox-controls">Showing from <span class="data-field high" data-field="pagestart"> ? </span> to <span class="data-field high" data-field="pageend"> ? </span><span class="filtered-text"> </span>in pages of <select class="data-field" data-field="pagesize"><option value="10" selected="yes">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option><option value="200">200</option><option value="500">500</option></select> substances<a class="paginate_disabled_previous prev-field" tabindex="0" role="button">Previous</a><a class="paginate_enabled_next next-field" tabindex="0" role="button">Next</a><input type="text" class="filterbox" placeholder="Filter..." /></div><div><table class="display"></table></div></div>';