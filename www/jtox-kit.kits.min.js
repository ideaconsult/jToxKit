!function(e,l,d){function AnnotationKit(t){e.extend(!0,this,AnnotationKit.defaults,t);var a=this;this.selector=t.selector,this.annoTip=new AnnoTip({context:this.context,onSelection:function(t){return a.analyzeAnno(t)},onAction:function(t,e){return a.onAction(t,e)},onClose:null}),t.autoStart&&this.start()}AnnotationKit.defaults={context:null,ajaxSettings:null,connector:null,inputSize:30,matchers:[{selector:"*",extractor:null,presenter:null,exclusive:!1}]},AnnotationKit.prototype.start=function(){this.annoTip.attach(this.selector)},AnnotationKit.prototype.onAction=function(t,e){if("edit"===t)return"function"==typeof this.controlsPrepack&&(e=this.controlsPrepack(a,e)),e.content=this.controlsPacker(e),this.annoTip.update(e),this.beautify(e.element),void l(e.element).addClass("openned");var a;"ok"===t&&(a=this.dataPacker(e),"function"==typeof this.dataPostprocess&&(a=this.dataPostprocess(a,e)),a&&l.ajax(l.extend(!0,this.ajaxSettings,{data:a}))),l(".annotip-severity",e.element).buttonset("destroy"),this.annoTip.discard()},AnnotationKit.prototype.analyzeAnno=function(i){var t=this.dataExtractor(i.element),n=t.data,e=l(i.element).parentsUntil(t.target).addBack().add(t.target),a=this.matchers;i.reference={},i.controls=[];for(var s=0;s<a.length;++s){var o=a[s],r=!1;if(e.filter(o.selector).each(function(t,e){var a=null;"function"==typeof o.extractor?a=o.extractor(n,i,e):"string"==typeof o.extractor||Array.isArray(o.extractor)?a=_.set({},o.extractor,_.get(n,o.extractor)):null!=o.extractor&&(a=o.extractor),null!=a&&(i.reference=l.extend(!0,i.reference,a)),"string"==typeof o.presenter?i.controls.push(d.ui.formatString(o.presenter,i)):"function"==typeof o.presenter&&i.controls.push(o.presenter(n,i,e)),r=!0}),r&&o.exclusive)break}return 0<i.controls.length},AnnotationKit.prototype.controlsPacker=function(t){return t.controls.push(d.formatString(d.ui.templates["anno-description"],this),d.formatString(d.ui.templates["anno-severity"],this)),"<form><div>"+t.controls.join("</div>\n<div>")+"</div></form>"},AnnotationKit.prototype.beautify=function(t){l(".annotip-severity",t).buttonset(),l("input",t).attr("size",this.inputSize-1),l("textarea",t).attr("cols",this.inputSize)},AnnotationKit.prototype.dataPreprocess=function(e,t){return l("form",t.element).serializeArray().forEach(function(t){_.set(e,t.name,t.value)}),e},AnnotationKit.prototype.dataPacker=function(t){return this.dataPreprocess({context:t.context,reference:t.reference,operation:t.operation,suggestion:t.suggestion},t)},AnnotationKit.prototype.dataExtractor=function(t){var e=l(t).closest("table.dataTable>tbody>tr")[0];return{target:e,data:d.tables.getTable(e).row(e).data()}},AnnotationKit.prototype.dataInserter=function(t,e){},d.ui.Annotation=AnnotationKit}(asSys,jQuery,jToxKit),function(d,u){function CompositionKit(t){d(this.rootElement=t.target).addClass("jtox-toolkit"),this.settings=d.extend(!0,{},CompositionKit.defaults,t),this.settings.compositionUri&&this.queryComposition(this.settings.compositionUri)}CompositionKit.prototype.prepareTable=function(t,e){var i=this,a=i.settings.columns.composition&&i.settings.columns.composition.Name;a&&i.settings.selectionHandler&&(u.tables.putActions(i,a),a.sWidth="60px");for(var n,s=u.tables.processColumns(i,"composition"),o=0,r=s.length;o<r;++o)if("Also"==s[o].title){s[o].title="",s[o].render=function(t,e,a){return t?'<a href="'+i.settings.baseUrl+"substance?type=related&compound_uri="+encodeURIComponent(t)+'" target="_blank">Also contained in...</a>':""};break}!i.settings.showDiagrams||(n=u.ambit.baseFeatures["http://www.opentox.org/api/1.1#Diagram"])&&n.column&&s.push(d.extend({},n.column,{title:"Structure",data:"component",render:function(t,e,a){return n.render(t.compound.URI,e,t)}})),i.table=u.tables.putTable(i,d("table.composition-table",e)[0],"composition",{columns:s}),d(i.table).DataTable().rows.add(t).draw();var l=d("th.colspan-2",i.table);return d(l).attr("colspan",2),d(d(l).next()).remove(),i.table},CompositionKit.prototype.queryComposition=function(t){var l=this;this.settings.baseUrl=u.formBaseUrl(this.compositionUri=t),u.ambit.call(l,t,function(t){if(t&&t.composition){var e={};u.ambit.processFeatures(t.feature);for(var a=0,i=t.composition.length;a<i;++a){var n=t.composition[a];u.ambit.processEntry(n.component,t.feature,u.ambit.getDatasetValue);var s=e[n.compositionUUID];s===undefined&&(e[n.compositionUUID]=s={name:"",purity:"",maxvalue:0,uuid:n.compositionUUID,composition:[]}),s.composition.push(n),""!=n.compositionName&&null!=n.compositionName&&(s.name=n.compositionName);var o=n.proportion.typical;"HAS_CONSTITUENT"==n.relation&&""==s.name&&(s.name=n.component.compound.name+" ("+u.valueAndUnits(o.value,o.unit||"%&nbsp;(w/w)",o.precision)+")"),"HAS_CONSTITUENT"==n.relation&&s.maxvalue<o.value&&(s.maxvalue=o.value,o=n.proportion.real,s.purity=u.valueAndUnits(o.lowerValue+"-"+o.upperValue,o.unit||"%&nbsp;(w/w)"))}if(u.fireCallback(l.settings.onLoaded,l,t.composition),!l.settings.noInterface)for(var a in e){var r=u.ui.putTemplate("all-composition",e[a],l.rootElement);l.settings.showBanner||d(".composition-info",r).remove(),l.prepareTable(e[a].composition,r[0])}}else u.fireCallback(l.settings.onLoaded,l,t.composition)})},CompositionKit.prototype.query=function(t){d(self.rootElement).empty(),this.queryComposition(t)},CompositionKit.defaults={selectionHandler:null,showBanner:!0,showDiagrams:!1,noInterface:!1,sDom:"rt<Ffp>",onLoaded:null,columns:{composition:{Type:{title:"Type",className:"left",width:"10%",data:"relation",render:function(t,e,a){if("display"!=e)return""+t;var i="HAS_ADDITIVE"==t?a.proportion.function_as_additive:"";return'<span class="camelCase">'+t.substr(4).toLowerCase()+"</span>"+(i===undefined||null===i||""==i?"":" ("+i+")")}},Name:{title:"Name",className:"camelCase left",width:"15%",data:"component.compound.name",render:function(t,e,a){return"display"!=e?""+t:'<a href="'+a.component.compound.URI+'" target="_blank" title="Click to view the compound"><span class="ui-icon ui-icon-link" style="float: left; margin-right: .3em;"></span></a>'+t}},"EC No.":{title:"EC No.",className:"left",width:"10%",data:"component.compound.einecs"},"CAS No.":{title:"CAS No.",className:"left",width:"10%",data:"component.compound.cas"},"Typical concentration":{title:"Typical concentration",className:"center",width:"15%",data:"proportion.typical",render:function(t,e,a){return"display"!=e?""+t.value:u.valueAndUnits(t.value,t.unit||"%&nbsp;(w/w)",t.precision)}},"Concentration ranges":{title:"Concentration ranges",className:"center colspan-2",width:"20%",data:"proportion.real",render:function(t,e,a){return"display"!=e?""+t.lowerValue:u.valueAndUnits(t.value,t.unit||"%&nbsp;(w/w)",t.precision)}},"Upper range":{title:"Upper range",className:"center",width:"20%",data:"proportion.real",render:function(t,e,a){return"display"!=e?""+t.upperValue:u.valueAndUnits(t.value,t.unit||"%&nbsp;(w/w)",t.precision)}},Also:{title:"Also",className:"center",orderable:!1,data:"component.compound.URI",defaultContent:"-"}}}},u.ui.Composition=CompositionKit}((asSys,jQuery),jToxKit),function(d,x,C){var e=0;function CompoundKit(t){x(this.rootElement=t.target).addClass("jtox-toolkit"),this.settings=x.extend(!0,{baseFeatures:C.ambit.baseFeatures},CompoundKit.defaults,t),null!=t&&null!=t.groups&&(this.settings.groups=t.groups),this.instanceNo=e++,this.settings.rememberChecks&&this.settings.showTabs&&(this.featureStates={}),this.settings.datasetUri?this.settings.initialQuery&&this.queryDataset(this.settings.datasetUri):this.datasetUri=this.settings.baseUrl+this.settings.defaultService}CompoundKit.prototype.init=function(){var t;this.feature=null,this.dataset=null,this.groups=null,this.fixTable=this.varTable=null,this.entriesCount=null,this.suspendEqualization=!1,this.orderList=[],this.usedFeatures=[],this.pageStart=this.settings.pageStart,this.pageSize=this.settings.pageSize,this.settings.noInterface||(t=this,C.ui.putTemplate("all-compound"," ? ",this.rootElement),C.tables.bindControls(this,{nextPage:function(){t.nextPage()},prevPage:function(){t.prevPage()},sizeChange:function(){t.queryEntries(t.pageStart,parseInt(x(this).val()))},filter:function(){t.updateTables()}}),this.$procDiv=x(".jt-processing",this.rootElement),this.$errDiv=x(".jt-error",this.rootElement))},CompoundKit.prototype.clearDataset=function(){if(this.usedFeatures!==undefined){this.settings.noInterface||x(this.rootElement).empty();for(var t=0,e=this.usedFeatures.length;t<e;++t){var a=this.usedFeatures[t];this.feature[a].used=!1}}},CompoundKit.prototype.prepareTabs=function(t,e,a){var i=this,n=document.createElement("div");n.style.display="none",t.appendChild(n),ulEl=document.createElement("ul"),n.appendChild(ulEl);var s=function(t,e){var a=document.createElement("li");ulEl.appendChild(a);var i=document.createElement("a");return i.href="#"+t,i.innerHTML=e,a.appendChild(i),a},o=[],r=0;for(var l in i.groups){var d,u="jtox-ds-"+l.replace(/\s/g,"_")+"-"+i.instanceNo+(e?"":"-details"),c=l.replace(/_/g," "),p=s(u,c);e&&(p.title="Select which columns to be displayed"),(f=document.createElement("div")).id=u,n.appendChild(f),i.settings.groupSelection&&e&&(d=C.ui.getTemplate("compound-one-tab"),x(f).append(d),x(".multi-select",d).on("click",function(t){var e=x(this).closest(".ui-tabs-panel"),a=x(this).hasClass("select");x("input",e).each(function(){this.checked=a,x(this).trigger("change")}),t.stopPropagation()})),a(f,l)&&(i.settings.hideEmpty?(x(f).remove(),x(p).remove(),--r):o.push(r)),++r,C.fireCallback(i.settings.onTab,i,f,p,c,e)}if(e&&i.settings.showExport){var h="jtox-ds-export-"+i.instanceNo,m=s(h,"Export");x(m).addClass("jtox-ds-export");var f=C.ui.getTemplate("compound-export",{id:h});x(n).append(f),f=x(".jtox-exportlist",f)[0];for(var g=0,b=i.settings.exports.length;g<b;++g){var v=i.settings.exports[g],y=C.ui.getTemplate("compound-download",{link:C.addParameter(i.datasetUri,"media="+encodeURIComponent(v.type)),type:v.type,icon:v.icon});x(f).append(y)}C.fireCallback(i.settings.onTab,i,f,m,"Export",e)}return n.style.display="block",x(n).tabs({collapsible:e,active:(!i.settings.tabsFolded||!e)&&0,disabled:o,heightStyle:e?"content":"auto"==i.settings.detailsHeight?"auto":"fill"})},CompoundKit.prototype.equalizeTables=function(){var r,l,t=this;t.suspendEqualization||null==t.fixTable||null==t.varTable||(C.tables.equalizeHeights(t.fixTable.tHead,t.varTable.tHead),C.tables.equalizeHeights(t.fixTable.tBodies[0],t.varTable.tBodies[0]),r=x(".jtox-ds-tables",t.rootElement)[0],l=x(".jtox-ds-variable",r).width(),x(".jtox-details-box",t.rootElement).each(function(t){var e,a,i,n,s,o=x(this).data("rootCell");o&&(this.style.display="none",e=function positionTo(t,e){var a={left:-e.offsetLeft,top:-e.offsetTop};for(e=e.offsetParent;t&&t!=e;t=t.offsetParent)a.left+=t.offsetLeft,a.top+=t.offsetTop;return a}(o,r),this.style.top=e.top+"px",this.style.left=e.left+"px",a=x(o).parents(".dataTables_wrapper").width()-o.offsetLeft,this.style.width=a+l+"px",this.style.display="block",i=x(o).parents("tr").height(),n=o.offsetHeight,s=x(this).height(),n<i&&x(o).height(n=i),n<s&&x(o).height(n=s),s<n&&(x(this).height(n),x(".ui-tabs").tabs("refresh")))}))},CompoundKit.prototype.featureValue=function(t,e,a){var i=this.feature[t],n=i.data!==undefined?d.get(e,x.isArray(i.data)?i.data[0]:i.data):e.values[t];return"function"==typeof i.render?i.render(n,a||"filter",e):C.ui.renderRange(n,i.units,a)},CompoundKit.prototype.featureUri=function(t){return this.feature[t].URI||t},CompoundKit.prototype.featureData=function(n,t,s){null==s&&(s="details");var o=this,r=[];return d.each(t,function(t){var e,a=x.extend({},o.feature[t]),i=a.visibility;i&&i!=s||(e=a.title,a.value=o.featureValue(t,n,s),!e||o.settings.hideEmptyDetails&&!a.value||(a.value||(a.value="-"),r.push(a)))}),r},CompoundKit.prototype.prepareColumn=function(i,n){if("details"==n.visibility)return null;var o,r,t={title:n.title?C.valueAndUnits(n.title.replace(/_/g," "),this.settings.showUnits?n.units:null):"",defaultContent:"-"};return"function"==typeof n.column?t=n.column.call(this,t,i):null!=n.column&&(t=x.extend(t,n.column)),t.data=null!=n.data?n.data:"values",null!=n.render?t.render=null!=n.data?n.render:function(t,e,a){return n.render(a.values[i],e,a)}:n.shorten?t.render=function(t,e,a){return n.data||(t=t[i]),t=t||"","display"!=e?""+t:C.ui.shortenedData(t,"Press to copy the value in the clipboard")}:null==n.data&&(t.render=(o=i,r=n.unit,function(t,e,a){var i=a.values[o]||"-";if("object"!=typeof i)return i;x.isArray(i)||(i=[i]);for(var n="",s=0;s<i.length;++s)n+="display"==e?"<div>":"",n+=C.ui.renderRange(i[s],r,e),n+="display"==e?"</div>":",";return n})),n.shorten&&(t.width="75px"),t},CompoundKit.prototype.getVarRow=function(t){return null!=t.tagName&&(t=C.ui.rowIndex(t)),document.getElementById("jtox-var-"+this.instanceNo+"-"+t)},CompoundKit.prototype.prepareTables=function(){var u=this,s=[],o=[],t=u.settings.baseFeatures["#IdRow"];t.render||(t.render=u.settings.hasDetails?function(t,e,a){return"display"!=e?""+t:"&nbsp;-&nbsp;"+t+'&nbsp;-&nbsp;<br/><i class="jtox-details-open fa fa-folder" title="Press to open/close detailed info for this compound"></i>'}:function(t,e,a){return"display"!=e?""+t:"&nbsp;-&nbsp;"+t+"&nbsp;-&nbsp;"}),o.push(u.prepareColumn("#IdRow",t),{className:"jtox-hidden",data:"index",defaultContent:"-",orderable:!0,render:function(t,e,a){return null==u.orderList?0:u.orderList[t]}}),s.push({className:"jtox-hidden jtox-ds-details paddingless",data:"index",render:function(t,e,a){return""}});var r=function(){var t=x(this).data(),e=x(t.sel+" table tr ."+t.column,u.rootElement);this.checked?(x(e).show(),x("table tr .blank-col",u.rootElement).addClass("jtox-hidden")):(x(e).hide(),0==x(t.sel+" table tr *:visible",u.rootElement).length&&x("table tr .blank-col",u.rootElement).removeClass("jtox-hidden")),u.settings.rememberChecks&&(u.featureStates[t.id]=this.checked),u.equalizeTables()},c=function(t,e){for(var a=0,i=t;i;i=i.nextElementSibling,++a)x(i).toggleClass("jtox-hidden");e?t.setAttribute("colspan",""+a):t.removeAttribute("colspan")},i=u.settings.hasDetails?function(t,e){var a,i,n,s,o,r,l=x(".jtox-ds-details",t)[0],d=x(t).data("jtox-index");(null==u.settings.preDetails||C.fireCallback(u.settings.preDetails,u,d,l))&&l&&(x(t).toggleClass("jtox-detailed-row"),a=x(t).hasClass("jtox-detailed-row"),c(l,a),i=u.getVarRow(d).firstElementChild,c(i,a),x(".jtox-details-open",t).toggleClass("fa-folder fa-folder-open"),a?(n=u.dataset.dataEntry[d],(s=document.createElement("div")).className="jtox-details-box jtox-details",o=x(".jtox-ds-tables",u.rootElement)[0],r=x(l).width()+x(".jtox-ds-variable",o).width(),x(s).width(r),null==u.settings.detailsHeight||"fill"==u.settings.detailsHeight?x(s).height(2*x(l).height()):0<parseInt(u.settings.detailsHeight)&&x(s).height(u.settings.detailsHeight),o.appendChild(s),u.prepareTabs(s,!1,function(t,e){var a,i=u.featureData(n,u.groups[e]);return(0<i.length||!u.settings.hideEmpty)&&(x(t).addClass("jtox-details-table"),a=document.createElement("table"),t.appendChild(a),x(a).dataTable({paging:!1,processing:!0,lengthChange:!1,autoWidth:!1,dom:"rt<f>",columns:C.tables.processColumns(u,"compound"),ordering:!0}),x(a).dataTable().fnAddData(i),x(a).dataTable().fnAdjustColumnSizing()),0==i.length}),x(l).height(s.offsetHeight),C.fireCallback(u.settings.onDetails,u,s,n,l),x(l).data("detailsDiv",s),x(s).data("rootCell",l)):(x(l).data("detailsDiv").remove(),x(l).data("detailsDiv",null),l.style.height=""),u.equalizeTables())}:null;for(var e in u.groups)d.each(u.groups[e],function(t){var e,a,i=u.feature[t],n=u.prepareColumn(t,i);n&&(a="col-"+(e=i.primary?o:s).length,n.className=(n.className?n.className+" ":"")+a,x('.jtox-ds-features input.jtox-checkbox[value="'+t+'"]',u.rootElement).data({sel:i.primary?".jtox-ds-fixed":".jtox-ds-variable",column:a,id:t}).on("change",r),e.push(n))});null!=u.settings.fixedWidth&&x(".jtox-ds-fixed",u.rootElement).width(u.settings.fixedWidth),C.tables.sortColDefs(o),u.fixTable=x(".jtox-ds-fixed table",u.rootElement).dataTable({paging:!1,lengthChange:!1,autoWidth:!1,dom:"rt",columns:o,ordering:!1,createdRow:function(e,t){var a=t.index;u.settings.hasDetails&&x(".jtox-details-open",e).on("click",function(t){i(e,t)}),x(e).data("jtox-index",a),C.fireCallback(u.settings.onRow,u,e,t,a),C.tables.installHandlers(u,e),x(".jtox-diagram .icon",e).on("click",function(){setTimeout(function(){x(u.fixTable).dataTable().fnAdjustColumnSizing(),u.equalizeTables()},50)})},language:{emptyTable:'<span class="jt-feeding">'+(u.settings.language.process||"Feeding data...")+"</span>"}})[0],s.push({className:"center blank-col"+(1<s.length?" jtox-hidden":""),data:"index",render:function(t,e,a){return"display"!=e?t:"..."}}),C.tables.sortColDefs(s),u.varTable=x(".jtox-ds-variable table",u.rootElement).dataTable({paging:!1,processing:!0,lengthChange:!1,autoWidth:!1,dom:"rt",ordering:!0,columns:s,scrollCollapse:!0,createdRow:function(t,e){var a=e.index;t.id="jtox-var-"+u.instanceNo+"-"+a,C.tables.equalizeHeights.apply(window,x("td.jtox-multi table tbody",t).toArray()),x(t).addClass("jtox-row"),x(t).data("jtox-index",a),C.fireCallback(u.settings.onRow,u,t,e,a),C.tables.installHandlers(u,t)},drawCallback:function(t){for(var e=x(".jtox-row",this),a=0,i=e.length;a<i;++a){var n=x(e[a]).data("jtox-index");u.orderList[n]=a}0<i&&x(u.fixTable).dataTable().fnSort([[1,"asc"]])},language:{emptyTable:"-"}})[0]},CompoundKit.prototype.updateTables=function(){this.settings.hasDetails&&x("div.jtox-details-box",this.rootElement).remove(),this.filterEntries(x(".jtox-controls input",this.rootElement).val())},CompoundKit.prototype.prepareGroups=function(t){var i=this,e=i.settings.groups;for(var n in"function"==typeof e&&(e=e(t,i)),i.groups={},e){var a,s=e[n];null!=s&&(a="function"==typeof s||"string"==typeof s?C.fireCallback(s,i,n,t):s,i.groups[n]=[],d.each(a,function(t,e){var a=!1;CompoundKit.enumSameAs(t,i.feature,function(t){a|=t.used}),"name"==e||a||(i.groups[n].push(t),i.usedFeatures.push(t),i.feature[t].used=!0)}))}},CompoundKit.prototype.enumerateFeatures=function(t){var e=!1;for(var a in this.groups){for(var i=0,n=this.groups[a].length;i<n&&!(e=t(this.groups[a][i],a));++i);if(e)break}return e},CompoundKit.prototype.filterEntries=function(n){var s=this,t=[];if(""!=(n=null==n?"":n.toLowerCase()))for(var e=0,a=s.dataset.dataEntry.length;e<a;++e){var o=s.dataset.dataEntry[e];s.enumerateFeatures(function(t,e){var a=s.feature[t];if(a.search!==undefined&&!a.search)return!1;var i=s.featureValue(t,o,"sort");return null!=i&&0<=i.toString().toLowerCase().indexOf(n)})&&t.push(o)}else t=s.dataset.dataEntry;x(s.fixTable).dataTable().fnClearTable(),x(s.varTable).dataTable().fnClearTable(),t&&t.length&&(x(s.fixTable).dataTable().fnAddData(t),x(s.varTable).dataTable().fnAddData(t)),x(".jt-feeding",s.rootElement).html(s.settings.language.zeroRecords||"No records matching the filter."),C.ui.updateTree(x(".jtox-controls",s.rootElement)[0],{"filtered-text":n?' (filtered to <span class="high">'+t.length+"</span>) ":" "}),s.settings.showTabs&&(s.suspendEqualization=!0,x(".jtox-ds-features .jtox-checkbox",s.rootElement).trigger("change"),s.suspendEqualization=!1),s.equalizeTables()},CompoundKit.prototype.queryUri=function(t){return this.datasetUri?(null==t&&(t={from:this.pageStart,size:this.pageSize}),t.from<0&&(t.from=0),null==t.size&&(t.size=this.pageSize),C.addParameter(this.datasetUri,"page="+Math.floor(t.from/t.size)+"&pagesize="+t.size)):null},CompoundKit.prototype.queryEntries=function(t,e,a){var i=this,n={from:t,size:e},s=i.queryUri(n);x(".jtox-controls select",i.rootElement).val(n.size);var o=function(t){var e;t?(i.pageSize=n.size,e=i.pageStart=Math.floor(n.from/n.size)*n.size,t.dataEntry.length<i.pageSize&&(i.entriesCount=e+t.dataEntry.length),i.dataset=CompoundKit.processDataset(t,x.extend(!0,{},t.feature,i.feature),i.settings.fnAccumulate,i.pageStart),C.fireCallback(i.settings.onLoaded,i,t),i.settings.noInterface||(i.updateTables(),i.settings.showControls&&i.updateControls(e,t.dataEntry.length))):C.fireCallback(i.settings.onLoaded,i,t),C.fireCallback(i.settings.onComplete,i)};(i.dataset=null)!=a?o(a):C.ambit.call(i,s,o)},CompoundKit.prototype.queryFeatures=function(t,i){var s=this,n=null,e=(e=t||s.settings.featureUri||s.settings.feature_uri)||C.addParameter(s.datasetUri,"page=0&pagesize=1");C.ambit.call(s,e,function(t,e){var a;t||200==e.status||(s.$procDiv.hide(),s.$errDiv.show().find(".message").html("Server error: "+e.statusText)),t&&(s.feature=t.feature,CompoundKit.processFeatures(s.feature,s.settings.baseFeatures),a={dataEntry:[],feature:s.feature},s.settings.noInterface?C.fireCallback(s.settings.onPrepared,s,a,s):(s.prepareGroups(a),s.settings.showTabs&&s.prepareTabs(x(".jtox-ds-features",s.rootElement)[0],!0,function(i,t){var n=!0;return d.each(s.groups[t],function(t){var e,a=(s.feature[t]||{}).visibility;a&&"main"!=a||(n=!1,(e=s.feature[t].title)&&function(t,e,a){var i=C.ui.getTemplate("compound-one-feature",{title:e.replace(/_/g," "),uri:s.featureUri(t)});x(a).append(i);var n=x('input[type="checkbox"]',i)[0];if(n)n.value=t,s.settings.rememberChecks&&(n.checked=s.featureStates[t]===undefined||s.featureStates[t])}(t,e,i))}),n}),C.fireCallback(s.settings.onPrepared,s,a,s),s.prepareTables(),s.equalizeTables()),i(n))})},CompoundKit.prototype.queryDataset=function(t,e){var a=this;this.clearDataset(),this.init(),t=C.ambit.grabPaging(a,t),a.settings.baseUrl=a.settings.baseUrl||C.formBaseUrl(t),a.datasetUri=(0!=t.indexOf("http")?a.settings.baseUrl:"")+t,a.$procDiv.show(),a.$errDiv.hide(),a.settings.language.loadingRecords&&x(".message",procDiv).html(a.settings.language.loadingRecords),a.queryFeatures(e,function(t){a.$procDiv.hide(),a.queryEntries(a.pageStart,a.pageSize,t)})},CompoundKit.prototype.query=function(t){this.queryDataset(t)},CompoundKit.prototype.nextPage=C.tables.nextPage,CompoundKit.prototype.prevPage=C.tables.prevPage,CompoundKit.prototype.updateControls=C.tables.updateControls,CompoundKit.processEntry=function(t,e,a){for(var i in a=a||CompoundKit.defaults.fnAccumulate,t.values){var n=e[i];if(n){var s=t.values[i];if(n.accumulate&&s&&n.data){var o="function"==typeof n.accumulate?n.accumulate:a,r=n.data;x.isArray(r)||(r=[r]);for(var l=0;l<r.length;++l)d.set(t,r[l],C.fireCallback(o,this,i,d.get(t,r[l]),s,e))}}}return t},CompoundKit.extractFeatures=function(t,e,a){var i=[];for(var n in e){var s=x.extend({},e[n]);s.value=t.values[n],s.title&&!1!==C.fireCallback(a,null,s,n,i.length)&&(s.value||(s.value="-"),i.push(s))}return i},CompoundKit.enumSameAs=function(t,e,a){for(var i=e[t],n=t.replace(/(http.+\/feature\/).*/g,"$1"),s=t;C.fireCallback(a,null,i,s),null!=i.sameAs&&i.sameAs!=t&&t!=n+i.sameAs;){if(e[i.sameAs]!==undefined)s=i.sameAs;else{if(e[n+i.sameAs]===undefined)break;s=n+i.sameAs}i=e[s]}return s},CompoundKit.processFeatures=function(t,e){for(var a in null==e&&(e=C.Ambit.baseFeatures),t=x.extend(t,e)){var i=t[a];i.URI||(i.URI=a),CompoundKit.enumSameAs(a,t,function(t,e){var a=t.sameAs;t=x.extend(!0,t,i),i=x.extend(!0,i,t),t.sameAs=a})}return t},CompoundKit.processDataset=function(t,e,a,i){e||(CompoundKit.processFeatures(t.feature),e=t.feature),a=a||CompoundKit.defaults.fnAccumulate,i=i||0;for(var n=0,s=t.dataEntry.length;n<s;++n)CompoundKit.processEntry(t.dataEntry[n],e,a),t.dataEntry[n].number=n+1+i,t.dataEntry[n].index=n;return t},CompoundKit.defaults={noInterface:!1,showTabs:!0,tabsFolded:!1,showExport:!0,showControls:!0,showUnits:!0,hideEmpty:!1,groupSelection:!0,hasDetails:!0,hideEmptyDetails:!0,detailsHeight:"fill",fixedWidth:null,pageSize:20,pageStart:0,rememberChecks:!1,featureUri:null,defaultService:"query/compound/search/all",initialQuery:!0,metricFeature:"http://www.opentox.org/api/1.1#Similarity",onTab:null,onLoaded:null,onComplete:null,onPrepared:null,onDetails:null,preDetails:null,language:{},fnAccumulate:function(t,e,a,i){return null==a?e:(a=a.toString(),null==e||0<=a.toLowerCase().indexOf(e.toLowerCase())?a:0<=e.toLowerCase().indexOf(a.toLowerCase())?e:e+", "+a)},groups:{Identifiers:["http://www.opentox.org/api/1.1#Diagram","#DetailedInfoRow","http://www.opentox.org/api/1.1#CASRN","http://www.opentox.org/api/1.1#EINECS","http://www.opentox.org/api/1.1#IUCLID5_UUID"],Names:["http://www.opentox.org/api/1.1#ChemicalName","http://www.opentox.org/api/1.1#TradeName","http://www.opentox.org/api/1.1#IUPACName","http://www.opentox.org/api/1.1#SMILES","http://www.opentox.org/api/1.1#InChIKey","http://www.opentox.org/api/1.1#InChI","http://www.opentox.org/api/1.1#REACHRegistrationDate"],Calculated:function(t,e){var a=[];for(var i in 0<e.dataEntry.length&&null!=e.dataEntry[0].compound.metric&&a.push(this.settings.metricFeature),e.feature){var n=e.feature[i];null==n.source||null==n.source.type||n.basic||"algorithm"!=n.source.type.toLowerCase()&&"model"!=n.source.type.toLowerCase()||a.push(i)}return a},Other:function(t,e){var a=[];for(var i in e.feature)e.feature[i].used||e.feature[i].basic||a.push(i);return a}},exports:[{type:"chemical/x-mdl-sdfile",icon:"/assets/img/types/sdf64.png"},{type:"chemical/x-cml",icon:"/assets/img/types/cml64.png"},{type:"chemical/x-daylight-smiles",icon:"/assets/img/types/smi64.png"},{type:"chemical/x-inchi",icon:"/assets/img/types/inchi64.png"},{type:"text/uri-list",icon:"/assets/img/types/lnk64.png"},{type:"application/pdf",icon:"/assets/img/types/pdf64.png"},{type:"text/csv",icon:"/assets/img/types/csv64.png"},{type:"text/plain",icon:"/assets/img/types/txt64.png"},{type:"text/x-arff",icon:"/assets/img/types/arff.png"},{type:"text/x-arff-3col",icon:"/assets/img/types/arff-3.png"},{type:"application/rdf+xml",icon:"/assets/img/types/rdf64.png"},{type:"application/json",icon:"/assets/img/types/json64.png"},{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",icon:"/assets/img/types/xlsx.png"}],baseFeatures:{"http://www.opentox.org/api/1.1#Diagram":{title:"Diagram",search:!1,visibility:"main",primary:!0,data:"compound.URI",column:{className:"paddingless",width:"125px"},render:function(t,e,a){return dUri=C.ambit.diagramUri(t),"display"!=e?dUri:'<div class="jtox-diagram borderless"><i class="icon fa fa-search-plus"></i><a target="_blank" href="'+t+'"><img src="'+dUri+'" class="jtox-smalldiagram"/></a></div>'}},"#IdRow":{used:!0,basic:!0,data:"number",column:{className:"middle"}},"#DetailedInfoRow":{title:"InfoRow",search:!1,data:"compound.URI",basic:!0,primary:!0,column:{className:"jtox-hidden jtox-ds-details paddingless",width:"0px"},visibility:"none",render:function(t,e,a){return""}},"http://www.opentox.org/api/1.1#Similarity":{title:"Similarity",data:"compound.metric",search:!0}},columns:{compound:{Name:{title:"Name",data:"title",render:function(t,e,a){return"<span>"+t+"</span>"+C.ui.fillHtml("info-ball",{href:a.URI||"#",title:"Compound's detailed info"})}},Value:{title:"Value",data:"value",defaultContent:"-"},SameAs:{title:"SameAs",data:"sameAs",defaultContent:"-"},Source:{title:"Source",data:"source",defaultContent:"-",render:function(t,e,a){return t&&t.type?'<a target="_blank" href="'+t.URI+'">'+t.type+"</a>":"-"}}}}},C.ui.Compound=CompoundKit}(_,jQuery,jToxKit),function(p,h,m,f){var s={},c={},a={servlet:"select",multipleSelection:!0,keepAllFacets:!0,connector:m,onPrepare:function(t){var e=t.url.indexOf("?");this.proxyUrl?(t.data={query:t.url.substr(e+1)},t.url=this.proxyUrl,t.type=t.method="POST"):t.url+=(e<0?"?":"&")+"wt=json"},topSpacing:10,nestingField:"type_s",nestingRules:{composition:{parent:"substance",limit:100},study:{parent:"substance",limit:1e4},params:{parent:"study",limit:1e4},conditions:{parent:"study",limit:1e4}},exportTypes:[],exportSolrDefaults:[{name:"echoParams",value:"none"},{name:"rows",value:999998}],exportDefaultDef:{callbacksMap:{lookup:function(t){return s[t]||t}}},savedQueries:[],listingFields:[],facets:[],summaryRenderers:{}},e=null,o=function(){null!=e&&clearTimeout(e),e=setTimeout(function(){var t=f.modifyURL(window.location.href,"ui",encodeURIComponent(JSON.stringify(c)));t&&window.history.pushState({query:window.location.search},document.title,t),e=null},1e3)},g=function(t){var e,a=e=t.title.replace(/^\"(.+)\"$/,"$1"),a=e.replace(/^caNanoLab\./,"").replace(/^http\:\/\/dx\.doi\.org/,"");a=(s[a]||a).replace("NPO_","").replace(" nanoparticle","");var i=m("<span/>").html(t.count||0);"function"==typeof t.onAux&&i.click(t.onAux);var n=m("<li/>").append(m('<a href="#" class="tag" title="'+e+" "+(t.hint||"")+(a!=e?" ["+e+"]":"")+'">'+a+"</a>").append(i));return"function"==typeof t.onMain&&n.click(t.onMain),t.color&&n.addClass(t.color),n},b=function(t){f.TagWidget.prototype.init.call(this,t),t.getListener("current").registerWidget(this)},v=function(t){var e=this.getHeaderText();e.textContent=f.ui.updateCounter(e.textContent,t),h.act(this,this.header.data("refreshPanel"));var a=c[this.id]||{};a.values=this.getValues(),c[this.id]=a,o()},y=function(t){var e="OR"==t.value.toUpperCase(),a=this.getValues();this.clearValues(),this.aggregate=!e,t.value=e?"AND":"OR";for(var i=0;i<a.length;++i)this.addValue(a[i]);this.doRequest();var n=c[this.id]||{};n.aggregate=!e,c[this.id]=n,o()};f.ui.FacetedSearch=function(t){this.id=null,h.extend(!0,this,a,t),this.serverUrl=this.solrUrl,"string"==typeof this.lookupMap&&(this.lookupMap=window[this.lookupMap]),null==this.lookupMap&&(this.lookupMap={}),s=this.lookupMap,m(t.target).html(f.ui.templates["faceted-search-kit"]),delete this.target;var e=f.parseURL(window.location.href).params.ui;null!=e&&(c=JSON.parse(decodeURIComponent(e))),this.initDom(),this.initComm(),this.initExport(),this.initQueries()},f.ui.FacetedSearch.prototype={initDom:function(){this.accordion=m("#accordion"),this.accordion.accordion({heightStyle:"content",collapsible:!0,animate:200,active:!1,activate:function(t,e){var a,i,n,s,o;e.newPanel&&e.newPanel[0]&&(a=e.newHeader[0],i=e.newPanel[0],n=m("input.widget-filter",i),s=n.outerHeight(!0),m("span.ui-icon-search",a).length?o=e.newPanel.data("refreshPanel"):(o=function(){i.scrollHeight>i.clientHeight||""!=n.val()||m(a).hasClass("nested-tab")?(m(i).scrollTop(s),n.show(),m("span.ui-icon-search",a).removeClass("unused")):(n.hide(),m("span.ui-icon-search",a).addClass("unused"))},e.newPanel.data("refreshPanel",o),e.newHeader.data("refreshPanel",o),e.newHeader.append(m('<span class="ui-icon ui-icon-search"></span>').on("click",function(t){e.newPanel.animate({scrollTop:0<e.newPanel.scrollTop()?0:s},300,function(){0<e.newPanel.scrollTop()?m("input.widget-filter",i).blur():m("input.widget-filter",i).focus()}),t.stopPropagation(),t.preventDefault()}))),n.val(""),o())}}),m(document).on("click","ul.tag-group",function(t){m(this).toggleClass("folded"),m(this).parents(".widget-root").data("refreshPanel").call()}),m(document).on("keyup","#accordion input.widget-filter",function(t){var a,i=m(this).val().toLowerCase(),e=m(this).parents("div.widget-root")[0];27==(t.keyCode||t.which)&&m(this).val(i=""),""==i?m("li,ul",e).show():m("li>a",e).each(function(){var t=m(this).closest("ul.tag-group"),e=m(this).parent();a=t.data("hidden")||0,e.hasClass("category")||(0<=this.title.toLowerCase().indexOf(i)||0<=this.innerText.toLowerCase().indexOf(i)?e.show():(e.hide(),++a)),t.length&&a&&t.data("hidden",a)}),m("ul.tag-group",e).each(function(){var t=m(this);a=parseInt(t.data("hidden"))||0,t.children().length>a+1?t.show().removeClass("folded"):t.hide().addClass("folded"),t.data("hidden",null)})});var a=m("#result-tabs"),i=this;a.tabs({}),m("#accordion-resizer").resizable({minWidth:150,maxWidth:450,grid:[10,10],handles:"e",start:function(t,e){resSize={width:a.width(),height:a.height()}},resize:function(t,e){i.accordion.accordion("refresh"),m("#query-sticky-wrapper").width(i.accordion.width()),m(this).width(function(t,e){return e-7})}}),m(".query-left#query").sticky({topSpacing:this.topSpacing,widthFromWrapper:!1})},initComm:function(){var t,s,e=h(p.Requesting,p.Spying,p.Pivoting,f.PivotWidgeting,f.RangeWidgeting),a=h(p.Requesting,p.Faceting,f.AccordionExpansion,f.TagWidget,f.Running);this.manager=t=new(h(p.Management,p.Configuring,p.QueryingJson,f.Translation,f.NestedSolrTranslation))(this),t.addListeners(new f.ResultWidget(m.extend(!0,{},this,{id:"result",target:m("#docs"),itemId:"s_uuid",nestLevel:"composition",onClick:function(t,e){var a,i;s.findItem(e.s_uuid)<0&&(s.addItem(e),a="",(i=m('a[href="#basket_tab"]')).html(f.ui.updateCounter(i.html(),s.length)),s.enumerateItems(function(t){a+=t.s_uuid+";"}),(a=f.modifyURL(window.location.href,"basket",a))&&window.history.pushState({query:window.location.search},document.title,a),m("footer",this).toggleClass("add none"))},onCreated:function(t){m("footer",this).addClass("add")}}))),t.addListeners(new(h(p.Widgets.Pager))({id:"pager",target:m("#pager"),prevLabel:"&lt;",nextLabel:"&gt;",innerWindow:1,renderHeader:function(t,e,a){m("#pager-header").html("<span>displaying "+Math.min(a,e+1)+" to "+Math.min(a,e+t)+" of "+a+"</span>")}}));for(var i=0,n=this.facets.length;i<n;++i){var o=this.facets[i],r=c[o.id];(u=new a(m.extend({target:this.accordion,expansionTemplate:"tab-topcategory",subtarget:"ul",runMethod:y,multivalue:this.multipleSelection,aggregate:r===undefined||r.aggregate===undefined?this.aggregateFacets:r.aggregate,exclusion:this.multipleSelection||this.keepAllFacets,useJson:!0,renderItem:g,init:b,onUpdated:v,nesting:"type_s:substance",domain:{type:"parent",which:"type_s:substance"},classes:o.color},o))).afterTranslation=function(t){this.populate(this.getFacetCounts(t.facets))},m(u.target).closest("div.widget-content").find("input.switcher").val(u.aggregate?"OR":"AND"),t.addListeners(u)}for(var l in t.addListeners(new e({id:"studies",target:this.accordion,subtarget:"ul",expansionTemplate:"tab-topcategory",before:"#cell_header",field:"loValue_d",lookupMap:this.lookupMap,pivot:this.pivot,statistics:{min:"min(loValue_d)",max:"max(loValue_d)",avg:"avg(loValue_d)"},slidersTarget:m("#sliders"),multivalue:this.multipleSelection,aggregate:this.aggregateFacets,exclusion:this.multipleSelection||this.keepAllFacets,useJson:!0,renderTag:g,classes:"dynamic-tab",nesting:"type_s:substance",domain:{type:"parent",which:"type_s:substance"}})),t.addListeners(new f.CurrentSearchWidget({id:"current",target:m("#selection"),renderItem:g,useJson:!0})),this.basket=s=new(h(f.ListWidget,f.ItemListWidget))(m.extend(!0,{},this,{id:"basket",target:m("#basket-docs"),summaryRenderers:this.summaryRenderers,itemId:"s_uuid",onClick:function(t,e){var a,i,n;!1!==s.eraseItem(e.s_uuid)?(m(this).remove(),a="",i=m('a[href="#basket_tab"]'),n=m("#result_"+e.s_uuid),i.html(f.ui.updateCounter(i.html(),s.length)),s.enumerateItems(function(t){a+=t.s_uuid+";"}),(a=f.modifyURL(window.location.href,"basket",a))&&window.history.pushState({query:window.location.search},document.title,a),0<n.length&&m("footer",n[0]).toggleClass("add none")):console.log("Trying to remove from basket an inexistent entry: "+JSON.stringify(e))},onCreated:function(t){m("footer",this).addClass("remove")}})),h.act(this,this.onPreInit,t),t.init(),c){var d=c[l].values,u=t.getListener(l);h.each(d,function(t){u.addValue(t)})}t.doRequest()},updateButtons:function(t){var e,a,i=m("button",t);m("#export_dataset").buttonset("option","disabled")?i.button("option","label","No target dataset selected...").button("disable"):m(t).find("input[name=export_dataset]").val()&&(e=m("#export_dataset :radio:checked + label").text().toLowerCase(),a=m(t.export_format).data("name").toUpperCase(),i.button("enable").each(function(){var t=m(this);t.button("option","label",f.formatString(t.data("format"),{source:e,format:a}))}))},initQueries:function(){var a=this.manager;this.queries=new(h(f.ListWidget))({id:"queries",target:m("#predefined-queries")}),this.queries.renderItem=function(t){return el$=f.ui.getTemplate("query-item",t),el$.data("query",t.filters),el$.on("click",function(t){var e=m(this).data("query");a.removeParameters("fq"),a.removeParameters("json.filter"),a.getParameter("q").value="",e.forEach(function(t){t.faceter?a.getListener(t.faceter).addValue(t.value):"object"==typeof t.parameter?a.addParameter(t.parameter):a.addParameter(t.name,t.value,t.domain)}),a.doRequest(),m("#result-tabs").tabs("option","active",0)}),el$},this.queries.populate(this.savedQueries)},initExport:function(){var o=this;this.prepareFormats(),this.prepareTypes(),m("#export_dataset").buttonset(),m("#export_dataset input").on("change",function(t){o.updateButtons(this.form)}),m("#export_tab button").button({disabled:!0});var i=m("#export_go");i.on("click",function(t){var e=i.button("option","label"),a=(new Date).getTime();i.button("option","label","Downloading..."),o.makeExport(m("#export_tab form")[0],function(t){null!=t&&(console.error(t),"object"==typeof t&&(t=t.message||"Wrong request!")),setTimeout(function(){i.button("option","label",(t||e).substr(0,40))},Math.max(0,a+900-(new Date).getTime()))})}),m("#result-tabs").tabs({activate:function(t,e){var a,i,n,s;"export_tab"==e.newPanel[0].id&&(i=0<((a=o.manager.getParameter("q").value)&&a.length)||0<o.manager.getParameter("json.filter").length,n=!!o.basket.length,s=i||n,m("#export_dataset").buttonset(s?"enable":"disable"),m("#export_select").toggleClass("disabled",!s),m("div.warning-message")[s?"hide":"show"](),m(".data_formats").toggleClass("disabled",!s),m("input#selected_data").prop("checked",n).prop("disabled",!n).toggleClass("disabled",!n),m("input#filtered_data").prop("checked",i&&!n).prop("disabled",!i).toggleClass("disabled",!i),m(".data_formats .jtox-ds-download a").first().trigger("click"),m(".data_formats .jtox-ds-download a").first().trigger("click"),m("#export_dataset").buttonset("refresh"),o.updateButtons(o.form))}})},makeExport:function(e,i){var a=this,n=this.exportFormats[m(".data_formats .selected").data("index")],t=this.exportTypes[parseInt(e.export_select.value)],s=_.defaultsDeep(m.extend(!0,{},t.definition),this.exportDefaultDef),o=t.server||n.server,r=this.getSelectedIds(e),l=function(t){e.search.value=t.join(" "),e.action=a.ambitUrl+"query/substance/study/uuid?media="+encodeURIComponent(e.export_format.value)},n=n.name;Array.prototype.unshift.apply(s.extraParams,this.exportSolrDefaults);var d,u,c=new(h(f.Exporting,p.Configuring,p.QueryingJson))({exportDefinition:s,useJson:!1,expectJson:!0});return c.init(this.manager),"ambitUrl"==o?r?l(r):m.ajax(c.prepareExport([{name:"wt",value:"json"},{name:"fl",value:"s_uuid_hs"}],r).getAjax(a.serverUrl,{async:!1,dataType:"json",success:function(t){var a=[];m.each(t.response.docs,function(t,e){a.push(e.s_uuid_hs)}),l(a),i()},error:function(t,e,a){i(a)}})):(d=c.prepareExport("tsv"==n?[{name:"wt",value:"json"},{name:"json2tsv",value:!0}]:[{name:"wt",value:"xlsx"===n?"json":n}],r,!1).getAjax(this.solrUrl),u=function(t){t instanceof Blob||(t=new Blob([t])),f.activateDownload(null,t,"Report-"+(new Date).toISOString().replace(":","_")+"."+n,!0),i()},s.template&&"xlsx"===n?Promise.all([m.ajax(d),f.promiseXHR(m.extend({url:s.template,settings:{responseType:"arraybuffer"}},this.ajaxSettings))]).then(function(t){var a=t[0],e=t[1];"function"==typeof s.onData&&s.onData(a),XlsxPopulate.fromDataAsync(e).then(function(t){try{new XlsxDataFill(new XlsxDataFill.XlsxPopulateAccess(t,XlsxPopulate),s).fillData(a),t.outputAsync().then(u)}catch(e){i(e)}})["catch"](i)})["catch"](i):(d.dataType="application/json",d.settings={responseType:"arraybuffer"},f.promiseXHR(d).then(u)["catch"](i))),!0},getSelectedIds:function(t){var e=null;return"filtered"!=t.export_dataset.value&&(e=[],this.basket.enumerateItems(function(t){e.push(t.s_uuid)})),e},prepareFormats:function(){for(var t=m("#export_tab div.data_formats"),n=this,e=0,a=this.exportFormats.length;e<a;++e){var i=f.ui.getTemplate("export-format",this.exportFormats[e]);i.data("index",e),t.append(i),m("a",t[0]).on("click",function(t){var e,a=m(this),i=a.closest("form")[0];return a.hasClass("disabled")||a.hasClass("selected")||(e=a.closest("div.data_formats"),i.export_format.value=a.data("mime"),m(i.export_format).data("name",a.data("name")),n.updateButtons(i),m("div",e[0]).removeClass("selected"),e.addClass("selected"),a.closest(".jtox-fadable").addClass("selected")),!1})}},prepareTypes:function(){for(var e=this,t=m("#export_select"),a=function(t){m(".data_formats a").addClass("disabled"),t.split(",").forEach(function(t){m(".data_formats a[data-name="+t+"]").removeClass("disabled")}),m(".data_formats a:visible").not(".disabled").first().trigger("click")},i=0,n=this.exportTypes.length;i<n;++i)t.append(f.ui.getTemplate("select-one-option",m.extend({value:i,selected:0==i?"selected":""},this.exportTypes[i])));t.on("change",function(t){return a(e.exportTypes[parseInt(this.value)].formats),!1}),a(this.exportTypes[0].formats)}}}(Solr,asSys,jQuery,jToxKit),function(n,s,o){o.ui.Logging=function(t){var e,i,a=s(t.target);n.extend(!0,this,n.common(t,this)),this.target=t.target,a.html(o.ui.templates["logger-main"]),a.addClass("jtox-toolkit jtox-log"),"number"==typeof this.lineHeight&&(this.lineHeight=this.lineHeight.toString()+"px"),"number"!=typeof this.keepMessages&&(this.keepMessages=parseInt(this.keepMessages)),this.listRoot=s(".list-root",this.target)[0],this.statusEl=s(".status",this.target)[0],this.rightSide?(this.statusEl.style.right="0px",a.addClass("right-side")):this.statusEl.style.left="0px",this.setStatus(""),this.events={},this.autoHide&&(a.bind("click",function(t){s(this).toggleClass("hidden")}),a.bind("mouseleave",function(t){s(this).addClass("hidden")})),this.mountDestination&&(e="object"==typeof this.mountDestination?this.mountDestination:_.get(window,this.mountDestination),i=this,e.onPrepare=function(t){return i.beforeRequest(t)},e.onSuccess=function(t,e,a){return i.afterRequest(t,a,e)},e.onError=function(t,e){return i.afterFailure(t,e)})},o.ui.Logging.prototype={mountDestination:null,statusDelay:1500,keepMessages:50,lineHeight:"20px",rightSide:!1,hasDetails:!0,autoHide:!0,formatEvent:function(t,e){var a={};return null!=t&&(a.header=t.method.toUpperCase()+": "+t.service,a.details="..."),null!=e&&(a.details=e.status+" "+e.statusText+"<br/>"+e.getAllResponseHeaders()),a},formatUrl:function(t){return t.protocol+"://"+t.host+t.path},setIcon:function(t,e){"error"==e?t.addClass("ui-state-error"):t.removeClass("ui-state-error"),t.data("status",e),"error"==e?s(".icon",t).addClass("ui-icon ui-icon-alert").removeClass("loading ui-icon-check"):"success"==e?s(".icon",t).addClass("ui-icon ui-icon-check").removeClass("loading ui-icon-alert"):(s(".icon",t).removeClass("ui-icon ui-icon-check ui-icon-alert"),"connecting"==e&&s(".icon",t).addClass("loading"))},setStatus:function(t){var e=this;s(".icon",e.statusEl).removeClass("jt-faded"),e.setIcon(s(e.statusEl),t),"error"!=t&&"success"!=t||setTimeout(function(){s(".icon",e.statusEl).addClass("jt-faded");var t=!1;s(".logline",e.listRoot).each(function(){"connecting"==s(e).data("status")&&(t=!0)}),t&&e.setStatus("connecting")},e.statusDelay)},addLine:function(t){var a=this,i=o.ui.getTemplate("logger-line",t);for(i.height("0px"),this.listRoot.insertBefore(i[0],this.listRoot.firstElementChild),setTimeout(function(){i.height(a.lineHeight)},150),a.hasDetails&&s(".icon",i[0]).on("click",function(t){var e;i.toggleClass("openned"),i.hasClass("openned")?(s(".info-field",i[e=0]).each(function(){e+=this.offsetHeight}),i.height(e+6)):i.height(a.lineHeight),t.stopPropagation()});this.listRoot.childNodes.length>a.keepMessages;)this.listRoot.removeChild(this.listRoot.lastElementChild);return i},beforeRequest:function(t){t.service=this.formatUrl(o.parseURL(t.url));var e=this.formatEvent(t),a=this.addLine(e);this.setStatus("connecting"),this.events[t.logId=Date.now()]=a,this.setIcon(a,"connecting"),a.data("status","connecting")},afterResponse:function(t,e,a){var i=this.events[e.logId];this.setStatus(t),i?(delete this.events[e.logId],i.html(o.formatString(o.ui.templates["logger-line"],this.formatEvent(null,a)))):(e.service||(e.service=this.formatUrl(o.parseURL(e.url))),i=this.addLine(this.formatEvent(e,a))),this.setIcon(i,t)},afterRequest:function(t,e,a){this.afterResponse("success",e,a)},afterFailure:function(t,e){this.afterResponse("error",e,t),console&&console.log("Error ["+e.service+"]: "+t.statusText)}}}(asSys,jQuery,jToxKit),function(k,o,q,A){function UserWidget(t){this.settings=q.extend(!0,{},UserWidget.defaults,t)}function MatrixKit(t){var a=this;q(this.rootElement=t.target).addClass("jtox-toolkit"),A.ui.putTemplate("all-matrix"," ? ",this.rootElement),this.settings=q.extend(!0,{},MatrixKit.defaults,t),"string"==typeof this.settings.studyTypeList&&(this.settings.studyTypeList=k.get(window,this.settings.studyTypeList,{}));var i=function(){var t;this.checked&&(document.body.className=this.id,(t=q(this).parent().data("action"))&&A.fireCallback(a[t],a,this.id,q(this).closest(".ui-tabs-panel")[0],!1))},n=function(t){var e;t&&(0<(e=q(".jq-buttonset.action input:checked",t)).length?e.each(i):A.fireCallback(a[q(t).data("action")],a,t.id,t,!0))};q(this.rootElement).tabs({heightStyle:"content",select:function(t,e){n(e.panel)},activate:function(t,e){e.newPanel&&n(e.newPanel[0])},create:function(t,e){e.panel&&n(e.panel[0])}}),q(".jq-buttonset",this.rootElement).buttonset(),q(".jq-buttonset.action input",this.rootElement).on("change",i);var s=o(A.AutocompleteWidget,UserWidget);q(".jtox-users-select",this.rootElement).each(function(t){var e=q(t);new s({target:t,baseUrl:a.settings.baseUrl,tokenMode:!0,extraParam:"bundle_number="+a.bundle.number,permission:e.data("permission")}).init()}),a.onIdentifiers(null,q("#jtox-identifiers",a.rootElement)[0]);var e=a.settings.bundleUri;return e&&a.load(e),a}UserWidget.prototype.__expects=["onFound","onSelect"],UserWidget.defaults={extraParam:"",baseUrl:"",permission:"canRead"},UserWidget.prototype.init=function(t){o.pass(this,UserWidget,"init",t)},UserWidget.prototype.callAmbit=function(t){var e=this,a=this.settings.baseUrl+"/myaccount/users";"string"==typeof t&&(a+="?"+t,t=null),this.findBox.addClass("loading"),A.ambit.call(this,a,t,function(t){e.findBox.removeClass("loading"),e.onFound(k.map(t||[],function(t){return{value:t.id,label:t.name}}))})},UserWidget.prototype.doRequest=function(t){this.callAmbit("q="+t)},UserWidget.prototype.onSelect=UserWidget.prototype.onRemoved=UserWidget.prototype.updateUsers=function(){var e=this,t=k.map(el.val(),function(t){return e.settings.permission+"="+t});return this.settings.extraParam&&t.push(this.settings.extraParam),this.callAmbit({method:"POST",data:t.join("&")}),!0},MatrixKit.prototype.starHighlight=function(t,e){q("span",t).each(function(t){t<e?q(this).removeClass("transparent"):q(this).addClass("transparent")})},MatrixKit.prototype.onIdentifiers=function(t,e){var a,i,n,s=this;e&&(q(e).hasClass("initialized")||(q(e).addClass("initialized"),s.createForm=q("form",e)[0],s.createForm.onsubmit=function(t){t.preventDefault(),t.stopPropagation(),A.validateForm(s.createForm)&&A.ambit.call(s,s.settings.baseUrl+"/bundle",{method:"POST",data:q(s.createForm).serializeArray()},function(t,e){var a,i;t?(s.load(t),""!=(a=A.parseURL(window.location.href)).query?a.query+="&bundleUri="+t:a.query="?bundleUri="+t,i=a.protocol+"://"+a.host+(""!=a.port?":"+a.port:"")+a.path+a.query+(""!=a.hash?"#"+a.hash:""),"pushState"in window.history?window.history.pushState(null,"",i):document.location=i):console.log("Error on creating bundle ["+e.status+"]: "+e.statusText)})},s.createForm.assFinalize.onclick=function(t){var e;t.preventDefault(),t.stopPropagation(),s.bundleUri&&((e=q(this)).addClass("loading"),A.ambit.call(s,s.bundleUri,{method:"PUT",data:{status:"published"}},function(t){e.removeClass("loading"),t?q('.data-field[data-field="status"]').html(function formatStatus(t){return{draft:"Draft Version",published:"Final Assessment",archived:"Archived Version"}[t]}("published")):s.load(s.bundleUri)}))},s.createForm.assNewVersion.onclick=function(t){var e;t.preventDefault(),t.stopPropagation(),s.bundleUri&&((e=q(this)).addClass("loading"),A.ambit.call(s,s.bundleUri,{method:"PUT",data:{status:"archived"}},function(t){e.removeClass("loading"),t||s.load(s.bundleUri)}),A.ambit.call(s,s.bundleUri+"/version",{method:"POST"},function(t,e){t?s.load(t):console.log("Error on creating bundle ["+e.status+": "+e.statusText)}))},s.createForm.assFinalize.style.display="none",s.createForm.assNewVersion.style.display="none",(a=q(".data-stars-field",s.createForm)[0]).innerHTML+=A.ui.putStars(s,0,"Assessment rating"),q("span.ui-icon-star",a).on("mouseover",function(t){for(var e=this;e;e=e.previousElementSibling)q(e).removeClass("transparent");for(e=this.nextElementSibling;e;e=e.nextElementSibling)q(e).addClass("transparent")}).on("click",function(t){for(var e=0,a=this;a;a=a.previousElementSibling,++e);s.createForm.stars.value=e,q(s.createForm.stars).trigger("change")}).parent().on("mouseout",function(t){s.starHighlight(this,parseInt(s.createForm.stars.value))}),q("input, select, textarea",s.createForm).on("change",function(t){var e,a;t.preventDefault(),t.stopPropagation(),s.bundleUri&&(e=this,A.fireCallback(checkForm,e,t)&&((a={})[e.name]=e.value,q(e).addClass("loading"),A.ambit.call(s,s.bundleUri,{method:"PUT",data:a},function(t){q(e).removeClass("loading"),t||s.load(s.bundleUri)})))}),i=q("#source-link")[0],n=q("#source"),i.href=n[0].value,n.on("change",function(){i.href=this.value})))},MatrixKit.prototype.onMatrix=function(t,i){var v=this;if(!q(i).hasClass("initialized")){var n=q(".save-button",i)[0];n.disabled=!0;var c=function(){v.edit.study.length<1?(n.disabled=!0,q(n).removeClass("jt-alert").addClass("jt-disabled"),n.innerHTML="Saved"):(n.disabled=!1,q(n).addClass("jt-alert").removeClass("jt-disabled"),n.innerHTML="Save")};q(n).on("click",function(){var a;0<v.edit.study.length&&(a=JSON.stringify({study:v.edit.study}),q(n).addClass("loading"),A.ambit.call(v,v.bundleUri+"/matrix",{method:"PUT",headers:{"Content-Type":"application/json"},data:a},function(t,e){t?A.ambit.call(v,v.bundleUri+"/matrix/deleted",{method:"PUT",headers:{"Content-Type":"application/json"},data:a},function(t,e){q(n).removeClass("loading"),t&&(v.edit.study=[],v.matrixKit.query(v.bundleUri+"/matrix"),c())}):q(n).removeClass("loading")}))});var p=function(a){var t={overlay:!0,closeOnEsc:!0,closeOnClick:"overlay",addClass:"popup-box jtox-toolkit ui-front",animation:"zoomIn",target:q(this),maxWidth:600,zIndex:90,onCloseComplete:function(){this.destroy()}},e=q(this).hasClass("delete-popup"),i=e?q("a",this.parentNode):q(this),n=i.data("feature"),s=i.data("index"),o=v.matrixKit.dataset.feature[n];if(i.hasClass("edit-popup")){var r=A.ambit.parseFeatureId(n),l={endpoint:"effects[0].endpoint",value:"effects[0].result",interpretation_result:"interpretation.result",type:"reliability.r_studyResultType",reference:"citation.title",justification:"protocol.guideline[0]",remarks:"interpretation.criteria"},d={owner:{substance:{uuid:a.compound.i5uuid}},protocol:{topcategory:r.topcategory,category:{code:r.category},endpoint:o.title,guideline:[""]},citation:{year:(new Date).getFullYear().toString()},parameters:{},interpretation:{},reliability:{},effects:[{result:{},conditions:{}}]};t.content=A.ui.getTemplate("jtox-endeditor").innerHTML+w.innerHTML,t.title=o.title||r.category,t.closeButton="box",t.confirmButton="Add",t.cancelButton="Cancel";var u=function(t,e,a){var i=l[e];i?k.set(d,i,a):d.effects[0].conditions[e]=a};t.onOpen=function(){var t=this,e=this.content[0];jToxEndpoint.linkEditors(v.matrixKit,e,{category:r.category,top:r.topcategory,onchange:u,conditions:!0}),q("input[type=button]",e).on("click",function(){y(a,n,d,i[0]),t.close()})},new jBox("Modal",t).open()}else{q(".dynamic-condition",C).remove();for(var c=q("tr.conditions",C)[0],p=q("td.postconditions",C)[0],h=0,m=o.annotation.length;h<m;++h){var f=o.annotation[h],g=document.createElement("th");g.className="dynamic-condition",g.innerHTML=f.p,c.appendChild(g),(g=document.createElement("td")).className="dynamic-condition",g.innerHTML=f.o,p.parentNode.insertBefore(g,p)}m<1&&((g=document.createElement("td")).className="dynamic-condition",g.innerHTML="-",p.parentNode.insertBefore(g,p)),q("th.conditions",C).attr("colspan",m);var b=a.values[n];o.isMultiValue&&q.isArray(b)||(b=[b]),A.ui.updateTree(C,{endpoint:o.title,guidance:o.creator,value:A.ui.renderRange(b[s],o.units,"display")}),e?(q(".delete-box",C).show(),t.onOpen=function(){var t=this,e=this.content[0];b[s].deleted?(q("button.jt-alert",e).hide(),q("textarea",e).val(b[s].remarks)):q("button.jt-alert",e).on("click",function(){x(a,n,s,q("textarea",e).val(),i[0]),t.close()})}):q(".delete-box",C).hide(),t.content=C.innerHTML,new jBox("Tooltip",t).open()}},y=function(e,t,a,i){v.edit.study.push(a),c(),t+="/"+v.edit.study.length;var n=A.ambit.parseFeatureId(t).category,s=A.$.extend(!0,{},v.matrixKit.settings.configuration.columns._,v.matrixKit.settings.configuration.columns[n]),o=null;for(var r in v.matrixKit.dataset.feature[t]=o={},o.sameAs="http://www.opentox.org/echaEndpoints.owl#"+n,o.title=a.effects[0].endpoint||a.citation.title||"",o.creator=a.protocol.guideline[0],o.isMultiValue=!0,o.annotation=[],a.effects[0].conditions)o.annotation.push({p:r,o:A.ui.renderRange(a.effects[0].conditions[r])});var l=!(e.values[t]=[a.effects[0].result])!==k.get(s,"effects.endpoint.bVisible")?o.title:null,l=[o.creator,l].filter(function(t){return null!==t}).join(" "),d='<span class="ui-icon ui-icon-circle-minus delete-popup" data-index="'+(v.edit.study.length-1)+'"></span>&nbsp;<a class="info-popup unsaved-study" data-index="0" data-feature="'+t+'" href="#">'+A.ui.renderRange(a.effects[0].result,null,"display",l)+"</a>",u=document.createElement("div");u.innerHTML=d,i.parentNode.insertBefore(u,i),v.matrixKit.equalizeTables(),q(".info-popup",u).on("click",function(t){p.call(this,e)}),q(".delete-popup",u).on("click",function(t){var e=q(this).data("index");v.edit.study.splice(e,1),q(this.parentNode).remove(),c()})},x=function(t,e,a,i,n){v.edit.study.push({owner:{substance:{uuid:t.compound.i5uuid}},effects_to_delete:[{result:{idresult:t.values[e][a].idresult,deleted:!0,remarks:i}}]}),c(),q(n).addClass("unsaved-study"),q("span",n.parentNode).removeClass("ui-icon-circle-minus").addClass("ui-icon-circle-plus").data("index",v.edit.study.length-1).on("click.undodelete",function(){var t=q(this).data("index");q(this).addClass("ui-icon-circle-minus").removeClass("ui-icon-circle-plus").off("click.undodelete").data("index",null),q("a",this.parentNode).removeClass("unsaved-study"),v.edit.study.splice(t,1),c()})},C=q("#info-box")[0],w=q("#edit-box")[0],e=document.createDocumentFragment();for(var a in v.settings.studyTypeList){var s=document.createElement("option");s.value=a,s.innerHTML=v.settings.studyTypeList[a].title,e.appendChild(s)}q("select.type-list",w)[0].appendChild(e),v.matrixKit=v.prepareMatrixKit(q(".jtox-toolkit",i)[0]),v.matrixKit.settings.onRow=function(a,e,t){A.$("td.jtox-multi .jtox-diagram span.ui-icon",a).on("click",function(){setTimeout(function(){A.tables.equalizeHeights.apply(window,A.$("td.jtox-multi table tbody",a).toArray())},50)}),q(".info-popup, .edit-popup, .delete-popup",a).on("click",function(t){q(this).hasClass("delete-popup")&&null!=q(this).data("index")||p.call(this,e)});var i=this;q("button.jtox-up",a).on("click",function(){var t=q(i.fixTable).find("> tbody > tr").index(a),e=q(i.varTable).find("> tbody > tr")[t];q(a).insertBefore(q(a.previousElementSibling)),q(e).insertBefore(q(e.previousElementSibling))}),q("button.jtox-down",a).on("click",function(){var t=q(i.fixTable).find("> tbody > tr").index(a),e=q(i.varTable).find("> tbody > tr")[t];q(a).insertAfter(q(a.nextElementSibling)),q(e).insertAfter(q(e.nextElementSibling))})},q(".create-button",i).on("click",function(){var a=this;q(a).addClass("loading"),A.ambit.call(v,v.bundleUri+"/matrix/working",{method:"POST",data:{deletematrix:!1}},function(t,e){q(a).removeClass("loading"),t&&(q(".jtox-toolkit",i).show(),q(".save-button",i).show(),q(".create-button",i).hide(),q("#xfinal").button("enable"),v.bundleSummary.matrix++,v.edit.matrixEditable=!0,v.matrixKit.query(v.bundleUri+"/matrix/working"))})}),q(i).addClass("initialized")}q(".save-button",i).hide(),q(".create-button",i).hide();var o,r,l=null;"xinitial"==t?(q(".jtox-toolkit",i).show(),v.edit.matrixEditable=!1,l=v.bundleUri+"/dataset?mergeDatasets=true"):(o="xfinal"==t?"/matrix/final":"/matrix/working",r="xfinal"!=t,0<v.bundleSummary.matrix?(q(".jtox-toolkit",i).show(),l=v.bundleUri+o,(v.edit.matrixEditable=r)?q(".save-button",i).show():q(".save-button",i).hide()):(q(".jtox-toolkit",i).hide(),q(".create-button",i).show())),l&&v.matrixKit.query(l)},MatrixKit.prototype.onEndpoint=function(t,e){var n=this,a=q(".tab-"+t.substr(3),e)[0];a.parentNode.style.left=-a.offsetLeft+"px";var i,s,o=encodeURIComponent(n.bundleUri);"endsubstance"==t?(n.substancesQueryKit||(n.substancesQueryKit=n.prepareSubstanceKit(q("#jtox-substance-query")[0]),q("#structures-expand-all").on("click",function(){q("#jtox-substance-query .jtox-details-open.ui-icon-folder-collapsed").each(function(){this.click()})}),q("#structures-collapse-all").on("click",function(){q("#jtox-substance-query .jtox-details-open.ui-icon-folder-open").each(function(){this.click()})})),n.substancesQueryKit.kit().queryDataset(n.bundleUri+"/compound")):(i=q("input",a)[0],1==a.childElementCount&&(s=document.createElement("div"),a.appendChild(s),n.endpointKit=new jToxEndpoint(s,{selectionHandler:"onSelectEndpoint",onRow:function(t,e,a){var i;!e.bundles||(i=e.bundles[n.bundleUri])&&"selected"==i.tag&&q("input.jtox-handler",t).attr("checked","checked")}}),q(i).on("change",function(t){var e=n.settings.baseUrl+"/query/study?mergeDatasets=true&bundleUri="+o;this.checked||(e+="&selected=substances&filterbybundle="+o),n.endpointKit.loadEndpoints(e)})),q(i).trigger("change"))},MatrixKit.prototype.onStructures=function(t,e){var s=this;s.queryKit||(s.queryKit=A.kit(q("#jtox-query")[0]),s.queryKit.setWidget("bundle",s.rootElement),s.queryKit.kit().settings.fixedWidth="200px",s.queryKit.kit().settings.onRow=function(t,e,a){var i,n;e.bundles&&(i=e.bundles[s.bundleUri]||{},n=q("textarea.remark",t).on("change",function(t){var e=A.ui.rowData(this),a=this,i=e.bundles[s.bundleUri]||{};q(a).addClass("loading"),A.ambit.call(s,s.bundleUri+"/compound",{method:"PUT",data:{compound_uri:e.compound.URI,command:"add",tag:i.tag,remarks:q(a).val()}},function(t){q(a).removeClass("loading")})}),i.tag?(q("button.jt-toggle."+i.tag.toLowerCase(),t).addClass("active"),n.val(i.remarks)):n.prop("disabled",!0).val(" "))}),"structlist"==t?s.queryKit.kit().queryDataset(s.bundleUri+"/compound"):s.queryKit.query()},MatrixKit.prototype.onReport=function(t,e){var b=this;q(e).hasClass("initialized")||(A.ui.updateTree(e,b.bundle),q("#generate-doc").on("click",function(){(function getData(){return new Promise(function(t,e){var r=q.extend(!0,{},b.bundle);r.created=formatDate(b.bundle.created),r.updated=formatDate(b.bundle.updated),r.structures=[];var l=[],a=q("#jtox-report-query .jtox-ds-fixed tbody tr"),d=q("#jtox-report-query .jtox-ds-variable tbody tr");a.each(function(t){var e={index:t+1},a=q(this),i=q(d[t]);e.tag=a.find("td:first-child button.active").text();var n=a.find("img.jtox-smalldiagram")[0],s=function get(i){return new Promise(function(t,e){var a=new XMLHttpRequest;a.open("GET",i),a.responseType="arraybuffer",a.onload=function(){200==a.status?t(a.response):e(Error(a.statusText))},a.onerror=function(){e(Error("Network Error"))},a.send()})}(n.src).then(function(t){e.image={data:t.slice(0),size:[n.width,n.height]}});l.push(s);var o=i.find("td:not(.jtox-hidden)");e.casrn=q(o[0]).text(),e.ecnum=q(o[1]).text(),e.names=q(o[2]).text(),e.rationale=q(o[3]).find("textarea").val(),e.substances=[],r.structures.push(e)}),q("#jtox-report-substance-query .jtox-substance").each(function(t){var i=r.structures[t];q(this).find("tbody tr").each(function(t){var e=q(this).find("td"),a={};a.i=t+1,a.name=q(e[1]).text(),a.uuid=q(e[2]).text(),a.type=q(e[3]).text(),a.pubname=q(e[4]).text(),a.refuuid=q(e[5]).text(),a.owner=q(e[6]).text(),a.info=q(e[7]).text(),a.contained=q(e[8]).text(),i.substances.push(a)})}),r.matrix=[],q("#jtox-report-matrix .jtox-ds-fixed .dataTable > tbody > tr").each(function(){var t={},e=q(this).find("> td:not(.jtox-hidden)");t.cas=q(e[1]).text(),t.substancename=q(e[2]).text(),t.i5uuid=q(e[3]).text(),t.datasource=q(e[4]).text(),t.tag=q(e[5]).text(),t.constituentname=q(e[7]).text(),t.content=q(e[8]).text(),t.containedas=q(e[9]).text(),r.matrix.push(t)});var i=r.matrix.length,n=Math.ceil(i/3);r.dataMatrix=[];for(var s=q("#jtox-report-final thead tr"),o=q("#jtox-report-final tbody tr"),u=q(s[0]).find("th"),c=q(s[1]).find("th"),p=q(s[2]).find("th"),h=0;h<n;h++){for(var m={tag1:"",tag2:"",tag3:"",name1:"",name2:"",name3:"",cas1:"",cas2:"",cas3:"",data:[]},f=1,g=Math.min(3,u.length-3*h);f<=g;f++)m["tag"+f]=q(u[3*h+f]).text();for(f=1,g=Math.min(3,c.length-3*h);f<=g;f++)m["name"+f]=q(c[3*h+f]).text();for(f=1,g=Math.min(3,p.length-3*h);f<=g;f++)m["cas"+f]=q(p[3*h+f]).text();o.each(function(){var t=q(this).find("th, td"),e={title:"",value1:"",value2:"",value3:""},a="";e.title=q(t[0]).text();for(var i=1,n=Math.min(3,c.length-3*h);i<=n;i++){var s=[];t[3*h+i]!==undefined&&q(t[3*h+i].childNodes).each(function(){a=0<q(".ui-icon-calculator",this).length?'<w:r><w:rPr><w:color w:val="FF0000" /></w:rPr><w:t xml:space="preserve">':'<w:r><w:rPr><w:color w:val="0000FF" /></w:rPr><w:t xml:space="preserve">',s.push(a+k.escape(q(this).text())+"</w:t></w:r>")}),e["value"+i]='<w:p><w:pPr><w:pStyle w:val="Style16"/><w:rPr></w:rPr></w:pPr>'+s.join("<w:r><w:br /></w:r>")+"</w:p>"}m.data.push(e)}),r.dataMatrix.push(m)}return r.adstructures=[],q("#jtox-report-gap-filling section").each(function(){var t={name:q("h3",this).text(),features:[]};q(this).children("div").each(function(){var i={name:q("h4",this).html(),data:[]};q("div.popup-box",this).each(function(){var e={endpoint:q("td.the-endpoint",this).text(),value:q("td.the-value",this).text(),guidance:q("td.postconditions",this).text(),rationaleTitle:q("h5",this).text(),rationale:q("p.justification",this).text(),conditions:[]},t=q("th.dynamic-condition",this),a=q("td.dynamic-condition",this);t.each(function(t){e.conditions.push({condition:this.innerHTML,value:a[t].innerHTML})}),i.data.push(e)}),t.features.push(i)}),r.adstructures.push(t)}),r.ddstructures=[],q("#jtox-report-deleting-data section").each(function(){var t={name:q("h3",this).text(),features:[]};q(this).children("div").each(function(){var i={name:q("h4",this).html(),data:[]};q("div.popup-box",this).each(function(){var e={endpoint:q("td.the-endpoint",this).text(),value:q("td.the-value",this).text(),guidance:q("td.postconditions",this).text(),rationale:q("p.justification",this).text(),conditions:[]},t=q("th.dynamic-condition",this),a=q("td.dynamic-condition",this);t.each(function(t){e.conditions.push({condition:this.innerHTML,value:a[t].innerHTML})}),i.data.push(e)}),t.features.push(i)}),r.ddstructures.push(t)}),Promise.all(l).then(function(){t(r)},e)})})().then(function(s){JSZipUtils.getBinaryContent("../report/assessment-report.docx",function(t,e){if(t)throw t;var a=new Docxgen,i=new ImageModule({centered:!1});i.getSizeFromData=function(t){return[t.size[0]/2,t.size[1]/2]},i.getImageFromData=function(t){return t.data.slice(0)},a.attachModule(i),a.load(e),a.setData(s),a.render();var n=a.getZip().generate({type:"blob",compression:"DEFLATE"});saveAs(n,"report.docx")})},function(t){console.log("Error",t)})}),q(e).addClass("initialized")),b.reportQueryKit||(b.reportQueryKit=A.kit(q("#jtox-report-query")[0]),b.reportQueryKit.setWidget("bundle",b.rootElement),b.reportQueryKit.kit().settings.fixedWidth="200px",b.reportQueryKit.kit().settings.onRow=function(t,e,a){var i;e.bundles&&((i=e.bundles[b.bundleUri]||{}).tag&&q("button.jt-toggle."+i.tag.toLowerCase(),t).addClass("active"),i.remarks&&q("textarea.remark",t).val(i.remarks).prop("readonly",!0))}),b.reportQueryKit.kit().queryDataset(b.bundleUri+"/compound"),b.reportSubstancesQueryKit||(b.reportSubstancesQueryKit=b.prepareSubstanceKit(q("#jtox-report-substance-query")[0]),b.reportSubstancesQueryKit.kit().settings.onRow=function(t,e,a){var i;e.bundles&&(i=e.bundles[b.bundleUri]||{},q("textarea.remark",t).val(i.remarks).prop("readonly",!0),i.tag&&q("button.jt-toggle."+i.tag.toLowerCase(),t).addClass("active"))}),b.reportSubstancesQueryKit.kit().queryDataset(b.bundleUri+"/compound"),b.reportMatrixKit||(b.reportMatrixKit=b.prepareMatrixKit(q("#jtox-report-matrix .jtox-toolkit")[0]),b.reportMatrixKit.settings.showTabs=!1,b.reportMatrixKit.settings.showControls=!1,b.reportMatrixKit.settings.fixedWidth="100%",b.reportMatrixKit.settings.onComplete=function(){var i=this,t=q('<table class="dataTable"><thead></thead><tbody></tbody></table>'),e=t.find("thead"),n=t.find("tbody"),s=q("<tr><th>Substance name</th></tr>"),o=q("<tr><th>Tag</th></tr>"),r=q("<tr><th>CAS No.</th></tr>");q(i.fixTable).find("> tbody > tr").each(function(){var t=q("<th></th>").html(q(this).find("td")[2].innerHTML);r.append(t);var e=q("<th></th>").html(q(this).find("td")[3].innerHTML);s.append(e);var a=q("<th></th>").append(q(q(this).find("td")[6]).find("button.active").clone());o.append(a)}),e.append(o).append(s).append(r),q(i.varTable).find("thead th").each(function(t){var e,a;""!=this.innerHTML&&(e=q(this),a=q("<tr></tr>").append("<th>"+e.html()+"</th>"),q(i.varTable).find("tbody > tr").each(function(){a.append("<td>"+q(this).find("td:nth-child("+(t+1)+")").html()+"</td>")}),n.append(a))}),q("#jtox-report-final > div").html("").append(t),q(i.varTable).remove(),i.equalizeTables();for(var a=q("#jtox-report-substance"),l=q("#jtox-report-feature"),d=q("#info-box"),u=[],c=[],p=0,h=i.dataset.dataEntry.length;p<h;p++){var m=i.dataset.dataEntry[p];for(var f in m.values)if(q.isArray(m.values[f]))for(var g=i.dataset.feature[f],b=0,v=m.values[f].length;b<v;b++){var y=m.values[f][b];if(g.isModelPredictionFeature||y.deleted){for(var x in i.feature){var C,w=i.feature[x];w.sameAs==g.sameAs&&(C=w.URI)}g.isModelPredictionFeature&&(u[p]||(u[p]={}),u[p][C]||(u[p][C]=[]),u[p][C].push({feature:g,value:y})),y.deleted&&(c[p]||(c[p]={}),c[p][C]||(c[p][C]=[]),c[p][C].push({feature:g,value:y}))}}}for(var p=0,j=u.length;p<j;p++)if(u[p]){var T=a.clone().removeAttr("id"),m=i.dataset.dataEntry[p];for(x in A.ui.updateTree(T[0],{name:m.compound.name||m.compound.tradename,number:m.number}),u[p]){var k=u[p][x],S=l.clone().removeAttr("id");A.ui.updateTree(S[0],{title:i.dataset.feature[x].title});for(b=0,h=k.length;b<h;b++){var U=d.clone().removeAttr("id"),g=k[b].feature,y=k[b].value;q(".dynamic-condition",U).remove();for(var E=q("tr.conditions",U)[0],_=q("td.postconditions",U)[0],R=0,I=g.annotation.length;R<I;++R){var P=g.annotation[R];(D=document.createElement("th")).className="dynamic-condition",D.innerHTML=P.p,E.appendChild(D),(D=document.createElement("td")).className="dynamic-condition",D.innerHTML=P.o,_.parentNode.insertBefore(D,_)}I<1&&((D=document.createElement("td")).className="dynamic-condition",D.innerHTML="-",_.parentNode.insertBefore(D,_)),q("th.conditions",U).attr("colspan",I),A.ui.updateTree(U,{endpoint:g.title,guidance:"",value:A.ui.renderRange(y,g.units,"display"),remarks:g.creator,studyType:g.source.type}),S.append(U)}T.append(S)}q("#jtox-report-gap-filling").append(T)}for(p=0,j=c.length;p<j;p++)if(c[p]){T=a.clone().removeAttr("id"),m=i.dataset.dataEntry[p];for(x in A.ui.updateTree(T[0],{name:m.compound.name||m.compound.tradename,number:m.number}),c[p]){k=c[p][x],S=l.clone().removeAttr("id");A.ui.updateTree(S[0],{title:i.dataset.feature[x].title});for(b=0,h=k.length;b<h;b++){U=d.clone().removeAttr("id"),g=k[b].feature,y=k[b].value;q(".dynamic-condition",U).remove();for(E=q("tr.conditions",U)[0],_=q("td.postconditions",U)[0],R=0,I=g.annotation.length;R<I;++R){var D,P=g.annotation[R];(D=document.createElement("th")).className="dynamic-condition",D.innerHTML=P.p,E.appendChild(D),(D=document.createElement("td")).className="dynamic-condition",D.innerHTML=P.o,_.parentNode.insertBefore(D,_)}I<1&&((D=document.createElement("td")).className="dynamic-condition",D.innerHTML="-",_.parentNode.insertBefore(D,_)),q("th.conditions",U).attr("colspan",I),A.ui.updateTree(U,{endpoint:g.title,guidance:g.creator,value:A.ui.renderRange(y,g.units,"display"),remarks:y.remarks}),U.find("h5").remove(),S.append(U)}T.append(S)}q("#jtox-report-deleting-data").append(T)}},b.reportMatrixKit.settings.onRow=function(t,e,a){setTimeout(function(){A.tables.equalizeHeights.apply(window,A.$("td.jtox-multi table tbody",t).toArray())},50)});var a=b.bundleUri+"/matrix/final";a&&b.reportMatrixKit.query(a)},MatrixKit.prototype.prepareSubstanceKit=function(t){var o=this,e=A.kit(t);return e.setWidget("bundle",o.rootElement),e.kit().settings.fixedWidth="100%",e.kit().settings.bUri=o.bundleUri,e.kit().settings.configuration.baseFeatures["http://www.opentox.org/api/1.1#ChemicalName"].primary=!0,e.kit().settings.configuration.baseFeatures["http://www.opentox.org/api/1.1#CASRN"].primary=!0,e.kit().settings.configuration.baseFeatures["http://www.opentox.org/api/1.1#EINECS"].primary=!0,e.kit().settings.configuration.baseFeatures["http://www.opentox.org/api/1.1#Reasoning"].primary=!0,e.kit().settings.configuration.baseFeatures["#IdRow"]={used:!0,basic:!0,data:"number",column:{sClass:"center"},render:function(t,e,a){if("display"!=e)return t||0;var i="&nbsp;-&nbsp;"+t+"&nbsp;-&nbsp;<br/>";return i+='<span class="jtox-details-open ui-icon ui-icon-folder-collapsed" title="Press to open/close detailed info for this compound"></span>'}},e.kit().settings.configuration.baseFeatures["#Tag"]={title:"Tag",used:!1,basic:!0,visibility:"main",primary:!0,column:{sClass:"center"},render:function(t,e,a){if("display"!=e)return t||0;var i,n="",s=a.bundles[o.bundleUri];return s&&s.tag&&(i="cm"==s.tag?"CM":s.tag.substr(0,1).toUpperCase(),n+='<button class="jt-toggle active" disabled="true"'+(s.remarks?'title="'+s.remarks+'"':"")+">"+i+"</button><br />"),n}},e.kit().settings.configuration.groups.Identifiers.push("#Tag"),e},MatrixKit.prototype.prepareMatrixKit=function(t){var T=this;jTConfig.matrix.groups=function(a,j){var i={Identifiers:T.settings.matrixIdentifiers.concat(T.settings.matrixMultiRows)},t=[],e={};for(var n in a.feature){var s,o=a.feature[n];null==o.sameAs||o.sameAs.indexOf("echaEndpoints.owl#")<0||(s=A.ambit.parseFeatureId(n).topcategory,null==(r=i[s])&&(i[s]=r=[]),null==e[o.sameAs]&&(e[o.sameAs]=!0,o.title||(o.title=o.sameAs.substr(o.sameAs.indexOf("#")+1)),o.render=function(C,w){return function(t,e,a){if("display"!=e)return"-";var i="";for(var n in j.dataset.feature){var s=j.dataset.feature[n];if(s.sameAs==C.sameAs&&null!=a.values[n]){for(var o,r=A.ambit.parseFeatureId(n).category,l=A.$.extend(!0,{},j.settings.configuration.columns._,j.settings.configuration.columns[r]),d=a.values[n],u=!1!==k.get(l,"effects.endpoint.bVisible")?"<strong>"+s.title+"</strong>":null,c="<span class='ui-icon "+(s.isModelPredictionFeature?"ui-icon-calculator":"ui-icon-tag")+"' title='"+s.source.type+"'></span>",p=[],h=[],m=[],f=0,g=s.annotation.length;f<g;f++){var b,v=s.annotation[f];"conditions"==v.type&&1==k.get(l,'conditions["'+v.p.toLowerCase()+'"].inMatrix')?(b=k.get(l,'conditions["'+v.p.toLowerCase()+'"].sTitle')||v.p,m.push(b+" = "+v.o)):"parameters"==v.type&&h.push(v.o)}0<h.length&&p.push("<span>"+h.join(", ")+"</span>"),0<m.length&&p.push("<span>"+m.join(", ")+"</span>"),1==k.get(l,"protocol.guideline.inMatrix")&&s.creator!==undefined&&null!=s.creator&&""!=s.creator&&"null"!=s.creator&&"no data"!=s.creator&&p.push('<span class="shortened" title="'+s.creator+'">'+s.creator+"</span>"),o=0<p.length?"("+p.join(", ")+")":"",s.isMultiValue&&q.isArray(d)||(d=[d]);for(var f=0,y=d.length;f<y;++f){var x=d[f];x.deleted&&!T.edit.matrixEditable||(i+="<div>",T.edit.matrixEditable&&(x.deleted?i+='<span class="ui-icon ui-icon-info delete-popup"></span>&nbsp;':i+='<span class="ui-icon ui-icon-circle-minus delete-popup"></span>&nbsp;'),i+='<a class="info-popup'+(x.deleted?" deleted":"")+'" data-index="'+f+'" data-feature="'+n+'" href="#">'+A.ui.renderRange(x,s.units,"display",u)+"</a>"+c+" "+o,i+=A.ui.getTemplate("info-ball",{href:a.compound.URI+"/study?property_uri="+encodeURIComponent(n),title:n+" property detailed info"}),i+="</div>")}}}return T.edit.matrixEditable&&(i+='<span class="ui-icon ui-icon-circle-plus edit-popup" data-feature="'+w+'"></span>'),i}}(o,n),o.column={sClass:"breakable",sWidth:"80px"},r.push(n)))}for(var r in i){"Identifiers"!=r&&i[r].sort(function(t,e){return a.feature[t].title==a.feature[e].title?0:a.feature[t].title<a.feature[e].title?-1:1})}(t=Object.keys(i)).sort(function(t,e){return"Identifiers"==t?-1:"Identifiers"==e?1:(t=i[t][0],e=i[e][0],a.feature[t].title==a.feature[e].title?0:a.feature[t].title<a.feature[e].title?-1:1)});var l={};return t.forEach(function(t,e){l[t]=i[t]}),i=l};var e=q.extend(!0,{},jTConfig.matrix,config_study);e.baseFeatures["#IdRow"]={used:!0,basic:!0,data:"number",column:{sClass:"center"},render:function(t,e,a){if("display"!=e)return t||0;var i=a.bundles[T.bundleUri],n="target";i&&i.tag&&(n=i.tag);var s="&nbsp;-&nbsp;"+t+"&nbsp;-&nbsp;<br/>";return T.edit.matrixEditable?s+='<button class="jt-toggle jtox-handler target'+("target"==n?" active":"")+'" data-tag="target" data-uri="'+a.compound.URI+'" data-handler="onTagSubstance" title="Select the substance as Target">T</button><button class="jt-toggle jtox-handler source'+("source"==n?" active":"")+'" data-tag="source" data-uri="'+a.compound.URI+'" data-handler="onTagSubstance" title="Select the substance as Source">S</button><button class="jt-toggle jtox-handler cm'+("cm"==n?" active":"")+'" data-tag="cm" data-uri="'+a.compound.URI+'" data-handler="onTagSubstance" title="Select the substance as Category Member">CM</button>':s+='<button class="jt-toggle active" disabled="true">'+(n="cm"==n?"CM":n.substr(0,1).toUpperCase())+"</button>",s+='<div><button type="button" class="ui-button ui-button-icon-only jtox-up"><span class="ui-icon ui-icon-triangle-1-n">up</span></button><br /><button type="button" class="ui-button ui-button-icon-only jtox-down"><span class="ui-icon ui-icon-triangle-1-s">down</span></button><br /></div>'}},e.baseFeatures["#Tag"]={title:"Tag",used:!1,basic:!0,visibility:"main",primary:!0,column:{sClass:"center"},render:function(t,e,a){if("display"!=e)return t||0;var i,n="",s=a.component.bundles[T.bundleUri];return s&&(s.tag&&(i="cm"==s.tag?"CM":s.tag.substr(0,1).toUpperCase(),n+='<button class="jt-toggle active" disabled="true"'+(s.remarks?'title="'+s.remarks+'"':"")+">"+i+"</button><br />"),s.remarks&&""!=s.remarks&&(n+=A.ui.getTemplate("info-ball",{href:"$",title:s.remarks}))),n}};var r=!(e.baseFeatures["http://www.opentox.org/api/1.1#CASRN"].primary=!0);return matrixKit=new jToxCompound(t,{rememberChecks:!0,tabsFolded:!0,showDiagrams:!0,showUnits:!1,hasDetails:!1,fixedWidth:"650px",configuration:e,featureUri:T.bundleUri+"/property",onPrepared:function(t,e){if(!r){for(var a=0,i=T.settings.matrixMultiRows.length;a<i;++a){var n=T.settings.matrixMultiRows[a],s=t.feature[n];s.render=function(n,s,o){return function(t,e,a){return"object"!=typeof t?"-":A.ui.renderMulti(t,e,a,function(t,e,a){var i=k.get(t,(0<n.indexOf("#Diagram")?"component.":"")+s);return"function"==typeof o?o(i,e,0<n.indexOf("#Diagram")?t.component:t):i})}}(n,s.data,s.render),s.data="composition";var o=s.column;null==o?s.column=o={sClass:"jtox-multi"}:null==o.sClass?o.sClass="jtox-multi":o.sClass+=" jtox-multi"}r=!0}},onLoaded:function(t){jToxCompound.processFeatures(t.feature,this.feature);for(var e=0,a=t.dataEntry.length;e<a;++e){var i=t.dataEntry[e];if(null!=i.composition)for(var n=0;n<i.composition.length;++n)jToxCompound.processEntry(i.composition[n].component,t.feature)}}}),matrixKit},MatrixKit.prototype.load=function(t){var n=this;A.call(n,t,function(t){t&&(t=t.dataset[0],n.bundleUri=t.URI,n.bundle=t,n.createForm&&(A.ui.updateTree(n.createForm,t),q("#status-"+t.status).prop("checked",!0),n.starHighlight(q(".data-stars-field div",n.createForm)[0],t.stars),n.createForm.stars.value=t.stars,n.createForm.assFinalize.style.display="",n.createForm.assNewVersion.style.display="",n.createForm.assStart.style.display="none"),q(n.rootElement).tabs("enable",1),A.call(n,t.URI+"/summary",function(t){if(t)for(var e=0,a=t.facet.length;e<a;++e){var i=t.facet[e];n.bundleSummary[i.value]=i.count}n.progressTabs()}),n.loadUsers(),q("#open-report").prop("href",n.settings.baseUrl+"/ui/assessment_report?bundleUri="+encodeURIComponent(n.bundleUri)),q("#export-substance").prop("href",n.bundleUri+"/substance?media=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),q("#export-initial-matrix").prop("href",n.bundleUri+"/dataset?media=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),q("#export-working-matrix").prop("href",n.bundleUri+"/matrix?media=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),A.fireCallback(n.settings.onLoaded,n))})},MatrixKit.prototype.loadUsers=function(){var t=this,e=t.bundle;A.call(t,t.settings.baseUrl+"/myaccount/users?mode=W&bundleUri="+encodeURIComponent(e.URI),function(t){if(t){var e=q("#users-write");if(0==e.length)return;e.data("tokenize").clear();for(var a=0,i=t.length;a<i;++a){var n=t[a];e.data("tokenize").tokenAdd(n.id,n.name,!0)}}}),A.call(t,t.settings.baseUrl+"/myaccount/users?mode=R&bundleUri="+encodeURIComponent(e.URI),function(t){if(t){var e=q("#users-read");if(0==e.length)return;e.data("tokenize").clear();for(var a=0,i=t.length;a<i;++a){var n=t[a];e.data("tokenize").tokenAdd(n.id,n.name,!0)}}})},MatrixKit.prototype.progressTabs=function(){q(this.rootElement).tabs(0<this.bundleSummary.compound?"enable":"disable",2),q(this.rootElement).tabs(0<this.bundleSummary.substance&&0<this.bundleSummary.property?"enable":"disable",3),0<this.bundleSummary.matrix?(q("#xfinal").button("enable"),q(this.rootElement).tabs("enable",4)):q("#xfinal").button("disable")},MatrixKit.prototype.selectStructure=function(t,e,a){var i=this,n=!q(a).hasClass("active");q(a).addClass("loading");var s=q("textarea.remark",i.queryKit.kit().getVarRow(a))[0];A.ambit.call(i,i.bundleUri+"/compound",{method:"PUT",data:{compound_uri:t,command:n?"add":"delete",tag:e,remarks:q(s).val()}},function(t){q(a).removeClass("loading"),t&&(q(a).toggleClass("active"),n?(i.bundleSummary.compound++,q("button",a.parentNode).removeClass("active"),q(a).addClass("active")):i.bundleSummary.compound--,q(s).prop("disabled",!n).val(n?"":" "),i.progressTabs())})},MatrixKit.prototype.structuresLoaded=function(t,e){q(this.rootElement).hasClass("structlist")&&(this.bundleSummary.compound=e.dataEntry.length,this.progressTabs())},MatrixKit.prototype.selectSubstance=function(t,e){var a=this;q(e).addClass("loading"),A.ambit.call(a,a.bundleUri+"/substance",{method:"PUT",data:{substance_uri:t,command:e.checked?"add":"delete"}},function(t){q(e).removeClass("loading"),t?(e.checked?a.bundleSummary.substance++:a.bundleSummary.substance--,a.progressTabs()):e.checked=!e.checked})},MatrixKit.prototype.tagSubstance=function(t,e){q(e).hasClass("active")||(q(e).addClass("loading"),A.ambit.call(this,this.bundleUri+"/substance",{method:"PUT",data:{substance_uri:t,command:"add",tag:q(e).data("tag")}},function(t){q(e.parentNode).find("button.jt-toggle").removeClass("active"),q(e).removeClass("loading").addClass("active"),t||(e.checked=!e.checked)}))},MatrixKit.prototype.selectEndpoint=function(t,e,a){var i=this;q(a).addClass("loading"),A.ambit.call(i,i.bundleUri+"/property",{method:"PUT",data:{topcategory:t,endpointcategory:e,command:a.checked?"add":"delete"}},function(t){q(a).removeClass("loading"),t?(a.checked?i.bundleSummary.property++:i.bundleSummary.property--,i.progressTabs()):a.checked=!a.checked})},q(document).ready(function(){q("#logger").on("click",function(){q(this).toggleClass("hidden")})}),MatrixKit.defaults={createForm:null,rootElement:null,bundleUri:null,bundleSummary:{compound:0,substance:0,property:0,matrix:0},edit:{study:[]},settings:{studyTypeList:{},maxStars:10,matrixIdentifiers:["http://www.opentox.org/api/1.1#CASRN","#SubstanceName","#SubstanceUUID","http://www.opentox.org/api/1.1#SubstanceDataSource"],matrixMultiRows:["#Tag","http://www.opentox.org/api/1.1#Diagram","#ConstituentName","#ConstituentContent","#ConstituentContainedAs"]}},A.ui.Matrix=MatrixKit}(_,asSys,jQuery,jToxKit),function(o,p,h){function buildValueRange(t,e){var a=" = ";return a+=null==t.min?"-&#x221E;":t.min,t.avg&&(a+="&#x2026;"+t.avg),a+="&#x2026;"+(null==t.max?"&#x221E;":t.max),e&&(a+=" "+h.formatUnits(t.val).replace(/<sup>(2|3)<\/sup>/g,"&#x00B$1;").replace(/<sup>(\d)<\/sup>/g,"^$1")),a}function InnerTagWidgeting(t){this.id=t.id,this.pivotWidget=t.pivotWidget}var m=/\W/g;InnerTagWidgeting.prototype={pivotWidget:null,hasValue:function(t){return this.pivotWidget.hasValue(this.id+":"+t)},clickHandler:function(t){return this.pivotWidget.clickHandler(this.id+":"+t)},modifyTag:function(t){return t.hint=t.unit?"\n"+t.unit.buckets.map(function(t){return buildValueRange(t,!0)}).join("\n"):t.buildValueRange(t),t.color=this.color,t}};var f=o(h.TagWidget,InnerTagWidgeting);h.PivotWidgeting=function(t){o.extend(!0,this,o.common(t,this)),this.target=t.target,this.targets={},this.lastEnabled=0,this.initialPivotCounts=null},h.PivotWidgeting.prototype={__expects:["getFaceterEntry","getPivotEntry","getPivotCounts","auxHandler"],automatic:!1,renderTag:null,multivalue:!1,aggregate:!1,exclusion:!1,init:function(t){o.pass(this,h.PivotWidgeting,"init",t),this.manager=t,this.manager.getListener("current").registerWidget(this,!0)},addFaceter:function(t,e){var a=o.pass(this,h.PivotWidgeting,"addFaceter",t,e);return"object"==typeof t&&(a.color=t.color),e>this.lastEnabled&&!t.disabled&&(this.lastEnabled=e),a},afterTranslation:function(t){var e=this.getPivotCounts(t.facets);for(o.pass(this,h.PivotWidgeting,"afterTranslation",t),i=0;i<e.length;++i){var a=e[i],n=a.val.replace(m,"_"),s=this.targets[n];s?s.target.children("ul").hide():(this.targets[n]=s=new h.AccordionExpansion(p.extend(!0,{},this.settings,this.getFaceterEntry(0),{id:n,title:a.val})),s.updateHandler=this.updateHandler(s),s.target.children().last().remove()),this.traversePivot(s.target,a,1),s.updateHandler(a.count)}this.target.accordion("refresh")},updateHandler:function(t){var e=t.getHeaderText();return function(t){e.textContent=h.ui.updateCounter(e.textContent,t)}},prepareTag:function(t){var e=this.parseValue(t);return{title:e.value,color:this.faceters[e.id].color,count:"i",onMain:this.unclickHandler(t),onAux:this.auxHandler(t)}},traversePivot:function(t,e,a){var i=[],n=this.getPivotEntry(a),s=e[n.id].buckets;if(a===this.lastEnabled){var o=t.data("widget");o?t.children().slice(1).remove():((o=new f({id:n.id,color:n.color,renderItem:this.renderTag,pivotWidget:this,target:t,multivalue:this.multivalue,aggregate:this.aggregate,exclusion:this.exclusion})).init(this.manager),t.data({widget:o,id:n.id})),o.populate(s,!0),i=[]}else if(null!=s)for(var r=0,l=s.length;r<l;++r){var d,u=s[r],c=u.val.replace(m,"_");1<t.children().length?d=p("#"+c,t[0]).show():(d=h.ui.getTemplate("tag-facet",n).attr("id",c),u.title=u.val,u.onMain=this.clickHandler(n.id+":"+u.val),u.hint=buildValueRange(u),d.append(this.renderTag(u).addClass("category title").addClass(n.color)),i.push(d)),this.traversePivot(d,u,a+1)}t.append(i)}}}((Solr,asSys),jQuery,jToxKit),function(y,x,C){var s={auto:"/query/compound/search/all",uri:"/query/compound/url/all",similarity:"/query/similarity",smarts:"/query/smarts"};function QueryKit(t){this.settings=x.extend(!0,QueryKit.defaults,t),x(this.rootElement=t.target).addClass("jtox-toolkit").append(C.ui.getTemplate("kit-query-all",this.settings)),this.search={mol:"",type:"",queryType:"auto"};var a=x("form",this.rootElement)[0];if(a.onsubmit=function(){return!1},this.settings.hideOptions)for(var e=this.settings.hideOptions.split(","),i=0;i<e.length;++i)x("#search"+e[i],this.rootElement).remove(),x('label[for="search'+e[i]+'"]',this.rootElement).remove();this.settings.hideContext?x(a.searchcontext).hide():a.searchcontext&&(a.searchcontext.value=this.settings.contextUri,x(a.searchcontext).on("change",function(t){this.settings.contextUri=this.value}));var n=this;x(a.searchbox).on("change",function(){n.setAuto()}),this.settings.slideInput&&x(a.searchbox).on("focus",function(){var t=x(a).width()-x(o).width()-30-x(".search-pane").width(),e=x(this).data("oldSize")||x(this).width();x(this).data("oldSize",e),x(this).css("width",e+t+"px")}).on("blur",function(){x(this).css("width","")});var s=!1;0<x("#searchuri",this.rootElement).length&&(s=!0,x(a.searchbox).autocomplete({minLength:2,open:function(){x(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){x(this).removeClass("ui-corner-top").addClass("ui-corner-all")},source:function(t,e){C.ambit.call(this,"/dataset?search=^"+t.term,function(t){e(t?x.map(t.dataset,function(t){var e=t.URI.lastIndexOf("/");return{label:(0<=e?"D"+t.URI.substring(e+1)+": ":"")+t.title,value:t.URI}}):[])})}}));var o=x(".jq-buttonset",this.rootElement).buttonset(),r=function(){a.searchbox.placeholder=x(this).data("placeholder"),x(".search-pane .auto-hide",n.rootElement).addClass("hidden"),x(".search-pane ."+this.id,n.rootElement).removeClass("hidden"),n.search.queryType=this.value,"uri"==this.value?(x(a.drawbutton).addClass("hidden"),s&&x(a.searchbox).autocomplete("enable")):(x(a.drawbutton).removeClass("hidden"),s&&x(a.searchbox).autocomplete("disable"))};x(".jq-buttonset input",this.rootElement).on("change",r);var l=x("#search"+this.settings.option,this.rootElement)[0];if(null!=l?x(l).trigger("click"):C.fireCallback(r,x(".jq-buttonset input",this.rootElement)[0]),window[this.settings.smartsList]){for(var d=window[this.settings.smartsList],u=[],c={},i=0,p=d.length;i<p;++i){var h=d[i];c[h.family]===undefined&&(c[h.family]=u.length,u.push([])),u[c[h.family]].push(h)}var m=document.createDocumentFragment();for(fi=0,fl=u.length;fi<fl;++fi){var f=document.createElement("optgroup");for(f.label=u[fi][0].family,i=0,el=u[fi].length;i<el;++i){var g=u[fi][i],b=document.createElement("option");b.innerHTML=g.name,b.value=g.smarts,g.hint&&x(b).attr("data-hint",g.hint),f.appendChild(b)}m.appendChild(f)}a.smarts.appendChild(m),a.smarts.firstElementChild.checked=!0,x(a.smarts).on("change",function(){var t=x(this[this.selectedIndex]).data("hint");a.smarts.title=t||"",n.setAuto(this.value)})}this.initComposer(a);var v=!1;this.settings.b64search?(this.setMol(window.atob(this.settings.b64search)),v=!0):this.settings.search&&(this.setAuto(this.settings.search),v=!0),C.tables.installHandlers(this),v&&this.settings.initialQuery&&y.defer(function(t){t.query()},this)}QueryKit.prototype.initComposer=function(a){document.getElementById("mol-composer")||x(document.body).append(C.ui.getTemplate("kit-query-composer",this.settings));var i=this,n=function(){var t=document.getElementById("ketcher-mol-frame");return"contentDocument"in t?t.contentWindow.ketcher:document.frames.ifKetcher.window.ketcher};x("#mol-composer").on("shown.bs.modal",function(t){var e=i.search.mol||a.searchbox.value;e&&n().setMolecule(e)}),x("#mol-composer button.mol-apply").on("click",function(t){var e=n();i.setMol(e.getMolfile()),a.searchbox.value=e.getSmiles()})},QueryKit.prototype.getMainKit=function(){return this.mainKit||("string"==typeof this.settings.mainKit?this.mainKit=C.ui.kit(x(this.settings.mainKit)):this.mainKit=C.ui.kit(this.settings.mainKit)),this.mainKit},QueryKit.prototype.query=function(t){t&&this.setAuto(t);var e=y.trimEnd(C.formBaseUrl(this.settings.datasetUri||this.getMainKit().datasetUri),"/"),a=x("form",this.rootElement)[0],i={type:this.search.type},n=this.search.queryType;"auto"===n&&"auto"===i.type&&0==a.searchbox.value.indexOf("http")&&(n="uri"),e+=s[n]+"?",this.search.mol?i.b64search=window.btoa(this.search.mol):(i.search=a.searchbox.value,i.search||(i.search=this.settings.defaultNeedle),this.setAuto(i.search)),"auto"===n&&a.regexp.checked?i.condition="regexp":"smarts"===n?i.filterBySubstance=a.smartsbysubstance.checked:"similarity"===n&&(i.threshold=a.threshold.value,i.filterBySubstance=a.similaritybysubstance.checked),this.settings.contextUri&&(i.datasetUri=this.settings.contextUri),e=C.addParameter(e,x.param(i)),this.getMainKit().query(e)},QueryKit.prototype.getNeedle=function(){return"mol"==this.search.type?this.search.mol:x("form",this.rootElement)[0].searchbox.value},QueryKit.prototype.setAuto=function(t){this.search.mol=null,this.search.type="auto";var e=x("form",this.rootElement)[0].searchbox;this.search.oldplace&&(e.placeholder=this.search.oldplace),null!=t&&(e.value=t)},QueryKit.prototype.setMol=function(t){var e=x("form",this.rootElement)[0].searchbox;this.search.mol=t,this.search.type="mol",this.search.oldplace=e.placeholder,e.placeholder="MOL formula saved_",e.value=""},QueryKit.defaults={defaultNeedle:"50-00-0",smartsList:"funcgroups",hideOptions:"",hideContext:!1,slideInput:!1,contextUri:null,initialQuery:!1,configuration:{handlers:{query:function(t){this.query()}}}},C.ui.Query=QueryKit}(_,jQuery,jToxKit),function(p,r,u,c){function SimpleRanger(t){this.sliderRoot=t.sliderRoot}SimpleRanger.prototype.__expects=["addValue","doRequest"],SimpleRanger.prototype.targetValue=null,SimpleRanger.prototype.updateHandler=function(){var e=this;return function(t){e.addValue(t)&&(e.sliderRoot.updateRequest=!0,e.doRequest())}},SimpleRanger.prototype.doRequest=function(){this.manager.doRequest()},SingleRangeWidget=r(p.Ranging,p.Patterning,c.SliderWidget,SimpleRanger,p.Delaying);var n={facet:!0,rows:0,fl:"id","facet.limit":-1,"facet.mincount":1,echoParams:"none"};c.RangeWidgeting=function(t){r.extend(!0,this,r.common(t,this)),this.slidersTarget=u(t.slidersTarget),this.lookupMap=t.lookupMap||{},this.pivotMap=null,this.rangeWidgets=[],Array.isArray(this.titleSkips)||(this.titleSkips=[this.titleSkips])},c.RangeWidgeting.prototype={__expects:["getPivotEntry","getPivotCounts","parseValue"],field:null,titleSkips:null,init:function(t){r.pass(this,c.RangeWidgeting,"init",t),this.manager=t;var e=this;e.applyCommand=u("#sliders-controls a.command.apply").on("click",function(t){return e.skipClear=!0,e.manager.doRequest(),!1}),u("#sliders-controls a.command.close").on("click",function(t){return e.rangeRemove(),!1})},afterTranslation:function(t){var e=this.getPivotCounts(t.facets);if(r.pass(this,c.RangeWidgeting,"afterTranslation",t),this.pivotMap)if(this.updateRequest){if(0<this.rangeWidgets.length)for(var a=this.buildPivotMap(e),i=0;i<this.rangeWidgets.length;++i){var n=this.rangeWidgets[i],s=a[n.targetValue];n.updateSlider([s[i].min,s[i].max])}}else this.rangeRemove();else{var o=this.manager.getParameter("q").value||"";o&&"*:*"!=o||this.manager.getParameter(this.useJson?"json.filter":"fq").value||(this.pivotMap=this.buildPivotMap(e))}this.updateRequest=!1},getPivotFromId:function(t){for(var e=null,a=0;(e=this.getPivotEntry(a)).id!=t;++a);return e},buildPivotMap:function(t){for(var d=this,u={},c=function(t,e,a,i){var n,s,o=d.getPivotEntry(e);if(o.disabled||(i=o.id+":"+t.val),a+=(t.val?o.field+":"+p.escapeValue(t.val):"-"+o.field+":*")+" ",n=t,null!=(s=d.getPivotEntry(e+1))&&(t=t[s.id].buckets),null!=s&&t.length)for(var r=0,l=t.length;r<l;++r)c(t[r],e+1,a,i);else(u[i]=u[i]||[]).push({id:o.id,pattern:a,color:o.color,min:n.min,max:n.max,avg:n.avg,val:n.val,count:n.count})},e=0;e<t.length;++e)c(t[e],0,"");return u},rangeRemove:function(){this.slidersTarget.empty().parent().removeClass("active");for(var t=0,e=this.rangeWidgets.length;t<e;++t)this.rangeWidgets[t].clearValues();this.rangeWidgets=[],this.lastPivotValue=null},buildTitle:function(t,e){for(var a=t.pattern.replace(/\\"/g,"%0022").match(/\w+:([^\s:\/"]+|"[^"]+")/g),i=[],n=0;n<a.length;++n){var s=a[n].match(/(\w+):([^\s:\/"]+|"[^"]+")/),o=s[2].replace(/^\s*\(\s*|\s*\)\s*$/g,"");s[1].match(e)||i.push(this.lookupMap[o]||o)}return i.join("/")+" <i>("+t.count+")</i>"},ensurePivotMap:function(e){if(null!=this.pivotMap)return e(this.pivotMap);var a=this.useJson?"json.filter":"fq",i=this;return this.doSpying(function(t){t.removeParameters(a),t.removeParameters("fl"),t.getParameter("q").value="",t.mergeParameters(n)},function(t){e(i.pivotMap=i.buildPivotMap(i.getPivotCounts(t.facets)))}),!1},openRangers:function(t){var e=this.pivotMap[t],a=this.buildPivotMap(this.getPivotCounts())[t];this.lastPivotValue=t,this.slidersTarget.empty().parent().addClass("active");for(var i=0,n=a.length;i<n;++i){var s=a[i],o=e.find(function(t){return t.pattern===s.pattern})||s,r=c.ui.getTemplate("slider-one"),l={id:s.id,targetValue:t,color:o.color,field:this.field,limits:[o.min,o.max],initial:[s.min,s.max],target:r,isRange:!0,valuePattern:s.pattern+"{{v}}",automatic:!0,title:this.buildTitle(s,/^unit[_shd]*|^effectendpoint[_shd]*/),units:"unit"==s.id?c.formatUnits(s.val):"",useJson:this.useJson,domain:this.domain,sliderRoot:this};this.slidersTarget.append(r),l.width=parseInt(this.slidersTarget.width()-u("#sliders-controls").width()-20)/(Math.min(n,2)+.1);var d=new SingleRangeWidget(l);this.rangeWidgets.push(d),d.init(this.manager)}},auxHandler:function(a){var i=this;return(this.getPivotFromId(this.parseValue(a).id)||{}).ranging?function(t){t.stopPropagation();var e=i.lastPivotValue;return i.rangeRemove(),a!=e&&i.ensurePivotMap(function(){i.openRangers(a)}),!1}:undefined},clearValues:function(){this.rangeRemove(),r.pass(this,c.RangeWidgeting,"clearValues")}}}(Solr,asSys,jQuery,jToxKit),function(t,l,s,o){var r='<a href="{{href}}" title="{{hint}}" target="{{target}}" class="{{css}}">{{value}}</a>';o.ItemListWidget=function(t){t.baseUrl=o.fixBaseUrl(t.baseUrl),l.extend(!0,this,l.common(t,this)),this.lookupMap=t.lookupMap||{},this.target=t.target,this.id=t.id,this.imagesRoot.match(/(\/|\\)$/)||(this.imagesRoot+="/")},o.ItemListWidget.prototype={baseUrl:"",summaryPrimes:["RESULTS"],imagesRoot:"../img/",tagDbs:{},onCreated:null,onClick:null,summaryRenderers:{RESULTS:function(t,e){var a=this;return t.map(function(t){return t.split(".").map(function(t){return a.lookupMap[t]||t}).join(".")})},REFOWNERS:function(t,e){return{topic:"Study Providers",content:t.map(function(t){return o.formatString(r,{href:"#",hint:"Freetext search",target:"_self",value:t,css:"freetext_selector"})})}},REFS:function(t,e){return{topic:"References",content:t.map(function(t){var e=null!=(e=t.match(/^doi:(.+)$/))?"https://www.doi.org/"+e[1]:t;return o.formatString(e.match(/^https?:\/\//)?r:'<span title="{{hint}}" class="{{css}}">{{value}}</span>',{href:e,hint:"External reference",target:"ref",value:t})})}}},renderLinks:function(t){var e=this.getBaseUrl(t)+"substance/",a={};if(null==t.content)a.link=e+t.s_uuid,a.link_target=t.s_uuid,a.footer='<a href="'+e+t.s_uuid+'" title="Substance" target="'+t.s_uuid+'">Material</a><a href="'+e+t.s_uuid+'/structure" title="Composition" target="'+t.s_uuid+'">Composition</a><a href="'+e+t.s_uuid+'/study" title="Study" target="'+t.s_uuid+'">Studies</a>',a.composition=this.renderComposition(t,'<a href="'+e+t.s_uuid+'/structure" title="Composition" target="'+t.s_uuid+'">&hellip;</a>').join("<br/>");else{a.link_target="external",a.composition=this.renderComposition(t),a.link_title=this.tagDbs[t.dbtag_hss]&&this.tagDbs[t.dbtag_hss].title||"External database",a.footer="";for(var i=0;i<t.content.length;++i)t.content[i].match(/^https?:\/\//)&&(a.link||(a.link=t.content[i]),a.footer+='<a href="'+t.content[i]+'" target="external">'+a.link_title+"</a>&nbsp;")}return a},renderItem:function(e){var a=this,i=s(this.renderSubstance(e));return i.length&&(s(this.target).append(i),"function"==typeof this.onClick&&s("a.command",i[0]).on("click",function(t){a.onClick.call(i[0],t,e,a)}),"function"==typeof this.onCreated&&this.onCreated.call(i,e,this),s("a.more",i[0]).on("click",function(t){t.preventDefault(),t.stopPropagation();var e=s(this),a=s(".more-less",e.parent()[0]);return a.is(":visible")?(a.hide(),e.text("more")):(a.show(),e.text("less")),!1})),null},renderSubstance:function(t){var e=o.ui.templates["summary-item"],a=this.buildSummary(t),i=function(t){return t.map(function(t){return o.formatString(e,t)}).join("")},n={logo:this.tagDbs[t.dbtag_hss]&&this.tagDbs[t.dbtag_hss].icon||this.imagesRoot+"external.png",link_title:this.tagDbs[t.dbtag_hss]&&this.tagDbs[t.dbtag_hss].title||"Substance",link_target:"_blank",link:"#",title:(t.publicname||t.name)+(t.pubname===t.name?"":"  ("+t.name+")")+(null==t.substanceType?"":" "+(this.lookupMap[t.substanceType]||t.substanceType)),summary:0<a.length?i(a.splice(0,this.summaryPrimes.length)):"",item_id:(this.prefix||this.id||"item")+"_"+t.s_uuid};return 0<a.length&&(n.summary+='<a href="#" class="more">more</a><div class="more-less" style="display:none;">'+i(a)+"</div>"),o.ui.getTemplate("result-item",s.extend(n,this.renderLinks(t)))},getBaseUrl:function(t){return o.fixBaseUrl(this.tagDbs[t.dbtag_hss]&&this.tagDbs[t.dbtag_hss].server||this.settings&&this.settings.baseUrl||this.baseUrl)},renderComposition:function(t,n){var a,s=[],e=t._extended_&&t._extended_.composition;return e&&(a={},l.each(e,function(t){var e=a[t.component_s],i=[];e===undefined&&(a[t.component_s]=e=[]),l.each(t,function(t,e){var a=e.match(/^(\w+)_[shd]+$/);(e=a&&a[1]||e).match(/type|id|component/)||i.push(o.formatString(r,{href:"#",hint:"Freetext search on '"+e+"'",target:"_self",value:t,css:"freetext_selector"}))}),e.push(i.join(", "))}),l.each(a,function(t,e){for(var a="",i=0;i<t.length;++i)""!=t[i]&&(a+=0==i?": ":"; ",1<t.length&&(a+="<strong>["+(i+1)+"]</strong>&nbsp;"),a+=t[i]);""===a&&n&&(a=":&nbsp;"+n),s.push(e+" ("+t.length+")"+a)})),s},buildSummary:function(t){var o=this,r=[];return l.each(t,function(t,e){var a,i,n,s=e.match(/^SUMMARY\.([^_]+)_?[hsd]*$/);s&&(s=s[1],(i="function"==typeof(a=o.summaryRenderers[s]||o.summaryRenderers._)?a.call(o,t,s):t)&&("object"!=typeof i||Array.isArray(i)?i={topic:s.toLowerCase(),values:i}:null==i.topic&&(i.topic=s.toLowerCase()),i.content||(i.content=Array.isArray(i.values)?i.values.join(", "):i.values.toString()),-1<(n=o.summaryPrimes.indexOf(s))&&n<r.length?r.splice(n,0,i):r.push(i)))}),r}},o.ResultWidgeting=function(t){l.extend(!0,this,l.common(t,this))},o.ResultWidgeting.prototype={__expects:["populate"],init:function(t){l.pass(this,o.ResultWidgeting,"init",t),this.manager=t},beforeRequest:function(){s(this.target).html(s("<img>").attr("src",this.imagesRoot+"ajax-loader.gif"))},afterFailure:function(t,e){s(this.target).html("Error retrieving data!")},afterTranslation:function(t){s(this.target).empty(),this.populate(t.entries)}},o.ResultWidget=l(t.Listing,o.ListWidget,o.ItemListWidget,o.ResultWidgeting)}(Solr,asSys,jQuery,jToxKit),function(b,v){var l=function(t){this.rootElement=t.target,this.instanceNo=l.instanceCount++,b(this.rootElement).addClass("jtox-toolkit"),this.settings=b.extend(!0,{},l.defaults,t),this.settings.tab=this.settings.tab||v.ui.fullUrl.hash,this.settings.errorDefault&&(l.defaults.errorDefault=this.settings.errorDefault);var e=v.ui.putTemplate("all-studies"," ? ",this.rootElement),a=this;v.ui.changeTabsIds(e[0],"_"+this.instanceNo),this.tabs=e.tabs({select:function(t,e){a.loadPanel(e.panel)},beforeActivate:function(t,e){e.newPanel&&a.loadPanel(e.newPanel[0])}}),e.on("click","div.jtox-study-tab div button",function(t){var e=b(this).parents(".jtox-study-tab")[0];b(this).hasClass("expand-all")?b(".jtox-foldable",e).removeClass("folded"):b(this).hasClass("collapse-all")&&b(".jtox-foldable",e).addClass("folded")}),this.settings.substanceUri?this.querySubstance(this.settings.substanceUri):this.settings.substanceId&&this.querySubstance(this.settings.baseUrl+"substance/"+this.settings.substanceId)};l.prototype.loadPanel=function(e){var t,a=this;b(e).hasClass("unloaded")&&(t=a.addParameters(b(e).data("jtox-uri")),v.ambit.call(a,t,function(t){t&&(b(".jtox-study.folded",e).removeClass("folded"),b(e).removeClass("unloaded").addClass("loaded"),a.processStudies(e,t.study,!0),v.fireCallback(a.settings.onStudy,a,t.study))}))},l.prototype.createCategory=function(t,e){var a,i=b("."+e+".jtox-study",t);return i.length||(a=v.ui.putTemplate("one-study",{}).addClass(e),i=b(t).append(a)),i[0]},l.prototype.addParameters=function(t){for(var e=["property_uri","top","category"],a=0;a<e.length;++a){var i=e[a];this.settings[i]&&(t=v.addParameter(t,i+"="+this.settings[i]))}return t},l.prototype.ensureTable=function(t,e){var o,a,i,s=this,r=e.protocol.category.code,n=b("."+r+" .jtox-study-table",t)[0];return b(n).hasClass("dataTable")?b(n).DataTable().clear():(o=[],a=function(t,e){var a,i=0,n=[];for(var s in t){-1<n.indexOf(s)||(t[s+" unit"]!==undefined&&n.push(s+" unit"),null!=(a=e(s))&&(o.push(a),i++))}return i},(i=function(t,e,a){for(var i=0;i<e;++i){var n=b.extend({},l.defaultColumns[i+t]);null!=(n=v.tables.modifyColDef(s,n,r,a))&&o.push(n)}})(0,1,"main"),a(e.parameters,function(i){if(e.effects[0].conditions[i]!==undefined||e.effects[0].conditions[i+" unit"]!==undefined)return undefined;var t={title:i,className:"center middle",data:"parameters."+i,defaultContent:"-"};return null==(t=v.tables.modifyColDef(s,t,r,"parameters"))?null:(t.render=function(t,e,a){return v.ui.renderRange(t,a[i+" unit"],e)},t)}),a(e.effects[0].conditions,function(i){var t={title:i,className:"center middle jtox-multi",data:"effects"};return null==(t=v.tables.modifyColDef(s,t,r,"conditions"))?null:(t.render=function(t,e,a){return v.tables.renderMulti(t,e,a,function(t,e){return v.ui.renderRange(t.conditions[i],t.conditions[i+" unit"],e)},{anno:"effects "+i})},t)}),i(1,3,"effects"),a(e.interpretation,function(t){var e={title:t,className:"center middle jtox-multi",data:"interpretation."+t,defaultContent:"-"};return v.tables.modifyColDef(s,e,r,"interpretation")}),i(4,5,"protocol"),v.tables.sortColDefs(o),b(n).dataTable({paging:!0,processing:!0,lengthChange:!1,autoWidth:!1,dom:s.settings.dom,columns:o,infoCallback:function(t,e,a,i,n,s){var o=b(".title .counter",b(this).parents(".jtox-study"))[0];return o.innerHTML=v.ui.updateCounter(o.innerHTML,n),s},createdRow:function(t){v.tables.equalizeHeights.apply(window,b("td.jtox-multi table tbody",t).toArray())},language:s.settings.language}),b(n).DataTable().columns.adjust()),n},l.prototype.processSummary=function(t){var i=this,n={},s={"P-CHEM":"P-Chem",ENV_FATE:"Env Fate",ECOTOX:"Eco Tox",TOX:"Tox"};b(".jtox-study",i.rootElement).remove(),t.sort(function(t,e){var a=t.category.order||t.category.description||t.category.title,i=e.category.order||e.category.description||e.category.title;return null==a?-1:null==i?1:a==i?0:a<i?-1:1});var o=0,r=null;for(var e=0,a=t.length;e<a;++e){var l,d,u=t[e],c=u.topcategory.title;c&&(c=c.replace(/ /g,"_"),l=(l=b(".jtox-study-tab."+c,i.rootElement)[0])||function addStudyTab(t,e){var a=v.ui.addTab(i.tabs,s[t]||e.topcategory.title,"jtox-"+t.toLowerCase()+"_"+i.instanceNo,v.ui.getTemplate("one-category",i.substance));return a.tab.data("type",t),a.content.addClass(t).data("jtox-uri",e.topcategory.uri),o++,r=t,a.content[0]}(c,u),(d=u.category.title)?i.createCategory(l,d):n[c]=u.count)}1==o&&(i.settings.tab=r),b("ul li a",i.rootElement).each(function(t){var e,a,i=b(this).data("type");i&&(e=n[i],(a=b(this)[0]).innerHTML=v.ui.updateCounter(a.innerHTML,e))});for(var p=null,h=function(t){p&&clearTimeout(p);var i=t.currentTarget,n=b(this).parents(".jtox-study-tab")[0];p=setTimeout(function(){for(var t=b(".jtox-study-table",n),e=0,a=t.length;e<a;++e)b(t[e]).DataTable().search(i.value).draw()},300)},m=b(".jtox-study-tab"),f=0,g=m.length;f<g;f++)b(".jtox-study-filter",m[f])[0].onkeydown=h},l.prototype.processStudies=function(t,e,a){var i={},n=0;if(a)for(var s=0,o=e.length;s<o;++s){var r=e[s];a&&(i[r.protocol.category.code]===undefined?(i[r.protocol.category.code]=[r],n++):i[r.protocol.category.code].push(r))}else i[e[0].protocol.category.code]=e;for(var l in i){var d=i[l],u=b("."+l+".jtox-study",t);if(!(u.length<1)){v.ui.updateTree(u,{title:d[0].protocol.category.title+" (0)"});for(var e={},s=0,c=d.length;s<c&&(b.extend(!0,e,d[s]),b.isEmptyObject(e.parameters)||b.isEmptyObject(e.effects[0].conditions));++s);var p=this.ensureTable(t,e);b(p).DataTable().rows.add(d).draw(),b(p.tBodies[0]).children().each(function(){v.tables.equalizeHeights.apply(window,b("td.jtox-multi table tbody",this).toArray())}),1<n&&b(p).parents(".jtox-study").addClass("folded"),b(".jtox-multi",p[0]).each(function(){this.style.height=this.offsetHeight+"px"})}}},l.prototype.querySummary=function(t){var n=this;t=n.addParameters(t),v.ambit.call(n,t,function(t){if(t&&t.facet&&n.processSummary(t.facet),v.fireCallback(n.settings.onSummary,n,t.facet),n.settings.tab){var e=b(".jtox-study-tab."+decodeURIComponent(n.settings.tab).replace(/ /g,"_").toUpperCase(),n.root)[0];if(e){for(var a=0,i=e.parentNode.children.length;a<i&&e.parentNode.children[a].id!=e.id;++a);--a,b(n.tabs).tabs("option","active",a),b(n.tabs).tabs("option","selected",a)}}})},l.prototype.insertComposition=function(t){var e=b(".jtox-compo-tab",this.rootElement)[0];b(e).empty(),new v.ui.Composition(b.extend({},this.settings,{target:e,compositionUri:t}))},l.prototype.querySubstance=function(t){var a=this;this.settings.baseUrl=v.formBaseUrl(t),v.ambit.call(a,t,function(e){e&&e.substance&&0<e.substance.length?((e=e.substance[0]).showname=e.publicname||e.name,e.IUCFlags=v.ambit.formatExtIdentifiers(e.externalIdentifiers,"display",e),a.substance=e,v.ui.updateTree(b(".jtox-substance",a.rootElement),e),v.ambit.call(a,e.referenceSubstance.uri,function(t){t&&0<t.dataEntry.length&&(v.ambit.processDataset(t,null,v.ambit.getDatasetValue),v.ui.updateTree(b(".jtox-substance",a.rootElement),b.extend(e,t.dataEntry[0])))}),v.fireCallback(a.settings.onLoaded,a,e.substance),a.querySummary(e.URI+"/studysummary"),a.insertComposition(e.URI+"/composition")):v.fireCallback(a.settings.onLoaded,a,null)})},l.prototype.query=function(t){this.querySubstance(t)},l.getFormatted=function(t,e,a){return"function"==typeof a?a.call(this,t,e):"string"==typeof a||"number"==typeof a?t[a]:t[0]},l.defaults={tab:null,dom:"rt<Fip>",language:{processing:'<img src="/assets/img/waiting_small.gif" border="0">',loadingRecords:"No studies found.",zeroRecords:"No studies found.",emptyTable:"No studies available.",info:"Showing _TOTAL_ study(s) (_START_ to _END_)",lengthMenu:'Display <select><option value="10">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option><option value="-1">all</option></select> studies.'},errorDefault:"Err",onSummary:null,onComposition:null,onStudy:null,onLoaded:null,columns:{study:{_:{main:{},parameters:{},conditions:{},effects:{},protocol:{},interpretation:{}}}}},l.defaultColumns=[{title:"Name",className:"center middle",width:"15%",data:"protocol.endpoint"},{title:"Endpoint",className:"center middle jtox-multi",width:"10%",data:"effects",render:function(t,e,a){return v.tables.renderMulti(t,e,a,function(t,e){var a=l.getFormatted(t,e,"endpoint");return null!=t.endpointtype&&(a+=" ("+t.endpointtype+")"),a},{anno:"endpoint endpointtype"})}},{title:"Result",className:"center middle jtox-multi",width:"10%",data:"effects",render:function(t,e,a){return v.tables.renderMulti(t,e,a,function(t,e){var a=v.ui.renderRange(t.result,null,e);return null!=t.result.errorValue&&(a+=" ("+(t.result.errQualifier||l.defaults.errorDefault)+" "+t.result.errorValue+")"),a},{anno:"result result.errQualifier result.errValue"})}},{title:"Text",className:"center middle jtox-multi",width:"10%",data:"effects",render:function(t,e,a){return v.tables.renderMulti(t,e,a,function(t){return t.result.textValue||"-"},{anno:"result result.textValue"})}},{title:"Guideline",className:"center middle",width:"15%",data:"protocol.guideline",render:"[,]",defaultContent:"-"},{title:"Owner",className:"center middle",width:"10%",data:"citation.owner",defaultContent:"-"},{title:"Citation",className:"center middle",width:"10%",data:"citation",render:function(t){return(t.title||"")+" "+(!!t.year||"")}},{title:"Reliability",className:"center middle",width:"10%",data:"reliability",render:function(t){return t.r_value}},{title:"UUID",className:"center middle",width:"15%",data:"uuid",searchable:!1,render:function(t,e){return"display"!=e?""+t:v.ui.shortenedData(t,"Press to copy the UUID in the clipboard")}}],l.instanceCount=0,v.ui.Study=l}((asSys,jQuery),jToxKit),function(l,d){function SubstanceKit(t){var a;this.rootElement=t.target,l(this.rootElement).addClass("jtox-toolkit"),this.settings=l.extend(!0,{},SubstanceKit.defaults,t),this.pageStart=this.settings.pageStart,this.pageSize=this.settings.pageSize,this.settings.noInterface||((a=this).settings.embedComposition&&null==this.settings.onDetails&&(this.settings.onDetails=function(t,e){new d.ui.Composition(t,l.extend({},a.settings,"object"==typeof a.settings.embedComposition?a.settings.embedComposition:{},{compositionUri:e.URI+"/composition"}))}),d.ui.putTemplate("all-substance"," ? ",this.rootElement),this.init(t)),this.settings.substanceUri&&this.querySubstance(a.settings.substanceUri)}SubstanceKit.prototype.init=function(t){var r=this,e=r.settings.columns.substance.Id;e&&(d.tables.putActions(r,e),e.title=""),r.settings.columns.substance.Owner.render=function(t,e,a){return"display"!=e?t:'<a target="_blank" href="'+r.settings.baseUrl+"substanceowner/"+a.ownerUUID+'/substance">'+t+"</a>"};var a={dom:"rti"};r.settings.showControls?(d.tables.bindControls(r,{nextPage:function(){r.nextPage()},prevPage:function(){r.prevPage()},sizeChange:function(){r.queryEntries(r.pageStart,parseInt(l(this).val()))},filter:function(){l(r.table).DataTable().filter(l(this).val()).draw()}}),a.infoCallback=function(t,e,a,i,n,s){var o=l(".filterbox",r.rootElement).val();return l(".filtered-text",r.rootElement).html(o?' (filtered to <span class="high">'+n+"</span>) ":" "),""}):l(".jtox-controls",r.rootElement).remove(),r.table=d.tables.putTable(r,l("table",r.rootElement)[0],"substance",a)},SubstanceKit.prototype.queryEntries=function(n,s){n<0&&(n=0),(!s||s<0)&&(s=this.pageSize);var t=Math.floor(n/s),e=d.addParameter(o.substanceUri,"page="+t+"&pagesize="+s),o=this;d.ambit.call(o,e,function(t,e){if(t||200==e.status||(t={substabce:[]}),t){o.pageSize=s,o.pageStart=n;for(var a=0,i=t.substance.length;a<i;++a)t.substance[a].index=a+n+1;o.substance=t.substance,t.substance.length<o.pageSize&&(o.entriesCount=n+t.substance.length),d.fireCallback(o.settings.onLoaded,o,t),o.settings.noInterface||(l(o.table).DataTable().clear(),l(o.table).DataTable().add(t.substance).draw(),o.updateControls(n,t.substance.length))}else d.fireCallback(o.settings.onLoaded,o,t)})},SubstanceKit.prototype.querySubstance=function(t){this.substanceUri=d.ambit.grabPaging(this,t),this.settings.baseUrl=d.formBaseUrl(t),this.queryEntries(this.pageStart)},SubstanceKit.prototype.query=function(t){this.querySubstance(t)},SubstanceKit.prototype.nextPage=d.tables.nextPage,SubstanceKit.prototype.prevPage=d.tables.prevPage,SubstanceKit.prototype.updateControls=d.tables.updateControls,SubstanceKit.defaults={showControls:!0,selectionHandler:null,embedComposition:null,noInterface:!1,onDetails:null,onLoaded:null,language:{loadingRecords:"No substances found.",zeroRecords:"No substances found.",emptyTable:"No substances available.",info:"Showing _TOTAL_ substance(s) (_START_ to _END_)"},pageStart:0,pageSize:10,columns:{substance:{Id:{title:"Id",data:"URI",defaultContent:"-",width:"60px",render:function(t,e,a){return"display"!=e?a.index:"&nbsp;-&nbsp;"+a.index+"&nbsp;-&nbsp;"}},"Substance Name":{title:"Substance Name",data:"name",render:function(t,e,a){return null!=t&&"null"!=t||(t="-"),"display"!=e?t:d.ui.linkedData('<a target="_blank" href="'+a.URI+'/study">'+t+"</a>","Click to view study details",t)}},"Substance UUID":{title:"Substance UUID",data:"i5uuid",render:function(t,e,a){return null==t||"null"==t?"":"display"!=e?t:d.ui.shortenedData('<a target="_blank" href="'+a.URI+'/study">'+t+"</a>","Press to copy the UUID in the clipboard",t)}},"Substance Type":{title:"Substance Type",data:"substanceType",width:"15%",defaultContent:"-"},"Public name":{title:"Public name",data:"publicname",defaultContent:"-"},"Reference substance UUID":{title:"Reference substance UUID",data:"referenceSubstance",render:function(t,e,a){return null==t.i5uuid||"null"==t.i5uuid?"":"display"!=e?t.i5uuid:d.ui.shortenedData('<a target="_blank" href="'+t.uri+'">'+t.i5uuid+"</a>","Press to copy the UUID in the clipboard",t.i5uuid)}},Owner:{title:"Owner",data:"ownerName",defaultContent:"-"},Info:{title:"Info",data:"externalIdentifiers",render:function(t,e,a){return d.ambit.formatExtIdentifiers(t,e,a)}}}}},d.ui.Substance=SubstanceKit}((asSys,jQuery),jToxKit),jT.ui.templates["button-icon"]='<button title="{{ title }}"><i class="fa fa-{{ icon }} {{ className }}"></i></button>',jT.ui.templates["select-one-option"]='<option value="{{ value }}" {{ selected }}>{{ name }}</button>',jT.ui.templates["info-ball"]='<sup class="helper"><a target="_blank" href="{{ href }}" title="{{ title }}"><span class="fa fa-info-circle"></span></a></sup>',jT.ui.templates["all-composition"]='<div class="jtox-composition unloaded"><table class="dataTable composition-info font-small display"><thead><tr><th>Composition name:</th><td class="camelCase">{{ name }}</td></tr><tr><th>Composition UUID:</th><td>{{ uuid }}</td></tr><tr><th>Purity of IUC Substance:</th><td>{{ purity }}</td></tr></thead></table><table class="composition-table display"></table></div>',jT.ui.templates["all-compound"]='<div class="jtox-compound"><div class="jtox-ds-features"></div><div class="jtox-controls">Showing from<span class="jtox-live-data high">{{ pagestart }}</span> to <span class="jtox-live-data high">{{ pageend }}</span><span class="jtox-live-data">{{ filtered-text }}</span>in pages of <select class="jtox-live-data" value="{{ pagesize }}"><option value="10" selected="yes">10</option><option value="20">20</option><option value="30">30</option><option value="50">50</option><option value="100">100</option></select> entries<a class="paginate_disabled_previous prev-field" tabindex="0" role="button">Previous</a><a class="paginate_enabled_next next-field" tabindex="0" role="button">Next</a><input type="text" class="filterbox" placeholder="Filter..." /></div><div class="jtox-ds-tables"><div class="jt-processing"><span class="message">Loading compounds...</span></div><div class="jt-error"><span class="message"></span></div><div class="jtox-ds-fixed"><table></table></div><div class="jtox-ds-variable"><table></table></div></div></div>',jT.ui.templates["compound-one-tab"]='<div class="jtox-selection"><a href="#" class="multi-select select">select all</a>&nbsp;<a href="#" class="multi-select unselect">unselect all</a></div>',jT.ui.templates["compound-one-feature"]='<div class="jtox-ds-feature"><input type="checkbox" checked="yes"class="jtox-checkbox" /><span class="jtox-title">{{ title }}</span><sup class="helper"><a target="_blank"href="{{ uri }}"><i class="fa fa-info-circle"></i></a></sup></div>',jT.ui.templates["compound-download"]='<div class="jtox-inline jtox-ds-download"><a target="_blank" href="{{ link }}"><img class="borderless" title="{{ type }}" src="{{ icon }}" alt="{{ type }}"/></a></div>',jT.ui.templates["compound-export"]='<div id="{{ id }}"><div class="jtox-inline">Download dataset as: </div><div class="jtox-inline jtox-exportlist"></div></div>',jT.ui.templates["faceted-search-kit"]='<div class="query-container">\x3c!-- left --\x3e<div id="query" class="query-left"><div id="accordion-resizer" class="ui-widget-content"><div id="accordion"></div></div></div>\x3c!-- right --\x3e<div id="result-tabs" class="query-right"><ul><li><a href="#hits_tab">Hits list</a></li><li><a href="#basket_tab">Selection</a></li><li><a href="#queries_tab">Predefined Queries</a></li><li class="jtox-ds-export"><a href="#export_tab">Export</a></li></ul><div id="hits_tab"><div class="row remove-bottom"><ul class="tags remove-bottom" id="selection"></ul><footer><div id="sliders-controls"><a href="#" class="jtox-fadable command close">Close</a></div><div id="sliders"></div></footer></div><div id="navigation"><ul id="pager"></ul><div id="pager-header"></div></div><div class="docs_wrapper"><section id="docs" class="item-list"></section></div></div><div id="basket_tab"><section id="basket-docs" class="item-list"></section><div style="padding-top: 70px;"></div></div><div id="queries_tab"><section id="predefined-queries" class="item-list"></section><div style="padding-top: 70px;"></div></div><div id="export_tab"><form target="_blank" method="post"><input type="hidden" name="search" /><h6>Select dataset to export</h6><div id="export_dataset"><input type="radio" value="filtered" name="export_dataset" id="filtered_data"checked="checked" /><label for="filtered_data">Filtered entries</label><input type="radio" value="selected" name="export_dataset" id="selected_data" /><label for="selected_data">Selected entries</label></div><h6>Select export/report type</h6><select id="export_select" name="export_select"></select><h6>Select output format</h6><input type="hidden" name="export_format" id="export_format" /><div class="data_formats"></div><br /><button id="export_go" type="button" name="export_go" data-format="Download {{source}} as {{format}}">?</button><div class="ui-state-error ui-corner-all warning-message" style="padding: 0 .7em;"><p><span class="ui-icon ui-icon-alert"style="float: left; margin-right: .3em;"></span><strong>Warning: </strong>Please, either add entries to the selection or some filters to the query.</p></div></form></div></div>\x3c!-- query container --\x3e</div>',jT.ui.templates["result-item"]='<article id="{{item_id}}" class="item"><header>{{title}}</header><a href="{{link}}" title="{{link_title}}" class="avatar" target="{{link_target}}"><img src="{{logo}}" /></a><div class="composition">{{composition}}</div>{{summary}}<footer class="links">{{footer}}<a href="#" class="add jtox-fadable command">Add to Selection</a><a href="#" class="remove jtox-fadable command">Remove from Selection</a><a href="#" class="none jtox-fadable command">Already added</a></footer></article>',jT.ui.templates["summary-item"]='<div class="one-summary"><span class="topic">{{topic}}:</span><span class="value">{{content}}</span></div>',jT.ui.templates["tag-facet"]='<ul class="tags tag-group folded"></ul>',jT.ui.templates["query-item"]='<article id="{{id}}" class="item"><header>{{title}}</header><div class="composition">{{description}}<a href="#" title="Apply the query" style="width: 100%;"><span style="float:right;margin:0;">Apply</span></a></div></article>',jT.ui.templates["tab-topcategory"]='<h3 id="{{id}}_header" class="nested-tab">{{title}}</h3><div id="{{id}}" class="widget-content widget-root"><div><input type="text" placeholder="Filter_" class="widget-filter" /><input type="button" class="switcher" value="OR" /></div><ul class="widget-content tags remove-bottom" data-color="{{color}}"></ul></div>',jT.ui.templates["slider-one"]='<input type="hidden" />',jT.ui.templates["export-format"]='<div class="jtox-inline jtox-ds-download jtox-fadable"><a target="_blank" data-name="{{name}}" data-mime="{{mime}}" href="#"><img class="borderless" src="{{icon}}" /></a></div>',jT.ui.templates["logger-main"]='<div class="list-wrap"><div class="list-root"></div></div><div class="status"><div class="icon jtox-fadable"></div></div>',jT.ui.templates["logger-line"]='<div class="logline"><div class="icon"></div><span class="content info-field">{{header}}</span><div class="details info-field">{{details}}</div></div>',jT.ui.templates["all-matrix"]='<div class="jtox-toolkit jtox-matrix-kit"><ul><li><a href="#jtox-identifiers">Assessment identifier</a></li><li><a href="#jtox-structures">Collect structures</a></li><li><a href="#jtox-endpoints">Endpoint data used</a></li><li><a href="#jtox-matrix">Assessment details</a></li><li><a href="#jtox-report">Report</a></li></ul><div id="jtox-identifiers" data-action="onIdentifiers"><form><table class="dataTable"><thead><tr><th class="right size-third"><label for="title" id="l_title">Title</label>*<a href=\'#\'class=\'chelp a_name\'>?</a>:</th><td><input class="data-field first-time" data-field="title" name="title" id="title" required /></td></tr><tr><th class="right size-third"><label for="maintainer" id="l_maintainer">Maintainer</label>*<a href=\'#\'class=\'chelp a_maintainer\'>?</a>:</th><td><input class="data-field first-time" data-field="maintainer" name="maintainer" id="maintainer"required /></td></tr><tr><th class="right top size-third"><label for="description">Purpose</label>*<a href=\'#\'class=\'chelp a_description\'>?</a>:</th><td><textarea class="nomargin data-field" data-field="description" name="description" id="description"required></textarea></td></tr><tr><th class="right size-third">Version <a href=\'#\' class=\'chelp a_version\'>?</a>:</th><td class="data-field" data-field="version">?.?</td></tr><tr><th class="right size-third">Version start date <a href=\'#\' class=\'chelp a_version_date\'>?</a>:</th><td class="data-field" data-field="created" data-format="formatDate"></td></tr><tr><th class="right size-third">Version last modified on <a href=\'#\' class=\'chelp a_version_date\'>?</a>:</th><td class="data-field" data-field="updated" data-format="formatDate"></td></tr><tr><th class="right size-third">Status<a href=\'#\' class=\'chelp a_published\'>?</a>:</th><td class="data-field" data-field="status" data-format="formatStatus"></td></tr><tr class="lri_hide"><th class="right size-third"><label for="license">License</label>*:</th><td><input class="data-field first-time" data-field="rights.URI" name="license" id="license" /></td></tr><tr class="lri_hide"><th class="right size-third"><label for="rightsHolder">Rights holder</label>*<a href=\'#\'class=\'chelp a_rightsholder\'>?</a>:</th><td><input class="data-field first-time" data-field="rightsHolder" name="rightsHolder"id="rightsHolder" /></td></tr><tr><th class="right size-third"><label for="seeAlso" id="l_seeAlso">See also</label>*<a href=\'#\'class=\'chelp a_code\'>?</a>:</th><td><input class="data-field first-time" data-field="seeAlso" name="seeAlso" id="seeAlso" required /></td></tr><tr><th class="right size-third"><label for="source" id="l_source">Source URL</label>*<a href=\'#\'class=\'chelp a_doclink\'>?</a>:</th><td><input class="data-field first-time" data-field="source" name="source" id="source" required /><a href="" id="source-link" target="_blank" class="ui-icon ui-icon-extlink">open link</a></td></tr><tr><th class="right size-third"><label for="number" id="l_number">Identifier</label><a href=\'#\'class=\'chelp assessment\'>?</a>:</th><td class="data-field" data-field="number"></td></tr><tr class="lri_hide"><th class="right size-third">Rating <a href=\'#\' class=\'chelp a_rating\'>?</a>:</th><td class="data-stars-field"><input type="hidden" name="stars" value="0" /></td></tr><tr class="aadb"><th class="right size-third top"><label for="users-write">Users with write access</label><a href=\'#\'class=\'chelp bundle_rw\'>?</a>:</th><td class="jtox-user-rights"><input name="users-write" id="users-write" class="jtox-users-select" data-permission="canWrite"/><button type="button" class="jtox-users-submit">Save</button></td></tr><tr class="aadb"><th class="right size-third top"><label for="users-read">Users with read access</label><a href=\'#\'class=\'chelp bundle_rw\'>?</a>:</th><td class="jtox-user-rights"><input name="users-read" id="users-read" class="jtox-users-select" data-permission="canRead"/><button type="button" class="jtox-users-submit">Save</button></td></tr></thead></table><div class="actions"><button name="assStart" type="submit">Start</button><button name="assFinalize" type="button">Finalize Assessment</button><button name="assNewVersion" type="button">Generate new version</button></div></form></div><div id="jtox-structures"><div class="jq-buttonset center action" data-action="onStructures"><input type="radio" id="structcollect" name="structaction" checked="checked"><labelfor="structcollect">Collect structures</label></input><input type="radio" id="structlist" name="structaction"><label for="structlist">Listcollected</label></input></div><div id="jtox-query" class="jtox-toolkit" data-kit="query" data-configuration="jTConfigurator"data-initial-query="false"><div class="jtox-foldable folded"><div class="title"><p class="data-field" data-field="title">Search</p></div><div class="content"><div id="searchbar" class="jtox-toolkit jtox-widget" data-kit="search" data-hide-options="url,context"></div></div></div><div id="browser" class="jtox-toolkit" data-kit="compound" data-show-tabs="false" data-hide-empty="true"data-on-details="onDetailedRow" data-details-height="500px" data-show-diagrams="true"data-on-loaded="onBrowserFilled"></div></div></div><div id="jtox-endpoints"><div class="jq-buttonset center action" data-action="onEndpoint"><input type="radio" id="endsubstance" name="endaction" checked="checked"><label for="endsubstance">Searchsubstance(s)</label></input><input type="radio" id="endpoints" name="endaction"><label for="endpoints">Selection ofendpoints</label></input></div><div class="size-full"><div class="jtox-slidable"><div class="jtox-inline tab-substance"><div class="float-right"><button type="button" id="structures-expand-all">Expand all</button><button type="button"id="structures-collapse-all">Collapse all</button></div><div id="jtox-substance-query" class="jtox-toolkit" data-kit="query" data-configuration="jTConfigurator"data-initial-query="false"><div id="substance-browser" class="jtox-toolkit" data-kit="compound" data-show-tabs="false"data-hide-empty="true" data-pre-details="preDetailedRow" data-show-diagrams="true"></div></div></div><div class="jtox-inline tab-points"><div class="check-all"><label for="endpointAll"><input type="checkbox" name="endpointAll" id="endpointAll" /> Show allendpoints</label></div></div></div></div></div><div id="jtox-matrix"><div class="jq-buttonset center action" data-action="onMatrix"><input type="radio" id="xinitial" name="xaction" checked="checked"><label for="xinitial">Initialmatrix</label></input><input type="radio" id="xworking" name="xaction"><label for="xworking">Working matrix</label></input><input type="radio" id="xfinal" name="xaction"><label for="xfinal">Final matrix</label></input></div><button class="save-button jt-disabled">Saved</button><button class="create-button">Create working copy</button><div class="jtox-toolkit" data-kit="compound" data-manual-init="true"></div></div><div id="jtox-report" class="jtox-report"><p><a href="${ambit_root}/ui/assessment_report?bundleUri=${ambit_root}/bundle/${bundleid}"id="open-report">Create assessment report</a></p><p><a href="${ambit_root}/bundle/${bundleid}/substance?media=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"id="export-substance">Create Excel file with all used experimental data</a></p><p><a href="${ambit_root}/bundle/${bundleid}/dataset?media=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"id="export-initial-matrix">Create Excel file with the initial matrix</a></p><p><a href="${ambit_root}/bundle/${bundleid}/matrix?media=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"id="export-working-matrix">Create Excel file with the working matrix</a></p></div></div>',jT.ui.templates["info-box"]='<div class="info-box"><table><thead><tr><th rowspan="2">Endpoint</th><th rowspan="2">Value</th><th class="conditions center">Conditions</th><th rowspan="2">Guideline or Justification</th></tr><tr class="conditions"></tr></thead><tbody><tr><td class="jtox-live-data the-endpoint">{{ endpoint }}</td><td class="jtox-live-data the-value non-breakable">{{ value }}</td><td class="jtox-live-data postconditions">{{ guidance }}</td></tr></tbody></table><table class="delete-box"><tr><td><textarea placeholder="Reason for deleting_"></textarea></td><td><button class="jt-alert">Delete</button></td></tr></table></div>',jT.ui.templates["edit-box"]='<div class="edit-box"><div class="jtox-medium-box box-field" data-name="type"><div class="jtox-details font-heavy jtox-required">Study type</div><select class="data-field type-list" data-field="type"><option value="-1"> - Select type - </option></select></div><div class="jtox-medium-box box-field" data-name="reference"><div class="jtox-details font-heavy jtox-required">Reference</div><input type="text" class="data-field" data-field="reference" placeholder="Reference_" /></div><div class="jtox-medium-box box-field size-full" data-name="justification"><div class="jtox-details font-heavy jtox-required">Guideline or Justification</div><textarea class="data-field" data-field="justification" placeholder="Justification_"></textarea></div><div class="jtox-medium-box box-field size-full" data-name="remarks"><div class="jtox-details font-heavy">Remarks</div><textarea class="data-field" data-field="remarks" placeholder="Remarks_"></textarea></div><div class="size-full the-send"><span class="data-field the-endpoint" data-field="endpoint"></span><input value="Apply" type="button" /></div></div>',jT.ui.templates["kit-query-all"]='<div class="jtox-query"><form><div class="jq-buttonset jtox-inline"><input type="radio" id="searchauto" value="auto" name="searchtype" checked="checked" data-placeholder="Enter CAS, EINECS, Chemical name, SMILES or InChI_" /><label for="searchauto" title="Exact structure or search by an identifier. CAS, Chemical name, SMILES or InChI. The input type is guessed automatically.">Exact structure</label><input type="radio" id="searchsimilarity" value="similarity" name="searchtype" data-placeholder="Enter Chemical name, SMILES or InChI_" /><label for="searchsimilarity" title="Enter SMILES or draw structure">Similarity</label><input type="radio" id="searchsmarts" value="smarts" name="searchtype" data-placeholder="Enter SMARTS_" /><label for="searchsmarts" title="Enter or draw a SMARTS query">Substructure</label><input type="radio" id="searchuri" value="uri" name="searchtype" data-placeholder="Enter URL to be examined..." /><label for="searchuri" title="Enter dataset URL">URL</label></div><div class="float-right search-pane"><div class="dynamic auto-hide searchauto hidden jtox-inline"><input type="checkbox" name="regexp" id="toxquery-regexp" /><label for="toxquery-regexp">Enable fragment search<sup class="helper"><a target="_blank" href="http://en.wikipedia.org/wiki/Regular_expression"><i class="fa fa-info-circle"></i></a></sup></label></div><div class="dynamic auto-hide searchsimilarity hidden jtox-inline"><input type="checkbox" name="similaritybysubstance" value="true" id="similaritybysubstance" /><label for="similaritybysubstance">Only hits with substance data</label><select name=\'threshold\' title=\'Tanimoto similarity threshold\'><option value=\'0.9\' selected="selected">0.9</option><option value=\'0.8\'>0.8</option><option value=\'0.7\'>0.7</option><option value=\'0.6\'>0.6</option><option value=\'0.5\'>0.5</option><option value=\'0.4\'>0.4</option><option value=\'0.3\'>0.3</option><option value=\'0.2\'>0.2</option><option value=\'0.1\'>0.1</option></select></div><div class="dynamic auto-hide searchsmarts hidden jtox-inline"><input type="checkbox" name="smartsbysubstance" value="true" id="smartsbysubstance" /><label for="smartsbysubstance">Only hits with substance data</label><select name="smarts" title="Predefined functional groups"></select></div><div class="jtox-inline"><input type="text" name="searchbox" /><button name="searchbutton" class="jtox-handler" title="Search/refresh" data-handler="query"><i class="fa fa-search"></i></button><button name="drawbutton" class="dynamic" title="Draw the (sub)structure" data-toggle="modal" data-target="#mol-composer"><i class="fa fa-edit"></i></button></div></div><div id="searchcontext" class="size-full"><input type="text" name="searchcontext" placeholder="Restrict the search within given dataset_" /></div></form></div>',jT.ui.templates["kit-query-composer"]='<div class="modal fade" id="mol-composer" tabindex="-1" role="dialog" aria-labelledby="mol-composer" aria-hidden="true"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="mol-composer">Molecule Composer</h5><button type="button" class="close" data-dismiss="modal" aria-label="Discard"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><iframe id="ketcher-mol-frame" src="/assets/lib/ketcher/ketcher.html?api_path={{baseUrl}}" class="col-12" height="600" scrolling="no"></iframe></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">Discard</button><button type="button" class="btn btn-primary mol-apply" data-dismiss="modal">Apply &amp; Use</button></div></div></div></div>',jT.ui.templates["all-studies"]='<div><ul><li><a href="#jtox-substance">IUC Substance</a></li><li><a href="#jtox-compo-tab">Composition</a></li></ul><div id="jtox-substance" class="jtox-substance"><table class="dataTable display"><thead><tr><th class="right size-third">IUC Substance name:</th><td class="camelCase">{{ name }}</td></tr><tr><th class="right">IUC Substance UUID:</th><td>{{ i5uuid }}</td></tr><tr><th class="right">IUC Public name:</th><td class="camelCase">{{ publicname }}</td></tr><tr><th class="right">Legal entity:</th><td>{{ ownerName }}</td></tr><tr><th class="right">Legal entity UUID:</th><td>{{ ownerUUID }}</td></tr><tr><th class="right">Type substance composition:</th><td>{{ substanceType }}</td></tr><tr class="borderless-bottom"><th class="right">IUC Substance Reference Identifier</th><td></td></tr><tr class="borderless-top borderless-bottom"><td class="right">CAS:</td><td>{{ compound.cas }}</td></tr><tr class="borderless-top borderless-bottom"><td class="right">EC:</td><td>{{ compound.einecs }}</td></tr><tr class="borderless-top borderless-bottom"><td class="right">Chemical name:</td><td>{{ compound.name }}</td></tr><tr class="borderless-top borderless-bottom"><td class="right">IUPAC name:</td><td>{{ compound.iupac }}</td></tr><tr class="borderless-top borderless-bottom"><td class="right">UUID:</td><td>{{ referenceSubstance.i5uuid }}</td></tr><tr class="borderless-top"><td class="right">IUC Flags:</td><td>{{ IUCFlags }}</td></tr></thead></table></div><div id="jtox-compo-tab" class="jtox-compo-tab"></div></div>',jT.ui.templates["one-category"]='<div class="jtox-study-tab unloaded"><div class="float-right"><button class="expand-all">Expand all</button><button class="collapse-all">Collapse all</button></div><p><input type="text" class="jtox-study-filter ui-input" placeholder="Filter..." /></p><h4 class="camelCase">{{ showname }}</h4></div>',jT.ui.templates["one-study"]='<div class="jtox-study jtox-foldable folded"><div class="title"><p class="counter">{{ title }}</p></div><div class="content"><table class="jtox-study-table content display"></table></div></div>',jT.ui.templates["all-substance"]='<div class="jtox-substance"><div class="jtox-controls">Showing from<span class="high jtox-live-data">{{ pagestart }}</span> to <span class="high jtox-live-data">{{ pageend }}</span><span class="filtered-text"> </span>in pages of <select value="{{ pagesize }}"><option value="10" selected="yes">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option><option value="200">200</option><option value="500">500</option></select> substances<a class="paginate_disabled_previous prev-field" tabindex="0" role="button">Previous</a><a class="paginate_enabled_next next-field" tabindex="0" role="button">Next</a><input type="text" class="filterbox" placeholder="Filter..." /></div><div><table class="display"></table></div></div>';