var jToxKit={version:"2.2.3"};!function(i,d){i.ui={formatString:function(e,t,n){for(var o=e.split(/\{\{([^}]+)\}\}/),s=o.length,a="",r=0;a+=o[r++],!(s<=r);++r){var i=d.path(t,o[r]);a+=null!=i?i:"function"==typeof n?n(o[r]):"string"==typeof n?n:""}return a},formatNumber:function(e,t){return t<1&&(t=parseInt(1/t)),Math.round(e*t)/t},formatUnits:function(e){return e.toString().replace(/(^|\W)u(\w)/g,"$1&#x00B5;$2").replace(/\^\(?([\-\d]+)\)?/g,"<sup>$1</sup>").replace(/ /g,"&nbsp;")},addParameter:function(e,t){return e+(-1=="&?".indexOf(e.charAt(e.length-1))?0<e.indexOf("?")?"&":"?":"")+t},removeParameter:function(e,t){return e.replace(new RegExp("(.*?.*)("+t+"=[^&s$]*&?)(.*)"),"$1$3")},parseURL:function(e){var i=document.createElement("a");return{source:i.href=e,protocol:i.protocol.replace(":",""),host:i.hostname,port:i.port,query:i.search,params:function(){for(var e,t,n,o={},s=i.search.replace(/^\?/,"").split("&"),a=s.length,r=0;r<a;r++)s[r]&&(t=1<(e=s[r].split("=")).length?decodeURIComponent(e[1].replace(/\+/g," ")):"",e[0].indexOf("[]")==e[0].length-2?(n=o[e[0].slice(0,-2)])===undefined?o[e[0].slice(0,-2)]=[t]:n.push(t):o[e[0]]=t);return o}(),file:(i.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:i.hash.replace("#",""),path:i.pathname.replace(/^([^\/])/,"/$1"),relative:(i.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:i.pathname.replace(/^\//,"").split("/")}},modifyURL:function(e,t,n){var o,s,a=document.createElement("a"),r=n?t+"="+encodeURIComponent(n):"";if(a.href=e,o=(s=a.search).match(new RegExp(t+"=[\\S^&]+")))s=s.replace(o[0],r);else{if(!r)return;"?"==s.charAt(0)?s="?"+r:s+=("&"==s.slice(-1)?"":"&")+r}return a.search=s,a.href},escapeHTML:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}},i.Translation=function(e){d.extend(!0,this,e)},i.Translation.prototype={__expects:["translateResponse"],init:function(){d.pass(this,i.Translation,"init")},parseResponse:function(e,t){d.pass(this,i.Translation,"parseResponse");var n=this.translateResponse(e,t),o=this;d.each(this.listeners,function(e){d.act(e,e.afterTranslation,n,t,o)})}},i.RawSolrTranslation=function(e){d.extend(!0,this,d.common(e,this))},i.RawSolrTranslation.prototype={collapseRules:{study:{fields:/topcategory[_sh]*|endpointcategory[_sh]*|guidance[_sh]*|reference[_sh]*|reference_owner[_sh]*|reference_year[_sh]*|guidance[_sh]*/},composition:{fields:/CORE|COATING|CONSTITUENT|ADDITIVE|IMPURITY|FUNCTIONALISATION|DOPING/}},init:function(e){d.pass(this,i.RawSolrTranslation,"init")},translateResponse:function(e,t){function W(s,a){d.each(o.collapseRules,function(n,e){var o={};d.each(a,function(e,t){t.match(n.fields)&&(delete a[t],Array.isArray(e)&&1==e.length&&(e=e[0]),o[t]=e)}),s._extended_===undefined&&(s._extended_={}),s._extended_[e]===undefined?s._extended_[e]=[o]:s._extended_[e].push(o)}),d.each(a,function(e,t){Array.isArray(e)&&1==e.length&&(e=e[0]),s[t]=e})}for(var n=[],o=this,s=0,a=e.response.docs.length;s<a;++s){var r=e.response.docs[s],i=e.expanded[r.s_uuid],l={};W(l,r);for(var c=0,u=i.docs.length;c<u;++c)W(l,i.docs[c]);n.push(l)}return{entries:n,stats:d.extend({},e.stats,e.responseHeader),facets:d.extend({},e.facet_counts.facet_fields||e.facets,e.facet_counts.facet_pivot),paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},i.NestedSolrTranslation=function(e){this.nestingField=e&&e.nestingField||"type_s"},i.NestedSolrTranslation.prototype={init:function(e){d.pass(this,i.NestedSolrTranslation,"init")},translateResponse:function(e,t){for(var n=e.response.docs,o=0,s=n.length;o<s;++o){var a=n[o],r={};if(a._childDocuments_){for(var i=0,l=a._childDocuments_.length;i<l;++i){var c=a._childDocuments_[i],u=c[this.nestingField];r[u]===undefined&&(r[u]=[]),r[u].push(c)}delete a._childDocuments_,a._extended_=r}}return{entries:n,stats:d.extend({},e.stats,e.responseHeader),facets:e.facets,paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},i.ModelRunning=function(e){d.extend(!0,this,e),this.models=null},i.ModelRunning.prototype={__expects:["pollTask"],algorithms:!1,forceCreate:!1,loadOnInit:!1,listFilter:null,onLoaded:null,init:function(e){d.pass(this,i.ModelRunning,"init",e),this.manager=e,this.loadOnInit&&this.queryList()},listModels:function(){var n=this;n.manager.doRequest("model",function(e,t){e&&e.model?n.models=e.model:200==t.status&&(e={model:[]}),d.act(n,n.onLoaded,e)})},listAlgorithms:function(e){var n=this,t="algorithm";e&&(t+="?search="+e),n.manager.doRequest(t,function(e,t){e&&e.algorithm?n.algorithm=e.algorithm:200==t.status&&(e={algorithm:[]}),d.act(n,n.onLoaded,e,t)})},getModel:function(n,o){function La(e,t){return o(e&&-1<e.completed?e.result:null,t)}var s=this;s.forceCreate?s.pollTask({url:n,method:"POST"},La):s.manager.doRequest("model?algorithm="+encodeURIComponent(n),function(e,t){e||404==t.status?e&&0!=e.model.length?o(e.model[0].URI,t):s.pollTask({url:n,method:"POST"},La):o(null,t)})},runPrediction:function(t,n,a){function Wa(e){s?a(null,e):o.pollTask({url:n,method:"POST",data:{dataset_uri:t}},function(e,t){s=!0,e&&-1<e.completed&&r(e.result)})}var o=this,s=!1,r=null;r=function(e){o.manager.connector.ajax({url:e,method:"GET",dataType:"json",error:function(e){a(null,e)},success:function(e,t){if(e&&e.dataEntry&&0<e.dataEntry.length){for(var n=!0,o=0,s=e.dataEntry.length;o<s;++o)if(0<d.weight(e.dataEntry[o].values)){n=!1;break}n?Wa(t):a(e,t)}else Wa(t)}})},o.forceCreate?Wa():r(i.ui.addParameter(t,"feature_uris[]="+encodeURIComponent(n+"/predicted")))},queryList:function(e){this.algorithms?this.listAlgorithms(this.listFilter=e||this.listFilter):this.listModels(this.modelUri)}},i.TaskPolling=function(e){d.extend(!0,this,e),this.models=null},i.TaskPolling.prototype={pollDelay:250,pollTimeout:15e3,init:function(e){d.pass(this,i.TaskPolling,"init",e),this.manager=e},pollTask:function(e,n){var t,o,s=this,a=null;o=function(e){"string"==typeof e&&(e={url:e,method:"GET"}),e.error=function(e){n(null,e)},e.success=t,e.dataType="json",s.manager.connector.ajax(e)},t=function(e,t){null==e||null==e.task||e.task.length<1?n(e,t):-1<(e=e.task[0]).completed||e.error?n(e,t):null==a?(a=Date.now(),setTimeout(function(){o(e.result)},s.pollDelay)):Date.now()-a>s.poolTimeout?n(e,t):setTimeout(function(){o(e.result)},s.pollDelay)},o(e)}},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=jToxKit:(this.jToxKit=this.jT=d.extend({},this.jToxKit,jToxKit),"function"==typeof define&&define.amd&&define(jToxKit))}(jToxKit,asSys);