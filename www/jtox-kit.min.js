var jToxKit={version:"2.2.3"};!function(l,p){l.ui={formatString:function(e,t,n){for(var o=e.split(/\{\{([^}]+)\}\}/),s=o.length,r="",a=0;r+=o[a++],!(s<=a);++a){var i=p.path(t,o[a]);r+=null!=i?i:"function"==typeof n?n(o[a]):"string"==typeof n?n:""}return r},formatNumber:function(e,t){return t<1&&(t=parseInt(1/t)),Math.round(e*t)/t},formatUnits:function(e){return e.toString().replace(/(^|\W)u(\w)/g,"$1&#x00B5;$2").replace(/\^\(?([\-\d]+)\)?/g,"<sup>$1</sup>").replace(/ /g,"&nbsp;")},addParameter:function(e,t){return e+(-1=="&?".indexOf(e.charAt(e.length-1))?0<e.indexOf("?")?"&":"?":"")+t},removeParameter:function(e,t){return e.replace(new RegExp("(.*?.*)("+t+"=[^&s$]*&?)(.*)"),"$1$3")},parseURL:function(e){var i=document.createElement("a");return{source:i.href=e,protocol:i.protocol.replace(":",""),host:i.hostname,port:i.port,query:i.search,params:function(){for(var e,t,n,o={},s=i.search.replace(/^\?/,"").split("&"),r=s.length,a=0;a<r;a++)s[a]&&(t=1<(e=s[a].split("=")).length?decodeURIComponent(e[1].replace(/\+/g," ")):"",e[0].indexOf("[]")==e[0].length-2?(n=o[e[0].slice(0,-2)])===undefined?o[e[0].slice(0,-2)]=[t]:n.push(t):o[e[0]]=t);return o}(),file:(i.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:i.hash.replace("#",""),path:i.pathname.replace(/^([^\/])/,"/$1"),relative:(i.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:i.pathname.replace(/^\//,"").split("/")}},modifyURL:function(e,t,n){var o,s,r=document.createElement("a"),a=n?t+"="+encodeURIComponent(n):"";if(r.href=e,o=(s=r.search).match(new RegExp(t+"=[\\S^&]+")))s=s.replace(o[0],a);else{if(!a)return;"?"==s.charAt(0)?s="?"+a:s+=("&"==s.slice(-1)?"":"&")+a}return r.search=s,r.href},escapeHTML:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}},l.Translation=function(e){p.extend(!0,this,e)},l.Translation.prototype={__expects:["translateResponse"],init:function(){p.pass(this,l.Translation,"init")},parseResponse:function(e,t){p.pass(this,l.Translation,"parseResponse");var n=this.translateResponse(e,t),o=this;p.each(this.listeners,function(e){p.act(e,e.afterTranslation,n,t,o)})}},l.RawSolrTranslation=function(e){p.extend(!0,this,p.common(e,this))},l.RawSolrTranslation.prototype={collapseRules:{study:{fields:/topcategory[_sh]*|endpointcategory[_sh]*|guidance[_sh]*|reference[_sh]*|reference_owner[_sh]*|reference_year[_sh]*|guidance[_sh]*/},composition:{fields:/CORE|COATING|CONSTITUENT|ADDITIVE|IMPURITY|FUNCTIONALISATION|DOPING/}},init:function(e){p.pass(this,l.RawSolrTranslation,"init")},translateResponse:function(e,t){for(var n=[],o=this,s=function(s,r){p.each(o.collapseRules,function(n,e){var o={};p.each(r,function(e,t){t.match(n.fields)&&(delete r[t],Array.isArray(e)&&1==e.length&&(e=e[0]),o[t]=e)}),s._extended_===undefined&&(s._extended_={}),s._extended_[e]===undefined?s._extended_[e]=[o]:s._extended_[e].push(o)}),p.each(r,function(e,t){Array.isArray(e)&&1==e.length&&(e=e[0]),s[t]=e})},r=0,a=e.response.docs.length;r<a;++r){var i=e.response.docs[r],l=e.expanded[i.s_uuid],c={};s(c,i);for(var u=0,d=l.docs.length;u<d;++u)s(c,l.docs[u]);n.push(c)}return{entries:n,stats:p.extend({},e.stats,e.responseHeader),facets:p.extend({},e.facet_counts.facet_fields||e.facets,e.facet_counts.facet_pivot),paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},l.NestedSolrTranslation=function(e){this.nestingField=e&&e.nestingField||"type_s"},l.NestedSolrTranslation.prototype={init:function(e){p.pass(this,l.NestedSolrTranslation,"init")},translateResponse:function(e,t){for(var n=e.response.docs,o=0,s=n.length;o<s;++o){var r=n[o],a={};if(r._childDocuments_){for(var i=0,l=r._childDocuments_.length;i<l;++i){var c=r._childDocuments_[i],u=c[this.nestingField];a[u]===undefined&&(a[u]=[]),a[u].push(c)}delete r._childDocuments_,r._extended_=a}}return{entries:n,stats:p.extend({},e.stats,e.responseHeader),facets:e.facets,paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},l.ModelRunning=function(e){p.extend(!0,this,e),this.models=null},l.ModelRunning.prototype={__expects:["pollTask"],algorithms:!1,forceCreate:!1,loadOnInit:!1,listFilter:null,onLoaded:null,init:function(e){p.pass(this,l.ModelRunning,"init",e),this.manager=e,this.loadOnInit&&this.queryList()},listModels:function(){var n=this;n.manager.doRequest("model",function(e,t){e&&e.model?n.models=e.model:200==t.status&&(e={model:[]}),p.act(n,n.onLoaded,e)})},listAlgorithms:function(e){var n=this,t="algorithm";e&&(t+="?search="+e),n.manager.doRequest(t,function(e,t){e&&e.algorithm?n.algorithm=e.algorithm:200==t.status&&(e={algorithm:[]}),p.act(n,n.onLoaded,e,t)})},getModel:function(n,o){var s=this,r=function(e,t){return o(e&&-1<e.completed?e.result:null,t)};s.forceCreate?s.pollTask({url:n,method:"POST"},r):s.manager.doRequest("model?algorithm="+encodeURIComponent(n),function(e,t){e||404==t.status?e&&0!=e.model.length?o(e.model[0].URI,t):s.pollTask({url:n,method:"POST"},r):o(null,t)})},runPrediction:function(t,n,r){var o=this,s=!1,a=null,i=function(e){s?r(null,e):o.pollTask({url:n,method:"POST",data:{dataset_uri:t}},function(e,t){s=!0,e&&-1<e.completed&&a(e.result)})};a=function(e){o.manager.connector.ajax({url:e,method:"GET",dataType:"json",error:function(e){r(null,e)},success:function(e,t){if(e&&e.dataEntry&&0<e.dataEntry.length){for(var n=!0,o=0,s=e.dataEntry.length;o<s;++o)if(0<p.weight(e.dataEntry[o].values)){n=!1;break}n?i(t):r(e,t)}else i(t)}})},o.forceCreate?i():a(l.ui.addParameter(t,"feature_uris[]="+encodeURIComponent(n+"/predicted")))},queryList:function(e){this.algorithms?this.listAlgorithms(this.listFilter=e||this.listFilter):this.listModels(this.modelUri)}},l.TaskPolling=function(e){p.extend(!0,this,e),this.models=null},l.TaskPolling.prototype={pollDelay:250,pollTimeout:15e3,init:function(e){p.pass(this,l.TaskPolling,"init",e),this.manager=e},pollTask:function(e,n){var t,o,s=this,r=null;o=function(e){"string"==typeof e&&(e={url:e,method:"GET"}),e.error=function(e){n(null,e)},e.success=t,e.dataType="json",s.manager.connector.ajax(e)},t=function(e,t){null==e||null==e.task||e.task.length<1?n(e,t):-1<(e=e.task[0]).completed||e.error?n(e,t):null==r?(r=Date.now(),setTimeout(function(){o(e.result)},s.pollDelay)):Date.now()-r>s.poolTimeout?n(e,t):setTimeout(function(){o(e.result)},s.pollDelay)},o(e)}},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=jToxKit:(this.jToxKit=this.jT=p.extend({},this.jToxKit,jToxKit),"function"==typeof define&&define.amd&&define(jToxKit))}(jToxKit,asSys);