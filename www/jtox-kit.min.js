var jToxKit={version:"2.4.2"};!function(c,p,o){function Exporting(e){p.extend(!0,this,p.common(e,this)),this.manager=null}(c=p.extend(c,{templateRegExp:/\{\{\s*([^}|]+)(|[^}\s]+)?\s*\}\}/,formatString:function(e,t,n){for(var r=e.split(c.templateRegExp),i=r.length,o="",a="object"!=typeof n?n:n&&n[""],s=0;o+=r[s++],!(i<=s);++s){var l=_.get(t,_.trim(r[s++]),null),u=n&&r[s]&&n[r[s].substr(1)];"function"==typeof u&&(l=u(l)),o+=null!=l?l:"function"==typeof a?a(r[s]):"string"==typeof a?a:""}return o},nicifyNumber:function(e,t){if(null==e)return"";var n=Math.pow(10,t||2);return(Math.round(e*n)/n).toFixed(t)},formatUnits:function(e){return e?e.toString().replace(/(^|\W)u(\w)/g,"$1&#x00B5;$2").replace(/\^\(?([\-\d]+)\)?/g,"<sup>$1</sup>").replace(/ /g,"&nbsp;"):""},valueAndUnits:function(e,t,n){var r="";return null!=e&&(r+=(e="string"==typeof e?_.trim(e):c.nicifyNumber(e,n).toString()).replace(/ /g,"&nbsp;"),r+=c.formatUnits(t)),r},simplifyValues:function(e,t){var n=function(e){return"object"==typeof e?_.map(e,n):e.toString()};return _.flatMapDeep(e,n).join(t||",")},addParameter:function(e,t){return e+(-1=="&?".indexOf(e.charAt(e.length-1))?0<e.indexOf("?")?"&":"?":"")+t},removeParameter:function(e,t){return e.replace(new RegExp("(.*?.*)("+t+"=[^&s$]*&?)(.*)"),"$1$3")},addHistory:function(e,t){"pushState"in window.history?window.history.pushState(null,t||"",e):document.location=e},parseURL:function(e){var s=document.createElement("a");return{source:s.href=e,protocol:s.protocol.replace(":",""),host:s.hostname,port:s.port,query:s.search,params:function(){for(var e,t,n,r={},i=s.search.replace(/^\?/,"").split("&"),o=i.length,a=0;a<o;a++)i[a]&&(t=1<(e=i[a].split("=")).length?decodeURIComponent(e[1].replace(/\+/g," ")):"",e[0].indexOf("[]")==e[0].length-2?(n=r[e[0].slice(0,-2)])===undefined?r[e[0].slice(0,-2)]=[t]:n.push(t):r[e[0]]=t);return r}(),file:(s.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:s.hash.replace("#",""),path:s.pathname.replace(/^([^\/])/,"/$1"),relative:(s.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:s.pathname.replace(/^\//,"").split("/")}},modifyURL:function(e,t,n){var r,i,o=document.createElement("a"),a=n?t+"="+encodeURIComponent(n):"";if(o.href=e,r=(i=o.search).match(new RegExp(t+"=[\\S^&]+")))i=i.replace(r[0],a);else{if(!a)return;"?"==i.charAt(0)?i="?"+a:i+=("&"==i.slice(-1)?"":"&")+a}return o.search=i,o.href},fixBaseUrl:function(e){return e&&"/"!=e.charAt(e.length-1)&&(e+="/"),e},formBaseUrl:function(e){var t=(t=e.match(/^((http[s]?|ftp):\/)?\/?([^:\/\s]+)(:\d+)?(\/\w+)/))&&t[0]+"/";return console.log("Deduced base URL: "+t+" (from: "+e+")"),t},copyToClipboard:function(e,t){t=t||"Press Ctrl-C (Command-C) to copy and then Enter.",window.prompt(t,e)},fireCallback:function(e,t){$.isArray(e)||(e=[e]);for(var n=!0,r=0,i=e.length;r<i;++r){var o=e[r];"function"!=typeof o&&(o=window[o]),n="function"==typeof o?o.apply(t!==undefined&&null!=t?t:document,Array.prototype.slice.call(arguments,2)):undefined}return n},validateForm:function(e,t){t=t||function(){if("checkValidity"in this)return this.checkValidity();var e=0<this.value.length;return e||(this.placeholder="You need to fill this box"),e};var n=!0;return $("input,textarea,select",e).each(function(){n=n&&!!t.call(this)}),n},activateDownload:function(e,t,n,r){t instanceof Blob||(t=new Blob([t]));var i=URL.createObjectURL(t),o=!1;e?e.style.visibility="visible":(e=document.createElement("a"),o=r=!0),e.href=i,e.download=n,!0===r&&e.addEventListener("click",function(){setTimeout(function(){e.parentElement&&e.parentElement.removeChild(e),window.URL.revokeObjectURL(i)},0)}),o&&e.click()},promiseXHR:function(r){var i=function(t,n){n&&Object.keys(n).forEach(function(e){t[e]=n[e]})};return new Promise(function(e,t){var n=new XMLHttpRequest;n.open(r.method||"GET",r.url,!0),Object.keys(r.headers||{}).forEach(function(e){n.setRequestHeader(e,r.headers[e])}),"string"==typeof r.dataType&&n.setRequestHeader("Content-Type",r.dataType),i(n,r.settings),i(n,r.xhrFields),n.onreadystatechange=function(){4===n.readyState&&(0==n.status&&n.response||200<=n.status&&n.status<300?e(n.response,n.statusText,n):t(n,n.statusText,n.responseText))},n.send(r.body||r.data)})},blobFromBase64:function(e,t){return new Blob([e],{type:t})}})).Translation=function(e){p.extend(!0,this,e)},c.Translation.prototype={__expects:["translateResponse"],init:function(){p.pass(this,c.Translation,"init")},parseResponse:function(e,t){p.pass(this,c.Translation,"parseResponse");var n=this.translateResponse(e,t),r=this;p.each(this.listeners,function(e){p.act(e,e.afterTranslation,n,t,r)})}},c.RawSolrTranslation=function(e){p.extend(!0,this,p.common(e,this))},c.RawSolrTranslation.prototype={collapseRules:{study:{fields:/topcategory[_sh]*|endpointcategory[_sh]*|guidance[_sh]*|reference[_sh]*|reference_owner[_sh]*|reference_year[_sh]*|guidance[_sh]*/},composition:{fields:/CORE|COATING|CONSTITUENT|ADDITIVE|IMPURITY|FUNCTIONALISATION|DOPING/}},init:function(e){p.pass(this,c.RawSolrTranslation,"init")},translateResponse:function(e,t){for(var n=[],r=this,i=function(i,o){p.each(r.collapseRules,function(n,e){var r={};p.each(o,function(e,t){t.match(n.fields)&&(delete o[t],Array.isArray(e)&&1==e.length&&(e=e[0]),r[t]=e)}),i._extended_===undefined&&(i._extended_={}),i._extended_[e]===undefined?i._extended_[e]=[r]:i._extended_[e].push(r)}),p.each(o,function(e,t){Array.isArray(e)&&1==e.length&&(e=e[0]),i[t]=e})},o=0,a=e.response.docs.length;o<a;++o){var s=e.response.docs[o],l=e.expanded[s.s_uuid],u={};i(u,s);for(var c=0,d=l.docs.length;c<d;++c)i(u,l.docs[c]);n.push(u)}return{entries:n,stats:p.extend({},e.stats,e.responseHeader),facets:p.extend({},e.facet_counts.facet_fields||e.facets,e.facet_counts.facet_pivot),paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},c.NestedSolrTranslation=function(e){this.nestingField=e&&e.nestingField||"type_s"},c.NestedSolrTranslation.prototype={init:function(e){p.pass(this,c.NestedSolrTranslation,"init")},translateResponse:function(e,t){for(var n=e.response.docs,r=0,i=n.length;r<i;++r){var o=n[r],a={};if(o._childDocuments_){for(var s=0,l=o._childDocuments_.length;s<l;++s){var u=o._childDocuments_[s],c=u[this.nestingField];a[c]===undefined&&(a[c]=[]),a[c].push(u)}delete o._childDocuments_,o._extended_=a}}return{entries:n,stats:p.extend({},e.stats,e.responseHeader),facets:e.facets,paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},c.ModelRunning=function(e){p.extend(!0,this,e),this.models=null},c.ModelRunning.prototype={__expects:["pollTask"],algorithms:!1,forceCreate:!1,loadOnInit:!1,listFilter:null,onLoaded:null,init:function(e){p.pass(this,c.ModelRunning,"init",e),this.manager=e,this.loadOnInit&&this.queryList()},listModels:function(){var n=this;n.manager.doRequest("model",function(e,t){e&&e.model?n.models=e.model:200==t.status&&(e={model:[]}),p.act(n,n.onLoaded,e)})},listAlgorithms:function(e){var n=this,t="algorithm";e&&(t+="?search="+e),n.manager.doRequest(t,function(e,t){e&&e.algorithm?n.algorithm=e.algorithm:200==t.status&&(e={algorithm:[]}),p.act(n,n.onLoaded,e,t)})},getModel:function(n,r){var i=this,o=function(e,t){return r(e&&-1<e.completed?e.result:null,t)};i.forceCreate?i.pollTask({url:n,method:"POST"},o):i.manager.doRequest("model?algorithm="+encodeURIComponent(n),function(e,t){e||404==t.status?e&&0!=e.model.length?r(e.model[0].URI,t):i.pollTask({url:n,method:"POST"},o):r(null,t)})},runPrediction:function(t,n,o){var r=this,i=!1,a=null,s=function(e){i?o(null,e):r.pollTask({url:n,method:"POST",data:{dataset_uri:t}},function(e,t){i=!0,e&&-1<e.completed&&a(e.result)})},a=function(e){r.manager.connector.ajax({url:e,method:"GET",dataType:"json",error:function(e){o(null,e)},success:function(e,t){if(e&&e.dataEntry&&0<e.dataEntry.length){for(var n=!0,r=0,i=e.dataEntry.length;r<i;++r)if(0<p.weight(e.dataEntry[r].values)){n=!1;break}n?s(t):o(e,t)}else s(t)}})};r.forceCreate?s():a(c.addParameter(t,"feature_uris[]="+encodeURIComponent(n+"/predicted")))},queryList:function(e){this.algorithms?this.listAlgorithms(this.listFilter=e||this.listFilter):this.listModels(this.modelUri)}},c.TaskPolling=function(e){p.extend(!0,this,e),this.models=null},c.TaskPolling.prototype={pollDelay:250,pollTimeout:15e3,init:function(e){p.pass(this,c.TaskPolling,"init",e),this.manager=e},pollTask:function(e,n){var r=this,i=null,o=function(e){"string"==typeof e&&(e={url:e,method:"GET"}),e.error=function(e){n(null,e)},e.success=t,e.dataType="json",r.manager.connector.ajax(e)},t=function(e,t){null==e||null==e.task||e.task.length<1||-1<(e=e.task[0]).completed||e.error?n(e,t):null==i?(i=Date.now(),setTimeout(function(){o(e.result)},r.pollDelay)):Date.now()-i>r.poolTimeout?n(e,t):setTimeout(function(){o(e.result)},r.pollDelay)};o(e)}},Exporting.prototype={__expects:["addParameter","prepareQuery"],useJson:!1,expectJson:!1,servlet:null,manualFilter:!1,exportDefinition:{extraParams:[],defaultFilter:null,inheritDomain:!0,domain:"",fieldsRegExp:null,idField:"id"},init:function(e){p.pass(this,Exporting,"init",e),this.manager=e,this.servlet=this.servlet||e.servlet||"select",this.fqName=this.useJson?"json.filter":"fq"},transformParameter:function(e,t){var n={value:e.value,name:t||e.name};return this.exportDefinition.inheritDomain&&e.domain&&"parent"==e.domain.type&&(this.exportDefinition.domain?e.value&&!e.value.match(this.exportDefinition.fieldsRegExp)||(n.domain=this.exportDefinition.domain):n.domain=e.domain),n},prepareFilters:function(){for(var e=[],t=this.manager.getParameter(this.expectJson?"json.filter":"fq"),n=0,r=t.length;n<r;n++){var i=t[n];this.manualFilter||this.addParameter(this.transformParameter(i,this.fqName)),e.push(o.stringifyValue(i))}return e},prepareExport:function(e,t,n){var r=!t||n?this.prepareFilters():[],i=0<r.length?r.join(" AND "):this.exportDefinition.defaultFilter||"",o=i.replace(/"|\\/g,"\\$&");t&&this.addParameter(this.fqName,this.exportDefinition.idField+":("+t.join(" ")+")"),this.addParameter(this.transformParameter(this.manager.getParameter("q")));for(var a=0,s=(e=(e||[]).concat(this.exportDefinition.extraParams||[])).length;a<s;++a){var l=this.transformParameter(e[a]);"string"==typeof l.value&&(l.value=l.value.replace("{{filter}}",i).replace("{{filter-escaped}}",o).replace(/\(\s*\)\s+OR\s+/,"")),this.addParameter(l)}return this},getAjax:function(e,t){var n=e+this.servlet,r=p.extend({},this.manager.ajaxSettings,t,this.prepareQuery());return 0<n.indexOf("?")&&r.url&&r.url.startsWith("?")&&(r.url="&"+r.url.substr(1)),r.url=n+(r.url||""),r}},c.Exporting=Exporting,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=jToxKit:(this.jToxKit=this.jT=p.extend({},this.jToxKit,jToxKit),"function"==typeof define&&define.amd&&define(jToxKit))}(jToxKit,asSys,Solr);