var jToxKit={version:"2.2.2"};!function(e,t){e.ui={formatString:function(e,n,o){for(var s=e.split(/\{\{([^}]+)\}\}/),r=s.length,a="",i=0;a+=s[i++],!(i>=r);++i){var l=t.path(n,s[i]);a+=null!=l?l:"function"==typeof o?o(s[i]):"string"==typeof o?o:""}return a},formatNumber:function(e,t){return t<1&&(t=parseInt(1/t)),Math.round(e*t)/t},formatUnits:function(e){return e.toString().replace(/(^|\W)u(\w)/g,"$1&#x00B5;$2").replace(/\^\(?([\-\d]+)\)?/g,"<sup>$1</sup>").replace(/ /g,"&nbsp;")},addParameter:function(e,t){return e+(-1=="&?".indexOf(e.charAt(e.length-1))?e.indexOf("?")>0?"&":"?":"")+t},removeParameter:function(e,t){return e.replace(new RegExp("(.*?.*)("+t+"=[^&s$]*&?)(.*)"),"$1$3")},parseURL:function(e){var t=document.createElement("a");return t.href=e,{source:e,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:function(){for(var e,n,o,s={},r=t.search.replace(/^\?/,"").split("&"),a=r.length,i=0;i<a;i++)r[i]&&(n=(e=r[i].split("=")).length>1?decodeURIComponent(e[1].replace(/\+/g," ")):"",e[0].indexOf("[]")==e[0].length-2?(o=s[e[0].slice(0,-2)])===undefined?s[e[0].slice(0,-2)]=[n]:o.push(n):s[e[0]]=n);return s}(),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}},modifyURL:function(e,t,n){var o,s,r=document.createElement("a"),a=n?t+"="+encodeURIComponent(n):"";if(r.href=e,o=(s=r.search).match(new RegExp(t+"=[\\S^&]+")))s=s.replace(o[0],a);else{if(!a)return;"?"==s.charAt(0)?s="?"+a:s+=("&"==s.slice(-1)?"":"&")+a}return r.search=s,r.href},escapeHTML:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}},e.Translation=function(e){t.extend(!0,this,e)},e.Translation.prototype={__expects:["translateResponse"],init:function(){t.pass(this,e.Translation,"init")},parseResponse:function(n,o){t.pass(this,e.Translation,"parseResponse");var s=this.translateResponse(n,o),r=this;t.each(this.listeners,function(e){t.act(e,e.afterTranslation,s,o,r)})}},e.RawSolrTranslation=function(e){t.extend(!0,this,t.common(e,this))},e.RawSolrTranslation.prototype={collapseRules:{study:{fields:/topcategory[_sh]*|endpointcategory[_sh]*|guidance[_sh]*|reference[_sh]*|reference_owner[_sh]*|reference_year[_sh]*|guidance[_sh]*/},composition:{fields:/CORE|COATING|CONSTITUENT|ADDITIVE|IMPURITY|FUNCTIONALISATION|DOPING/}},init:function(n){t.pass(this,e.RawSolrTranslation,"init")},translateResponse:function(e,n){for(var o=[],s=this,r=function(e,n){t.each(s.collapseRules,function(o,s){var r={};t.each(n,function(e,t){t.match(o.fields)&&(delete n[t],Array.isArray(e)&&1==e.length&&(e=e[0]),r[t]=e)}),e._extended_===undefined&&(e._extended_={}),e._extended_[s]===undefined?e._extended_[s]=[r]:e._extended_[s].push(r)}),t.each(n,function(t,n){Array.isArray(t)&&1==t.length&&(t=t[0]),e[n]=t})},a=0,i=e.response.docs.length;a<i;++a){var l=e.response.docs[a],c=e.expanded[l.s_uuid],u={};r(u,l);for(var d=0,p=c.docs.length;d<p;++d)r(u,c.docs[d]);o.push(u)}return{entries:o,stats:t.extend({},e.stats,e.responseHeader),facets:t.extend({},e.facet_counts.facet_fields||e.facets,e.facet_counts.facet_pivot),paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},e.NestedSolrTranslation=function(e){this.nestingField=e&&e.nestingField||"type_s"},e.NestedSolrTranslation.prototype={init:function(n){t.pass(this,e.NestedSolrTranslation,"init")},translateResponse:function(e,n){for(var o=e.response.docs,s=0,r=o.length;s<r;++s){var a=o[s],i={};if(a._childDocuments_){for(var l=0,c=a._childDocuments_.length;l<c;++l){var u=a._childDocuments_[l],d=u[this.nestingField];i[d]===undefined&&(i[d]=[]),i[d].push(u)}delete a._childDocuments_,a._extended_=i}}return{entries:o,stats:t.extend({},e.stats,e.responseHeader),facets:e.facets,paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},e.ModelRunning=function(e){t.extend(!0,this,e),this.models=null},e.ModelRunning.prototype={__expects:["pollTask"],algorithms:!1,forceCreate:!1,loadOnInit:!1,listFilter:null,onLoaded:null,init:function(n){t.pass(this,e.ModelRunning,"init",n),this.manager=n,this.loadOnInit&&this.queryList()},listModels:function(){var e=this;e.manager.doRequest("model",function(n,o){n&&n.model?e.models=n.model:200==o.status&&(n={model:[]}),t.act(e,e.onLoaded,n)})},listAlgorithms:function(e){var n=this,o="algorithm";e&&(o+="?search="+e),n.manager.doRequest(o,function(e,o){e&&e.algorithm?n.algorithm=e.algorithm:200==o.status&&(e={algorithm:[]}),t.act(n,n.onLoaded,e,o)})},getModel:function(e,t){var n=this,o=function(e,n){return t(e&&e.completed>-1?e.result:null,n)};n.forceCreate?n.pollTask({url:e,method:"POST"},o):n.manager.doRequest("model?algorithm="+encodeURIComponent(e),function(s,r){s||404==r.status?s&&0!=s.model.length?t(s.model[0].URI,r):n.pollTask({url:e,method:"POST"},o):t(null,r)})},runPrediction:function(n,o,s){var r=this,a=!1,i=null,l=function(e){a?s(null,e):r.pollTask({url:o,method:"POST",data:{dataset_uri:n}},function(e,t){a=!0,e&&e.completed>-1&&i(e.result)})};i=function(e){r.manager.connector.ajax({url:e,method:"GET",dataType:"json",error:function(e){s(null,e)},success:function(e,n){if(e&&e.dataEntry&&e.dataEntry.length>0){for(var o=!0,r=0,a=e.dataEntry.length;r<a;++r)if(t.weight(e.dataEntry[r].values)>0){o=!1;break}o?l(n):s(e,n)}else l(n)}})},r.forceCreate?l():i(e.ui.addParameter(n,"feature_uris[]="+encodeURIComponent(o+"/predicted")))},queryList:function(e){this.algorithms?this.listAlgorithms(this.listFilter=e||this.listFilter):this.listModels(this.modelUri)}},e.TaskPolling=function(e){t.extend(!0,this,e),this.models=null},e.TaskPolling.prototype={pollDelay:250,pollTimeout:15e3,init:function(n){t.pass(this,e.TaskPolling,"init",n),this.manager=n},pollTask:function(e,t){var n,o,s=this,r=null;o=function(e){"string"==typeof e&&(e={url:e,method:"GET"}),e.error=function(e){t(null,e)},e.success=n,e.dataType="json",s.manager.connector.ajax(e)},n=function(e,n){null==e||null==e.task||e.task.length<1?t(e,n):(e=e.task[0]).completed>-1||e.error?t(e,n):null==r?(r=Date.now(),setTimeout(function(){o(e.result)},s.pollDelay)):Date.now()-r>s.poolTimeout?t(e,n):setTimeout(function(){o(e.result)},s.pollDelay)},o(e)}},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=jToxKit:(this.jToxKit=this.jT=t.extend({},this.jToxKit,jToxKit),"function"==typeof define&&define.amd&&define(jToxKit))}(jToxKit,asSys);