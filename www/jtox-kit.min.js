var jToxKit={version:"2.2.7"};!function(l,p,i){function Exporting(e){p.extend(!0,this,p.common(e,this)),this.manager=null}l.ui={formatString:function(e,t,n){for(var r=e.split(/\{\{([^}]+)\}\}/),a=r.length,s="",i=0;s+=r[i++],!(a<=i);++i){var o=p.path(t,r[i]);s+=null!=o?o:"function"==typeof n?n(r[i]):"string"==typeof n?n:""}return s},formatNumber:function(e,t){return t<1&&(t=parseInt(1/t)),Math.round(e*t)/t},nicifyNumber:function(e,t){if(null==e)return"";var n,r=Math.pow(10,t||9);for(t=10;t<r&&(n=Math.round(e*t),!(Math.abs(n-e*t)<.1));t*=10);return parseInt(n)/t},formatUnits:function(e){return e.toString().replace(/(^|\W)u(\w)/g,"$1&#x00B5;$2").replace(/\^\(?([\-\d]+)\)?/g,"<sup>$1</sup>").replace(/ /g,"&nbsp;")},addParameter:function(e,t){return e+(-1=="&?".indexOf(e.charAt(e.length-1))?0<e.indexOf("?")?"&":"?":"")+t},removeParameter:function(e,t){return e.replace(new RegExp("(.*?.*)("+t+"=[^&s$]*&?)(.*)"),"$1$3")},parseURL:function(e){var o=document.createElement("a");return{source:o.href=e,protocol:o.protocol.replace(":",""),host:o.hostname,port:o.port,query:o.search,params:function(){for(var e,t,n,r={},a=o.search.replace(/^\?/,"").split("&"),s=a.length,i=0;i<s;i++)a[i]&&(t=1<(e=a[i].split("=")).length?decodeURIComponent(e[1].replace(/\+/g," ")):"",e[0].indexOf("[]")==e[0].length-2?(n=r[e[0].slice(0,-2)])===undefined?r[e[0].slice(0,-2)]=[t]:n.push(t):r[e[0]]=t);return r}(),file:(o.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:o.hash.replace("#",""),path:o.pathname.replace(/^([^\/])/,"/$1"),relative:(o.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:o.pathname.replace(/^\//,"").split("/")}},modifyURL:function(e,t,n){var r,a,s=document.createElement("a"),i=n?t+"="+encodeURIComponent(n):"";if(s.href=e,r=(a=s.search).match(new RegExp(t+"=[\\S^&]+")))a=a.replace(r[0],i);else{if(!i)return;"?"==a.charAt(0)?a="?"+i:a+=("&"==a.slice(-1)?"":"&")+i}return s.search=a,s.href},escapeHTML:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},activateDownload:function(e,t,n,r){var a=URL.createObjectURL(t),s=!1;e?e.style.visibility="visible":(e=document.createElement("a"),s=r=!0),e.href=a,e.download=n,!0===r&&e.addEventListener("click",function(){setTimeout(function(){e.parentElement&&e.parentElement.removeChild(e),window.URL.revokeObjectURL(a)},0)}),s&&e.click()},promiseXHR:function(r){return new Promise(function(e,t){var n=new XMLHttpRequest;n.open(r.method||"GET",r.url,!0),r.headers&&Object.keys(r.headers).forEach(function(e){n.setRequestHeader(e,r.headers[e])}),"string"==typeof r.dataType&&n.setRequestHeader("Content-Type",r.dataType),Object.keys(r.settings).forEach(function(e){n[e]=r.settings[e]}),n.onreadystatechange=function(){4===n.readyState&&(0==n.status&&n.response||200<=n.status&&n.status<300?e(n.response,n.statusText,n):t(n,n.statusText,n.responseText))},n.send(r.body||r.data)})},blobFromBase64:function(e,t){return new Blob([e],{type:t})}},l.Translation=function(e){p.extend(!0,this,e)},l.Translation.prototype={__expects:["translateResponse"],init:function(){p.pass(this,l.Translation,"init")},parseResponse:function(e,t){p.pass(this,l.Translation,"parseResponse");var n=this.translateResponse(e,t),r=this;p.each(this.listeners,function(e){p.act(e,e.afterTranslation,n,t,r)})}},l.RawSolrTranslation=function(e){p.extend(!0,this,p.common(e,this))},l.RawSolrTranslation.prototype={collapseRules:{study:{fields:/topcategory[_sh]*|endpointcategory[_sh]*|guidance[_sh]*|reference[_sh]*|reference_owner[_sh]*|reference_year[_sh]*|guidance[_sh]*/},composition:{fields:/CORE|COATING|CONSTITUENT|ADDITIVE|IMPURITY|FUNCTIONALISATION|DOPING/}},init:function(e){p.pass(this,l.RawSolrTranslation,"init")},translateResponse:function(e,t){for(var n=[],r=this,a=function(a,s){p.each(r.collapseRules,function(n,e){var r={};p.each(s,function(e,t){t.match(n.fields)&&(delete s[t],Array.isArray(e)&&1==e.length&&(e=e[0]),r[t]=e)}),a._extended_===undefined&&(a._extended_={}),a._extended_[e]===undefined?a._extended_[e]=[r]:a._extended_[e].push(r)}),p.each(s,function(e,t){Array.isArray(e)&&1==e.length&&(e=e[0]),a[t]=e})},s=0,i=e.response.docs.length;s<i;++s){var o=e.response.docs[s],l=e.expanded[o.s_uuid],u={};a(u,o);for(var c=0,d=l.docs.length;c<d;++c)a(u,l.docs[c]);n.push(u)}return{entries:n,stats:p.extend({},e.stats,e.responseHeader),facets:p.extend({},e.facet_counts.facet_fields||e.facets,e.facet_counts.facet_pivot),paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},l.NestedSolrTranslation=function(e){this.nestingField=e&&e.nestingField||"type_s"},l.NestedSolrTranslation.prototype={init:function(e){p.pass(this,l.NestedSolrTranslation,"init")},translateResponse:function(e,t){for(var n=e.response.docs,r=0,a=n.length;r<a;++r){var s=n[r],i={};if(s._childDocuments_){for(var o=0,l=s._childDocuments_.length;o<l;++o){var u=s._childDocuments_[o],c=u[this.nestingField];i[c]===undefined&&(i[c]=[]),i[c].push(u)}delete s._childDocuments_,s._extended_=i}}return{entries:n,stats:p.extend({},e.stats,e.responseHeader),facets:e.facets,paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},l.ModelRunning=function(e){p.extend(!0,this,e),this.models=null},l.ModelRunning.prototype={__expects:["pollTask"],algorithms:!1,forceCreate:!1,loadOnInit:!1,listFilter:null,onLoaded:null,init:function(e){p.pass(this,l.ModelRunning,"init",e),this.manager=e,this.loadOnInit&&this.queryList()},listModels:function(){var n=this;n.manager.doRequest("model",function(e,t){e&&e.model?n.models=e.model:200==t.status&&(e={model:[]}),p.act(n,n.onLoaded,e)})},listAlgorithms:function(e){var n=this,t="algorithm";e&&(t+="?search="+e),n.manager.doRequest(t,function(e,t){e&&e.algorithm?n.algorithm=e.algorithm:200==t.status&&(e={algorithm:[]}),p.act(n,n.onLoaded,e,t)})},getModel:function(n,r){var a=this,s=function(e,t){return r(e&&-1<e.completed?e.result:null,t)};a.forceCreate?a.pollTask({url:n,method:"POST"},s):a.manager.doRequest("model?algorithm="+encodeURIComponent(n),function(e,t){e||404==t.status?e&&0!=e.model.length?r(e.model[0].URI,t):a.pollTask({url:n,method:"POST"},s):r(null,t)})},runPrediction:function(t,n,s){var r=this,a=!1,i=null,o=function(e){a?s(null,e):r.pollTask({url:n,method:"POST",data:{dataset_uri:t}},function(e,t){a=!0,e&&-1<e.completed&&i(e.result)})};i=function(e){r.manager.connector.ajax({url:e,method:"GET",dataType:"json",error:function(e){s(null,e)},success:function(e,t){if(e&&e.dataEntry&&0<e.dataEntry.length){for(var n=!0,r=0,a=e.dataEntry.length;r<a;++r)if(0<p.weight(e.dataEntry[r].values)){n=!1;break}n?o(t):s(e,t)}else o(t)}})},r.forceCreate?o():i(l.ui.addParameter(t,"feature_uris[]="+encodeURIComponent(n+"/predicted")))},queryList:function(e){this.algorithms?this.listAlgorithms(this.listFilter=e||this.listFilter):this.listModels(this.modelUri)}},l.TaskPolling=function(e){p.extend(!0,this,e),this.models=null},l.TaskPolling.prototype={pollDelay:250,pollTimeout:15e3,init:function(e){p.pass(this,l.TaskPolling,"init",e),this.manager=e},pollTask:function(e,n){var t,r,a=this,s=null;r=function(e){"string"==typeof e&&(e={url:e,method:"GET"}),e.error=function(e){n(null,e)},e.success=t,e.dataType="json",a.manager.connector.ajax(e)},t=function(e,t){null==e||null==e.task||e.task.length<1||-1<(e=e.task[0]).completed||e.error?n(e,t):null==s?(s=Date.now(),setTimeout(function(){r(e.result)},a.pollDelay)):Date.now()-s>a.poolTimeout?n(e,t):setTimeout(function(){r(e.result)},a.pollDelay)},r(e)}},Exporting.prototype={__expects:["addParameter","prepareQuery"],useJson:!1,expectJson:!1,servlet:null,exportDefinition:{extraParams:[],defaultFilter:null,manualFilter:!1,inheritDomain:!0,domain:"",fieldsRegExp:null,idField:"id"},init:function(e){p.pass(this,Exporting,"init",e),this.manager=e,this.servlet=this.servlet||e.servlet||"select",this.fqName=this.useJson?"json.filter":"fq"},transformParameter:function(e,t){var n={value:e.value,name:t||e.name};return this.exportDefinition.inheritDomain&&e.domain&&"parent"==e.domain.type&&(this.exportDefinition.domain?e.value&&!e.value.match(this.exportDefinition.fieldsRegExp)||(n.domain=this.exportDefinition.domain):n.domain=e.domain),n},prepareFilters:function(e){for(var t=[],n=this.manager.getParameter(this.expectJson?"json.filter":"fq"),r=0,a=n.length;r<a;r++){var s=n[r];this.exportDefinition.manualFilter||this.addParameter(this.transformParameter(s,this.fqName)),t.push(i.stringifyValue(s))}return this.exportDefinition.manualFilter||(this.addParameter(this.transformParameter(this.manager.getParameter("q"))),e&&this.addParameter(this.fqName,this.exportDefinition.idField+":("+e.join(" ")+")")),t},prepareExport:function(e,t){for(var n=this.prepareFilters(t),r=1<n.length?"("+n.join(" AND ")+")":0<n.length?n[0]:this.exportDefinition.defaultFilter,a=r.replace(/"|\\/g,"\\$&"),s=0,i=(e=(e||[]).concat(this.exportDefinition.extraParams||[])).length;s<i;++s){var o=this.transformParameter(e[s]);"string"==typeof o.value&&(o.value=o.value.replace("{{filter}}",r).replace("{{filter-escaped}}",a)),this.addParameter(o)}return this},getAjax:function(e,t){var n=e+this.servlet,r=p.extend({},this.manager.ajaxSettings,t,this.prepareQuery());return 0<n.indexOf("?")&&r.url&&r.url.startsWith("?")&&(r.url="&"+r.url.substr(1)),r.url=n+(r.url||""),r}},l.Exporting=Exporting,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=jToxKit:(this.jToxKit=this.jT=p.extend({},this.jToxKit,jToxKit),"function"==typeof define&&define.amd&&define(jToxKit))}(jToxKit,asSys,Solr);