var jToxKit={version:"2.4.0"};!function(l,p,o){function Exporting(e){p.extend(!0,this,p.common(e,this)),this.manager=null}(l=p.extend(l,{templateRegExp:/\{\{([^}]+)\}\}/,formatString:function(e,t,n){for(var r=e.split(l.templateRegExp),i=r.length,a="",o=0;a+=r[o++],!(i<=o);++o){var s=_.get(t,_.trim(r[o]),null);a+=null!=s?s:"function"==typeof n?n(r[o]):"string"==typeof n?n:""}return a},nicifyNumber:function(e,t){if(null==e)return"";var n,r=Math.pow(10,t||9);for(t=10;t<r&&(n=Math.round(e*t),!(Math.abs(n-e*t)<.1));t*=10);return parseInt(n)/t},formatUnits:function(e){return e?e.toString().replace(/(^|\W)u(\w)/g,"$1&#x00B5;$2").replace(/\^\(?([\-\d]+)\)?/g,"<sup>$1</sup>").replace(/ /g,"&nbsp;"):""},valueAndUnits:function(e,t,n){var r="";return null!=e&&(r+=(e="string"==typeof e?_.trim(e):l.nicifyNumber(e,n).toString()).replace(/ /g,"&nbsp;"),r+=l.formatUnits(t)),r},addParameter:function(e,t){return e+(-1=="&?".indexOf(e.charAt(e.length-1))?0<e.indexOf("?")?"&":"?":"")+t},removeParameter:function(e,t){return e.replace(new RegExp("(.*?.*)("+t+"=[^&s$]*&?)(.*)"),"$1$3")},parseURL:function(e){var s=document.createElement("a");return{source:s.href=e,protocol:s.protocol.replace(":",""),host:s.hostname,port:s.port,query:s.search,params:function(){for(var e,t,n,r={},i=s.search.replace(/^\?/,"").split("&"),a=i.length,o=0;o<a;o++)i[o]&&(t=1<(e=i[o].split("=")).length?decodeURIComponent(e[1].replace(/\+/g," ")):"",e[0].indexOf("[]")==e[0].length-2?(n=r[e[0].slice(0,-2)])===undefined?r[e[0].slice(0,-2)]=[t]:n.push(t):r[e[0]]=t);return r}(),file:(s.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:s.hash.replace("#",""),path:s.pathname.replace(/^([^\/])/,"/$1"),relative:(s.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:s.pathname.replace(/^\//,"").split("/")}},modifyURL:function(e,t,n){var r,i,a=document.createElement("a"),o=n?t+"="+encodeURIComponent(n):"";if(a.href=e,r=(i=a.search).match(new RegExp(t+"=[\\S^&]+")))i=i.replace(r[0],o);else{if(!o)return;"?"==i.charAt(0)?i="?"+o:i+=("&"==i.slice(-1)?"":"&")+o}return a.search=i,a.href},fixBaseUrl:function(e){return e&&"/"!=e.charAt(e.length-1)&&(e+="/"),e},formBaseUrl:function(e){var t=(t=e.match(/^((http[s]?|ftp):\/)?\/?([^:\/\s]+)(:\d+)?(\/\w+)/))&&t[0]+"/";return console.log("Deduced base URL: "+t+" (from: "+e+")"),t},copyToClipboard:function(e,t){t=t||"Press Ctrl-C (Command-C) to copy and then Enter.",window.prompt(t,e)},fireCallback:function(e,t){$.isArray(e)||(e=[e]);for(var n=!0,r=0,i=e.length;r<i;++r){var a=e[r];"function"!=typeof a&&(a=window[a]),n="function"==typeof a?a.apply(t!==undefined&&null!=t?t:document,Array.prototype.slice.call(arguments,2)):undefined}return n},validateForm:function(e,t){t=t||function(){if("checkValidity"in this)return this.checkValidity();var e=0<this.value.length;return e||(this.placeholder="You need to fill this box"),e};var n=!0;return $("input,textarea,select",e).each(function(){n=n&&!!t.call(this)}),n},activateDownload:function(e,t,n,r){var i=URL.createObjectURL(t),a=!1;e?e.style.visibility="visible":(e=document.createElement("a"),a=r=!0),e.href=i,e.download=n,!0===r&&e.addEventListener("click",function(){setTimeout(function(){e.parentElement&&e.parentElement.removeChild(e),window.URL.revokeObjectURL(i)},0)}),a&&e.click()},promiseXHR:function(r){var i=function(t,n){n&&Object.keys(n).forEach(function(e){t[e]=n[e]})};return new Promise(function(e,t){var n=new XMLHttpRequest;n.open(r.method||"GET",r.url,!0),Object.keys(r.headers||{}).forEach(function(e){n.setRequestHeader(e,r.headers[e])}),"string"==typeof r.dataType&&n.setRequestHeader("Content-Type",r.dataType),i(n,r.settings),i(n,r.xhrFields),n.onreadystatechange=function(){4===n.readyState&&(0==n.status&&n.response||200<=n.status&&n.status<300?e(n.response,n.statusText,n):t(n,n.statusText,n.responseText))},n.send(r.body||r.data)})},blobFromBase64:function(e,t){return new Blob([e],{type:t})}})).Translation=function(e){p.extend(!0,this,e)},l.Translation.prototype={__expects:["translateResponse"],init:function(){p.pass(this,l.Translation,"init")},parseResponse:function(e,t){p.pass(this,l.Translation,"parseResponse");var n=this.translateResponse(e,t),r=this;p.each(this.listeners,function(e){p.act(e,e.afterTranslation,n,t,r)})}},l.RawSolrTranslation=function(e){p.extend(!0,this,p.common(e,this))},l.RawSolrTranslation.prototype={collapseRules:{study:{fields:/topcategory[_sh]*|endpointcategory[_sh]*|guidance[_sh]*|reference[_sh]*|reference_owner[_sh]*|reference_year[_sh]*|guidance[_sh]*/},composition:{fields:/CORE|COATING|CONSTITUENT|ADDITIVE|IMPURITY|FUNCTIONALISATION|DOPING/}},init:function(e){p.pass(this,l.RawSolrTranslation,"init")},translateResponse:function(e,t){for(var n=[],r=this,i=function(i,a){p.each(r.collapseRules,function(n,e){var r={};p.each(a,function(e,t){t.match(n.fields)&&(delete a[t],Array.isArray(e)&&1==e.length&&(e=e[0]),r[t]=e)}),i._extended_===undefined&&(i._extended_={}),i._extended_[e]===undefined?i._extended_[e]=[r]:i._extended_[e].push(r)}),p.each(a,function(e,t){Array.isArray(e)&&1==e.length&&(e=e[0]),i[t]=e})},a=0,o=e.response.docs.length;a<o;++a){var s=e.response.docs[a],l=e.expanded[s.s_uuid],u={};i(u,s);for(var c=0,d=l.docs.length;c<d;++c)i(u,l.docs[c]);n.push(u)}return{entries:n,stats:p.extend({},e.stats,e.responseHeader),facets:p.extend({},e.facet_counts.facet_fields||e.facets,e.facet_counts.facet_pivot),paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},l.NestedSolrTranslation=function(e){this.nestingField=e&&e.nestingField||"type_s"},l.NestedSolrTranslation.prototype={init:function(e){p.pass(this,l.NestedSolrTranslation,"init")},translateResponse:function(e,t){for(var n=e.response.docs,r=0,i=n.length;r<i;++r){var a=n[r],o={};if(a._childDocuments_){for(var s=0,l=a._childDocuments_.length;s<l;++s){var u=a._childDocuments_[s],c=u[this.nestingField];o[c]===undefined&&(o[c]=[]),o[c].push(u)}delete a._childDocuments_,a._extended_=o}}return{entries:n,stats:p.extend({},e.stats,e.responseHeader),facets:e.facets,paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},l.ModelRunning=function(e){p.extend(!0,this,e),this.models=null},l.ModelRunning.prototype={__expects:["pollTask"],algorithms:!1,forceCreate:!1,loadOnInit:!1,listFilter:null,onLoaded:null,init:function(e){p.pass(this,l.ModelRunning,"init",e),this.manager=e,this.loadOnInit&&this.queryList()},listModels:function(){var n=this;n.manager.doRequest("model",function(e,t){e&&e.model?n.models=e.model:200==t.status&&(e={model:[]}),p.act(n,n.onLoaded,e)})},listAlgorithms:function(e){var n=this,t="algorithm";e&&(t+="?search="+e),n.manager.doRequest(t,function(e,t){e&&e.algorithm?n.algorithm=e.algorithm:200==t.status&&(e={algorithm:[]}),p.act(n,n.onLoaded,e,t)})},getModel:function(n,r){var i=this,a=function(e,t){return r(e&&-1<e.completed?e.result:null,t)};i.forceCreate?i.pollTask({url:n,method:"POST"},a):i.manager.doRequest("model?algorithm="+encodeURIComponent(n),function(e,t){e||404==t.status?e&&0!=e.model.length?r(e.model[0].URI,t):i.pollTask({url:n,method:"POST"},a):r(null,t)})},runPrediction:function(t,n,a){var r=this,i=!1,o=null,s=function(e){i?a(null,e):r.pollTask({url:n,method:"POST",data:{dataset_uri:t}},function(e,t){i=!0,e&&-1<e.completed&&o(e.result)})},o=function(e){r.manager.connector.ajax({url:e,method:"GET",dataType:"json",error:function(e){a(null,e)},success:function(e,t){if(e&&e.dataEntry&&0<e.dataEntry.length){for(var n=!0,r=0,i=e.dataEntry.length;r<i;++r)if(0<p.weight(e.dataEntry[r].values)){n=!1;break}n?s(t):a(e,t)}else s(t)}})};r.forceCreate?s():o(l.addParameter(t,"feature_uris[]="+encodeURIComponent(n+"/predicted")))},queryList:function(e){this.algorithms?this.listAlgorithms(this.listFilter=e||this.listFilter):this.listModels(this.modelUri)}},l.TaskPolling=function(e){p.extend(!0,this,e),this.models=null},l.TaskPolling.prototype={pollDelay:250,pollTimeout:15e3,init:function(e){p.pass(this,l.TaskPolling,"init",e),this.manager=e},pollTask:function(e,n){var r=this,i=null,a=function(e){"string"==typeof e&&(e={url:e,method:"GET"}),e.error=function(e){n(null,e)},e.success=t,e.dataType="json",r.manager.connector.ajax(e)},t=function(e,t){null==e||null==e.task||e.task.length<1||-1<(e=e.task[0]).completed||e.error?n(e,t):null==i?(i=Date.now(),setTimeout(function(){a(e.result)},r.pollDelay)):Date.now()-i>r.poolTimeout?n(e,t):setTimeout(function(){a(e.result)},r.pollDelay)};a(e)}},Exporting.prototype={__expects:["addParameter","prepareQuery"],useJson:!1,expectJson:!1,servlet:null,exportDefinition:{extraParams:[],defaultFilter:null,manualFilter:!1,inheritDomain:!0,domain:"",fieldsRegExp:null,idField:"id"},init:function(e){p.pass(this,Exporting,"init",e),this.manager=e,this.servlet=this.servlet||e.servlet||"select",this.fqName=this.useJson?"json.filter":"fq"},transformParameter:function(e,t){var n={value:e.value,name:t||e.name};return this.exportDefinition.inheritDomain&&e.domain&&"parent"==e.domain.type&&(this.exportDefinition.domain?e.value&&!e.value.match(this.exportDefinition.fieldsRegExp)||(n.domain=this.exportDefinition.domain):n.domain=e.domain),n},prepareFilters:function(e){for(var t=[],n=this.manager.getParameter(this.expectJson?"json.filter":"fq"),r=0,i=n.length;r<i;r++){var a=n[r];this.exportDefinition.manualFilter||this.addParameter(this.transformParameter(a,this.fqName)),t.push(o.stringifyValue(a))}return this.exportDefinition.manualFilter||(this.addParameter(this.transformParameter(this.manager.getParameter("q"))),e&&this.addParameter(this.fqName,this.exportDefinition.idField+":("+e.join(" ")+")")),t},prepareExport:function(e,t){for(var n=this.prepareFilters(t),r=1<n.length?"("+n.join(" AND ")+")":0<n.length?n[0]:this.exportDefinition.defaultFilter,i=r.replace(/"|\\/g,"\\$&"),a=0,o=(e=(e||[]).concat(this.exportDefinition.extraParams||[])).length;a<o;++a){var s=this.transformParameter(e[a]);"string"==typeof s.value&&(s.value=s.value.replace("{{filter}}",r).replace("{{filter-escaped}}",i)),this.addParameter(s)}return this},getAjax:function(e,t){var n=e+this.servlet,r=p.extend({},this.manager.ajaxSettings,t,this.prepareQuery());return 0<n.indexOf("?")&&r.url&&r.url.startsWith("?")&&(r.url="&"+r.url.substr(1)),r.url=n+(r.url||""),r}},l.Exporting=Exporting,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=jToxKit:(this.jToxKit=this.jT=p.extend({},this.jToxKit,jToxKit),"function"==typeof define&&define.amd&&define(jToxKit))}(jToxKit,asSys,Solr);