var jToxKit={version:"2.2.3"};!function(a,d,r){function Exporting(e){d.extend(!0,this,d.common(e,this)),this.manager=null}a.ui={formatString:function(e,t,n){for(var i=e.split(/\{\{([^}]+)\}\}/),s=i.length,r="",o=0;r+=i[o++],!(s<=o);++o){var a=d.path(t,i[o]);r+=null!=a?a:"function"==typeof n?n(i[o]):"string"==typeof n?n:""}return r},formatNumber:function(e,t){return t<1&&(t=parseInt(1/t)),Math.round(e*t)/t},formatUnits:function(e){return e.toString().replace(/(^|\W)u(\w)/g,"$1&#x00B5;$2").replace(/\^\(?([\-\d]+)\)?/g,"<sup>$1</sup>").replace(/ /g,"&nbsp;")},addParameter:function(e,t){return e+(-1=="&?".indexOf(e.charAt(e.length-1))?0<e.indexOf("?")?"&":"?":"")+t},removeParameter:function(e,t){return e.replace(new RegExp("(.*?.*)("+t+"=[^&s$]*&?)(.*)"),"$1$3")},parseURL:function(e){var a=document.createElement("a");return{source:a.href=e,protocol:a.protocol.replace(":",""),host:a.hostname,port:a.port,query:a.search,params:function(){for(var e,t,n,i={},s=a.search.replace(/^\?/,"").split("&"),r=s.length,o=0;o<r;o++)s[o]&&(t=1<(e=s[o].split("=")).length?decodeURIComponent(e[1].replace(/\+/g," ")):"",e[0].indexOf("[]")==e[0].length-2?(n=i[e[0].slice(0,-2)])===undefined?i[e[0].slice(0,-2)]=[t]:n.push(t):i[e[0]]=t);return i}(),file:(a.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:a.hash.replace("#",""),path:a.pathname.replace(/^([^\/])/,"/$1"),relative:(a.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:a.pathname.replace(/^\//,"").split("/")}},modifyURL:function(e,t,n){var i,s,r=document.createElement("a"),o=n?t+"="+encodeURIComponent(n):"";if(r.href=e,i=(s=r.search).match(new RegExp(t+"=[\\S^&]+")))s=s.replace(i[0],o);else{if(!o)return;"?"==s.charAt(0)?s="?"+o:s+=("&"==s.slice(-1)?"":"&")+o}return r.search=s,r.href},escapeHTML:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},activateDownload:function(e,t,n,i,s){var r=URL.createObjectURL(t);e.style.visibility="visible",e.href=r,e.download=n,e.innerHTML=i,!0===s&&e.addEventListener("click",function(){setTimeout(function(){e.parentNode.removeChild(e),window.URL.revokeObjectURL(r)},0)})},blobFromBase64:function(e,t){return new Blob([e],{type:t})}},a.Translation=function(e){d.extend(!0,this,e)},a.Translation.prototype={__expects:["translateResponse"],init:function(){d.pass(this,a.Translation,"init")},parseResponse:function(e,t){d.pass(this,a.Translation,"parseResponse");var n=this.translateResponse(e,t),i=this;d.each(this.listeners,function(e){d.act(e,e.afterTranslation,n,t,i)})}},a.RawSolrTranslation=function(e){d.extend(!0,this,d.common(e,this))},a.RawSolrTranslation.prototype={collapseRules:{study:{fields:/topcategory[_sh]*|endpointcategory[_sh]*|guidance[_sh]*|reference[_sh]*|reference_owner[_sh]*|reference_year[_sh]*|guidance[_sh]*/},composition:{fields:/CORE|COATING|CONSTITUENT|ADDITIVE|IMPURITY|FUNCTIONALISATION|DOPING/}},init:function(e){d.pass(this,a.RawSolrTranslation,"init")},translateResponse:function(e,t){function da(s,r){d.each(i.collapseRules,function(n,e){var i={};d.each(r,function(e,t){t.match(n.fields)&&(delete r[t],Array.isArray(e)&&1==e.length&&(e=e[0]),i[t]=e)}),s._extended_===undefined&&(s._extended_={}),s._extended_[e]===undefined?s._extended_[e]=[i]:s._extended_[e].push(i)}),d.each(r,function(e,t){Array.isArray(e)&&1==e.length&&(e=e[0]),s[t]=e})}for(var n=[],i=this,s=0,r=e.response.docs.length;s<r;++s){var o=e.response.docs[s],a=e.expanded[o.s_uuid],l={};da(l,o);for(var u=0,c=a.docs.length;u<c;++u)da(l,a.docs[u]);n.push(l)}return{entries:n,stats:d.extend({},e.stats,e.responseHeader),facets:d.extend({},e.facet_counts.facet_fields||e.facets,e.facet_counts.facet_pivot),paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},a.NestedSolrTranslation=function(e){this.nestingField=e&&e.nestingField||"type_s"},a.NestedSolrTranslation.prototype={init:function(e){d.pass(this,a.NestedSolrTranslation,"init")},translateResponse:function(e,t){for(var n=e.response.docs,i=0,s=n.length;i<s;++i){var r=n[i],o={};if(r._childDocuments_){for(var a=0,l=r._childDocuments_.length;a<l;++a){var u=r._childDocuments_[a],c=u[this.nestingField];o[c]===undefined&&(o[c]=[]),o[c].push(u)}delete r._childDocuments_,r._extended_=o}}return{entries:n,stats:d.extend({},e.stats,e.responseHeader),facets:e.facets,paging:{start:e.response.start,count:e.response.docs.length,total:e.response.numFound,pageSize:parseInt(e.responseHeader.params.rows)}}}},a.ModelRunning=function(e){d.extend(!0,this,e),this.models=null},a.ModelRunning.prototype={__expects:["pollTask"],algorithms:!1,forceCreate:!1,loadOnInit:!1,listFilter:null,onLoaded:null,init:function(e){d.pass(this,a.ModelRunning,"init",e),this.manager=e,this.loadOnInit&&this.queryList()},listModels:function(){var n=this;n.manager.doRequest("model",function(e,t){e&&e.model?n.models=e.model:200==t.status&&(e={model:[]}),d.act(n,n.onLoaded,e)})},listAlgorithms:function(e){var n=this,t="algorithm";e&&(t+="?search="+e),n.manager.doRequest(t,function(e,t){e&&e.algorithm?n.algorithm=e.algorithm:200==t.status&&(e={algorithm:[]}),d.act(n,n.onLoaded,e,t)})},getModel:function(n,i){function Ua(e,t){return i(e&&-1<e.completed?e.result:null,t)}var s=this;s.forceCreate?s.pollTask({url:n,method:"POST"},Ua):s.manager.doRequest("model?algorithm="+encodeURIComponent(n),function(e,t){e||404==t.status?e&&0!=e.model.length?i(e.model[0].URI,t):s.pollTask({url:n,method:"POST"},Ua):i(null,t)})},runPrediction:function(t,n,r){function db(e){s?r(null,e):i.pollTask({url:n,method:"POST",data:{dataset_uri:t}},function(e,t){s=!0,e&&-1<e.completed&&o(e.result)})}var i=this,s=!1,o=null;o=function(e){i.manager.connector.ajax({url:e,method:"GET",dataType:"json",error:function(e){r(null,e)},success:function(e,t){if(e&&e.dataEntry&&0<e.dataEntry.length){for(var n=!0,i=0,s=e.dataEntry.length;i<s;++i)if(0<d.weight(e.dataEntry[i].values)){n=!1;break}n?db(t):r(e,t)}else db(t)}})},i.forceCreate?db():o(a.ui.addParameter(t,"feature_uris[]="+encodeURIComponent(n+"/predicted")))},queryList:function(e){this.algorithms?this.listAlgorithms(this.listFilter=e||this.listFilter):this.listModels(this.modelUri)}},a.TaskPolling=function(e){d.extend(!0,this,e),this.models=null},a.TaskPolling.prototype={pollDelay:250,pollTimeout:15e3,init:function(e){d.pass(this,a.TaskPolling,"init",e),this.manager=e},pollTask:function(e,n){var t,i,s=this,r=null;i=function(e){"string"==typeof e&&(e={url:e,method:"GET"}),e.error=function(e){n(null,e)},e.success=t,e.dataType="json",s.manager.connector.ajax(e)},t=function(e,t){null==e||null==e.task||e.task.length<1?n(e,t):-1<(e=e.task[0]).completed||e.error?n(e,t):null==r?(r=Date.now(),setTimeout(function(){i(e.result)},s.pollDelay)):Date.now()-r>s.poolTimeout?n(e,t):setTimeout(function(){i(e.result)},s.pollDelay)},i(e)}},Exporting.prototype={useJson:null,servlet:null,exportDefinition:{extraParams:[],defaultFilter:null,fields:"",domain:"",fieldsRegExp:null},idField:"id",selectedIds:null,init:function(e){d.pass(this,Exporting,"init",e),this.manager=e,this.servlet=this.servlet||e.servlet||"select",null===this.useJson&&(this.useJson=e.useJson),this.fqName=this.useJson?"json.filter":"fq"},makeParameter:function(e,t){var n={value:e.value,name:t||e.name};return e.domain&&"parent"==e.domain.type&&(this.exportDefinition.domain?e.value&&!e.value.match(this.exportDefinition.fieldsRegExp)||(n.domain=this.exportDefinition.domain):n.domain=e.domain),n},prepareFilters:function(){var e=[],t=this.manager.getParameter(this.fqName);this.innerParams=[];for(var n=0,i=t.length;n<i;n++){var s=t[n];e.push(r.stringifyParameter(this.makeParameter(s,"fq"))),this.innerParams.push(r.stringifyValue(s).replace(/"|\\/g,"\\$&"))}return e.push(r.stringifyParameter(this.makeParameter(this.manager.getParameter("q")))||"*:*"),e},prepareExport:function(e,t){var n=this.prepareFilters().concat(t,this.exportDefinition.extraParams||[]),i=1<this.innerParams.length?"("+this.innerParams.join(" AND ")+")":0<this.innerParams.length?this.innerParams[0]:this.exportDefinition.defaultFilter;return this.selectedIds&&n.push("fq="+encodeURIComponent(this.idField+":("+this.selectedIds.join(" ")+")")),this.exportDefinition.extraParams&&Array.prototype.push.apply(n,this.exportDefinition.extraParams),n.push("fl="+encodeURIComponent(this.exportDefinition.fields.replace("{{filter}}",i))),this.exportURL=e+this.servlet+"?"+n.join("&")},doRequest:function(e){this.manager.doRequest(e)}},a.Exporting=Exporting,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=jToxKit:(this.jToxKit=this.jT=d.extend({},this.jToxKit,jToxKit),"function"==typeof define&&define.amd&&define(jToxKit))}(jToxKit,asSys,Solr);